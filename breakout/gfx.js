import * as glu from "../shared/glu.js";
import * as geo from "../shared/geo3d.js";
import * as array from "../shared/array.js";
const vertexSrc = `#version 300 es
precision mediump float;
uniform mat4 world_matrix;
uniform mat4 view_matrix;
uniform mat4 projection_matrix;
in vec3 vert_position;
in vec3 vert_normal;
in vec4 vert_color;
out vec3 frag_normal;
out vec4 frag_color;

void main() {
    frag_color = vert_color;
    frag_normal - vert_normal;
    gl_Position = projection_matrix * view_matrix * world_matrix * vec4(vert_position, 1.f);
}`;
const fragmentSrc = `#version 300 es
precision highp float;
precision highp sampler2D;
precision highp sampler2DArray;

in vec4 frag_color;
in vec3 frag_normal;
out vec4 out_color;

void main() {
    out_color = frag_color;
}`;
const elemsPerVertex = 10;
const vertexStride = elemsPerVertex * 4;
export class Renderer {
    constructor(canvas) {
        this.canvas = canvas;
        this.projectionMatrix = geo.Mat4.identity();
        this.viewMatrix = geo.Mat4.identity();
        this.batches = [];
        this.gl = glu.createContext(this.canvas);
        const gl = this.gl;
        this.program = glu.compileProgram(gl, vertexSrc, fragmentSrc);
        this.worldMatrixLoc = glu.getUniformLocation(gl, this.program, "world_matrix");
        this.viewMatrixLoc = glu.getUniformLocation(gl, this.program, "view_matrix");
        this.projectionMatrixLoc = glu.getUniformLocation(gl, this.program, "projection_matrix");
    }
    present() {
        const gl = this.gl;
        this.projectionMatrix = geo.Mat4.perspective(Math.PI / 4, gl.drawingBufferWidth / gl.drawingBufferHeight, 1, 100);
        gl.bindFramebuffer(gl.FRAMEBUFFER, null);
        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
        gl.clearColor(0, 0, 0, 1);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
        this.renderBatches();
    }
    createMesh(mesh) {
        // for now - place single triangle into vertex buffer
        const gl = this.gl;
        const vbo = glu.createBuffer(gl);
        const ibo = glu.createBuffer(gl);
        gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
        gl.bufferData(gl.ARRAY_BUFFER, toFloatArray(mesh.vertices), gl.STATIC_DRAW);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint32Array(mesh.indices), gl.STATIC_DRAW);
        return this.createVao(vbo, ibo);
    }
    drawBatch(batch) {
        this.batches.push(batch);
    }
    createVao(vbo, ibo) {
        const { gl, program } = this;
        const vao = glu.createVertexArray(gl);
        gl.bindVertexArray(vao);
        const positionAttribIdx = glu.getAttribLocation(gl, program, "vert_position");
        const normalAttribIdx = glu.getAttribLocation(gl, program, "vert_normal");
        const colorAttribIdx = glu.getAttribLocation(gl, program, "vert_color");
        gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
        gl.enableVertexAttribArray(positionAttribIdx);
        gl.enableVertexAttribArray(normalAttribIdx);
        gl.enableVertexAttribArray(colorAttribIdx);
        gl.vertexAttribPointer(positionAttribIdx, 3, gl.FLOAT, false, vertexStride, 0);
        gl.vertexAttribPointer(normalAttribIdx, 3, gl.FLOAT, false, vertexStride, 12);
        gl.vertexAttribPointer(colorAttribIdx, 4, gl.FLOAT, false, vertexStride, 24);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
        return vao;
    }
    renderBatches() {
        const gl = this.gl;
        gl.useProgram(this.program);
        gl.uniformMatrix4fv(this.projectionMatrixLoc, false, this.projectionMatrix.toArray());
        gl.uniformMatrix4fv(this.viewMatrixLoc, false, this.viewMatrix.toArray());
        for (const batch of this.batches) {
            gl.uniformMatrix4fv(this.worldMatrixLoc, false, batch.worldMatrix.toArray());
            gl.bindVertexArray(batch.vao);
            gl.drawElements(gl.TRIANGLES, batch.numIndices, gl.UNSIGNED_INT, batch.offset);
        }
        this.batches = [];
    }
}
function toFloatArray(vertices) {
    const a = new Float32Array(vertices.flatMap(v => [
        v.position.x, v.position.y, v.position.z,
        v.normal.x, v.normal.y, v.normal.z,
        v.color.x, v.color.y, v.color.z, v.color.w
    ]));
    return a;
}
export function cube() {
    // -x, +x, -y, +y, -z, +z
    const vertices = new Array(
    // -x
    { position: new geo.Vec3(-1, -1, -1), normal: new geo.Vec3(-1, 0, 0), color: new geo.Vec4(1, 0, 0, 1) }, { position: new geo.Vec3(-1, -1, 1), normal: new geo.Vec3(-1, 0, 0), color: new geo.Vec4(1, 0, 0, 1) }, { position: new geo.Vec3(-1, 1, 1), normal: new geo.Vec3(-1, 0, 0), color: new geo.Vec4(1, 0, 0, 1) }, { position: new geo.Vec3(-1, 1, -1), normal: new geo.Vec3(-1, 0, 0), color: new geo.Vec4(1, 0, 0, 1) }, 
    // +x
    { position: new geo.Vec3(1, -1, 1), normal: new geo.Vec3(1, 0, 0), color: new geo.Vec4(0, 1, 0, 1) }, { position: new geo.Vec3(1, -1, -1), normal: new geo.Vec3(1, 0, 0), color: new geo.Vec4(0, 1, 0, 1) }, { position: new geo.Vec3(1, 1, -1), normal: new geo.Vec3(1, 0, 0), color: new geo.Vec4(0, 1, 0, 1) }, { position: new geo.Vec3(1, 1, 1), normal: new geo.Vec3(1, 0, 0), color: new geo.Vec4(0, 1, 0, 1) }, 
    // -y
    { position: new geo.Vec3(-1, -1, 1), normal: new geo.Vec3(0, -1, 0), color: new geo.Vec4(1, 0, 0, 1) }, { position: new geo.Vec3(-1, -1, -1), normal: new geo.Vec3(0, -1, 0), color: new geo.Vec4(1, 0, 0, 1) }, { position: new geo.Vec3(1, -1, -1), normal: new geo.Vec3(0, -1, 0), color: new geo.Vec4(1, 0, 0, 1) }, { position: new geo.Vec3(1, -1, 1), normal: new geo.Vec3(0, -1, 0), color: new geo.Vec4(1, 0, 0, 1) }, 
    // +y
    { position: new geo.Vec3(-1, 1, 1), normal: new geo.Vec3(0, 1, 0), color: new geo.Vec4(0, 1, 0, 1) }, { position: new geo.Vec3(1, 1, 1), normal: new geo.Vec3(0, 1, 0), color: new geo.Vec4(0, 1, 0, 1) }, { position: new geo.Vec3(1, 1, -1), normal: new geo.Vec3(0, 1, 0), color: new geo.Vec4(0, 1, 0, 1) }, { position: new geo.Vec3(-1, 1, -1), normal: new geo.Vec3(0, 1, 0), color: new geo.Vec4(0, 1, 0, 1) }, 
    // -z
    { position: new geo.Vec3(-1, -1, -1), normal: new geo.Vec3(0, 0, -1), color: new geo.Vec4(1, 0, 0, 1) }, { position: new geo.Vec3(-1, 1, -1), normal: new geo.Vec3(0, 0, -1), color: new geo.Vec4(1, 0, 0, 1) }, { position: new geo.Vec3(1, 1, -1), normal: new geo.Vec3(0, 0, -1), color: new geo.Vec4(1, 0, 0, 1) }, { position: new geo.Vec3(1, -1, -1), normal: new geo.Vec3(0, 0, -1), color: new geo.Vec4(1, 0, 0, 1) }, 
    // +z
    { position: new geo.Vec3(-1, -1, 1), normal: new geo.Vec3(0, 0, 1), color: new geo.Vec4(0, 1, 0, 1) }, { position: new geo.Vec3(1, -1, 1), normal: new geo.Vec3(0, 0, 1), color: new geo.Vec4(0, 1, 0, 1) }, { position: new geo.Vec3(1, 1, 1), normal: new geo.Vec3(0, 0, 1), color: new geo.Vec4(0, 1, 0, 1) }, { position: new geo.Vec3(-1, 1, 1), normal: new geo.Vec3(0, 0, 1), color: new geo.Vec4(0, 1, 0, 1) });
    return {
        vertices,
        indices: quadIndices(vertices.length / 4)
    };
}
export function sphere(rows, cols) {
    // create north pole
    const vertices = new Array();
    const indices = new Array();
    const northPole = { position: new geo.Vec3(0, 1, 0), normal: new geo.Vec3(0, 1, 0), color: new geo.Vec4(1, 1, 1, 1) };
    vertices.push(northPole);
    // iterate over angles, essentially forming polar coordinates of each point
    // let theta = elevation angle above xy plane
    // let phi = xy plane angle
    const dtheta = Math.PI / (rows + 1);
    const dphi = 2 * Math.PI / cols;
    for (let j = 0; j < cols; ++j) {
        const phi = dphi * j;
        const theta = dtheta;
        const position = new geo.Vec3(Math.sin(theta) * Math.cos(phi), Math.cos(theta), Math.sin(theta) * Math.sin(phi));
        console.log(position.toString());
        vertices.push({ position: position, normal: position, color: new geo.Vec4(1, 1, 1, 1) });
        // connect to pole to form triangle
        indices.push(j + 1, (j + 1) % cols + 1, 0);
    }
    // interior
    for (let i = 1; i < rows; ++i) {
        const theta = dtheta * (i + 1);
        const prevRowOffset = (i - 1) * cols + 1;
        const rowOffset = prevRowOffset + cols;
        for (let j = 0; j < cols; ++j) {
            const phi = dphi * j;
            const position = new geo.Vec3(Math.sin(theta) * Math.cos(phi), Math.cos(theta), Math.sin(theta) * Math.sin(phi));
            vertices.push({ position: position, normal: position, color: new geo.Vec4(1, 1, 1, 1) });
            const a = prevRowOffset + j;
            const b = rowOffset + j;
            const c = rowOffset + (j + 1) % cols;
            const d = prevRowOffset + (j + 1) % cols;
            indices.push(a, b, c, a, c, d);
        }
    }
    // create south pole
    const southPole = { position: new geo.Vec3(0, -1, 0), normal: new geo.Vec3(0, -1, 0), color: new geo.Vec4(1, 1, 1, 1) };
    vertices.push(southPole);
    const southPoleIdx = vertices.length - 1;
    // connect south pole to rest of mesh
    for (let j = 0; j < cols; ++j) {
        const offset = southPoleIdx - cols;
        // connect to pole to form triangle
        indices.push(offset + j, southPoleIdx, offset + (j + 1) % cols);
    }
    return {
        vertices: vertices,
        indices: indices
    };
}
function quadIndices(quads) {
    return array.generate(quads, i => [i * 4, i * 4 + 1, i * 4 + 2, i * 4, i * 4 + 2, i * 4 + 3]).flat();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2Z4LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZ2Z4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxHQUFHLE1BQU0sa0JBQWtCLENBQUE7QUFDdkMsT0FBTyxLQUFLLEdBQUcsTUFBTSxvQkFBb0IsQ0FBQTtBQUN6QyxPQUFPLEtBQUssS0FBSyxNQUFNLG9CQUFvQixDQUFBO0FBRTNDLE1BQU0sU0FBUyxHQUFHOzs7Ozs7Ozs7Ozs7Ozs7RUFlaEIsQ0FBQTtBQUVGLE1BQU0sV0FBVyxHQUFHOzs7Ozs7Ozs7OztFQVdsQixDQUFBO0FBMEJGLE1BQU0sY0FBYyxHQUFHLEVBQUUsQ0FBQTtBQUN6QixNQUFNLFlBQVksR0FBRyxjQUFjLEdBQUcsQ0FBQyxDQUFBO0FBRXZDLE1BQU0sT0FBTyxRQUFRO0lBVWpCLFlBQTZCLE1BQXlCO1FBQXpCLFdBQU0sR0FBTixNQUFNLENBQW1CO1FBSi9DLHFCQUFnQixHQUFhLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUE7UUFDaEQsZUFBVSxHQUFhLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUE7UUFDekMsWUFBTyxHQUFZLEVBQUUsQ0FBQTtRQUd6QixJQUFJLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQ3hDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUE7UUFDbEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsY0FBYyxDQUFDLEVBQUUsRUFBRSxTQUFTLEVBQUUsV0FBVyxDQUFDLENBQUE7UUFDN0QsSUFBSSxDQUFDLGNBQWMsR0FBRyxHQUFHLENBQUMsa0JBQWtCLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsY0FBYyxDQUFDLENBQUE7UUFDOUUsSUFBSSxDQUFDLGFBQWEsR0FBRyxHQUFHLENBQUMsa0JBQWtCLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsYUFBYSxDQUFDLENBQUE7UUFDNUUsSUFBSSxDQUFDLG1CQUFtQixHQUFHLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRSxtQkFBbUIsQ0FBQyxDQUFBO0lBQzVGLENBQUM7SUFFTSxPQUFPO1FBQ1YsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQTtRQUVsQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixHQUFHLEVBQUUsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUE7UUFFakgsRUFBRSxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxDQUFBO1FBQ3hDLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsa0JBQWtCLEVBQUUsRUFBRSxDQUFDLG1CQUFtQixDQUFDLENBQUE7UUFDaEUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUN6QixFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxnQkFBZ0IsR0FBRyxFQUFFLENBQUMsZ0JBQWdCLENBQUMsQ0FBQTtRQUNuRCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUE7SUFDeEIsQ0FBQztJQUVNLFVBQVUsQ0FBQyxJQUFZO1FBQzFCLHFEQUFxRDtRQUNyRCxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFBO1FBQ2xCLE1BQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUE7UUFDaEMsTUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUNoQyxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsR0FBRyxDQUFDLENBQUE7UUFDbkMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsWUFBWSxFQUFFLFlBQVksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxDQUFDLFdBQVcsQ0FBQyxDQUFBO1FBQzNFLEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsQ0FBQyxDQUFBO1FBQzNDLEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLG9CQUFvQixFQUFFLElBQUksV0FBVyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxFQUFFLENBQUMsV0FBVyxDQUFDLENBQUE7UUFDckYsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUNuQyxDQUFDO0lBRU0sU0FBUyxDQUFDLEtBQVk7UUFDekIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDNUIsQ0FBQztJQUVPLFNBQVMsQ0FBQyxHQUFnQixFQUFFLEdBQWdCO1FBQ2hELE1BQU0sRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFBO1FBQzVCLE1BQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUNyQyxFQUFFLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBRXZCLE1BQU0saUJBQWlCLEdBQUcsR0FBRyxDQUFDLGlCQUFpQixDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsZUFBZSxDQUFDLENBQUE7UUFDN0UsTUFBTSxlQUFlLEdBQUcsR0FBRyxDQUFDLGlCQUFpQixDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsYUFBYSxDQUFDLENBQUE7UUFDekUsTUFBTSxjQUFjLEdBQUcsR0FBRyxDQUFDLGlCQUFpQixDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsWUFBWSxDQUFDLENBQUE7UUFDdkUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsWUFBWSxFQUFFLEdBQUcsQ0FBQyxDQUFBO1FBQ25DLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBO1FBQzdDLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQyxlQUFlLENBQUMsQ0FBQTtRQUMzQyxFQUFFLENBQUMsdUJBQXVCLENBQUMsY0FBYyxDQUFDLENBQUE7UUFDMUMsRUFBRSxDQUFDLG1CQUFtQixDQUFDLGlCQUFpQixFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDOUUsRUFBRSxDQUFDLG1CQUFtQixDQUFDLGVBQWUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLEVBQUUsQ0FBQyxDQUFBO1FBQzdFLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxFQUFFLENBQUMsQ0FBQTtRQUM1RSxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLENBQUMsQ0FBQTtRQUMzQyxPQUFPLEdBQUcsQ0FBQTtJQUNkLENBQUM7SUFFTyxhQUFhO1FBQ2pCLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUE7UUFDbEIsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7UUFDM0IsRUFBRSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUE7UUFDckYsRUFBRSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQTtRQUV6RSxLQUFLLE1BQU0sS0FBSyxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDOUIsRUFBRSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQTtZQUM1RSxFQUFFLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQTtZQUM3QixFQUFFLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUMsWUFBWSxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQTtTQUNqRjtRQUVELElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFBO0lBQ3JCLENBQUM7Q0FDSjtBQUVELFNBQVMsWUFBWSxDQUFDLFFBQWtCO0lBQ3BDLE1BQU0sQ0FBQyxHQUFHLElBQUksWUFBWSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUM3QyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUFDLENBQUMsQ0FBQyxDQUFBO0lBRWpELE9BQU8sQ0FBQyxDQUFBO0FBQ1osQ0FBQztBQUVELE1BQU0sVUFBVSxJQUFJO0lBQ2hCLHlCQUF5QjtJQUN6QixNQUFNLFFBQVEsR0FBRyxJQUFJLEtBQUs7SUFDdEIsS0FBSztJQUNMLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFDdkcsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFDdEcsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQ3JHLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFO0lBQ3RHLEtBQUs7SUFDTCxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQ3BHLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUNyRyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQ3BHLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFO0lBQ25HLEtBQUs7SUFDTCxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUN0RyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQ3ZHLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQ3RHLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRTtJQUNyRyxLQUFLO0lBQ0wsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUNwRyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUNuRyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQ3BHLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRTtJQUNyRyxLQUFLO0lBQ0wsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUN2RyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUN0RyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFDckcsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUU7SUFDdEcsS0FBSztJQUNMLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUNyRyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQ3BHLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFD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QTtBQUNMLENBQUM7QUFFRCxTQUFTLFdBQVcsQ0FBQyxLQUFhO0lBQzlCLE9BQU8sS0FBSyxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7QUFDeEcsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGdsdSBmcm9tIFwiLi4vc2hhcmVkL2dsdS5qc1wiXHJcbmltcG9ydCAqIGFzIGdlbyBmcm9tIFwiLi4vc2hhcmVkL2dlbzNkLmpzXCJcclxuaW1wb3J0ICogYXMgYXJyYXkgZnJvbSBcIi4uL3NoYXJlZC9hcnJheS5qc1wiXHJcblxyXG5jb25zdCB2ZXJ0ZXhTcmMgPSBgI3ZlcnNpb24gMzAwIGVzXHJcbnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0O1xyXG51bmlmb3JtIG1hdDQgd29ybGRfbWF0cml4O1xyXG51bmlmb3JtIG1hdDQgdmlld19tYXRyaXg7XHJcbnVuaWZvcm0gbWF0NCBwcm9qZWN0aW9uX21hdHJpeDtcclxuaW4gdmVjMyB2ZXJ0X3Bvc2l0aW9uO1xyXG5pbiB2ZWMzIHZlcnRfbm9ybWFsO1xyXG5pbiB2ZWM0IHZlcnRfY29sb3I7XHJcbm91dCB2ZWMzIGZyYWdfbm9ybWFsO1xyXG5vdXQgdmVjNCBmcmFnX2NvbG9yO1xyXG5cclxudm9pZCBtYWluKCkge1xyXG4gICAgZnJhZ19jb2xvciA9IHZlcnRfY29sb3I7XHJcbiAgICBmcmFnX25vcm1hbCAtIHZlcnRfbm9ybWFsO1xyXG4gICAgZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uX21hdHJpeCAqIHZpZXdfbWF0cml4ICogd29ybGRfbWF0cml4ICogdmVjNCh2ZXJ0X3Bvc2l0aW9uLCAxLmYpO1xyXG59YFxyXG5cclxuY29uc3QgZnJhZ21lbnRTcmMgPSBgI3ZlcnNpb24gMzAwIGVzXHJcbnByZWNpc2lvbiBoaWdocCBmbG9hdDtcclxucHJlY2lzaW9uIGhpZ2hwIHNhbXBsZXIyRDtcclxucHJlY2lzaW9uIGhpZ2hwIHNhbXBsZXIyREFycmF5O1xyXG5cclxuaW4gdmVjNCBmcmFnX2NvbG9yO1xyXG5pbiB2ZWMzIGZyYWdfbm9ybWFsO1xyXG5vdXQgdmVjNCBvdXRfY29sb3I7XHJcblxyXG52b2lkIG1haW4oKSB7XHJcbiAgICBvdXRfY29sb3IgPSBmcmFnX2NvbG9yO1xyXG59YFxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBWZXJ0ZXgge1xyXG4gICAgcG9zaXRpb246IGdlby5WZWMzXHJcbiAgICBub3JtYWw6IGdlby5WZWMzXHJcbiAgICBjb2xvcjogZ2VvLlZlYzRcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJeE1lc2gge1xyXG4gICAgdmVydGljZXM6IFZlcnRleFtdXHJcbiAgICBpbmRpY2VzOiBudW1iZXJbXVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIE1lc2hEYXRhIHtcclxuICAgIHZlcnRpY2VzOiBWZXJ0ZXhbXVxyXG4gICAgaW5kaWNlczogbnVtYmVyW11cclxuICAgIGluZGV4T2Zmc2V0OiBudW1iZXJcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBCYXRjaCB7XHJcbiAgICB3b3JsZE1hdHJpeDogZ2VvLk1hdDRcclxuICAgIHZhbzogV2ViR0xWZXJ0ZXhBcnJheU9iamVjdFxyXG4gICAgb2Zmc2V0OiBudW1iZXJcclxuICAgIG51bUluZGljZXM6IG51bWJlclxyXG59XHJcblxyXG5jb25zdCBlbGVtc1BlclZlcnRleCA9IDEwXHJcbmNvbnN0IHZlcnRleFN0cmlkZSA9IGVsZW1zUGVyVmVydGV4ICogNFxyXG5cclxuZXhwb3J0IGNsYXNzIFJlbmRlcmVyIHtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgZ2w6IFdlYkdMMlJlbmRlcmluZ0NvbnRleHRcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgcHJvZ3JhbTogV2ViR0xQcm9ncmFtXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IHdvcmxkTWF0cml4TG9jOiBXZWJHTFVuaWZvcm1Mb2NhdGlvblxyXG4gICAgcHJpdmF0ZSByZWFkb25seSB2aWV3TWF0cml4TG9jOiBXZWJHTFVuaWZvcm1Mb2NhdGlvblxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBwcm9qZWN0aW9uTWF0cml4TG9jOiBXZWJHTFVuaWZvcm1Mb2NhdGlvblxyXG4gICAgcHVibGljIHByb2plY3Rpb25NYXRyaXg6IGdlby5NYXQ0ID0gZ2VvLk1hdDQuaWRlbnRpdHkoKVxyXG4gICAgcHVibGljIHZpZXdNYXRyaXg6IGdlby5NYXQ0ID0gZ2VvLk1hdDQuaWRlbnRpdHkoKVxyXG4gICAgcHJpdmF0ZSBiYXRjaGVzOiBCYXRjaFtdID0gW11cclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmdsID0gZ2x1LmNyZWF0ZUNvbnRleHQodGhpcy5jYW52YXMpXHJcbiAgICAgICAgY29uc3QgZ2wgPSB0aGlzLmdsXHJcbiAgICAgICAgdGhpcy5wcm9ncmFtID0gZ2x1LmNvbXBpbGVQcm9ncmFtKGdsLCB2ZXJ0ZXhTcmMsIGZyYWdtZW50U3JjKVxyXG4gICAgICAgIHRoaXMud29ybGRNYXRyaXhMb2MgPSBnbHUuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsLCB0aGlzLnByb2dyYW0sIFwid29ybGRfbWF0cml4XCIpXHJcbiAgICAgICAgdGhpcy52aWV3TWF0cml4TG9jID0gZ2x1LmdldFVuaWZvcm1Mb2NhdGlvbihnbCwgdGhpcy5wcm9ncmFtLCBcInZpZXdfbWF0cml4XCIpXHJcbiAgICAgICAgdGhpcy5wcm9qZWN0aW9uTWF0cml4TG9jID0gZ2x1LmdldFVuaWZvcm1Mb2NhdGlvbihnbCwgdGhpcy5wcm9ncmFtLCBcInByb2plY3Rpb25fbWF0cml4XCIpXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHByZXNlbnQoKSB7XHJcbiAgICAgICAgY29uc3QgZ2wgPSB0aGlzLmdsXHJcblxyXG4gICAgICAgIHRoaXMucHJvamVjdGlvbk1hdHJpeCA9IGdlby5NYXQ0LnBlcnNwZWN0aXZlKE1hdGguUEkgLyA0LCBnbC5kcmF3aW5nQnVmZmVyV2lkdGggLyBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0LCAxLCAxMDApXHJcblxyXG4gICAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgbnVsbClcclxuICAgICAgICBnbC52aWV3cG9ydCgwLCAwLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGgsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQpXHJcbiAgICAgICAgZ2wuY2xlYXJDb2xvcigwLCAwLCAwLCAxKVxyXG4gICAgICAgIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQgfCBnbC5ERVBUSF9CVUZGRVJfQklUKVxyXG4gICAgICAgIHRoaXMucmVuZGVyQmF0Y2hlcygpXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNyZWF0ZU1lc2gobWVzaDogSXhNZXNoKTogV2ViR0xWZXJ0ZXhBcnJheU9iamVjdCB7XHJcbiAgICAgICAgLy8gZm9yIG5vdyAtIHBsYWNlIHNpbmdsZSB0cmlhbmdsZSBpbnRvIHZlcnRleCBidWZmZXJcclxuICAgICAgICBjb25zdCBnbCA9IHRoaXMuZ2xcclxuICAgICAgICBjb25zdCB2Ym8gPSBnbHUuY3JlYXRlQnVmZmVyKGdsKVxyXG4gICAgICAgIGNvbnN0IGlibyA9IGdsdS5jcmVhdGVCdWZmZXIoZ2wpXHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHZibylcclxuICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgdG9GbG9hdEFycmF5KG1lc2gudmVydGljZXMpLCBnbC5TVEFUSUNfRFJBVylcclxuICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBpYm8pXHJcbiAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgbmV3IFVpbnQzMkFycmF5KG1lc2guaW5kaWNlcyksIGdsLlNUQVRJQ19EUkFXKVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVZhbyh2Ym8sIGlibylcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZHJhd0JhdGNoKGJhdGNoOiBCYXRjaCkge1xyXG4gICAgICAgIHRoaXMuYmF0Y2hlcy5wdXNoKGJhdGNoKVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY3JlYXRlVmFvKHZibzogV2ViR0xCdWZmZXIsIGlibzogV2ViR0xCdWZmZXIpOiBXZWJHTFZlcnRleEFycmF5T2JqZWN0IHtcclxuICAgICAgICBjb25zdCB7IGdsLCBwcm9ncmFtIH0gPSB0aGlzXHJcbiAgICAgICAgY29uc3QgdmFvID0gZ2x1LmNyZWF0ZVZlcnRleEFycmF5KGdsKVxyXG4gICAgICAgIGdsLmJpbmRWZXJ0ZXhBcnJheSh2YW8pXHJcblxyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uQXR0cmliSWR4ID0gZ2x1LmdldEF0dHJpYkxvY2F0aW9uKGdsLCBwcm9ncmFtLCBcInZlcnRfcG9zaXRpb25cIilcclxuICAgICAgICBjb25zdCBub3JtYWxBdHRyaWJJZHggPSBnbHUuZ2V0QXR0cmliTG9jYXRpb24oZ2wsIHByb2dyYW0sIFwidmVydF9ub3JtYWxcIilcclxuICAgICAgICBjb25zdCBjb2xvckF0dHJpYklkeCA9IGdsdS5nZXRBdHRyaWJMb2NhdGlvbihnbCwgcHJvZ3JhbSwgXCJ2ZXJ0X2NvbG9yXCIpXHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHZibylcclxuICAgICAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShwb3NpdGlvbkF0dHJpYklkeClcclxuICAgICAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShub3JtYWxBdHRyaWJJZHgpXHJcbiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoY29sb3JBdHRyaWJJZHgpXHJcbiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihwb3NpdGlvbkF0dHJpYklkeCwgMywgZ2wuRkxPQVQsIGZhbHNlLCB2ZXJ0ZXhTdHJpZGUsIDApXHJcbiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihub3JtYWxBdHRyaWJJZHgsIDMsIGdsLkZMT0FULCBmYWxzZSwgdmVydGV4U3RyaWRlLCAxMilcclxuICAgICAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKGNvbG9yQXR0cmliSWR4LCA0LCBnbC5GTE9BVCwgZmFsc2UsIHZlcnRleFN0cmlkZSwgMjQpXHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgaWJvKVxyXG4gICAgICAgIHJldHVybiB2YW9cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlbmRlckJhdGNoZXMoKSB7XHJcbiAgICAgICAgY29uc3QgZ2wgPSB0aGlzLmdsXHJcbiAgICAgICAgZ2wudXNlUHJvZ3JhbSh0aGlzLnByb2dyYW0pXHJcbiAgICAgICAgZ2wudW5pZm9ybU1hdHJpeDRmdih0aGlzLnByb2plY3Rpb25NYXRyaXhMb2MsIGZhbHNlLCB0aGlzLnByb2plY3Rpb25NYXRyaXgudG9BcnJheSgpKVxyXG4gICAgICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYodGhpcy52aWV3TWF0cml4TG9jLCBmYWxzZSwgdGhpcy52aWV3TWF0cml4LnRvQXJyYXkoKSlcclxuXHJcbiAgICAgICAgZm9yIChjb25zdCBiYXRjaCBvZiB0aGlzLmJhdGNoZXMpIHtcclxuICAgICAgICAgICAgZ2wudW5pZm9ybU1hdHJpeDRmdih0aGlzLndvcmxkTWF0cml4TG9jLCBmYWxzZSwgYmF0Y2gud29ybGRNYXRyaXgudG9BcnJheSgpKVxyXG4gICAgICAgICAgICBnbC5iaW5kVmVydGV4QXJyYXkoYmF0Y2gudmFvKVxyXG4gICAgICAgICAgICBnbC5kcmF3RWxlbWVudHMoZ2wuVFJJQU5HTEVTLCBiYXRjaC5udW1JbmRpY2VzLCBnbC5VTlNJR05FRF9JTlQsIGJhdGNoLm9mZnNldClcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuYmF0Y2hlcyA9IFtdXHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRvRmxvYXRBcnJheSh2ZXJ0aWNlczogVmVydGV4W10pOiBGbG9hdDMyQXJyYXkge1xyXG4gICAgY29uc3QgYSA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMuZmxhdE1hcCh2ID0+IFtcclxuICAgICAgICB2LnBvc2l0aW9uLngsIHYucG9zaXRpb24ueSwgdi5wb3NpdGlvbi56LFxyXG4gICAgICAgIHYubm9ybWFsLngsIHYubm9ybWFsLnksIHYubm9ybWFsLnosXHJcbiAgICAgICAgdi5jb2xvci54LCB2LmNvbG9yLnksIHYuY29sb3Iueiwgdi5jb2xvci53XSkpXHJcblxyXG4gICAgcmV0dXJuIGFcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGN1YmUoKTogSXhNZXNoIHtcclxuICAgIC8vIC14LCAreCwgLXksICt5LCAteiwgK3pcclxuICAgIGNvbnN0IHZlcnRpY2VzID0gbmV3IEFycmF5PFZlcnRleD4oXHJcbiAgICAgICAgLy8gLXhcclxuICAgICAgICB7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIC0xLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKC0xLCAwLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAwLCAwLCAxKSB9LFxyXG4gICAgICAgIHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgLTEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygtMSwgMCwgMCksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMCwgMCwgMSkgfSxcclxuICAgICAgICB7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIDEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygtMSwgMCwgMCksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMCwgMCwgMSkgfSxcclxuICAgICAgICB7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIDEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoLTEsIDAsIDApLCBjb2xvcjogbmV3IGdlby5WZWM0KDEsIDAsIDAsIDEpIH0sXHJcbiAgICAgICAgLy8gK3hcclxuICAgICAgICB7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgLTEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygxLCAwLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgwLCAxLCAwLCAxKSB9LFxyXG4gICAgICAgIHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAtMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygxLCAwLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgwLCAxLCAwLCAxKSB9LFxyXG4gICAgICAgIHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAxLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDEsIDAsIDApLCBjb2xvcjogbmV3IGdlby5WZWM0KDAsIDEsIDAsIDEpIH0sXHJcbiAgICAgICAgeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIDEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygxLCAwLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgwLCAxLCAwLCAxKSB9LFxyXG4gICAgICAgIC8vIC15XHJcbiAgICAgICAgeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAtMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIC0xLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAwLCAwLCAxKSB9LFxyXG4gICAgICAgIHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgLTEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgLTEsIDApLCBjb2xvcjogbmV3IGdlby5WZWM0KDEsIDAsIDAsIDEpIH0sXHJcbiAgICAgICAgeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIC0xLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIC0xLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAwLCAwLCAxKSB9LFxyXG4gICAgICAgIHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAtMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIC0xLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAwLCAwLCAxKSB9LFxyXG4gICAgICAgIC8vICt5XHJcbiAgICAgICAgeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAxLCAxKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMSwgMCksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMCwgMSwgMCwgMSkgfSxcclxuICAgICAgICB7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDEsIDApLCBjb2xvcjogbmV3IGdlby5WZWM0KDAsIDEsIDAsIDEpIH0sXHJcbiAgICAgICAgeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIDEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMSwgMCksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMCwgMSwgMCwgMSkgfSxcclxuICAgICAgICB7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIDEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMSwgMCksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMCwgMSwgMCwgMSkgfSxcclxuICAgICAgICAvLyAtelxyXG4gICAgICAgIHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgLTEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMCwgLTEpLCBjb2xvcjogbmV3IGdlby5WZWM0KDEsIDAsIDAsIDEpIH0sXHJcbiAgICAgICAgeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAxLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIC0xKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAwLCAwLCAxKSB9LFxyXG4gICAgICAgIHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAxLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIC0xKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAwLCAwLCAxKSB9LFxyXG4gICAgICAgIHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAtMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAwLCAtMSksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMCwgMCwgMSkgfSxcclxuICAgICAgICAvLyArelxyXG4gICAgICAgIHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgLTEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAwLCAxKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgwLCAxLCAwLCAxKSB9LFxyXG4gICAgICAgIHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAtMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIDEpLCBjb2xvcjogbmV3IGdlby5WZWM0KDAsIDEsIDAsIDEpIH0sXHJcbiAgICAgICAgeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIDEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAwLCAxKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgwLCAxLCAwLCAxKSB9LFxyXG4gICAgICAgIHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIDEpLCBjb2xvcjogbmV3IGdlby5WZWM0KDAsIDEsIDAsIDEpIH1cclxuICAgIClcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHZlcnRpY2VzLFxyXG4gICAgICAgIGluZGljZXM6IHF1YWRJbmRpY2VzKHZlcnRpY2VzLmxlbmd0aCAvIDQpXHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzcGhlcmUocm93czogbnVtYmVyLCBjb2xzOiBudW1iZXIpOiBJeE1lc2gge1xyXG4gICAgLy8gY3JlYXRlIG5vcnRoIHBvbGVcclxuICAgIGNvbnN0IHZlcnRpY2VzID0gbmV3IEFycmF5PFZlcnRleD4oKVxyXG4gICAgY29uc3QgaW5kaWNlcyA9IG5ldyBBcnJheTxudW1iZXI+KClcclxuICAgIGNvbnN0IG5vcnRoUG9sZTogVmVydGV4ID0geyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDAsIDEsIDApLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAxLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAxLCAxLCAxKSB9XHJcbiAgICB2ZXJ0aWNlcy5wdXNoKG5vcnRoUG9sZSlcclxuXHJcbiAgICAvLyBpdGVyYXRlIG92ZXIgYW5nbGVzLCBlc3NlbnRpYWxseSBmb3JtaW5nIHBvbGFyIGNvb3JkaW5hdGVzIG9mIGVhY2ggcG9pbnRcclxuICAgIC8vIGxldCB0aGV0YSA9IGVsZXZhdGlvbiBhbmdsZSBhYm92ZSB4eSBwbGFuZVxyXG4gICAgLy8gbGV0IHBoaSA9IHh5IHBsYW5lIGFuZ2xlXHJcbiAgICBjb25zdCBkdGhldGEgPSBNYXRoLlBJIC8gKHJvd3MgKyAxKVxyXG4gICAgY29uc3QgZHBoaSA9IDIgKiBNYXRoLlBJIC8gY29sc1xyXG5cclxuICAgIGZvciAobGV0IGogPSAwOyBqIDwgY29sczsgKytqKSB7XHJcbiAgICAgICAgY29uc3QgcGhpID0gZHBoaSAqIGpcclxuICAgICAgICBjb25zdCB0aGV0YSA9IGR0aGV0YVxyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gbmV3IGdlby5WZWMzKFxyXG4gICAgICAgICAgICBNYXRoLnNpbih0aGV0YSkgKiBNYXRoLmNvcyhwaGkpLFxyXG4gICAgICAgICAgICBNYXRoLmNvcyh0aGV0YSksXHJcbiAgICAgICAgICAgIE1hdGguc2luKHRoZXRhKSAqIE1hdGguc2luKHBoaSlcclxuICAgICAgICApXHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKHBvc2l0aW9uLnRvU3RyaW5nKCkpXHJcbiAgICAgICAgdmVydGljZXMucHVzaCh7IHBvc2l0aW9uOiBwb3NpdGlvbiwgbm9ybWFsOiBwb3NpdGlvbiwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAxLCAxLCAxKSB9KVxyXG5cclxuICAgICAgICAvLyBjb25uZWN0IHRvIHBvbGUgdG8gZm9ybSB0cmlhbmdsZVxyXG4gICAgICAgIGluZGljZXMucHVzaChqICsgMSwgKGogKyAxKSAlIGNvbHMgKyAxLCAwKVxyXG4gICAgfVxyXG5cclxuICAgIC8vIGludGVyaW9yXHJcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHJvd3M7ICsraSkge1xyXG4gICAgICAgIGNvbnN0IHRoZXRhID0gZHRoZXRhICogKGkgKyAxKVxyXG4gICAgICAgIGNvbnN0IHByZXZSb3dPZmZzZXQgPSAoaSAtIDEpICogY29scyArIDFcclxuICAgICAgICBjb25zdCByb3dPZmZzZXQgPSBwcmV2Um93T2Zmc2V0ICsgY29sc1xyXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY29sczsgKytqKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBoaSA9IGRwaGkgKiBqXHJcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gbmV3IGdlby5WZWMzKFxyXG4gICAgICAgICAgICAgICAgTWF0aC5zaW4odGhldGEpICogTWF0aC5jb3MocGhpKSxcclxuICAgICAgICAgICAgICAgIE1hdGguY29zKHRoZXRhKSxcclxuICAgICAgICAgICAgICAgIE1hdGguc2luKHRoZXRhKSAqIE1hdGguc2luKHBoaSlcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKHsgcG9zaXRpb246IHBvc2l0aW9uLCBub3JtYWw6IHBvc2l0aW9uLCBjb2xvcjogbmV3IGdlby5WZWM0KDEsIDEsIDEsIDEpIH0pXHJcblxyXG4gICAgICAgICAgICBjb25zdCBhID0gcHJldlJvd09mZnNldCArIGpcclxuICAgICAgICAgICAgY29uc3QgYiA9IHJvd09mZnNldCArIGpcclxuICAgICAgICAgICAgY29uc3QgYyA9IHJvd09mZnNldCArIChqICsgMSkgJSBjb2xzXHJcbiAgICAgICAgICAgIGNvbnN0IGQgPSBwcmV2Um93T2Zmc2V0ICsgKGogKyAxKSAlIGNvbHNcclxuICAgICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGMsIGEsIGMsIGQpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIGNyZWF0ZSBzb3V0aCBwb2xlXHJcbiAgICBjb25zdCBzb3V0aFBvbGU6IFZlcnRleCA9IHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygwLCAtMSwgMCksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIC0xLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAxLCAxLCAxKSB9XHJcbiAgICB2ZXJ0aWNlcy5wdXNoKHNvdXRoUG9sZSlcclxuICAgIGNvbnN0IHNvdXRoUG9sZUlkeCA9IHZlcnRpY2VzLmxlbmd0aCAtIDFcclxuXHJcbiAgICAvLyBjb25uZWN0IHNvdXRoIHBvbGUgdG8gcmVzdCBvZiBtZXNoXHJcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNvbHM7ICsraikge1xyXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IHNvdXRoUG9sZUlkeCAtIGNvbHNcclxuXHJcbiAgICAgICAgLy8gY29ubmVjdCB0byBwb2xlIHRvIGZvcm0gdHJpYW5nbGVcclxuICAgICAgICBpbmRpY2VzLnB1c2gob2Zmc2V0ICsgaiwgc291dGhQb2xlSWR4LCBvZmZzZXQgKyAoaiArIDEpICUgY29scylcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHZlcnRpY2VzOiB2ZXJ0aWNlcyxcclxuICAgICAgICBpbmRpY2VzOiBpbmRpY2VzXHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHF1YWRJbmRpY2VzKHF1YWRzOiBudW1iZXIpOiBudW1iZXJbXSB7XHJcbiAgICByZXR1cm4gYXJyYXkuZ2VuZXJhdGUocXVhZHMsIGkgPT4gW2kgKiA0LCBpICogNCArIDEsIGkgKiA0ICsgMiwgaSAqIDQsIGkgKiA0ICsgMiwgaSAqIDQgKyAzXSkuZmxhdCgpXHJcbn0iXX0=