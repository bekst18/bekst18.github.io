import * as glu from "../shared/glu.js";
import * as geo from "../shared/geo3d.js";
import * as array from "../shared/array.js";
import * as iter from "../shared/iter.js";
const vertexSrc = `#version 300 es
precision mediump float;
uniform mat4 world_matrix;
uniform mat4 view_matrix;
uniform mat4 projection_matrix;
uniform vec4 diffuse_color;

in vec3 vert_position;
in vec3 vert_normal;
in vec4 vert_color;
out vec3 frag_normal;
out vec3 frag_position;
out vec4 frag_color;

void main() {
    frag_color = vert_color * diffuse_color;
    frag_normal = mat3(world_matrix) * vert_normal;
    vec4 position_world = world_matrix * vec4(vert_position, 1.f);
    gl_Position = projection_matrix * view_matrix * position_world;
    frag_position = position_world.xyz / position_world.w;
}`;
const fragmentSrc = `#version 300 es
precision highp float;
precision highp sampler2D;
precision highp sampler2DArray;

uniform vec3 eye_position;
uniform float roughness;
in vec4 frag_color;
in vec3 frag_position;
in vec3 frag_normal;
out vec4 out_color;

void main() {
    float specular_intensity = 1.f - roughness;
    float specular_pow = mix(.1f, 32.f, specular_intensity);
    vec3 surface_normal = normalize(frag_normal);
    vec3 to_light = normalize(vec3(-1, 0, 1));
    vec3 half_vec = normalize(normalize(eye_position - frag_position) + to_light);
    float ndl = clamp(dot(to_light, surface_normal), 0.f, 1.f);
    float ndh = pow(clamp(dot(half_vec, surface_normal), 0.0, 1.f), specular_pow);

    vec3 directional = frag_color.rgb * ndl;
    vec3 specular = vec3(1, 1, 1) * ndh * specular_intensity;
    out_color = vec4(directional + specular, frag_color.a);
}`;
export class Vertex {
    constructor(options = {}) {
        var _a, _b, _c, _d, _e, _f;
        this.position = (_b = (_a = options.position) === null || _a === void 0 ? void 0 : _a.clone()) !== null && _b !== void 0 ? _b : new geo.Vec3(0, 0, 0);
        this.normal = (_d = (_c = options.normal) === null || _c === void 0 ? void 0 : _c.clone()) !== null && _d !== void 0 ? _d : new geo.Vec3(0, 0, 0);
        this.color = (_f = (_e = options.color) === null || _e === void 0 ? void 0 : _e.clone()) !== null && _f !== void 0 ? _f : new geo.Vec4(1, 1, 1, 1);
    }
    clone() {
        return new Vertex(this);
    }
}
export class IxMesh {
    constructor(options = {}) {
        this.vertices = [];
        this.indices = [];
        if (options.vertices) {
            this.vertices.push(...options.vertices);
        }
        if (options.indices) {
            this.indices.push(...options.indices);
        }
    }
    clear() {
        this.vertices = [];
        this.indices = [];
    }
    transform(mat) {
        transform(mat, this.vertices);
    }
    cat(ixm) {
        const offset = this.vertices.length;
        this.vertices.push(...ixm.vertices.map(v => v.clone()));
        this.indices.push(...ixm.indices.map(ix => ix + offset));
    }
    calcAABB() {
        return calcAABB(this.vertices);
    }
    static cube() {
        // -x, +x, -y, +y, -z, +z
        const vertices = new Array(
        // -x
        new Vertex({ position: new geo.Vec3(-1, -1, -1), normal: new geo.Vec3(-1, 0, 0) }), new Vertex({ position: new geo.Vec3(-1, -1, 1), normal: new geo.Vec3(-1, 0, 0) }), new Vertex({ position: new geo.Vec3(-1, 1, 1), normal: new geo.Vec3(-1, 0, 0), }), new Vertex({ position: new geo.Vec3(-1, 1, -1), normal: new geo.Vec3(-1, 0, 0) }), 
        // +x
        new Vertex({ position: new geo.Vec3(1, -1, 1), normal: new geo.Vec3(1, 0, 0) }), new Vertex({ position: new geo.Vec3(1, -1, -1), normal: new geo.Vec3(1, 0, 0) }), new Vertex({ position: new geo.Vec3(1, 1, -1), normal: new geo.Vec3(1, 0, 0) }), new Vertex({ position: new geo.Vec3(1, 1, 1), normal: new geo.Vec3(1, 0, 0) }), 
        // -y
        new Vertex({ position: new geo.Vec3(-1, -1, 1), normal: new geo.Vec3(0, -1, 0) }), new Vertex({ position: new geo.Vec3(-1, -1, -1), normal: new geo.Vec3(0, -1, 0) }), new Vertex({ position: new geo.Vec3(1, -1, -1), normal: new geo.Vec3(0, -1, 0) }), new Vertex({ position: new geo.Vec3(1, -1, 1), normal: new geo.Vec3(0, -1, 0) }), 
        // +y
        new Vertex({ position: new geo.Vec3(-1, 1, 1), normal: new geo.Vec3(0, 1, 0) }), new Vertex({ position: new geo.Vec3(1, 1, 1), normal: new geo.Vec3(0, 1, 0) }), new Vertex({ position: new geo.Vec3(1, 1, -1), normal: new geo.Vec3(0, 1, 0) }), new Vertex({ position: new geo.Vec3(-1, 1, -1), normal: new geo.Vec3(0, 1, 0) }), 
        // -z
        new Vertex({ position: new geo.Vec3(-1, -1, -1), normal: new geo.Vec3(0, 0, -1) }), new Vertex({ position: new geo.Vec3(-1, 1, -1), normal: new geo.Vec3(0, 0, -1) }), new Vertex({ position: new geo.Vec3(1, 1, -1), normal: new geo.Vec3(0, 0, -1) }), new Vertex({ position: new geo.Vec3(1, -1, -1), normal: new geo.Vec3(0, 0, -1) }), 
        // +z
        new Vertex({ position: new geo.Vec3(-1, -1, 1), normal: new geo.Vec3(0, 0, 1) }), new Vertex({ position: new geo.Vec3(1, -1, 1), normal: new geo.Vec3(0, 0, 1) }), new Vertex({ position: new geo.Vec3(1, 1, 1), normal: new geo.Vec3(0, 0, 1) }), new Vertex({ position: new geo.Vec3(-1, 1, 1), normal: new geo.Vec3(0, 0, 1) }));
        return new IxMesh({
            vertices,
            indices: quadIndices(vertices.length / 4)
        });
    }
    static sphere(rows, cols) {
        // create north pole
        const vertices = new Array();
        const indices = new Array();
        const northPole = new Vertex({ position: new geo.Vec3(0, 1, 0), normal: new geo.Vec3(0, 1, 0), color: new geo.Vec4(1, 1, 1, 1) });
        vertices.push(northPole);
        // iterate over angles, essentially forming polar coordinates of each point
        // let theta = elevation angle above xy plane
        // let phi = xy plane angle
        const dtheta = Math.PI / (rows + 1);
        const dphi = 2 * Math.PI / cols;
        for (let j = 0; j < cols; ++j) {
            const phi = dphi * j;
            const theta = dtheta;
            const position = new geo.Vec3(Math.sin(theta) * Math.cos(phi), Math.cos(theta), Math.sin(theta) * Math.sin(phi));
            vertices.push(new Vertex({ position: position, normal: position, color: new geo.Vec4(1, 1, 1, 1) }));
            // connect to pole to form triangle
            indices.push(j + 1, (j + 1) % cols + 1, 0);
        }
        // interior
        for (let i = 1; i < rows; ++i) {
            const theta = dtheta * (i + 1);
            const prevRowOffset = (i - 1) * cols + 1;
            const rowOffset = prevRowOffset + cols;
            for (let j = 0; j < cols; ++j) {
                const phi = dphi * j;
                const position = new geo.Vec3(Math.sin(theta) * Math.cos(phi), Math.cos(theta), Math.sin(theta) * Math.sin(phi));
                vertices.push(new Vertex({ position: position, normal: position, color: new geo.Vec4(1, 1, 1, 1) }));
                const a = prevRowOffset + j;
                const b = rowOffset + j;
                const c = rowOffset + (j + 1) % cols;
                const d = prevRowOffset + (j + 1) % cols;
                indices.push(a, b, c, a, c, d);
            }
        }
        // create south pole
        const southPole = new Vertex({ position: new geo.Vec3(0, -1, 0), normal: new geo.Vec3(0, -1, 0), color: new geo.Vec4(1, 1, 1, 1) });
        vertices.push(southPole);
        const southPoleIdx = vertices.length - 1;
        // connect south pole to rest of mesh
        for (let j = 0; j < cols; ++j) {
            const offset = southPoleIdx - cols;
            // connect to pole to form triangle
            indices.push(offset + j, southPoleIdx, offset + (j + 1) % cols);
        }
        return new IxMesh({
            vertices,
            indices
        });
    }
    static rect(aabb) {
        // -x, +x, -y, +y, -z, +z
        const mesh = IxMesh.cube();
        const halfExtents = aabb.extents.divX(2);
        const negHalfExtents = halfExtents.neg();
        const translation = geo.Mat4.translation(aabb.min.sub(negHalfExtents));
        const scaling = geo.Mat4.scaling(halfExtents);
        const mat = scaling.matmul(translation);
        mesh.transform(mat);
        return mesh;
    }
    static rectFromCoords(minX, minY, minZ, maxX, maxY, maxZ) {
        return this.rect(geo.AABB.fromCoords(minX, minY, minZ, maxX, maxY, maxZ));
    }
}
function quadIndices(quads) {
    return array.generate(quads, i => [i * 4, i * 4 + 1, i * 4 + 2, i * 4, i * 4 + 2, i * 4 + 3]).flat();
}
export class Batch {
    constructor(options = {}) {
        var _a, _b, _c, _d, _e, _f;
        this.diffuseColor = new geo.Vec4(1, 1, 1, 1);
        this.roughness = 0;
        this.worldMatrix = (_a = options.worldMatrix) !== null && _a !== void 0 ? _a : geo.Mat4.identity();
        this.diffuseColor = (_b = options.diffuseColor) !== null && _b !== void 0 ? _b : new geo.Vec4(1, 1, 1, 1);
        this.roughness = (_c = options.roughness) !== null && _c !== void 0 ? _c : 0;
        this.vao = (_d = options.vao) !== null && _d !== void 0 ? _d : null;
        this.offset = (_e = options.offset) !== null && _e !== void 0 ? _e : 0;
        this.numIndices = (_f = options.numIndices) !== null && _f !== void 0 ? _f : 0;
    }
}
const elemsPerVertex = 10;
const vertexStride = elemsPerVertex * 4;
export class Renderer {
    constructor(canvas) {
        this.canvas = canvas;
        this.projectionMatrix = geo.Mat4.identity();
        this.viewMatrix = geo.Mat4.identity();
        this.batches = [];
        this.gl = glu.createContext(this.canvas);
        const gl = this.gl;
        this.program = glu.compileProgram(gl, vertexSrc, fragmentSrc);
        this.worldMatrixLoc = glu.getUniformLocation(gl, this.program, "world_matrix");
        this.viewMatrixLoc = glu.getUniformLocation(gl, this.program, "view_matrix");
        this.projectionMatrixLoc = glu.getUniformLocation(gl, this.program, "projection_matrix");
        this.projectionMatrixLoc = glu.getUniformLocation(gl, this.program, "projection_matrix");
        this.diffuseColorLoc = glu.getUniformLocation(gl, this.program, "diffuse_color");
        this.eyePositionLoc = glu.getUniformLocation(gl, this.program, "eye_position");
        this.roughnessLoc = glu.getUniformLocation(gl, this.program, "roughness");
    }
    present() {
        const gl = this.gl;
        this.projectionMatrix = geo.Mat4.perspective(Math.PI / 2, gl.drawingBufferWidth / gl.drawingBufferHeight, 1, 512);
        gl.bindFramebuffer(gl.FRAMEBUFFER, null);
        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
        gl.clearColor(0, 0, 0, 1);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
        gl.enable(gl.DEPTH_TEST);
        this.renderBatches();
    }
    createMesh(mesh) {
        // for now - place single triangle into vertex buffer
        const gl = this.gl;
        const vbo = glu.createBuffer(gl);
        const ibo = glu.createBuffer(gl);
        gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
        gl.bufferData(gl.ARRAY_BUFFER, toFloatArray(mesh.vertices), gl.STATIC_DRAW);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint32Array(mesh.indices), gl.STATIC_DRAW);
        return this.createVao(vbo, ibo);
    }
    drawBatch(batch) {
        this.batches.push(batch);
    }
    createVao(vbo, ibo) {
        const { gl, program } = this;
        const vao = glu.createVertexArray(gl);
        gl.bindVertexArray(vao);
        const positionAttribIdx = glu.getAttribLocation(gl, program, "vert_position");
        const normalAttribIdx = glu.getAttribLocation(gl, program, "vert_normal");
        const colorAttribIdx = glu.getAttribLocation(gl, program, "vert_color");
        gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
        gl.enableVertexAttribArray(positionAttribIdx);
        gl.enableVertexAttribArray(normalAttribIdx);
        gl.enableVertexAttribArray(colorAttribIdx);
        gl.vertexAttribPointer(positionAttribIdx, 3, gl.FLOAT, false, vertexStride, 0);
        gl.vertexAttribPointer(normalAttribIdx, 3, gl.FLOAT, false, vertexStride, 12);
        gl.vertexAttribPointer(colorAttribIdx, 4, gl.FLOAT, false, vertexStride, 24);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
        gl.bindVertexArray(null);
        return vao;
    }
    renderBatches() {
        const gl = this.gl;
        gl.useProgram(this.program);
        gl.uniformMatrix4fv(this.projectionMatrixLoc, false, this.projectionMatrix.toArray());
        gl.uniformMatrix4fv(this.viewMatrixLoc, false, this.viewMatrix.toArray());
        // determine eye position and set uniform
        {
            const invViewMatrix = this.viewMatrix.invert();
            const eyePosition = invViewMatrix.transform3(new geo.Vec3(0, 0, 0));
            gl.uniform3fv(this.eyePositionLoc, eyePosition.toArray());
        }
        for (const batch of this.batches) {
            if (!batch.vao) {
                continue;
            }
            if (batch.numIndices <= 0) {
                continue;
            }
            gl.uniformMatrix4fv(this.worldMatrixLoc, false, batch.worldMatrix.toArray());
            gl.uniform4fv(this.diffuseColorLoc, batch.diffuseColor.toArray());
            gl.uniform1f(this.roughnessLoc, batch.roughness);
            gl.bindVertexArray(batch.vao);
            gl.drawElements(gl.TRIANGLES, batch.numIndices, gl.UNSIGNED_INT, batch.offset);
        }
        this.batches = [];
    }
}
function toFloatArray(vertices) {
    const a = new Float32Array(vertices.flatMap(v => [
        v.position.x, v.position.y, v.position.z,
        v.normal.x, v.normal.y, v.normal.z,
        v.color.x, v.color.y, v.color.z, v.color.w
    ]));
    return a;
}
export function transform(mat, vertices) {
    const basis = mat.toMat3();
    for (const v of vertices) {
        v.position = mat.transform3(v.position);
        v.normal = basis.transform(v.normal);
    }
}
export function calcAABB(vertices) {
    const aabb = geo.AABB.fromPoints(iter.map(vertices, v => v.position));
    return aabb;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2Z4LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZ2Z4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxHQUFHLE1BQU0sa0JBQWtCLENBQUE7QUFDdkMsT0FBTyxLQUFLLEdBQUcsTUFBTSxvQkFBb0IsQ0FBQTtBQUN6QyxPQUFPLEtBQUssS0FBSyxNQUFNLG9CQUFvQixDQUFBO0FBQzNDLE9BQU8sS0FBSyxJQUFJLE1BQU0sbUJBQW1CLENBQUE7QUFFekMsTUFBTSxTQUFTLEdBQUc7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0VBb0JoQixDQUFBO0FBRUYsTUFBTSxXQUFXLEdBQUc7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztFQXdCbEIsQ0FBQTtBQVFGLE1BQU0sT0FBTyxNQUFNO0lBS2YsWUFBWSxVQUF5QixFQUFFOztRQUNuQyxJQUFJLENBQUMsUUFBUSxlQUFHLE9BQU8sQ0FBQyxRQUFRLDBDQUFFLEtBQUsscUNBQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDbEUsSUFBSSxDQUFDLE1BQU0sZUFBRyxPQUFPLENBQUMsTUFBTSwwQ0FBRSxLQUFLLHFDQUFNLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO1FBQzlELElBQUksQ0FBQyxLQUFLLGVBQUcsT0FBTyxDQUFDLEtBQUssMENBQUUsS0FBSyxxQ0FBTSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFDbkUsQ0FBQztJQUVELEtBQUs7UUFDRCxPQUFPLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQzNCLENBQUM7Q0FDSjtBQU9ELE1BQU0sT0FBTyxNQUFNO0lBSWYsWUFBWSxVQUF5QixFQUFFO1FBSGhDLGFBQVEsR0FBYSxFQUFFLENBQUE7UUFDdkIsWUFBTyxHQUFhLEVBQUUsQ0FBQTtRQUd6QixJQUFJLE9BQU8sQ0FBQyxRQUFRLEVBQUU7WUFDbEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUE7U0FDMUM7UUFFRCxJQUFJLE9BQU8sQ0FBQyxPQUFPLEVBQUU7WUFDakIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUE7U0FDeEM7SUFDTCxDQUFDO0lBRUQsS0FBSztRQUNELElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFBO1FBQ2xCLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFBO0lBQ3JCLENBQUM7SUFFRCxTQUFTLENBQUMsR0FBYTtRQUNuQixTQUFTLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUNqQyxDQUFDO0lBRUQsR0FBRyxDQUFDLEdBQVc7UUFDWCxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQTtRQUNuQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUN2RCxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUE7SUFDNUQsQ0FBQztJQUVELFFBQVE7UUFDSixPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDbEMsQ0FBQztJQUVELE1BQU0sQ0FBQyxJQUFJO1FBQ1AseUJBQXlCO1FBQ3pCLE1BQU0sUUFBUSxHQUFHLElBQUksS0FBSztRQUN0QixLQUFLO1FBQ0wsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUNsRixJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUNqRixJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFDakYsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDakYsS0FBSztRQUNMLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDL0UsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2hGLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDL0UsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDOUUsS0FBSztRQUNMLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2pGLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDbEYsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDakYsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ2hGLEtBQUs7UUFDTCxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQy9FLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQzlFLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDL0UsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ2hGLEtBQUs7UUFDTCxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2xGLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2pGLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUNoRixJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUNqRixLQUFLO1FBQ0wsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2hGLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDL0UsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDOUUsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUNsRixDQUFBO1FBRUQsT0FBTyxJQUFJLE1BQU0sQ0FBQztZQUNkLFFBQVE7WUFDUixPQUFPLEVBQUUsV0FBVyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1NBQzVDLENBQUMsQ0FBQTtJQUNOLENBQUM7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RyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUE7SUFDMUIsS0FBSyxNQUFNLENBQUMsSUFBSSxRQUFRLEVBQUU7UUFDdEIsQ0FBQyxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUN2QyxDQUFDLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0tBQ3ZDO0FBQ0wsQ0FBQztBQUVELE1BQU0sVUFBVSxRQUFRLENBQUMsUUFBMEI7SUFDL0MsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQTtJQUNyRSxPQUFPLElBQUksQ0FBQTtBQUNmLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBnbHUgZnJvbSBcIi4uL3NoYXJlZC9nbHUuanNcIlxyXG5pbXBvcnQgKiBhcyBnZW8gZnJvbSBcIi4uL3NoYXJlZC9nZW8zZC5qc1wiXHJcbmltcG9ydCAqIGFzIGFycmF5IGZyb20gXCIuLi9zaGFyZWQvYXJyYXkuanNcIlxyXG5pbXBvcnQgKiBhcyBpdGVyIGZyb20gXCIuLi9zaGFyZWQvaXRlci5qc1wiXHJcblxyXG5jb25zdCB2ZXJ0ZXhTcmMgPSBgI3ZlcnNpb24gMzAwIGVzXHJcbnByZWNpc2lvbiBtZWRpdW1wIGZsb2F0O1xyXG51bmlmb3JtIG1hdDQgd29ybGRfbWF0cml4O1xyXG51bmlmb3JtIG1hdDQgdmlld19tYXRyaXg7XHJcbnVuaWZvcm0gbWF0NCBwcm9qZWN0aW9uX21hdHJpeDtcclxudW5pZm9ybSB2ZWM0IGRpZmZ1c2VfY29sb3I7XHJcblxyXG5pbiB2ZWMzIHZlcnRfcG9zaXRpb247XHJcbmluIHZlYzMgdmVydF9ub3JtYWw7XHJcbmluIHZlYzQgdmVydF9jb2xvcjtcclxub3V0IHZlYzMgZnJhZ19ub3JtYWw7XHJcbm91dCB2ZWMzIGZyYWdfcG9zaXRpb247XHJcbm91dCB2ZWM0IGZyYWdfY29sb3I7XHJcblxyXG52b2lkIG1haW4oKSB7XHJcbiAgICBmcmFnX2NvbG9yID0gdmVydF9jb2xvciAqIGRpZmZ1c2VfY29sb3I7XHJcbiAgICBmcmFnX25vcm1hbCA9IG1hdDMod29ybGRfbWF0cml4KSAqIHZlcnRfbm9ybWFsO1xyXG4gICAgdmVjNCBwb3NpdGlvbl93b3JsZCA9IHdvcmxkX21hdHJpeCAqIHZlYzQodmVydF9wb3NpdGlvbiwgMS5mKTtcclxuICAgIGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbl9tYXRyaXggKiB2aWV3X21hdHJpeCAqIHBvc2l0aW9uX3dvcmxkO1xyXG4gICAgZnJhZ19wb3NpdGlvbiA9IHBvc2l0aW9uX3dvcmxkLnh5eiAvIHBvc2l0aW9uX3dvcmxkLnc7XHJcbn1gXHJcblxyXG5jb25zdCBmcmFnbWVudFNyYyA9IGAjdmVyc2lvbiAzMDAgZXNcclxucHJlY2lzaW9uIGhpZ2hwIGZsb2F0O1xyXG5wcmVjaXNpb24gaGlnaHAgc2FtcGxlcjJEO1xyXG5wcmVjaXNpb24gaGlnaHAgc2FtcGxlcjJEQXJyYXk7XHJcblxyXG51bmlmb3JtIHZlYzMgZXllX3Bvc2l0aW9uO1xyXG51bmlmb3JtIGZsb2F0IHJvdWdobmVzcztcclxuaW4gdmVjNCBmcmFnX2NvbG9yO1xyXG5pbiB2ZWMzIGZyYWdfcG9zaXRpb247XHJcbmluIHZlYzMgZnJhZ19ub3JtYWw7XHJcbm91dCB2ZWM0IG91dF9jb2xvcjtcclxuXHJcbnZvaWQgbWFpbigpIHtcclxuICAgIGZsb2F0IHNwZWN1bGFyX2ludGVuc2l0eSA9IDEuZiAtIHJvdWdobmVzcztcclxuICAgIGZsb2F0IHNwZWN1bGFyX3BvdyA9IG1peCguMWYsIDMyLmYsIHNwZWN1bGFyX2ludGVuc2l0eSk7XHJcbiAgICB2ZWMzIHN1cmZhY2Vfbm9ybWFsID0gbm9ybWFsaXplKGZyYWdfbm9ybWFsKTtcclxuICAgIHZlYzMgdG9fbGlnaHQgPSBub3JtYWxpemUodmVjMygtMSwgMCwgMSkpO1xyXG4gICAgdmVjMyBoYWxmX3ZlYyA9IG5vcm1hbGl6ZShub3JtYWxpemUoZXllX3Bvc2l0aW9uIC0gZnJhZ19wb3NpdGlvbikgKyB0b19saWdodCk7XHJcbiAgICBmbG9hdCBuZGwgPSBjbGFtcChkb3QodG9fbGlnaHQsIHN1cmZhY2Vfbm9ybWFsKSwgMC5mLCAxLmYpO1xyXG4gICAgZmxvYXQgbmRoID0gcG93KGNsYW1wKGRvdChoYWxmX3ZlYywgc3VyZmFjZV9ub3JtYWwpLCAwLjAsIDEuZiksIHNwZWN1bGFyX3Bvdyk7XHJcblxyXG4gICAgdmVjMyBkaXJlY3Rpb25hbCA9IGZyYWdfY29sb3IucmdiICogbmRsO1xyXG4gICAgdmVjMyBzcGVjdWxhciA9IHZlYzMoMSwgMSwgMSkgKiBuZGggKiBzcGVjdWxhcl9pbnRlbnNpdHk7XHJcbiAgICBvdXRfY29sb3IgPSB2ZWM0KGRpcmVjdGlvbmFsICsgc3BlY3VsYXIsIGZyYWdfY29sb3IuYSk7XHJcbn1gXHJcblxyXG5pbnRlcmZhY2UgVmVydGV4T3B0aW9ucyB7XHJcbiAgICBwb3NpdGlvbj86IGdlby5WZWMzXHJcbiAgICBub3JtYWw/OiBnZW8uVmVjM1xyXG4gICAgY29sb3I/OiBnZW8uVmVjNFxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgVmVydGV4IHtcclxuICAgIHBvc2l0aW9uOiBnZW8uVmVjM1xyXG4gICAgbm9ybWFsOiBnZW8uVmVjM1xyXG4gICAgY29sb3I6IGdlby5WZWM0XHJcblxyXG4gICAgY29uc3RydWN0b3Iob3B0aW9uczogVmVydGV4T3B0aW9ucyA9IHt9KSB7XHJcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IG9wdGlvbnMucG9zaXRpb24/LmNsb25lKCkgPz8gbmV3IGdlby5WZWMzKDAsIDAsIDApXHJcbiAgICAgICAgdGhpcy5ub3JtYWwgPSBvcHRpb25zLm5vcm1hbD8uY2xvbmUoKSA/PyBuZXcgZ2VvLlZlYzMoMCwgMCwgMClcclxuICAgICAgICB0aGlzLmNvbG9yID0gb3B0aW9ucy5jb2xvcj8uY2xvbmUoKSA/PyBuZXcgZ2VvLlZlYzQoMSwgMSwgMSwgMSlcclxuICAgIH1cclxuXHJcbiAgICBjbG9uZSgpOiBWZXJ0ZXgge1xyXG4gICAgICAgIHJldHVybiBuZXcgVmVydGV4KHRoaXMpXHJcbiAgICB9XHJcbn1cclxuXHJcbmludGVyZmFjZSBJeE1lc2hPcHRpb25zIHtcclxuICAgIHZlcnRpY2VzPzogVmVydGV4W11cclxuICAgIGluZGljZXM/OiBudW1iZXJbXVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgSXhNZXNoIHtcclxuICAgIHB1YmxpYyB2ZXJ0aWNlczogVmVydGV4W10gPSBbXVxyXG4gICAgcHVibGljIGluZGljZXM6IG51bWJlcltdID0gW11cclxuXHJcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zOiBJeE1lc2hPcHRpb25zID0ge30pIHtcclxuICAgICAgICBpZiAob3B0aW9ucy52ZXJ0aWNlcykge1xyXG4gICAgICAgICAgICB0aGlzLnZlcnRpY2VzLnB1c2goLi4ub3B0aW9ucy52ZXJ0aWNlcylcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChvcHRpb25zLmluZGljZXMpIHtcclxuICAgICAgICAgICAgdGhpcy5pbmRpY2VzLnB1c2goLi4ub3B0aW9ucy5pbmRpY2VzKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbGVhcigpIHtcclxuICAgICAgICB0aGlzLnZlcnRpY2VzID0gW11cclxuICAgICAgICB0aGlzLmluZGljZXMgPSBbXVxyXG4gICAgfVxyXG5cclxuICAgIHRyYW5zZm9ybShtYXQ6IGdlby5NYXQ0KSB7XHJcbiAgICAgICAgdHJhbnNmb3JtKG1hdCwgdGhpcy52ZXJ0aWNlcylcclxuICAgIH1cclxuXHJcbiAgICBjYXQoaXhtOiBJeE1lc2gpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBvZmZzZXQgPSB0aGlzLnZlcnRpY2VzLmxlbmd0aFxyXG4gICAgICAgIHRoaXMudmVydGljZXMucHVzaCguLi5peG0udmVydGljZXMubWFwKHYgPT4gdi5jbG9uZSgpKSlcclxuICAgICAgICB0aGlzLmluZGljZXMucHVzaCguLi5peG0uaW5kaWNlcy5tYXAoaXggPT4gaXggKyBvZmZzZXQpKVxyXG4gICAgfVxyXG5cclxuICAgIGNhbGNBQUJCKCk6IGdlby5BQUJCIHtcclxuICAgICAgICByZXR1cm4gY2FsY0FBQkIodGhpcy52ZXJ0aWNlcylcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgY3ViZSgpOiBJeE1lc2gge1xyXG4gICAgICAgIC8vIC14LCAreCwgLXksICt5LCAteiwgK3pcclxuICAgICAgICBjb25zdCB2ZXJ0aWNlcyA9IG5ldyBBcnJheTxWZXJ0ZXg+KFxyXG4gICAgICAgICAgICAvLyAteFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgLTEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoLTEsIDAsIDApIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgLTEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygtMSwgMCwgMCkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAxLCAxKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoLTEsIDAsIDApLCB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIDEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoLTEsIDAsIDApIH0pLFxyXG4gICAgICAgICAgICAvLyAreFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAtMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDEsIDAsIDApIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAtMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygxLCAwLCAwKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygxLCAwLCAwKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDEsIDAsIDApIH0pLFxyXG4gICAgICAgICAgICAvLyAteVxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgLTEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAtMSwgMCkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAtMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAtMSwgMCkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIC0xLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIC0xLCAwKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgLTEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAtMSwgMCkgfSksXHJcbiAgICAgICAgICAgIC8vICt5XHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAxLCAxKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMSwgMCkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIDEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAxLCAwKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAxLCAwKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIDEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMSwgMCkgfSksXHJcbiAgICAgICAgICAgIC8vIC16XHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAtMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAwLCAtMSkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAxLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIC0xKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAwLCAtMSkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIC0xLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIC0xKSB9KSxcclxuICAgICAgICAgICAgLy8gK3pcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIC0xLCAxKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMCwgMSkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIC0xLCAxKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMCwgMSkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIDEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAwLCAxKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIDEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAwLCAxKSB9KVxyXG4gICAgICAgIClcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBJeE1lc2goe1xyXG4gICAgICAgICAgICB2ZXJ0aWNlcyxcclxuICAgICAgICAgICAgaW5kaWNlczogcXVhZEluZGljZXModmVydGljZXMubGVuZ3RoIC8gNClcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBzcGhlcmUocm93czogbnVtYmVyLCBjb2xzOiBudW1iZXIpOiBJeE1lc2gge1xyXG4gICAgICAgIC8vIGNyZWF0ZSBub3J0aCBwb2xlXHJcbiAgICAgICAgY29uc3QgdmVydGljZXMgPSBuZXcgQXJyYXk8VmVydGV4PigpXHJcbiAgICAgICAgY29uc3QgaW5kaWNlcyA9IG5ldyBBcnJheTxudW1iZXI+KClcclxuICAgICAgICBjb25zdCBub3J0aFBvbGUgPSBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygwLCAxLCAwKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMSwgMCksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMSwgMSwgMSkgfSlcclxuICAgICAgICB2ZXJ0aWNlcy5wdXNoKG5vcnRoUG9sZSlcclxuXHJcbiAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIGFuZ2xlcywgZXNzZW50aWFsbHkgZm9ybWluZyBwb2xhciBjb29yZGluYXRlcyBvZiBlYWNoIHBvaW50XHJcbiAgICAgICAgLy8gbGV0IHRoZXRhID0gZWxldmF0aW9uIGFuZ2xlIGFib3ZlIHh5IHBsYW5lXHJcbiAgICAgICAgLy8gbGV0IHBoaSA9IHh5IHBsYW5lIGFuZ2xlXHJcbiAgICAgICAgY29uc3QgZHRoZXRhID0gTWF0aC5QSSAvIChyb3dzICsgMSlcclxuICAgICAgICBjb25zdCBkcGhpID0gMiAqIE1hdGguUEkgLyBjb2xzXHJcblxyXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY29sczsgKytqKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBoaSA9IGRwaGkgKiBqXHJcbiAgICAgICAgICAgIGNvbnN0IHRoZXRhID0gZHRoZXRhXHJcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gbmV3IGdlby5WZWMzKFxyXG4gICAgICAgICAgICAgICAgTWF0aC5zaW4odGhldGEpICogTWF0aC5jb3MocGhpKSxcclxuICAgICAgICAgICAgICAgIE1hdGguY29zKHRoZXRhKSxcclxuICAgICAgICAgICAgICAgIE1hdGguc2luKHRoZXRhKSAqIE1hdGguc2luKHBoaSlcclxuICAgICAgICAgICAgKVxyXG5cclxuICAgICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVydGV4KHsgcG9zaXRpb246IHBvc2l0aW9uLCBub3JtYWw6IHBvc2l0aW9uLCBjb2xvcjogbmV3IGdlby5WZWM0KDEsIDEsIDEsIDEpIH0pKVxyXG5cclxuICAgICAgICAgICAgLy8gY29ubmVjdCB0byBwb2xlIHRvIGZvcm0gdHJpYW5nbGVcclxuICAgICAgICAgICAgaW5kaWNlcy5wdXNoKGogKyAxLCAoaiArIDEpICUgY29scyArIDEsIDApXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBpbnRlcmlvclxyXG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcm93czsgKytpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRoZXRhID0gZHRoZXRhICogKGkgKyAxKVxyXG4gICAgICAgICAgICBjb25zdCBwcmV2Um93T2Zmc2V0ID0gKGkgLSAxKSAqIGNvbHMgKyAxXHJcbiAgICAgICAgICAgIGNvbnN0IHJvd09mZnNldCA9IHByZXZSb3dPZmZzZXQgKyBjb2xzXHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY29sczsgKytqKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwaGkgPSBkcGhpICogalxyXG4gICAgICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSBuZXcgZ2VvLlZlYzMoXHJcbiAgICAgICAgICAgICAgICAgICAgTWF0aC5zaW4odGhldGEpICogTWF0aC5jb3MocGhpKSxcclxuICAgICAgICAgICAgICAgICAgICBNYXRoLmNvcyh0aGV0YSksXHJcbiAgICAgICAgICAgICAgICAgICAgTWF0aC5zaW4odGhldGEpICogTWF0aC5zaW4ocGhpKVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVydGV4KHsgcG9zaXRpb246IHBvc2l0aW9uLCBub3JtYWw6IHBvc2l0aW9uLCBjb2xvcjogbmV3IGdlby5WZWM0KDEsIDEsIDEsIDEpIH0pKVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBwcmV2Um93T2Zmc2V0ICsgalxyXG4gICAgICAgICAgICAgICAgY29uc3QgYiA9IHJvd09mZnNldCArIGpcclxuICAgICAgICAgICAgICAgIGNvbnN0IGMgPSByb3dPZmZzZXQgKyAoaiArIDEpICUgY29sc1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZCA9IHByZXZSb3dPZmZzZXQgKyAoaiArIDEpICUgY29sc1xyXG4gICAgICAgICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGMsIGEsIGMsIGQpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGNyZWF0ZSBzb3V0aCBwb2xlXHJcbiAgICAgICAgY29uc3Qgc291dGhQb2xlID0gbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMCwgLTEsIDApLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAtMSwgMCksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMSwgMSwgMSkgfSlcclxuICAgICAgICB2ZXJ0aWNlcy5wdXNoKHNvdXRoUG9sZSlcclxuICAgICAgICBjb25zdCBzb3V0aFBvbGVJZHggPSB2ZXJ0aWNlcy5sZW5ndGggLSAxXHJcblxyXG4gICAgICAgIC8vIGNvbm5lY3Qgc291dGggcG9sZSB0byByZXN0IG9mIG1lc2hcclxuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNvbHM7ICsraikge1xyXG4gICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBzb3V0aFBvbGVJZHggLSBjb2xzXHJcblxyXG4gICAgICAgICAgICAvLyBjb25uZWN0IHRvIHBvbGUgdG8gZm9ybSB0cmlhbmdsZVxyXG4gICAgICAgICAgICBpbmRpY2VzLnB1c2gob2Zmc2V0ICsgaiwgc291dGhQb2xlSWR4LCBvZmZzZXQgKyAoaiArIDEpICUgY29scylcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgSXhNZXNoKHtcclxuICAgICAgICAgICAgdmVydGljZXMsXHJcbiAgICAgICAgICAgIGluZGljZXNcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyByZWN0KGFhYmI6IGdlby5BQUJCKTogSXhNZXNoIHtcclxuICAgICAgICAvLyAteCwgK3gsIC15LCAreSwgLXosICt6XHJcbiAgICAgICAgY29uc3QgbWVzaCA9IEl4TWVzaC5jdWJlKClcclxuICAgICAgICBjb25zdCBoYWxmRXh0ZW50cyA9IGFhYmIuZXh0ZW50cy5kaXZYKDIpXHJcbiAgICAgICAgY29uc3QgbmVnSGFsZkV4dGVudHMgPSBoYWxmRXh0ZW50cy5uZWcoKVxyXG4gICAgICAgIGNvbnN0IHRyYW5zbGF0aW9uID0gZ2VvLk1hdDQudHJhbnNsYXRpb24oYWFiYi5taW4uc3ViKG5lZ0hhbGZFeHRlbnRzKSlcclxuICAgICAgICBjb25zdCBzY2FsaW5nID0gZ2VvLk1hdDQuc2NhbGluZyhoYWxmRXh0ZW50cylcclxuICAgICAgICBjb25zdCBtYXQgPSBzY2FsaW5nLm1hdG11bCh0cmFuc2xhdGlvbilcclxuICAgICAgICBtZXNoLnRyYW5zZm9ybShtYXQpXHJcbiAgICAgICAgcmV0dXJuIG1lc2hcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgcmVjdEZyb21Db29yZHMobWluWDogbnVtYmVyLCBtaW5ZOiBudW1iZXIsIG1pblo6IG51bWJlciwgbWF4WDogbnVtYmVyLCBtYXhZOiBudW1iZXIsIG1heFo6IG51bWJlcik6IEl4TWVzaCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVjdChnZW8uQUFCQi5mcm9tQ29vcmRzKG1pblgsIG1pblksIG1pblosIG1heFgsIG1heFksIG1heFopKVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBxdWFkSW5kaWNlcyhxdWFkczogbnVtYmVyKTogbnVtYmVyW10ge1xyXG4gICAgcmV0dXJuIGFycmF5LmdlbmVyYXRlKHF1YWRzLCBpID0+IFtpICogNCwgaSAqIDQgKyAxLCBpICogNCArIDIsIGkgKiA0LCBpICogNCArIDIsIGkgKiA0ICsgM10pLmZsYXQoKVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIE1lc2hEYXRhIHtcclxuICAgIHZlcnRpY2VzOiBWZXJ0ZXhbXVxyXG4gICAgaW5kaWNlczogbnVtYmVyW11cclxuICAgIGluZGV4T2Zmc2V0OiBudW1iZXJcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBCYXRjaE9wdGlvbnMge1xyXG4gICAgd29ybGRNYXRyaXg/OiBnZW8uTWF0NFxyXG4gICAgZGlmZnVzZUNvbG9yPzogZ2VvLlZlYzRcclxuICAgIHJvdWdobmVzcz86IG51bWJlclxyXG4gICAgdmFvPzogV2ViR0xWZXJ0ZXhBcnJheU9iamVjdFxyXG4gICAgb2Zmc2V0PzogbnVtYmVyXHJcbiAgICBudW1JbmRpY2VzPzogbnVtYmVyXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBCYXRjaCB7XHJcbiAgICBwdWJsaWMgd29ybGRNYXRyaXg6IGdlby5NYXQ0XHJcbiAgICBwdWJsaWMgZGlmZnVzZUNvbG9yOiBnZW8uVmVjNCA9IG5ldyBnZW8uVmVjNCgxLCAxLCAxLCAxKVxyXG4gICAgcHVibGljIHJvdWdobmVzczogbnVtYmVyID0gMFxyXG4gICAgcHVibGljIHZhbzogV2ViR0xWZXJ0ZXhBcnJheU9iamVjdCB8IG51bGxcclxuICAgIHB1YmxpYyBvZmZzZXQ6IG51bWJlclxyXG4gICAgcHVibGljIG51bUluZGljZXM6IG51bWJlclxyXG5cclxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM6IEJhdGNoT3B0aW9ucyA9IHt9KSB7XHJcbiAgICAgICAgdGhpcy53b3JsZE1hdHJpeCA9IG9wdGlvbnMud29ybGRNYXRyaXggPz8gZ2VvLk1hdDQuaWRlbnRpdHkoKVxyXG4gICAgICAgIHRoaXMuZGlmZnVzZUNvbG9yID0gb3B0aW9ucy5kaWZmdXNlQ29sb3IgPz8gbmV3IGdlby5WZWM0KDEsIDEsIDEsIDEpXHJcbiAgICAgICAgdGhpcy5yb3VnaG5lc3MgPSBvcHRpb25zLnJvdWdobmVzcyA/PyAwXHJcbiAgICAgICAgdGhpcy52YW8gPSBvcHRpb25zLnZhbyA/PyBudWxsXHJcbiAgICAgICAgdGhpcy5vZmZzZXQgPSBvcHRpb25zLm9mZnNldCA/PyAwXHJcbiAgICAgICAgdGhpcy5udW1JbmRpY2VzID0gb3B0aW9ucy5udW1JbmRpY2VzID8/IDBcclxuICAgIH1cclxufVxyXG5cclxuY29uc3QgZWxlbXNQZXJWZXJ0ZXggPSAxMFxyXG5jb25zdCB2ZXJ0ZXhTdHJpZGUgPSBlbGVtc1BlclZlcnRleCAqIDRcclxuXHJcbmV4cG9ydCBjbGFzcyBSZW5kZXJlciB7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGdsOiBXZWJHTDJSZW5kZXJpbmdDb250ZXh0XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IHByb2dyYW06IFdlYkdMUHJvZ3JhbVxyXG4gICAgcHJpdmF0ZSByZWFkb25seSB3b3JsZE1hdHJpeExvYzogV2ViR0xVbmlmb3JtTG9jYXRpb25cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgdmlld01hdHJpeExvYzogV2ViR0xVbmlmb3JtTG9jYXRpb25cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgcHJvamVjdGlvbk1hdHJpeExvYzogV2ViR0xVbmlmb3JtTG9jYXRpb25cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGlmZnVzZUNvbG9yTG9jOiBXZWJHTFVuaWZvcm1Mb2NhdGlvblxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBleWVQb3NpdGlvbkxvYzogV2ViR0xVbmlmb3JtTG9jYXRpb25cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgcm91Z2huZXNzTG9jOiBXZWJHTFVuaWZvcm1Mb2NhdGlvblxyXG4gICAgcHVibGljIHByb2plY3Rpb25NYXRyaXg6IGdlby5NYXQ0ID0gZ2VvLk1hdDQuaWRlbnRpdHkoKVxyXG4gICAgcHVibGljIHZpZXdNYXRyaXg6IGdlby5NYXQ0ID0gZ2VvLk1hdDQuaWRlbnRpdHkoKVxyXG4gICAgcHJpdmF0ZSBiYXRjaGVzOiBCYXRjaFtdID0gW11cclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmdsID0gZ2x1LmNyZWF0ZUNvbnRleHQodGhpcy5jYW52YXMpXHJcbiAgICAgICAgY29uc3QgZ2wgPSB0aGlzLmdsXHJcbiAgICAgICAgdGhpcy5wcm9ncmFtID0gZ2x1LmNvbXBpbGVQcm9ncmFtKGdsLCB2ZXJ0ZXhTcmMsIGZyYWdtZW50U3JjKVxyXG4gICAgICAgIHRoaXMud29ybGRNYXRyaXhMb2MgPSBnbHUuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsLCB0aGlzLnByb2dyYW0sIFwid29ybGRfbWF0cml4XCIpXHJcbiAgICAgICAgdGhpcy52aWV3TWF0cml4TG9jID0gZ2x1LmdldFVuaWZvcm1Mb2NhdGlvbihnbCwgdGhpcy5wcm9ncmFtLCBcInZpZXdfbWF0cml4XCIpXHJcbiAgICAgICAgdGhpcy5wcm9qZWN0aW9uTWF0cml4TG9jID0gZ2x1LmdldFVuaWZvcm1Mb2NhdGlvbihnbCwgdGhpcy5wcm9ncmFtLCBcInByb2plY3Rpb25fbWF0cml4XCIpXHJcbiAgICAgICAgdGhpcy5wcm9qZWN0aW9uTWF0cml4TG9jID0gZ2x1LmdldFVuaWZvcm1Mb2NhdGlvbihnbCwgdGhpcy5wcm9ncmFtLCBcInByb2plY3Rpb25fbWF0cml4XCIpXHJcbiAgICAgICAgdGhpcy5kaWZmdXNlQ29sb3JMb2MgPSBnbHUuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsLCB0aGlzLnByb2dyYW0sIFwiZGlmZnVzZV9jb2xvclwiKVxyXG4gICAgICAgIHRoaXMuZXllUG9zaXRpb25Mb2MgPSBnbHUuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsLCB0aGlzLnByb2dyYW0sIFwiZXllX3Bvc2l0aW9uXCIpXHJcbiAgICAgICAgdGhpcy5yb3VnaG5lc3NMb2MgPSBnbHUuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsLCB0aGlzLnByb2dyYW0sIFwicm91Z2huZXNzXCIpXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHByZXNlbnQoKSB7XHJcbiAgICAgICAgY29uc3QgZ2wgPSB0aGlzLmdsXHJcblxyXG4gICAgICAgIHRoaXMucHJvamVjdGlvbk1hdHJpeCA9IGdlby5NYXQ0LnBlcnNwZWN0aXZlKE1hdGguUEkgLyAyLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGggLyBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0LCAxLCA1MTIpXHJcblxyXG4gICAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgbnVsbClcclxuICAgICAgICBnbC52aWV3cG9ydCgwLCAwLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGgsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQpXHJcbiAgICAgICAgZ2wuY2xlYXJDb2xvcigwLCAwLCAwLCAxKVxyXG4gICAgICAgIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQgfCBnbC5ERVBUSF9CVUZGRVJfQklUKVxyXG4gICAgICAgIGdsLmVuYWJsZShnbC5ERVBUSF9URVNUKVxyXG4gICAgICAgIHRoaXMucmVuZGVyQmF0Y2hlcygpXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNyZWF0ZU1lc2gobWVzaDogSXhNZXNoKTogV2ViR0xWZXJ0ZXhBcnJheU9iamVjdCB7XHJcbiAgICAgICAgLy8gZm9yIG5vdyAtIHBsYWNlIHNpbmdsZSB0cmlhbmdsZSBpbnRvIHZlcnRleCBidWZmZXJcclxuICAgICAgICBjb25zdCBnbCA9IHRoaXMuZ2xcclxuICAgICAgICBjb25zdCB2Ym8gPSBnbHUuY3JlYXRlQnVmZmVyKGdsKVxyXG4gICAgICAgIGNvbnN0IGlibyA9IGdsdS5jcmVhdGVCdWZmZXIoZ2wpXHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHZibylcclxuICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgdG9GbG9hdEFycmF5KG1lc2gudmVydGljZXMpLCBnbC5TVEFUSUNfRFJBVylcclxuICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBpYm8pXHJcbiAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgbmV3IFVpbnQzMkFycmF5KG1lc2guaW5kaWNlcyksIGdsLlNUQVRJQ19EUkFXKVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVZhbyh2Ym8sIGlibylcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZHJhd0JhdGNoKGJhdGNoOiBCYXRjaCkge1xyXG4gICAgICAgIHRoaXMuYmF0Y2hlcy5wdXNoKGJhdGNoKVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY3JlYXRlVmFvKHZibzogV2ViR0xCdWZmZXIsIGlibzogV2ViR0xCdWZmZXIpOiBXZWJHTFZlcnRleEFycmF5T2JqZWN0IHtcclxuICAgICAgICBjb25zdCB7IGdsLCBwcm9ncmFtIH0gPSB0aGlzXHJcbiAgICAgICAgY29uc3QgdmFvID0gZ2x1LmNyZWF0ZVZlcnRleEFycmF5KGdsKVxyXG4gICAgICAgIGdsLmJpbmRWZXJ0ZXhBcnJheSh2YW8pXHJcblxyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uQXR0cmliSWR4ID0gZ2x1LmdldEF0dHJpYkxvY2F0aW9uKGdsLCBwcm9ncmFtLCBcInZlcnRfcG9zaXRpb25cIilcclxuICAgICAgICBjb25zdCBub3JtYWxBdHRyaWJJZHggPSBnbHUuZ2V0QXR0cmliTG9jYXRpb24oZ2wsIHByb2dyYW0sIFwidmVydF9ub3JtYWxcIilcclxuICAgICAgICBjb25zdCBjb2xvckF0dHJpYklkeCA9IGdsdS5nZXRBdHRyaWJMb2NhdGlvbihnbCwgcHJvZ3JhbSwgXCJ2ZXJ0X2NvbG9yXCIpXHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHZibylcclxuICAgICAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShwb3NpdGlvbkF0dHJpYklkeClcclxuICAgICAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShub3JtYWxBdHRyaWJJZHgpXHJcbiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoY29sb3JBdHRyaWJJZHgpXHJcbiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihwb3NpdGlvbkF0dHJpYklkeCwgMywgZ2wuRkxPQVQsIGZhbHNlLCB2ZXJ0ZXhTdHJpZGUsIDApXHJcbiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihub3JtYWxBdHRyaWJJZHgsIDMsIGdsLkZMT0FULCBmYWxzZSwgdmVydGV4U3RyaWRlLCAxMilcclxuICAgICAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKGNvbG9yQXR0cmliSWR4LCA0LCBnbC5GTE9BVCwgZmFsc2UsIHZlcnRleFN0cmlkZSwgMjQpXHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgaWJvKVxyXG5cclxuICAgICAgICBnbC5iaW5kVmVydGV4QXJyYXkobnVsbClcclxuICAgICAgICByZXR1cm4gdmFvXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZW5kZXJCYXRjaGVzKCkge1xyXG4gICAgICAgIGNvbnN0IGdsID0gdGhpcy5nbFxyXG4gICAgICAgIGdsLnVzZVByb2dyYW0odGhpcy5wcm9ncmFtKVxyXG4gICAgICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYodGhpcy5wcm9qZWN0aW9uTWF0cml4TG9jLCBmYWxzZSwgdGhpcy5wcm9qZWN0aW9uTWF0cml4LnRvQXJyYXkoKSlcclxuICAgICAgICBnbC51bmlmb3JtTWF0cml4NGZ2KHRoaXMudmlld01hdHJpeExvYywgZmFsc2UsIHRoaXMudmlld01hdHJpeC50b0FycmF5KCkpXHJcblxyXG4gICAgICAgIC8vIGRldGVybWluZSBleWUgcG9zaXRpb24gYW5kIHNldCB1bmlmb3JtXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjb25zdCBpbnZWaWV3TWF0cml4ID0gdGhpcy52aWV3TWF0cml4LmludmVydCgpXHJcbiAgICAgICAgICAgIGNvbnN0IGV5ZVBvc2l0aW9uID0gaW52Vmlld01hdHJpeC50cmFuc2Zvcm0zKG5ldyBnZW8uVmVjMygwLCAwLCAwKSlcclxuICAgICAgICAgICAgZ2wudW5pZm9ybTNmdih0aGlzLmV5ZVBvc2l0aW9uTG9jLCBleWVQb3NpdGlvbi50b0FycmF5KCkpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGNvbnN0IGJhdGNoIG9mIHRoaXMuYmF0Y2hlcykge1xyXG4gICAgICAgICAgICBpZiAoIWJhdGNoLnZhbykge1xyXG4gICAgICAgICAgICAgICAgY29udGludWVcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGJhdGNoLm51bUluZGljZXMgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgY29udGludWVcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZ2wudW5pZm9ybU1hdHJpeDRmdih0aGlzLndvcmxkTWF0cml4TG9jLCBmYWxzZSwgYmF0Y2gud29ybGRNYXRyaXgudG9BcnJheSgpKVxyXG4gICAgICAgICAgICBnbC51bmlmb3JtNGZ2KHRoaXMuZGlmZnVzZUNvbG9yTG9jLCBiYXRjaC5kaWZmdXNlQ29sb3IudG9BcnJheSgpKVxyXG4gICAgICAgICAgICBnbC51bmlmb3JtMWYodGhpcy5yb3VnaG5lc3NMb2MsIGJhdGNoLnJvdWdobmVzcylcclxuICAgICAgICAgICAgZ2wuYmluZFZlcnRleEFycmF5KGJhdGNoLnZhbylcclxuICAgICAgICAgICAgZ2wuZHJhd0VsZW1lbnRzKGdsLlRSSUFOR0xFUywgYmF0Y2gubnVtSW5kaWNlcywgZ2wuVU5TSUdORURfSU5ULCBiYXRjaC5vZmZzZXQpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmJhdGNoZXMgPSBbXVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiB0b0Zsb2F0QXJyYXkodmVydGljZXM6IFZlcnRleFtdKTogRmxvYXQzMkFycmF5IHtcclxuICAgIGNvbnN0IGEgPSBuZXcgRmxvYXQzMkFycmF5KHZlcnRpY2VzLmZsYXRNYXAodiA9PiBbXHJcbiAgICAgICAgdi5wb3NpdGlvbi54LCB2LnBvc2l0aW9uLnksIHYucG9zaXRpb24ueixcclxuICAgICAgICB2Lm5vcm1hbC54LCB2Lm5vcm1hbC55LCB2Lm5vcm1hbC56LFxyXG4gICAgICAgIHYuY29sb3IueCwgdi5jb2xvci55LCB2LmNvbG9yLnosIHYuY29sb3Iud10pKVxyXG5cclxuICAgIHJldHVybiBhXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0cmFuc2Zvcm0obWF0OiBnZW8uTWF0NCwgdmVydGljZXM6IFZlcnRleFtdKSB7XHJcbiAgICBjb25zdCBiYXNpcyA9IG1hdC50b01hdDMoKVxyXG4gICAgZm9yIChjb25zdCB2IG9mIHZlcnRpY2VzKSB7XHJcbiAgICAgICAgdi5wb3NpdGlvbiA9IG1hdC50cmFuc2Zvcm0zKHYucG9zaXRpb24pXHJcbiAgICAgICAgdi5ub3JtYWwgPSBiYXNpcy50cmFuc2Zvcm0odi5ub3JtYWwpXHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjYWxjQUFCQih2ZXJ0aWNlczogSXRlcmFibGU8VmVydGV4Pik6IGdlby5BQUJCIHtcclxuICAgIGNvbnN0IGFhYmIgPSBnZW8uQUFCQi5mcm9tUG9pbnRzKGl0ZXIubWFwKHZlcnRpY2VzLCB2ID0+IHYucG9zaXRpb24pKVxyXG4gICAgcmV0dXJuIGFhYmJcclxufSJdfQ==