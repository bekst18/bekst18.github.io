import * as glu from "../shared/glu.js";
import * as geo from "../shared/geo3d.js";
import * as array from "../shared/array.js";
import * as iter from "../shared/iter.js";
const vertexSrc = `#version 300 es
precision mediump float;
uniform mat4 world_matrix;
uniform mat4 view_matrix;
uniform mat4 projection_matrix;
uniform vec4 diffuse_color;
in vec3 vert_position;
in vec3 vert_normal;
in vec4 vert_color;
out vec3 frag_normal;
out vec4 frag_color;

void main() {
    frag_color = vert_color * diffuse_color;
    frag_normal - vert_normal;
    gl_Position = projection_matrix * view_matrix * world_matrix * vec4(vert_position, 1.f);
}`;
const fragmentSrc = `#version 300 es
precision highp float;
precision highp sampler2D;
precision highp sampler2DArray;

in vec4 frag_color;
in vec3 frag_normal;
out vec4 out_color;

void main() {
    out_color = frag_color;
}`;
export class Vertex {
    constructor(options = {}) {
        var _a, _b, _c, _d, _e, _f;
        this.position = (_b = (_a = options.position) === null || _a === void 0 ? void 0 : _a.clone()) !== null && _b !== void 0 ? _b : new geo.Vec3(0, 0, 0);
        this.normal = (_d = (_c = options.normal) === null || _c === void 0 ? void 0 : _c.clone()) !== null && _d !== void 0 ? _d : new geo.Vec3(0, 0, 0);
        this.color = (_f = (_e = options.color) === null || _e === void 0 ? void 0 : _e.clone()) !== null && _f !== void 0 ? _f : new geo.Vec4(1, 1, 1, 1);
    }
    clone() {
        return new Vertex(this);
    }
}
export class IxMesh {
    constructor(options = {}) {
        this.vertices = [];
        this.indices = [];
        if (options.vertices) {
            this.vertices.push(...options.vertices);
        }
        if (options.indices) {
            this.indices.push(...options.indices);
        }
    }
    clear() {
        this.vertices = [];
        this.indices = [];
    }
    transform(mat) {
        transform(mat, this.vertices);
    }
    cat(ixm) {
        const offset = this.vertices.length;
        this.vertices.push(...ixm.vertices.map(v => v.clone()));
        this.indices.push(...ixm.indices.map(ix => ix + offset));
    }
    calcAABB() {
        return calcAABB(this.vertices);
    }
    static cube() {
        // -x, +x, -y, +y, -z, +z
        const vertices = new Array(
        // -x
        new Vertex({ position: new geo.Vec3(-1, -1, -1), normal: new geo.Vec3(-1, 0, 0) }), new Vertex({ position: new geo.Vec3(-1, -1, 1), normal: new geo.Vec3(-1, 0, 0) }), new Vertex({ position: new geo.Vec3(-1, 1, 1), normal: new geo.Vec3(-1, 0, 0), }), new Vertex({ position: new geo.Vec3(-1, 1, -1), normal: new geo.Vec3(-1, 0, 0) }), 
        // +x
        new Vertex({ position: new geo.Vec3(1, -1, 1), normal: new geo.Vec3(1, 0, 0) }), new Vertex({ position: new geo.Vec3(1, -1, -1), normal: new geo.Vec3(1, 0, 0) }), new Vertex({ position: new geo.Vec3(1, 1, -1), normal: new geo.Vec3(1, 0, 0) }), new Vertex({ position: new geo.Vec3(1, 1, 1), normal: new geo.Vec3(1, 0, 0) }), 
        // -y
        new Vertex({ position: new geo.Vec3(-1, -1, 1), normal: new geo.Vec3(0, -1, 0) }), new Vertex({ position: new geo.Vec3(-1, -1, -1), normal: new geo.Vec3(0, -1, 0) }), new Vertex({ position: new geo.Vec3(1, -1, -1), normal: new geo.Vec3(0, -1, 0) }), new Vertex({ position: new geo.Vec3(1, -1, 1), normal: new geo.Vec3(0, -1, 0) }), 
        // +y
        new Vertex({ position: new geo.Vec3(-1, 1, 1), normal: new geo.Vec3(0, 1, 0) }), new Vertex({ position: new geo.Vec3(1, 1, 1), normal: new geo.Vec3(0, 1, 0) }), new Vertex({ position: new geo.Vec3(1, 1, -1), normal: new geo.Vec3(0, 1, 0) }), new Vertex({ position: new geo.Vec3(-1, 1, -1), normal: new geo.Vec3(0, 1, 0) }), 
        // -z
        new Vertex({ position: new geo.Vec3(-1, -1, -1), normal: new geo.Vec3(0, 0, -1) }), new Vertex({ position: new geo.Vec3(-1, 1, -1), normal: new geo.Vec3(0, 0, -1) }), new Vertex({ position: new geo.Vec3(1, 1, -1), normal: new geo.Vec3(0, 0, -1) }), new Vertex({ position: new geo.Vec3(1, -1, -1), normal: new geo.Vec3(0, 0, -1) }), 
        // +z
        new Vertex({ position: new geo.Vec3(-1, -1, 1), normal: new geo.Vec3(0, 0, 1) }), new Vertex({ position: new geo.Vec3(1, -1, 1), normal: new geo.Vec3(0, 0, 1) }), new Vertex({ position: new geo.Vec3(1, 1, 1), normal: new geo.Vec3(0, 0, 1) }), new Vertex({ position: new geo.Vec3(-1, 1, 1), normal: new geo.Vec3(0, 0, 1) }));
        return new IxMesh({
            vertices,
            indices: quadIndices(vertices.length / 4)
        });
    }
    static sphere(rows, cols) {
        // create north pole
        const vertices = new Array();
        const indices = new Array();
        const northPole = new Vertex({ position: new geo.Vec3(0, 1, 0), normal: new geo.Vec3(0, 1, 0), color: new geo.Vec4(1, 1, 1, 1) });
        vertices.push(northPole);
        // iterate over angles, essentially forming polar coordinates of each point
        // let theta = elevation angle above xy plane
        // let phi = xy plane angle
        const dtheta = Math.PI / (rows + 1);
        const dphi = 2 * Math.PI / cols;
        for (let j = 0; j < cols; ++j) {
            const phi = dphi * j;
            const theta = dtheta;
            const position = new geo.Vec3(Math.sin(theta) * Math.cos(phi), Math.cos(theta), Math.sin(theta) * Math.sin(phi));
            vertices.push(new Vertex({ position: position, normal: position, color: new geo.Vec4(1, 1, 1, 1) }));
            // connect to pole to form triangle
            indices.push(j + 1, (j + 1) % cols + 1, 0);
        }
        // interior
        for (let i = 1; i < rows; ++i) {
            const theta = dtheta * (i + 1);
            const prevRowOffset = (i - 1) * cols + 1;
            const rowOffset = prevRowOffset + cols;
            for (let j = 0; j < cols; ++j) {
                const phi = dphi * j;
                const position = new geo.Vec3(Math.sin(theta) * Math.cos(phi), Math.cos(theta), Math.sin(theta) * Math.sin(phi));
                vertices.push(new Vertex({ position: position, normal: position, color: new geo.Vec4(1, 1, 1, 1) }));
                const a = prevRowOffset + j;
                const b = rowOffset + j;
                const c = rowOffset + (j + 1) % cols;
                const d = prevRowOffset + (j + 1) % cols;
                indices.push(a, b, c, a, c, d);
            }
        }
        // create south pole
        const southPole = new Vertex({ position: new geo.Vec3(0, -1, 0), normal: new geo.Vec3(0, -1, 0), color: new geo.Vec4(1, 1, 1, 1) });
        vertices.push(southPole);
        const southPoleIdx = vertices.length - 1;
        // connect south pole to rest of mesh
        for (let j = 0; j < cols; ++j) {
            const offset = southPoleIdx - cols;
            // connect to pole to form triangle
            indices.push(offset + j, southPoleIdx, offset + (j + 1) % cols);
        }
        return new IxMesh({
            vertices,
            indices
        });
    }
    static rect(aabb) {
        // -x, +x, -y, +y, -z, +z
        const mesh = IxMesh.cube();
        const halfExtents = aabb.extents.divX(2);
        const negHalfExtents = halfExtents.neg();
        const translation = geo.Mat4.translation(aabb.min.sub(negHalfExtents));
        const scaling = geo.Mat4.scaling(halfExtents);
        const mat = scaling.matmul(translation);
        mesh.transform(mat);
        return mesh;
    }
    static rectFromCoords(minX, minY, minZ, maxX, maxY, maxZ) {
        return this.rect(geo.AABB.fromCoords(minX, minY, minZ, maxX, maxY, maxZ));
    }
}
function quadIndices(quads) {
    return array.generate(quads, i => [i * 4, i * 4 + 1, i * 4 + 2, i * 4, i * 4 + 2, i * 4 + 3]).flat();
}
export class Batch {
    constructor(options = {}) {
        var _a, _b, _c, _d, _e;
        this.diffuseColor = new geo.Vec4(1, 1, 1, 1);
        this.worldMatrix = (_a = options.worldMatrix) !== null && _a !== void 0 ? _a : geo.Mat4.identity();
        this.diffuseColor = (_b = options.diffuseColor) !== null && _b !== void 0 ? _b : new geo.Vec4(1, 1, 1, 1);
        this.vao = (_c = options.vao) !== null && _c !== void 0 ? _c : null;
        this.offset = (_d = options.offset) !== null && _d !== void 0 ? _d : 0;
        this.numIndices = (_e = options.numIndices) !== null && _e !== void 0 ? _e : 0;
    }
}
const elemsPerVertex = 10;
const vertexStride = elemsPerVertex * 4;
export class Renderer {
    constructor(canvas) {
        this.canvas = canvas;
        this.projectionMatrix = geo.Mat4.identity();
        this.viewMatrix = geo.Mat4.identity();
        this.batches = [];
        this.gl = glu.createContext(this.canvas);
        const gl = this.gl;
        this.program = glu.compileProgram(gl, vertexSrc, fragmentSrc);
        this.worldMatrixLoc = glu.getUniformLocation(gl, this.program, "world_matrix");
        this.viewMatrixLoc = glu.getUniformLocation(gl, this.program, "view_matrix");
        this.projectionMatrixLoc = glu.getUniformLocation(gl, this.program, "projection_matrix");
        this.projectionMatrixLoc = glu.getUniformLocation(gl, this.program, "projection_matrix");
        this.diffuseColorLoc = glu.getUniformLocation(gl, this.program, "diffuse_color");
    }
    present() {
        const gl = this.gl;
        this.projectionMatrix = geo.Mat4.perspective(Math.PI / 2, gl.drawingBufferWidth / gl.drawingBufferHeight, 1, 512);
        gl.bindFramebuffer(gl.FRAMEBUFFER, null);
        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
        gl.clearColor(0, 0, 0, 1);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
        this.renderBatches();
    }
    createMesh(mesh) {
        // for now - place single triangle into vertex buffer
        const gl = this.gl;
        const vbo = glu.createBuffer(gl);
        const ibo = glu.createBuffer(gl);
        gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
        gl.bufferData(gl.ARRAY_BUFFER, toFloatArray(mesh.vertices), gl.STATIC_DRAW);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint32Array(mesh.indices), gl.STATIC_DRAW);
        return this.createVao(vbo, ibo);
    }
    drawBatch(batch) {
        this.batches.push(batch);
    }
    createVao(vbo, ibo) {
        const { gl, program } = this;
        const vao = glu.createVertexArray(gl);
        gl.bindVertexArray(vao);
        const positionAttribIdx = glu.getAttribLocation(gl, program, "vert_position");
        const normalAttribIdx = glu.getAttribLocation(gl, program, "vert_normal");
        const colorAttribIdx = glu.getAttribLocation(gl, program, "vert_color");
        gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
        gl.enableVertexAttribArray(positionAttribIdx);
        gl.enableVertexAttribArray(normalAttribIdx);
        gl.enableVertexAttribArray(colorAttribIdx);
        gl.vertexAttribPointer(positionAttribIdx, 3, gl.FLOAT, false, vertexStride, 0);
        gl.vertexAttribPointer(normalAttribIdx, 3, gl.FLOAT, false, vertexStride, 12);
        gl.vertexAttribPointer(colorAttribIdx, 4, gl.FLOAT, false, vertexStride, 24);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
        gl.bindVertexArray(null);
        return vao;
    }
    renderBatches() {
        const gl = this.gl;
        gl.useProgram(this.program);
        gl.uniformMatrix4fv(this.projectionMatrixLoc, false, this.projectionMatrix.toArray());
        gl.uniformMatrix4fv(this.viewMatrixLoc, false, this.viewMatrix.toArray());
        for (const batch of this.batches) {
            if (!batch.vao) {
                continue;
            }
            if (batch.numIndices <= 0) {
                continue;
            }
            gl.uniformMatrix4fv(this.worldMatrixLoc, false, batch.worldMatrix.toArray());
            gl.uniform4fv(this.diffuseColorLoc, batch.diffuseColor.toArray());
            gl.bindVertexArray(batch.vao);
            gl.drawElements(gl.TRIANGLES, batch.numIndices, gl.UNSIGNED_INT, batch.offset);
        }
        this.batches = [];
    }
}
function toFloatArray(vertices) {
    const a = new Float32Array(vertices.flatMap(v => [
        v.position.x, v.position.y, v.position.z,
        v.normal.x, v.normal.y, v.normal.z,
        v.color.x, v.color.y, v.color.z, v.color.w
    ]));
    return a;
}
export function transform(mat, vertices) {
    const basis = mat.toMat3();
    for (const v of vertices) {
        v.position = mat.transform3(v.position);
        v.normal = basis.transform(v.normal);
    }
}
export function calcAABB(vertices) {
    const aabb = geo.AABB.fromPoints(iter.map(vertices, v => v.position));
    return aabb;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2Z4LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZ2Z4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxHQUFHLE1BQU0sa0JBQWtCLENBQUE7QUFDdkMsT0FBTyxLQUFLLEdBQUcsTUFBTSxvQkFBb0IsQ0FBQTtBQUN6QyxPQUFPLEtBQUssS0FBSyxNQUFNLG9CQUFvQixDQUFBO0FBQzNDLE9BQU8sS0FBSyxJQUFJLE1BQU0sbUJBQW1CLENBQUE7QUFFekMsTUFBTSxTQUFTLEdBQUc7Ozs7Ozs7Ozs7Ozs7Ozs7RUFnQmhCLENBQUE7QUFFRixNQUFNLFdBQVcsR0FBRzs7Ozs7Ozs7Ozs7RUFXbEIsQ0FBQTtBQVFGLE1BQU0sT0FBTyxNQUFNO0lBS2YsWUFBWSxVQUF5QixFQUFFOztRQUNuQyxJQUFJLENBQUMsUUFBUSxlQUFHLE9BQU8sQ0FBQyxRQUFRLDBDQUFFLEtBQUsscUNBQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDbEUsSUFBSSxDQUFDLE1BQU0sZUFBRyxPQUFPLENBQUMsTUFBTSwwQ0FBRSxLQUFLLHFDQUFNLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO1FBQzlELElBQUksQ0FBQyxLQUFLLGVBQUcsT0FBTyxDQUFDLEtBQUssMENBQUUsS0FBSyxxQ0FBTSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFDbkUsQ0FBQztJQUVELEtBQUs7UUFDRCxPQUFPLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQzNCLENBQUM7Q0FDSjtBQU9ELE1BQU0sT0FBTyxNQUFNO0lBSWYsWUFBWSxVQUF5QixFQUFFO1FBSGhDLGFBQVEsR0FBYSxFQUFFLENBQUE7UUFDdkIsWUFBTyxHQUFhLEVBQUUsQ0FBQTtRQUd6QixJQUFJLE9BQU8sQ0FBQyxRQUFRLEVBQUU7WUFDbEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUE7U0FDMUM7UUFFRCxJQUFJLE9BQU8sQ0FBQyxPQUFPLEVBQUU7WUFDakIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUE7U0FDeEM7SUFDTCxDQUFDO0lBRUQsS0FBSztRQUNELElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFBO1FBQ2xCLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFBO0lBQ3JCLENBQUM7SUFFRCxTQUFTLENBQUMsR0FBYTtRQUNuQixTQUFTLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUNqQyxDQUFDO0lBRUQsR0FBRyxDQUFDLEdBQVc7UUFDWCxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQTtRQUNuQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUN2RCxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUE7SUFDNUQsQ0FBQztJQUVELFFBQVE7UUFDSixPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDbEMsQ0FBQztJQUVELE1BQU0sQ0FBQyxJQUFJO1FBQ1AseUJBQXlCO1FBQ3pCLE1BQU0sUUFBUSxHQUFHLElBQUksS0FBSztRQUN0QixLQUFLO1FBQ0wsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUNsRixJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUNqRixJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFDakYsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDakYsS0FBSztRQUNMLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDL0UsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2hGLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDL0UsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDOUUsS0FBSztRQUNMLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2pGLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDbEYsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDakYsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ2hGLEtBQUs7UUFDTCxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQy9FLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQzlFLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDL0UsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ2hGLEtBQUs7UUFDTCxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2xGLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2pGLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUNoRixJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUNqRixLQUFLO1FBQ0wsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2hGLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDL0UsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDOUUsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUNsRixDQUFBO1FBRUQsT0FBTyxJQUFJLE1BQU0sQ0FBQztZQUNkLFFBQVE7WUFDUixPQUFPLEVBQUUsV0FBVyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1NBQzVDLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFFRCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQVksRUFBRSxJQUFZO1FBQ3BDLG9CQUFvQjtRQUNwQixNQUFNLFFBQVEsR0FBRyxJQUFJLEtBQUssRUFBVSxDQUFBO1FBQ3BDLE1BQU0sT0FBTyxHQUFHLElBQUksS0FBSyxFQUFVLENBQUE7UUFDbkMsTUFBTSxTQUFTLEdBQUcsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ2pJLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUE7UUFFeEIsMkVBQTJFO1FBQzNFLDZDQUE2QztRQUM3QywyQkFBMkI7UUFDM0IsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQTtRQUNuQyxNQUFNLElBQUksR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUE7UUFFL0IsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksRUFBRSxFQUFFLENBQUMsRUFBRTtZQUMzQixNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxDQUFBO1lBQ3BCLE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQTtZQUNwQixNQUFNLFFBQVEsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQ3pCLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFDL0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFDZixJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQ2xDLENBQUE7WUFFRCxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7WUFFcEcsbUNBQW1DO1lBQ25DLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO1NBQzdDO1FBRUQsV0FBVztRQUNYLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsRUFBRSxDQUFDLEVBQUU7WUFDM0IsTUFBTSxLQUFLLEdBQUcsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO1lBQzlCLE1BQU0sYUFBYSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLENBQUE7WUFDeEMsTUFBTSxTQUFTLEdBQUcsYUFBYSxHQUFHLElBQUksQ0FBQTtZQUN0QyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxFQUFFLEVBQUUsQ0FBQyxFQUFFO2dCQUMzQixNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxDQUFBO2dCQUNwQixNQUFNLFFBQVEsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQ3pCLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFDL0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFDZixJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQ2xDLENBQUE7Z0JBQ0QsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO2dCQUVwRyxNQUFNLENBQUMsR0FBRyxhQUFhLEdBQUcsQ0FBQyxDQUFBO2dCQUMzQixNQUFNLENBQUMsR0FBRyxTQUFTLEdBQUcsQ0FBQyxDQUFBO2dCQUN2QixNQUFNLENBQUMsR0FBRyxTQUFTLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFBO2dCQUNwQyxNQUFNLENBQUMsR0FBRyxhQUFhLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFBO2dCQUN4QyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7YUFDakM7U0FDSjtRQUVELG9CQUFvQjtRQUNwQixNQUFNLFNBQVMsR0FBRyxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ25JLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUE7UUFDeEIsTUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUE7UUFFeEMscUNBQXFDO1FBQ3JDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsRUFBRSxDQUFDLEVBQUU7WUFDM0IsTUFBTSxNQUFNLEdBQUcsWUFBWSxHQUFHLElBQUksQ0FBQTtZQUVsQyxtQ0FBbUM7WUFDbkMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLFlBQVksRUFBRSxNQUFNLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUE7U0FDbEU7UUFFRCxPQUFPLElBQUksTUFBTSxDQUFDO1lBQ2QsUUFBUTtZQUNSLE9BQU87U0FDVixDQUFDLENBQUE7SUFDTixDQUFDO0lBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFjO1FBQ3RCLHlCQUF5QjtRQUN6QixNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDMUIsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDeEMsTUFBTSxjQUFjLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFBO1FBQ3hDLE1BQU0sV0FBVyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUE7UUFDdEUsTUFBTSxPQUFPLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUE7UUFDN0MsTUFBTSxHQUFHLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUN2QyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ25CLE9BQU8sSUFBSSxDQUFBO0lBQ2YsQ0FBQztJQUVELE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBWSxFQUFFLElBQVksRUFBRSxJQUFZLEVBQUUsSUFBWSxFQUFFLElBQVksRUFBRSxJQUFZO1FBQ3BHLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUE7SUFDN0UsQ0FBQztDQUNKO0FBRUQsU0FBUyxXQUFXLENBQUMsS0FBYTtJQUM5QixPQUFPLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFBO0FBQ3hHLENBQUM7QUFnQkQsTUFBTSxPQUFPLEtBQUs7SUFPZCxZQUFZLFVBQXdCLEVBQUU7O1FBTC9CLGlCQUFZLEdBQWEsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO1FBTXBELElBQUksQ0FBQyxXQUFXLFNBQUcsT0FBTyxDQUFDLFdBQVcsbUNBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtRQUM3RCxJQUFJLENBQUMsWUFBWSxTQUFHLE9BQU8sQ0FBQyxZQUFZLG1DQUFJLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUNwRSxJQUFJLENBQUMsR0FBRyxTQUFHLE9BQU8sQ0FBQyxHQUFHLG1DQUFJLElBQUksQ0FBQTtRQUM5QixJQUFJLENBQUMsTUFBTSxTQUFHLE9BQU8sQ0FBQyxNQUFNLG1DQUFJLENBQUMsQ0FBQTtRQUNqQyxJQUFJLENBQUMsVUFBVSxTQUFHLE9BQU8sQ0FBQyxVQUFVLG1DQUFJLENBQUMsQ0FBQTtJQUM3QyxDQUFDO0NBQ0o7QUFFRCxNQUFNLGNBQWMsR0FBRyxFQUFFLENBQUE7QUFDekIsTUFBTSxZQUFZLEdBQUcsY0FBYyxHQUFHLENBQUMsQ0FBQTtBQUV2QyxNQUFNLE9BQU8sUUFBUTtJQVdqQixZQUE2QixNQUF5QjtRQUF6QixXQUFNLEdBQU4sTUFBTSxDQUFtQjtRQUovQyxxQkFBZ0IsR0FBYSxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO1FBQ2hELGVBQVUsR0FBYSxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO1FBQ3pDLFlBQU8sR0FBWSxFQUFFLENBQUE7UUFHekIsSUFBSSxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUN4QyxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFBO1FBQ2xCLElBQUksQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLGNBQWMsQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFLFdBQVcsQ0FBQyxDQUFBO1FBQzdELElBQUksQ0FBQyxjQUFjLEdBQUcsR0FBRyxDQUFDLGtCQUFrQixDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLGNBQWMsQ0FBQyxDQUFBO1FBQzlFLElBQUksQ0FBQyxhQUFhLEdBQUcsR0FBRyxDQUFDLGtCQUFrQixDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLGFBQWEsQ0FBQyxDQUFBO1FBQzVFLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxHQUFHLENBQUMsa0JBQWtCLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsbUJBQW1CLENBQUMsQ0FBQTtRQUN4RixJQUFJLENBQUMsbUJBQW1CLEdBQUcsR0FBRyxDQUFDLGtCQUFrQixDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLG1CQUFtQixDQUFDLENBQUE7UUFDeEYsSUFBSSxDQUFDLGVBQWUsR0FBRyxHQUFHLENBQUMsa0JBQWtCLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsZUFBZSxDQUFDLENBQUE7SUFDcEYsQ0FBQztJQUVNLE9BQU87UUFDVixNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFBO1FBRWxCLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsa0JBQWtCLEdBQUcsRUFBRSxDQUFDLG1CQUFtQixFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQTtRQUVqSCxFQUFFLENBQUMsZUFBZSxDQUFDLEVBQUUsQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFDeEMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsRUFBRSxFQUFFLENBQUMsbUJBQW1CLENBQUMsQ0FBQTtRQUNoRSxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO1FBQ3pCLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLGdCQUFnQixHQUFHLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO1FBQ25ELElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQTtJQUN4QixDQUFDO0lBRU0sVUFBVSxDQUFDLElBQVk7UUFDMUIscURBQXFEO1FBQ3JELE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUE7UUFDbEIsTUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUNoQyxNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ2hDLEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxHQUFHLENBQUMsQ0FBQTtRQUNuQyxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFLENBQUMsV0FBVyxDQUFDLENBQUE7UUFDM0UsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxDQUFDLENBQUE7UUFDM0MsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsb0JBQW9CLEVBQUUsSUFBSSxXQUFXLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUNyRixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ25DLENBQUM7SUFFTSxTQUFTLENBQUMsS0FBWTtRQUN6QixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUM1QixDQUFDO0lBRU8sU0FBUyxDQUFDLEdBQWdCLEVBQUUsR0FBZ0I7UUFDaEQsTUFBTSxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUE7UUFDNUIsTUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ3JDLEVBQUUsQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUE7UUFFdkIsTUFBTSxpQkFBaUIsR0FBRyxHQUFHLENBQUMsaUJBQWlCLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxlQUFlLENBQUMsQ0FBQTtRQUM3RSxNQUFNLGVBQWUsR0FBRyxHQUFHLENBQUMsaUJBQWlCLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxhQUFhLENBQUMsQ0FBQTtRQUN6RSxNQUFNLGNBQWMsR0FBRyxHQUFHLENBQUMsaUJBQWlCLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxZQUFZLENBQUMsQ0FBQTtRQUN2RSxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsR0FBRyxDQUFDLENBQUE7UUFDbkMsRUFBRSxDQUFDLHVCQUF1QixDQUFDLGlCQUFpQixDQUFDLENBQUE7UUFDN0MsRUFBRSxDQUFDLHVCQUF1QixDQUFDLGVBQWUsQ0FBQyxDQUFBO1FBQzNDLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQyxjQUFjLENBQUMsQ0FBQTtRQUMxQyxFQUFFLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUM5RSxFQUFFLENBQUMsbUJBQW1CLENBQUMsZUFBZSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsRUFBRSxDQUFDLENBQUE7UUFDN0UsRUFBRSxDQUFDLG1CQUFtQixDQUFDLGNBQWMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLEVBQUUsQ0FBQyxDQUFBO1FBQzVFLEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsQ0FBQyxDQUFBO1FBRTNDLEVBQUUsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDeEIsT0FBTyxHQUFHLENBQUE7SUFDZCxDQUFDO0lBRU8sYUFBYTtRQUNqQixNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFBO1FBQ2xCLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBQzNCLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFBO1FBQ3JGLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUE7UUFFekUsS0FBSyxNQUFNLEtBQUssSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQzlCLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFO2dCQUNaLFNBQVE7YUFDWDtZQUVELElBQUksS0FBSyxDQUFDLFVBQVUsSUFBSSxDQUFDLEVBQUU7Z0JBQ3ZCLFNBQVE7YUFDWDtZQUVELEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUE7WUFDNUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQTtZQUNqRSxFQUFFLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQTtZQUM3QixFQUFFLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUMsWUFBWSxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQTtTQUNqRjtRQUVELElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFBO0lBQ3JCLENBQUM7Q0FDSjtBQUVELFNBQVMsWUFBWSxDQUFDLFFBQWtCO0lBQ3BDLE1BQU0sQ0FBQyxHQUFHLElBQUksWUFBWSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUM3QyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUFDLENBQUMsQ0FBQyxDQUFBO0lBRWpELE9BQU8sQ0FBQyxDQUFBO0FBQ1osQ0FBQztBQUVELE1BQU0sVUFBVSxTQUFTLENBQUMsR0FBYSxFQUFFLFFBQWtCO0lBQ3ZELE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQTtJQUMxQixLQUFLLE1BQU0sQ0FBQyxJQUFJLFFBQVEsRUFBRTtRQUN0QixDQUFDLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBQ3ZDLENBQUMsQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUE7S0FDdkM7QUFDTCxDQUFDO0FBRUQsTUFBTSxVQUFVLFFBQVEsQ0FBQyxRQUEwQjtJQUMvQyxNQUFNLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFBO0lBQ3JFLE9BQU8sSUFBSSxDQUFBO0FBQ2YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGdsdSBmcm9tIFwiLi4vc2hhcmVkL2dsdS5qc1wiXHJcbmltcG9ydCAqIGFzIGdlbyBmcm9tIFwiLi4vc2hhcmVkL2dlbzNkLmpzXCJcclxuaW1wb3J0ICogYXMgYXJyYXkgZnJvbSBcIi4uL3NoYXJlZC9hcnJheS5qc1wiXHJcbmltcG9ydCAqIGFzIGl0ZXIgZnJvbSBcIi4uL3NoYXJlZC9pdGVyLmpzXCJcclxuXHJcbmNvbnN0IHZlcnRleFNyYyA9IGAjdmVyc2lvbiAzMDAgZXNcclxucHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7XHJcbnVuaWZvcm0gbWF0NCB3b3JsZF9tYXRyaXg7XHJcbnVuaWZvcm0gbWF0NCB2aWV3X21hdHJpeDtcclxudW5pZm9ybSBtYXQ0IHByb2plY3Rpb25fbWF0cml4O1xyXG51bmlmb3JtIHZlYzQgZGlmZnVzZV9jb2xvcjtcclxuaW4gdmVjMyB2ZXJ0X3Bvc2l0aW9uO1xyXG5pbiB2ZWMzIHZlcnRfbm9ybWFsO1xyXG5pbiB2ZWM0IHZlcnRfY29sb3I7XHJcbm91dCB2ZWMzIGZyYWdfbm9ybWFsO1xyXG5vdXQgdmVjNCBmcmFnX2NvbG9yO1xyXG5cclxudm9pZCBtYWluKCkge1xyXG4gICAgZnJhZ19jb2xvciA9IHZlcnRfY29sb3IgKiBkaWZmdXNlX2NvbG9yO1xyXG4gICAgZnJhZ19ub3JtYWwgLSB2ZXJ0X25vcm1hbDtcclxuICAgIGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbl9tYXRyaXggKiB2aWV3X21hdHJpeCAqIHdvcmxkX21hdHJpeCAqIHZlYzQodmVydF9wb3NpdGlvbiwgMS5mKTtcclxufWBcclxuXHJcbmNvbnN0IGZyYWdtZW50U3JjID0gYCN2ZXJzaW9uIDMwMCBlc1xyXG5wcmVjaXNpb24gaGlnaHAgZmxvYXQ7XHJcbnByZWNpc2lvbiBoaWdocCBzYW1wbGVyMkQ7XHJcbnByZWNpc2lvbiBoaWdocCBzYW1wbGVyMkRBcnJheTtcclxuXHJcbmluIHZlYzQgZnJhZ19jb2xvcjtcclxuaW4gdmVjMyBmcmFnX25vcm1hbDtcclxub3V0IHZlYzQgb3V0X2NvbG9yO1xyXG5cclxudm9pZCBtYWluKCkge1xyXG4gICAgb3V0X2NvbG9yID0gZnJhZ19jb2xvcjtcclxufWBcclxuXHJcbmludGVyZmFjZSBWZXJ0ZXhPcHRpb25zIHtcclxuICAgIHBvc2l0aW9uPzogZ2VvLlZlYzNcclxuICAgIG5vcm1hbD86IGdlby5WZWMzXHJcbiAgICBjb2xvcj86IGdlby5WZWM0XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBWZXJ0ZXgge1xyXG4gICAgcG9zaXRpb246IGdlby5WZWMzXHJcbiAgICBub3JtYWw6IGdlby5WZWMzXHJcbiAgICBjb2xvcjogZ2VvLlZlYzRcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zOiBWZXJ0ZXhPcHRpb25zID0ge30pIHtcclxuICAgICAgICB0aGlzLnBvc2l0aW9uID0gb3B0aW9ucy5wb3NpdGlvbj8uY2xvbmUoKSA/PyBuZXcgZ2VvLlZlYzMoMCwgMCwgMClcclxuICAgICAgICB0aGlzLm5vcm1hbCA9IG9wdGlvbnMubm9ybWFsPy5jbG9uZSgpID8/IG5ldyBnZW8uVmVjMygwLCAwLCAwKVxyXG4gICAgICAgIHRoaXMuY29sb3IgPSBvcHRpb25zLmNvbG9yPy5jbG9uZSgpID8/IG5ldyBnZW8uVmVjNCgxLCAxLCAxLCAxKVxyXG4gICAgfVxyXG5cclxuICAgIGNsb25lKCk6IFZlcnRleCB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBWZXJ0ZXgodGhpcylcclxuICAgIH1cclxufVxyXG5cclxuaW50ZXJmYWNlIEl4TWVzaE9wdGlvbnMge1xyXG4gICAgdmVydGljZXM/OiBWZXJ0ZXhbXVxyXG4gICAgaW5kaWNlcz86IG51bWJlcltdXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBJeE1lc2gge1xyXG4gICAgcHVibGljIHZlcnRpY2VzOiBWZXJ0ZXhbXSA9IFtdXHJcbiAgICBwdWJsaWMgaW5kaWNlczogbnVtYmVyW10gPSBbXVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM6IEl4TWVzaE9wdGlvbnMgPSB7fSkge1xyXG4gICAgICAgIGlmIChvcHRpb25zLnZlcnRpY2VzKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmVydGljZXMucHVzaCguLi5vcHRpb25zLnZlcnRpY2VzKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG9wdGlvbnMuaW5kaWNlcykge1xyXG4gICAgICAgICAgICB0aGlzLmluZGljZXMucHVzaCguLi5vcHRpb25zLmluZGljZXMpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyKCkge1xyXG4gICAgICAgIHRoaXMudmVydGljZXMgPSBbXVxyXG4gICAgICAgIHRoaXMuaW5kaWNlcyA9IFtdXHJcbiAgICB9XHJcblxyXG4gICAgdHJhbnNmb3JtKG1hdDogZ2VvLk1hdDQpIHtcclxuICAgICAgICB0cmFuc2Zvcm0obWF0LCB0aGlzLnZlcnRpY2VzKVxyXG4gICAgfVxyXG5cclxuICAgIGNhdChpeG06IEl4TWVzaCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IHRoaXMudmVydGljZXMubGVuZ3RoXHJcbiAgICAgICAgdGhpcy52ZXJ0aWNlcy5wdXNoKC4uLml4bS52ZXJ0aWNlcy5tYXAodiA9PiB2LmNsb25lKCkpKVxyXG4gICAgICAgIHRoaXMuaW5kaWNlcy5wdXNoKC4uLml4bS5pbmRpY2VzLm1hcChpeCA9PiBpeCArIG9mZnNldCkpXHJcbiAgICB9XHJcblxyXG4gICAgY2FsY0FBQkIoKTogZ2VvLkFBQkIge1xyXG4gICAgICAgIHJldHVybiBjYWxjQUFCQih0aGlzLnZlcnRpY2VzKVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBjdWJlKCk6IEl4TWVzaCB7XHJcbiAgICAgICAgLy8gLXgsICt4LCAteSwgK3ksIC16LCArelxyXG4gICAgICAgIGNvbnN0IHZlcnRpY2VzID0gbmV3IEFycmF5PFZlcnRleD4oXHJcbiAgICAgICAgICAgIC8vIC14XHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAtMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygtMSwgMCwgMCkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAtMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKC0xLCAwLCAwKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIDEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygtMSwgMCwgMCksIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygtMSwgMCwgMCkgfSksXHJcbiAgICAgICAgICAgIC8vICt4XHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIC0xLCAxKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMSwgMCwgMCkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIC0xLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDEsIDAsIDApIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAxLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDEsIDAsIDApIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAxLCAxKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMSwgMCwgMCkgfSksXHJcbiAgICAgICAgICAgIC8vIC15XHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAtMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIC0xLCAwKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIC0xLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIC0xLCAwKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgLTEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgLTEsIDApIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAtMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIC0xLCAwKSB9KSxcclxuICAgICAgICAgICAgLy8gK3lcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIDEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAxLCAwKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDEsIDApIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAxLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDEsIDApIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAxLCAwKSB9KSxcclxuICAgICAgICAgICAgLy8gLXpcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIC0xLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIC0xKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIDEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMCwgLTEpIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAxLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIC0xKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgLTEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMCwgLTEpIH0pLFxyXG4gICAgICAgICAgICAvLyArelxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgLTEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAwLCAxKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgLTEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAwLCAxKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIDEpIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIDEpIH0pXHJcbiAgICAgICAgKVxyXG5cclxuICAgICAgICByZXR1cm4gbmV3IEl4TWVzaCh7XHJcbiAgICAgICAgICAgIHZlcnRpY2VzLFxyXG4gICAgICAgICAgICBpbmRpY2VzOiBxdWFkSW5kaWNlcyh2ZXJ0aWNlcy5sZW5ndGggLyA0KVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHNwaGVyZShyb3dzOiBudW1iZXIsIGNvbHM6IG51bWJlcik6IEl4TWVzaCB7XHJcbiAgICAgICAgLy8gY3JlYXRlIG5vcnRoIHBvbGVcclxuICAgICAgICBjb25zdCB2ZXJ0aWNlcyA9IG5ldyBBcnJheTxWZXJ0ZXg+KClcclxuICAgICAgICBjb25zdCBpbmRpY2VzID0gbmV3IEFycmF5PG51bWJlcj4oKVxyXG4gICAgICAgIGNvbnN0IG5vcnRoUG9sZSA9IG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDAsIDEsIDApLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAxLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAxLCAxLCAxKSB9KVxyXG4gICAgICAgIHZlcnRpY2VzLnB1c2gobm9ydGhQb2xlKVxyXG5cclxuICAgICAgICAvLyBpdGVyYXRlIG92ZXIgYW5nbGVzLCBlc3NlbnRpYWxseSBmb3JtaW5nIHBvbGFyIGNvb3JkaW5hdGVzIG9mIGVhY2ggcG9pbnRcclxuICAgICAgICAvLyBsZXQgdGhldGEgPSBlbGV2YXRpb24gYW5nbGUgYWJvdmUgeHkgcGxhbmVcclxuICAgICAgICAvLyBsZXQgcGhpID0geHkgcGxhbmUgYW5nbGVcclxuICAgICAgICBjb25zdCBkdGhldGEgPSBNYXRoLlBJIC8gKHJvd3MgKyAxKVxyXG4gICAgICAgIGNvbnN0IGRwaGkgPSAyICogTWF0aC5QSSAvIGNvbHNcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjb2xzOyArK2opIHtcclxuICAgICAgICAgICAgY29uc3QgcGhpID0gZHBoaSAqIGpcclxuICAgICAgICAgICAgY29uc3QgdGhldGEgPSBkdGhldGFcclxuICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSBuZXcgZ2VvLlZlYzMoXHJcbiAgICAgICAgICAgICAgICBNYXRoLnNpbih0aGV0YSkgKiBNYXRoLmNvcyhwaGkpLFxyXG4gICAgICAgICAgICAgICAgTWF0aC5jb3ModGhldGEpLFxyXG4gICAgICAgICAgICAgICAgTWF0aC5zaW4odGhldGEpICogTWF0aC5zaW4ocGhpKVxyXG4gICAgICAgICAgICApXHJcblxyXG4gICAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogcG9zaXRpb24sIG5vcm1hbDogcG9zaXRpb24sIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMSwgMSwgMSkgfSkpXHJcblxyXG4gICAgICAgICAgICAvLyBjb25uZWN0IHRvIHBvbGUgdG8gZm9ybSB0cmlhbmdsZVxyXG4gICAgICAgICAgICBpbmRpY2VzLnB1c2goaiArIDEsIChqICsgMSkgJSBjb2xzICsgMSwgMClcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGludGVyaW9yXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCByb3dzOyArK2kpIHtcclxuICAgICAgICAgICAgY29uc3QgdGhldGEgPSBkdGhldGEgKiAoaSArIDEpXHJcbiAgICAgICAgICAgIGNvbnN0IHByZXZSb3dPZmZzZXQgPSAoaSAtIDEpICogY29scyArIDFcclxuICAgICAgICAgICAgY29uc3Qgcm93T2Zmc2V0ID0gcHJldlJvd09mZnNldCArIGNvbHNcclxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjb2xzOyArK2opIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBoaSA9IGRwaGkgKiBqXHJcbiAgICAgICAgICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG5ldyBnZW8uVmVjMyhcclxuICAgICAgICAgICAgICAgICAgICBNYXRoLnNpbih0aGV0YSkgKiBNYXRoLmNvcyhwaGkpLFxyXG4gICAgICAgICAgICAgICAgICAgIE1hdGguY29zKHRoZXRhKSxcclxuICAgICAgICAgICAgICAgICAgICBNYXRoLnNpbih0aGV0YSkgKiBNYXRoLnNpbihwaGkpXHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogcG9zaXRpb24sIG5vcm1hbDogcG9zaXRpb24sIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMSwgMSwgMSkgfSkpXHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgYSA9IHByZXZSb3dPZmZzZXQgKyBqXHJcbiAgICAgICAgICAgICAgICBjb25zdCBiID0gcm93T2Zmc2V0ICsgalxyXG4gICAgICAgICAgICAgICAgY29uc3QgYyA9IHJvd09mZnNldCArIChqICsgMSkgJSBjb2xzXHJcbiAgICAgICAgICAgICAgICBjb25zdCBkID0gcHJldlJvd09mZnNldCArIChqICsgMSkgJSBjb2xzXHJcbiAgICAgICAgICAgICAgICBpbmRpY2VzLnB1c2goYSwgYiwgYywgYSwgYywgZClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gY3JlYXRlIHNvdXRoIHBvbGVcclxuICAgICAgICBjb25zdCBzb3V0aFBvbGUgPSBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygwLCAtMSwgMCksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIC0xLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAxLCAxLCAxKSB9KVxyXG4gICAgICAgIHZlcnRpY2VzLnB1c2goc291dGhQb2xlKVxyXG4gICAgICAgIGNvbnN0IHNvdXRoUG9sZUlkeCA9IHZlcnRpY2VzLmxlbmd0aCAtIDFcclxuXHJcbiAgICAgICAgLy8gY29ubmVjdCBzb3V0aCBwb2xlIHRvIHJlc3Qgb2YgbWVzaFxyXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY29sczsgKytqKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IHNvdXRoUG9sZUlkeCAtIGNvbHNcclxuXHJcbiAgICAgICAgICAgIC8vIGNvbm5lY3QgdG8gcG9sZSB0byBmb3JtIHRyaWFuZ2xlXHJcbiAgICAgICAgICAgIGluZGljZXMucHVzaChvZmZzZXQgKyBqLCBzb3V0aFBvbGVJZHgsIG9mZnNldCArIChqICsgMSkgJSBjb2xzKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBJeE1lc2goe1xyXG4gICAgICAgICAgICB2ZXJ0aWNlcyxcclxuICAgICAgICAgICAgaW5kaWNlc1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHJlY3QoYWFiYjogZ2VvLkFBQkIpOiBJeE1lc2gge1xyXG4gICAgICAgIC8vIC14LCAreCwgLXksICt5LCAteiwgK3pcclxuICAgICAgICBjb25zdCBtZXNoID0gSXhNZXNoLmN1YmUoKVxyXG4gICAgICAgIGNvbnN0IGhhbGZFeHRlbnRzID0gYWFiYi5leHRlbnRzLmRpdlgoMilcclxuICAgICAgICBjb25zdCBuZWdIYWxmRXh0ZW50cyA9IGhhbGZFeHRlbnRzLm5lZygpXHJcbiAgICAgICAgY29uc3QgdHJhbnNsYXRpb24gPSBnZW8uTWF0NC50cmFuc2xhdGlvbihhYWJiLm1pbi5zdWIobmVnSGFsZkV4dGVudHMpKVxyXG4gICAgICAgIGNvbnN0IHNjYWxpbmcgPSBnZW8uTWF0NC5zY2FsaW5nKGhhbGZFeHRlbnRzKVxyXG4gICAgICAgIGNvbnN0IG1hdCA9IHNjYWxpbmcubWF0bXVsKHRyYW5zbGF0aW9uKVxyXG4gICAgICAgIG1lc2gudHJhbnNmb3JtKG1hdClcclxuICAgICAgICByZXR1cm4gbWVzaFxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyByZWN0RnJvbUNvb3JkcyhtaW5YOiBudW1iZXIsIG1pblk6IG51bWJlciwgbWluWjogbnVtYmVyLCBtYXhYOiBudW1iZXIsIG1heFk6IG51bWJlciwgbWF4WjogbnVtYmVyKTogSXhNZXNoIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZWN0KGdlby5BQUJCLmZyb21Db29yZHMobWluWCwgbWluWSwgbWluWiwgbWF4WCwgbWF4WSwgbWF4WikpXHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHF1YWRJbmRpY2VzKHF1YWRzOiBudW1iZXIpOiBudW1iZXJbXSB7XHJcbiAgICByZXR1cm4gYXJyYXkuZ2VuZXJhdGUocXVhZHMsIGkgPT4gW2kgKiA0LCBpICogNCArIDEsIGkgKiA0ICsgMiwgaSAqIDQsIGkgKiA0ICsgMiwgaSAqIDQgKyAzXSkuZmxhdCgpXHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgTWVzaERhdGEge1xyXG4gICAgdmVydGljZXM6IFZlcnRleFtdXHJcbiAgICBpbmRpY2VzOiBudW1iZXJbXVxyXG4gICAgaW5kZXhPZmZzZXQ6IG51bWJlclxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEJhdGNoT3B0aW9ucyB7XHJcbiAgICB3b3JsZE1hdHJpeD86IGdlby5NYXQ0XHJcbiAgICBkaWZmdXNlQ29sb3I/OiBnZW8uVmVjNFxyXG4gICAgdmFvPzogV2ViR0xWZXJ0ZXhBcnJheU9iamVjdFxyXG4gICAgb2Zmc2V0PzogbnVtYmVyXHJcbiAgICBudW1JbmRpY2VzPzogbnVtYmVyXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBCYXRjaCB7XHJcbiAgICBwdWJsaWMgd29ybGRNYXRyaXg6IGdlby5NYXQ0XHJcbiAgICBwdWJsaWMgZGlmZnVzZUNvbG9yOiBnZW8uVmVjNCA9IG5ldyBnZW8uVmVjNCgxLCAxLCAxLCAxKVxyXG4gICAgcHVibGljIHZhbzogV2ViR0xWZXJ0ZXhBcnJheU9iamVjdCB8IG51bGxcclxuICAgIHB1YmxpYyBvZmZzZXQ6IG51bWJlclxyXG4gICAgcHVibGljIG51bUluZGljZXM6IG51bWJlclxyXG5cclxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM6IEJhdGNoT3B0aW9ucyA9IHt9KSB7XHJcbiAgICAgICAgdGhpcy53b3JsZE1hdHJpeCA9IG9wdGlvbnMud29ybGRNYXRyaXggPz8gZ2VvLk1hdDQuaWRlbnRpdHkoKVxyXG4gICAgICAgIHRoaXMuZGlmZnVzZUNvbG9yID0gb3B0aW9ucy5kaWZmdXNlQ29sb3IgPz8gbmV3IGdlby5WZWM0KDEsIDEsIDEsIDEpXHJcbiAgICAgICAgdGhpcy52YW8gPSBvcHRpb25zLnZhbyA/PyBudWxsXHJcbiAgICAgICAgdGhpcy5vZmZzZXQgPSBvcHRpb25zLm9mZnNldCA/PyAwXHJcbiAgICAgICAgdGhpcy5udW1JbmRpY2VzID0gb3B0aW9ucy5udW1JbmRpY2VzID8/IDBcclxuICAgIH1cclxufVxyXG5cclxuY29uc3QgZWxlbXNQZXJWZXJ0ZXggPSAxMFxyXG5jb25zdCB2ZXJ0ZXhTdHJpZGUgPSBlbGVtc1BlclZlcnRleCAqIDRcclxuXHJcbmV4cG9ydCBjbGFzcyBSZW5kZXJlciB7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGdsOiBXZWJHTDJSZW5kZXJpbmdDb250ZXh0XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IHByb2dyYW06IFdlYkdMUHJvZ3JhbVxyXG4gICAgcHJpdmF0ZSByZWFkb25seSB3b3JsZE1hdHJpeExvYzogV2ViR0xVbmlmb3JtTG9jYXRpb25cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgdmlld01hdHJpeExvYzogV2ViR0xVbmlmb3JtTG9jYXRpb25cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgcHJvamVjdGlvbk1hdHJpeExvYzogV2ViR0xVbmlmb3JtTG9jYXRpb25cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGlmZnVzZUNvbG9yTG9jOiBXZWJHTFVuaWZvcm1Mb2NhdGlvblxyXG4gICAgcHVibGljIHByb2plY3Rpb25NYXRyaXg6IGdlby5NYXQ0ID0gZ2VvLk1hdDQuaWRlbnRpdHkoKVxyXG4gICAgcHVibGljIHZpZXdNYXRyaXg6IGdlby5NYXQ0ID0gZ2VvLk1hdDQuaWRlbnRpdHkoKVxyXG4gICAgcHJpdmF0ZSBiYXRjaGVzOiBCYXRjaFtdID0gW11cclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmdsID0gZ2x1LmNyZWF0ZUNvbnRleHQodGhpcy5jYW52YXMpXHJcbiAgICAgICAgY29uc3QgZ2wgPSB0aGlzLmdsXHJcbiAgICAgICAgdGhpcy5wcm9ncmFtID0gZ2x1LmNvbXBpbGVQcm9ncmFtKGdsLCB2ZXJ0ZXhTcmMsIGZyYWdtZW50U3JjKVxyXG4gICAgICAgIHRoaXMud29ybGRNYXRyaXhMb2MgPSBnbHUuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsLCB0aGlzLnByb2dyYW0sIFwid29ybGRfbWF0cml4XCIpXHJcbiAgICAgICAgdGhpcy52aWV3TWF0cml4TG9jID0gZ2x1LmdldFVuaWZvcm1Mb2NhdGlvbihnbCwgdGhpcy5wcm9ncmFtLCBcInZpZXdfbWF0cml4XCIpXHJcbiAgICAgICAgdGhpcy5wcm9qZWN0aW9uTWF0cml4TG9jID0gZ2x1LmdldFVuaWZvcm1Mb2NhdGlvbihnbCwgdGhpcy5wcm9ncmFtLCBcInByb2plY3Rpb25fbWF0cml4XCIpXHJcbiAgICAgICAgdGhpcy5wcm9qZWN0aW9uTWF0cml4TG9jID0gZ2x1LmdldFVuaWZvcm1Mb2NhdGlvbihnbCwgdGhpcy5wcm9ncmFtLCBcInByb2plY3Rpb25fbWF0cml4XCIpXHJcbiAgICAgICAgdGhpcy5kaWZmdXNlQ29sb3JMb2MgPSBnbHUuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsLCB0aGlzLnByb2dyYW0sIFwiZGlmZnVzZV9jb2xvclwiKVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBwcmVzZW50KCkge1xyXG4gICAgICAgIGNvbnN0IGdsID0gdGhpcy5nbFxyXG5cclxuICAgICAgICB0aGlzLnByb2plY3Rpb25NYXRyaXggPSBnZW8uTWF0NC5wZXJzcGVjdGl2ZShNYXRoLlBJIC8gMiwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoIC8gZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCwgMSwgNTEyKVxyXG5cclxuICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIG51bGwpXHJcbiAgICAgICAgZ2wudmlld3BvcnQoMCwgMCwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KVxyXG4gICAgICAgIGdsLmNsZWFyQ29sb3IoMCwgMCwgMCwgMSlcclxuICAgICAgICBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUIHwgZ2wuREVQVEhfQlVGRkVSX0JJVClcclxuICAgICAgICB0aGlzLnJlbmRlckJhdGNoZXMoKVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjcmVhdGVNZXNoKG1lc2g6IEl4TWVzaCk6IFdlYkdMVmVydGV4QXJyYXlPYmplY3Qge1xyXG4gICAgICAgIC8vIGZvciBub3cgLSBwbGFjZSBzaW5nbGUgdHJpYW5nbGUgaW50byB2ZXJ0ZXggYnVmZmVyXHJcbiAgICAgICAgY29uc3QgZ2wgPSB0aGlzLmdsXHJcbiAgICAgICAgY29uc3QgdmJvID0gZ2x1LmNyZWF0ZUJ1ZmZlcihnbClcclxuICAgICAgICBjb25zdCBpYm8gPSBnbHUuY3JlYXRlQnVmZmVyKGdsKVxyXG4gICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB2Ym8pXHJcbiAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIHRvRmxvYXRBcnJheShtZXNoLnZlcnRpY2VzKSwgZ2wuU1RBVElDX0RSQVcpXHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgaWJvKVxyXG4gICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIG5ldyBVaW50MzJBcnJheShtZXNoLmluZGljZXMpLCBnbC5TVEFUSUNfRFJBVylcclxuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVWYW8odmJvLCBpYm8pXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRyYXdCYXRjaChiYXRjaDogQmF0Y2gpIHtcclxuICAgICAgICB0aGlzLmJhdGNoZXMucHVzaChiYXRjaClcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZVZhbyh2Ym86IFdlYkdMQnVmZmVyLCBpYm86IFdlYkdMQnVmZmVyKTogV2ViR0xWZXJ0ZXhBcnJheU9iamVjdCB7XHJcbiAgICAgICAgY29uc3QgeyBnbCwgcHJvZ3JhbSB9ID0gdGhpc1xyXG4gICAgICAgIGNvbnN0IHZhbyA9IGdsdS5jcmVhdGVWZXJ0ZXhBcnJheShnbClcclxuICAgICAgICBnbC5iaW5kVmVydGV4QXJyYXkodmFvKVxyXG5cclxuICAgICAgICBjb25zdCBwb3NpdGlvbkF0dHJpYklkeCA9IGdsdS5nZXRBdHRyaWJMb2NhdGlvbihnbCwgcHJvZ3JhbSwgXCJ2ZXJ0X3Bvc2l0aW9uXCIpXHJcbiAgICAgICAgY29uc3Qgbm9ybWFsQXR0cmliSWR4ID0gZ2x1LmdldEF0dHJpYkxvY2F0aW9uKGdsLCBwcm9ncmFtLCBcInZlcnRfbm9ybWFsXCIpXHJcbiAgICAgICAgY29uc3QgY29sb3JBdHRyaWJJZHggPSBnbHUuZ2V0QXR0cmliTG9jYXRpb24oZ2wsIHByb2dyYW0sIFwidmVydF9jb2xvclwiKVxyXG4gICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB2Ym8pXHJcbiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkocG9zaXRpb25BdHRyaWJJZHgpXHJcbiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkobm9ybWFsQXR0cmliSWR4KVxyXG4gICAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KGNvbG9yQXR0cmliSWR4KVxyXG4gICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIocG9zaXRpb25BdHRyaWJJZHgsIDMsIGdsLkZMT0FULCBmYWxzZSwgdmVydGV4U3RyaWRlLCAwKVxyXG4gICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIobm9ybWFsQXR0cmliSWR4LCAzLCBnbC5GTE9BVCwgZmFsc2UsIHZlcnRleFN0cmlkZSwgMTIpXHJcbiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihjb2xvckF0dHJpYklkeCwgNCwgZ2wuRkxPQVQsIGZhbHNlLCB2ZXJ0ZXhTdHJpZGUsIDI0KVxyXG4gICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIGlibylcclxuXHJcbiAgICAgICAgZ2wuYmluZFZlcnRleEFycmF5KG51bGwpXHJcbiAgICAgICAgcmV0dXJuIHZhb1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVuZGVyQmF0Y2hlcygpIHtcclxuICAgICAgICBjb25zdCBnbCA9IHRoaXMuZ2xcclxuICAgICAgICBnbC51c2VQcm9ncmFtKHRoaXMucHJvZ3JhbSlcclxuICAgICAgICBnbC51bmlmb3JtTWF0cml4NGZ2KHRoaXMucHJvamVjdGlvbk1hdHJpeExvYywgZmFsc2UsIHRoaXMucHJvamVjdGlvbk1hdHJpeC50b0FycmF5KCkpXHJcbiAgICAgICAgZ2wudW5pZm9ybU1hdHJpeDRmdih0aGlzLnZpZXdNYXRyaXhMb2MsIGZhbHNlLCB0aGlzLnZpZXdNYXRyaXgudG9BcnJheSgpKVxyXG5cclxuICAgICAgICBmb3IgKGNvbnN0IGJhdGNoIG9mIHRoaXMuYmF0Y2hlcykge1xyXG4gICAgICAgICAgICBpZiAoIWJhdGNoLnZhbykge1xyXG4gICAgICAgICAgICAgICAgY29udGludWVcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGJhdGNoLm51bUluZGljZXMgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgY29udGludWVcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZ2wudW5pZm9ybU1hdHJpeDRmdih0aGlzLndvcmxkTWF0cml4TG9jLCBmYWxzZSwgYmF0Y2gud29ybGRNYXRyaXgudG9BcnJheSgpKVxyXG4gICAgICAgICAgICBnbC51bmlmb3JtNGZ2KHRoaXMuZGlmZnVzZUNvbG9yTG9jLCBiYXRjaC5kaWZmdXNlQ29sb3IudG9BcnJheSgpKVxyXG4gICAgICAgICAgICBnbC5iaW5kVmVydGV4QXJyYXkoYmF0Y2gudmFvKVxyXG4gICAgICAgICAgICBnbC5kcmF3RWxlbWVudHMoZ2wuVFJJQU5HTEVTLCBiYXRjaC5udW1JbmRpY2VzLCBnbC5VTlNJR05FRF9JTlQsIGJhdGNoLm9mZnNldClcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuYmF0Y2hlcyA9IFtdXHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRvRmxvYXRBcnJheSh2ZXJ0aWNlczogVmVydGV4W10pOiBGbG9hdDMyQXJyYXkge1xyXG4gICAgY29uc3QgYSA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMuZmxhdE1hcCh2ID0+IFtcclxuICAgICAgICB2LnBvc2l0aW9uLngsIHYucG9zaXRpb24ueSwgdi5wb3NpdGlvbi56LFxyXG4gICAgICAgIHYubm9ybWFsLngsIHYubm9ybWFsLnksIHYubm9ybWFsLnosXHJcbiAgICAgICAgdi5jb2xvci54LCB2LmNvbG9yLnksIHYuY29sb3Iueiwgdi5jb2xvci53XSkpXHJcblxyXG4gICAgcmV0dXJuIGFcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRyYW5zZm9ybShtYXQ6IGdlby5NYXQ0LCB2ZXJ0aWNlczogVmVydGV4W10pIHtcclxuICAgIGNvbnN0IGJhc2lzID0gbWF0LnRvTWF0MygpXHJcbiAgICBmb3IgKGNvbnN0IHYgb2YgdmVydGljZXMpIHtcclxuICAgICAgICB2LnBvc2l0aW9uID0gbWF0LnRyYW5zZm9ybTModi5wb3NpdGlvbilcclxuICAgICAgICB2Lm5vcm1hbCA9IGJhc2lzLnRyYW5zZm9ybSh2Lm5vcm1hbClcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNhbGNBQUJCKHZlcnRpY2VzOiBJdGVyYWJsZTxWZXJ0ZXg+KTogZ2VvLkFBQkIge1xyXG4gICAgY29uc3QgYWFiYiA9IGdlby5BQUJCLmZyb21Qb2ludHMoaXRlci5tYXAodmVydGljZXMsIHYgPT4gdi5wb3NpdGlvbikpXHJcbiAgICByZXR1cm4gYWFiYlxyXG59Il19