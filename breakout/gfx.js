import * as glu from "../shared/glu.js";
import * as geo from "../shared/geo3d.js";
import * as array from "../shared/array.js";
const vertexSrc = `#version 300 es
precision mediump float;
uniform mat4 world_matrix;
uniform mat4 view_matrix;
uniform mat4 projection_matrix;
in vec3 vert_position;
in vec3 vert_normal;
in vec4 vert_color;
out vec3 frag_normal;
out vec4 frag_color;

void main() {
    frag_color = vert_color;
    frag_normal - vert_normal;
    gl_Position = projection_matrix * view_matrix * world_matrix * vec4(vert_position, 1.f);
}`;
const fragmentSrc = `#version 300 es
precision highp float;
precision highp sampler2D;
precision highp sampler2DArray;

in vec4 frag_color;
in vec3 frag_normal;
out vec4 out_color;

void main() {
    out_color = frag_color;
}`;
export class Vertex {
    constructor(options = {}) {
        var _a, _b, _c, _d, _e, _f;
        this.position = (_b = (_a = options.position) === null || _a === void 0 ? void 0 : _a.clone()) !== null && _b !== void 0 ? _b : new geo.Vec3(0, 0, 0);
        this.normal = (_d = (_c = options.normal) === null || _c === void 0 ? void 0 : _c.clone()) !== null && _d !== void 0 ? _d : new geo.Vec3(0, 0, 0);
        this.color = (_f = (_e = options.color) === null || _e === void 0 ? void 0 : _e.clone()) !== null && _f !== void 0 ? _f : new geo.Vec4(1, 1, 1, 1);
    }
    clone() {
        return new Vertex(this);
    }
}
export class IxMesh {
    constructor(options = {}) {
        this.vertices = [];
        this.indices = [];
        if (options.vertices) {
            this.vertices.push(...options.vertices);
        }
        if (options.indices) {
            this.indices.push(...options.indices);
        }
    }
    clear() {
        this.vertices = [];
        this.indices = [];
    }
    transform(mat) {
        transform(mat, this.vertices);
    }
    cat(ixm) {
        const offset = this.vertices.length;
        this.vertices.push(...ixm.vertices.map(v => v.clone()));
        this.indices.push(...ixm.indices.map(ix => ix + offset));
    }
    static cube() {
        // -x, +x, -y, +y, -z, +z
        const vertices = new Array(
        // -x
        new Vertex({ position: new geo.Vec3(-1, -1, -1), normal: new geo.Vec3(-1, 0, 0), color: new geo.Vec4(1, 0, 0, 1) }), new Vertex({ position: new geo.Vec3(-1, -1, 1), normal: new geo.Vec3(-1, 0, 0), color: new geo.Vec4(1, 0, 0, 1) }), new Vertex({ position: new geo.Vec3(-1, 1, 1), normal: new geo.Vec3(-1, 0, 0), color: new geo.Vec4(1, 0, 0, 1) }), new Vertex({ position: new geo.Vec3(-1, 1, -1), normal: new geo.Vec3(-1, 0, 0), color: new geo.Vec4(1, 0, 0, 1) }), 
        // +x
        new Vertex({ position: new geo.Vec3(1, -1, 1), normal: new geo.Vec3(1, 0, 0), color: new geo.Vec4(0, 1, 0, 1) }), new Vertex({ position: new geo.Vec3(1, -1, -1), normal: new geo.Vec3(1, 0, 0), color: new geo.Vec4(0, 1, 0, 1) }), new Vertex({ position: new geo.Vec3(1, 1, -1), normal: new geo.Vec3(1, 0, 0), color: new geo.Vec4(0, 1, 0, 1) }), new Vertex({ position: new geo.Vec3(1, 1, 1), normal: new geo.Vec3(1, 0, 0), color: new geo.Vec4(0, 1, 0, 1) }), 
        // -y
        new Vertex({ position: new geo.Vec3(-1, -1, 1), normal: new geo.Vec3(0, -1, 0), color: new geo.Vec4(1, 0, 0, 1) }), new Vertex({ position: new geo.Vec3(-1, -1, -1), normal: new geo.Vec3(0, -1, 0), color: new geo.Vec4(1, 0, 0, 1) }), new Vertex({ position: new geo.Vec3(1, -1, -1), normal: new geo.Vec3(0, -1, 0), color: new geo.Vec4(1, 0, 0, 1) }), new Vertex({ position: new geo.Vec3(1, -1, 1), normal: new geo.Vec3(0, -1, 0), color: new geo.Vec4(1, 0, 0, 1) }), 
        // +y
        new Vertex({ position: new geo.Vec3(-1, 1, 1), normal: new geo.Vec3(0, 1, 0), color: new geo.Vec4(0, 1, 0, 1) }), new Vertex({ position: new geo.Vec3(1, 1, 1), normal: new geo.Vec3(0, 1, 0), color: new geo.Vec4(0, 1, 0, 1) }), new Vertex({ position: new geo.Vec3(1, 1, -1), normal: new geo.Vec3(0, 1, 0), color: new geo.Vec4(0, 1, 0, 1) }), new Vertex({ position: new geo.Vec3(-1, 1, -1), normal: new geo.Vec3(0, 1, 0), color: new geo.Vec4(0, 1, 0, 1) }), 
        // -z
        new Vertex({ position: new geo.Vec3(-1, -1, -1), normal: new geo.Vec3(0, 0, -1), color: new geo.Vec4(1, 0, 0, 1) }), new Vertex({ position: new geo.Vec3(-1, 1, -1), normal: new geo.Vec3(0, 0, -1), color: new geo.Vec4(1, 0, 0, 1) }), new Vertex({ position: new geo.Vec3(1, 1, -1), normal: new geo.Vec3(0, 0, -1), color: new geo.Vec4(1, 0, 0, 1) }), new Vertex({ position: new geo.Vec3(1, -1, -1), normal: new geo.Vec3(0, 0, -1), color: new geo.Vec4(1, 0, 0, 1) }), 
        // +z
        new Vertex({ position: new geo.Vec3(-1, -1, 1), normal: new geo.Vec3(0, 0, 1), color: new geo.Vec4(0, 1, 0, 1) }), new Vertex({ position: new geo.Vec3(1, -1, 1), normal: new geo.Vec3(0, 0, 1), color: new geo.Vec4(0, 1, 0, 1) }), new Vertex({ position: new geo.Vec3(1, 1, 1), normal: new geo.Vec3(0, 0, 1), color: new geo.Vec4(0, 1, 0, 1) }), new Vertex({ position: new geo.Vec3(-1, 1, 1), normal: new geo.Vec3(0, 0, 1), color: new geo.Vec4(0, 1, 0, 1) }));
        return new IxMesh({
            vertices,
            indices: quadIndices(vertices.length / 4)
        });
    }
    static sphere(rows, cols) {
        // create north pole
        const vertices = new Array();
        const indices = new Array();
        const northPole = new Vertex({ position: new geo.Vec3(0, 1, 0), normal: new geo.Vec3(0, 1, 0), color: new geo.Vec4(1, 1, 1, 1) });
        vertices.push(northPole);
        // iterate over angles, essentially forming polar coordinates of each point
        // let theta = elevation angle above xy plane
        // let phi = xy plane angle
        const dtheta = Math.PI / (rows + 1);
        const dphi = 2 * Math.PI / cols;
        for (let j = 0; j < cols; ++j) {
            const phi = dphi * j;
            const theta = dtheta;
            const position = new geo.Vec3(Math.sin(theta) * Math.cos(phi), Math.cos(theta), Math.sin(theta) * Math.sin(phi));
            vertices.push(new Vertex({ position: position, normal: position, color: new geo.Vec4(1, 1, 1, 1) }));
            // connect to pole to form triangle
            indices.push(j + 1, (j + 1) % cols + 1, 0);
        }
        // interior
        for (let i = 1; i < rows; ++i) {
            const theta = dtheta * (i + 1);
            const prevRowOffset = (i - 1) * cols + 1;
            const rowOffset = prevRowOffset + cols;
            for (let j = 0; j < cols; ++j) {
                const phi = dphi * j;
                const position = new geo.Vec3(Math.sin(theta) * Math.cos(phi), Math.cos(theta), Math.sin(theta) * Math.sin(phi));
                vertices.push(new Vertex({ position: position, normal: position, color: new geo.Vec4(1, 1, 1, 1) }));
                const a = prevRowOffset + j;
                const b = rowOffset + j;
                const c = rowOffset + (j + 1) % cols;
                const d = prevRowOffset + (j + 1) % cols;
                indices.push(a, b, c, a, c, d);
            }
        }
        // create south pole
        const southPole = new Vertex({ position: new geo.Vec3(0, -1, 0), normal: new geo.Vec3(0, -1, 0), color: new geo.Vec4(1, 1, 1, 1) });
        vertices.push(southPole);
        const southPoleIdx = vertices.length - 1;
        // connect south pole to rest of mesh
        for (let j = 0; j < cols; ++j) {
            const offset = southPoleIdx - cols;
            // connect to pole to form triangle
            indices.push(offset + j, southPoleIdx, offset + (j + 1) % cols);
        }
        return new IxMesh({
            vertices,
            indices
        });
    }
    static rect(aabb) {
        // -x, +x, -y, +y, -z, +z
        const mesh = IxMesh.cube();
        const halfExtents = aabb.extents.divX(2);
        const negHalfExtents = halfExtents.neg();
        const translation = geo.Mat4.translation(aabb.min.sub(negHalfExtents));
        const scaling = geo.Mat4.scaling(halfExtents);
        const mat = scaling.matmul(translation);
        mesh.transform(mat);
        return mesh;
    }
}
function quadIndices(quads) {
    return array.generate(quads, i => [i * 4, i * 4 + 1, i * 4 + 2, i * 4, i * 4 + 2, i * 4 + 3]).flat();
}
const elemsPerVertex = 10;
const vertexStride = elemsPerVertex * 4;
export class Renderer {
    constructor(canvas) {
        this.canvas = canvas;
        this.projectionMatrix = geo.Mat4.identity();
        this.viewMatrix = geo.Mat4.identity();
        this.batches = [];
        this.gl = glu.createContext(this.canvas);
        const gl = this.gl;
        this.program = glu.compileProgram(gl, vertexSrc, fragmentSrc);
        this.worldMatrixLoc = glu.getUniformLocation(gl, this.program, "world_matrix");
        this.viewMatrixLoc = glu.getUniformLocation(gl, this.program, "view_matrix");
        this.projectionMatrixLoc = glu.getUniformLocation(gl, this.program, "projection_matrix");
    }
    present() {
        const gl = this.gl;
        this.projectionMatrix = geo.Mat4.perspective(Math.PI / 2, gl.drawingBufferWidth / gl.drawingBufferHeight, 1, 512);
        gl.bindFramebuffer(gl.FRAMEBUFFER, null);
        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
        gl.clearColor(0, 0, 0, 1);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
        this.renderBatches();
    }
    createMesh(mesh) {
        // for now - place single triangle into vertex buffer
        const gl = this.gl;
        const vbo = glu.createBuffer(gl);
        const ibo = glu.createBuffer(gl);
        gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
        gl.bufferData(gl.ARRAY_BUFFER, toFloatArray(mesh.vertices), gl.STATIC_DRAW);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint32Array(mesh.indices), gl.STATIC_DRAW);
        return this.createVao(vbo, ibo);
    }
    drawBatch(batch) {
        this.batches.push(batch);
    }
    createVao(vbo, ibo) {
        const { gl, program } = this;
        const vao = glu.createVertexArray(gl);
        gl.bindVertexArray(vao);
        const positionAttribIdx = glu.getAttribLocation(gl, program, "vert_position");
        const normalAttribIdx = glu.getAttribLocation(gl, program, "vert_normal");
        const colorAttribIdx = glu.getAttribLocation(gl, program, "vert_color");
        gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
        gl.enableVertexAttribArray(positionAttribIdx);
        gl.enableVertexAttribArray(normalAttribIdx);
        gl.enableVertexAttribArray(colorAttribIdx);
        gl.vertexAttribPointer(positionAttribIdx, 3, gl.FLOAT, false, vertexStride, 0);
        gl.vertexAttribPointer(normalAttribIdx, 3, gl.FLOAT, false, vertexStride, 12);
        gl.vertexAttribPointer(colorAttribIdx, 4, gl.FLOAT, false, vertexStride, 24);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
        gl.bindVertexArray(null);
        return vao;
    }
    renderBatches() {
        const gl = this.gl;
        gl.useProgram(this.program);
        gl.uniformMatrix4fv(this.projectionMatrixLoc, false, this.projectionMatrix.toArray());
        gl.uniformMatrix4fv(this.viewMatrixLoc, false, this.viewMatrix.toArray());
        for (const batch of this.batches) {
            gl.uniformMatrix4fv(this.worldMatrixLoc, false, batch.worldMatrix.toArray());
            gl.bindVertexArray(batch.vao);
            gl.drawElements(gl.TRIANGLES, batch.numIndices, gl.UNSIGNED_INT, batch.offset);
        }
        this.batches = [];
    }
}
function toFloatArray(vertices) {
    const a = new Float32Array(vertices.flatMap(v => [
        v.position.x, v.position.y, v.position.z,
        v.normal.x, v.normal.y, v.normal.z,
        v.color.x, v.color.y, v.color.z, v.color.w
    ]));
    return a;
}
export function transform(mat, vertices) {
    const basis = mat.toMat3();
    for (const v of vertices) {
        v.position = mat.transform3(v.position);
        v.normal = basis.transform(v.normal);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2Z4LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZ2Z4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxHQUFHLE1BQU0sa0JBQWtCLENBQUE7QUFDdkMsT0FBTyxLQUFLLEdBQUcsTUFBTSxvQkFBb0IsQ0FBQTtBQUN6QyxPQUFPLEtBQUssS0FBSyxNQUFNLG9CQUFvQixDQUFBO0FBRTNDLE1BQU0sU0FBUyxHQUFHOzs7Ozs7Ozs7Ozs7Ozs7RUFlaEIsQ0FBQTtBQUVGLE1BQU0sV0FBVyxHQUFHOzs7Ozs7Ozs7OztFQVdsQixDQUFBO0FBUUYsTUFBTSxPQUFPLE1BQU07SUFLZixZQUFZLFVBQXlCLEVBQUU7O1FBQ25DLElBQUksQ0FBQyxRQUFRLGVBQUcsT0FBTyxDQUFDLFFBQVEsMENBQUUsS0FBSyxxQ0FBTSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUNsRSxJQUFJLENBQUMsTUFBTSxlQUFHLE9BQU8sQ0FBQyxNQUFNLDBDQUFFLEtBQUsscUNBQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDOUQsSUFBSSxDQUFDLEtBQUssZUFBRyxPQUFPLENBQUMsS0FBSywwQ0FBRSxLQUFLLHFDQUFNLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUNuRSxDQUFDO0lBRUQsS0FBSztRQUNELE9BQU8sSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDM0IsQ0FBQztDQUNKO0FBT0QsTUFBTSxPQUFPLE1BQU07SUFJZixZQUFZLFVBQXlCLEVBQUU7UUFIaEMsYUFBUSxHQUFhLEVBQUUsQ0FBQTtRQUN2QixZQUFPLEdBQWEsRUFBRSxDQUFBO1FBR3pCLElBQUksT0FBTyxDQUFDLFFBQVEsRUFBRTtZQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQTtTQUMxQztRQUVELElBQUksT0FBTyxDQUFDLE9BQU8sRUFBRTtZQUNqQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQTtTQUN4QztJQUNMLENBQUM7SUFFRCxLQUFLO1FBQ0QsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUE7UUFDbEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUE7SUFDckIsQ0FBQztJQUVELFNBQVMsQ0FBQyxHQUFhO1FBQ25CLFNBQVMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQ2pDLENBQUM7SUFFRCxHQUFHLENBQUMsR0FBVztRQUNYLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFBO1FBQ25DLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFBO1FBQ3ZELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQTtJQUM1RCxDQUFDO0lBRUQsTUFBTSxDQUFDLElBQUk7UUFDUCx5QkFBeUI7UUFDekIsTUFBTSxRQUFRLEdBQUcsSUFBSSxLQUFLO1FBQ3RCLEtBQUs7UUFDTCxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDbkgsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUNsSCxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUNqSCxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ2xILEtBQUs7UUFDTCxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDaEgsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDakgsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2hILElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDL0csS0FBSztRQUNMLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDbEgsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ25ILElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDbEgsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDakgsS0FBSztRQUNMLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUNoSCxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQy9HLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUNoSCxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUNqSCxLQUFLO1FBQ0wsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ25ILElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDbEgsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDakgsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUNsSCxLQUFLO1FBQ0wsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFF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a0I7SUFDdkQsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFBO0lBQzFCLEtBQUssTUFBTSxDQUFDLElBQUksUUFBUSxFQUFFO1FBQ3RCLENBQUMsQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDdkMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQTtLQUN2QztBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBnbHUgZnJvbSBcIi4uL3NoYXJlZC9nbHUuanNcIlxyXG5pbXBvcnQgKiBhcyBnZW8gZnJvbSBcIi4uL3NoYXJlZC9nZW8zZC5qc1wiXHJcbmltcG9ydCAqIGFzIGFycmF5IGZyb20gXCIuLi9zaGFyZWQvYXJyYXkuanNcIlxyXG5cclxuY29uc3QgdmVydGV4U3JjID0gYCN2ZXJzaW9uIDMwMCBlc1xyXG5wcmVjaXNpb24gbWVkaXVtcCBmbG9hdDtcclxudW5pZm9ybSBtYXQ0IHdvcmxkX21hdHJpeDtcclxudW5pZm9ybSBtYXQ0IHZpZXdfbWF0cml4O1xyXG51bmlmb3JtIG1hdDQgcHJvamVjdGlvbl9tYXRyaXg7XHJcbmluIHZlYzMgdmVydF9wb3NpdGlvbjtcclxuaW4gdmVjMyB2ZXJ0X25vcm1hbDtcclxuaW4gdmVjNCB2ZXJ0X2NvbG9yO1xyXG5vdXQgdmVjMyBmcmFnX25vcm1hbDtcclxub3V0IHZlYzQgZnJhZ19jb2xvcjtcclxuXHJcbnZvaWQgbWFpbigpIHtcclxuICAgIGZyYWdfY29sb3IgPSB2ZXJ0X2NvbG9yO1xyXG4gICAgZnJhZ19ub3JtYWwgLSB2ZXJ0X25vcm1hbDtcclxuICAgIGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbl9tYXRyaXggKiB2aWV3X21hdHJpeCAqIHdvcmxkX21hdHJpeCAqIHZlYzQodmVydF9wb3NpdGlvbiwgMS5mKTtcclxufWBcclxuXHJcbmNvbnN0IGZyYWdtZW50U3JjID0gYCN2ZXJzaW9uIDMwMCBlc1xyXG5wcmVjaXNpb24gaGlnaHAgZmxvYXQ7XHJcbnByZWNpc2lvbiBoaWdocCBzYW1wbGVyMkQ7XHJcbnByZWNpc2lvbiBoaWdocCBzYW1wbGVyMkRBcnJheTtcclxuXHJcbmluIHZlYzQgZnJhZ19jb2xvcjtcclxuaW4gdmVjMyBmcmFnX25vcm1hbDtcclxub3V0IHZlYzQgb3V0X2NvbG9yO1xyXG5cclxudm9pZCBtYWluKCkge1xyXG4gICAgb3V0X2NvbG9yID0gZnJhZ19jb2xvcjtcclxufWBcclxuXHJcbmludGVyZmFjZSBWZXJ0ZXhPcHRpb25zIHtcclxuICAgIHBvc2l0aW9uPzogZ2VvLlZlYzNcclxuICAgIG5vcm1hbD86IGdlby5WZWMzXHJcbiAgICBjb2xvcj86IGdlby5WZWM0XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBWZXJ0ZXgge1xyXG4gICAgcG9zaXRpb246IGdlby5WZWMzXHJcbiAgICBub3JtYWw6IGdlby5WZWMzXHJcbiAgICBjb2xvcjogZ2VvLlZlYzRcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zOiBWZXJ0ZXhPcHRpb25zID0ge30pIHtcclxuICAgICAgICB0aGlzLnBvc2l0aW9uID0gb3B0aW9ucy5wb3NpdGlvbj8uY2xvbmUoKSA/PyBuZXcgZ2VvLlZlYzMoMCwgMCwgMClcclxuICAgICAgICB0aGlzLm5vcm1hbCA9IG9wdGlvbnMubm9ybWFsPy5jbG9uZSgpID8/IG5ldyBnZW8uVmVjMygwLCAwLCAwKVxyXG4gICAgICAgIHRoaXMuY29sb3IgPSBvcHRpb25zLmNvbG9yPy5jbG9uZSgpID8/IG5ldyBnZW8uVmVjNCgxLCAxLCAxLCAxKVxyXG4gICAgfVxyXG5cclxuICAgIGNsb25lKCk6IFZlcnRleCB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBWZXJ0ZXgodGhpcylcclxuICAgIH1cclxufVxyXG5cclxuaW50ZXJmYWNlIEl4TWVzaE9wdGlvbnMge1xyXG4gICAgdmVydGljZXM/OiBWZXJ0ZXhbXVxyXG4gICAgaW5kaWNlcz86IG51bWJlcltdXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBJeE1lc2gge1xyXG4gICAgcHVibGljIHZlcnRpY2VzOiBWZXJ0ZXhbXSA9IFtdXHJcbiAgICBwdWJsaWMgaW5kaWNlczogbnVtYmVyW10gPSBbXVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM6IEl4TWVzaE9wdGlvbnMgPSB7fSkge1xyXG4gICAgICAgIGlmIChvcHRpb25zLnZlcnRpY2VzKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmVydGljZXMucHVzaCguLi5vcHRpb25zLnZlcnRpY2VzKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG9wdGlvbnMuaW5kaWNlcykge1xyXG4gICAgICAgICAgICB0aGlzLmluZGljZXMucHVzaCguLi5vcHRpb25zLmluZGljZXMpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyKCkge1xyXG4gICAgICAgIHRoaXMudmVydGljZXMgPSBbXVxyXG4gICAgICAgIHRoaXMuaW5kaWNlcyA9IFtdXHJcbiAgICB9XHJcblxyXG4gICAgdHJhbnNmb3JtKG1hdDogZ2VvLk1hdDQpIHtcclxuICAgICAgICB0cmFuc2Zvcm0obWF0LCB0aGlzLnZlcnRpY2VzKVxyXG4gICAgfVxyXG5cclxuICAgIGNhdChpeG06IEl4TWVzaCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IHRoaXMudmVydGljZXMubGVuZ3RoXHJcbiAgICAgICAgdGhpcy52ZXJ0aWNlcy5wdXNoKC4uLml4bS52ZXJ0aWNlcy5tYXAodiA9PiB2LmNsb25lKCkpKVxyXG4gICAgICAgIHRoaXMuaW5kaWNlcy5wdXNoKC4uLml4bS5pbmRpY2VzLm1hcChpeCA9PiBpeCArIG9mZnNldCkpXHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGN1YmUoKTogSXhNZXNoIHtcclxuICAgICAgICAvLyAteCwgK3gsIC15LCAreSwgLXosICt6XHJcbiAgICAgICAgY29uc3QgdmVydGljZXMgPSBuZXcgQXJyYXk8VmVydGV4PihcclxuICAgICAgICAgICAgLy8gLXhcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIC0xLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKC0xLCAwLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAwLCAwLCAxKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIC0xLCAxKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoLTEsIDAsIDApLCBjb2xvcjogbmV3IGdlby5WZWM0KDEsIDAsIDAsIDEpIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKC0xLCAwLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAwLCAwLCAxKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIDEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoLTEsIDAsIDApLCBjb2xvcjogbmV3IGdlby5WZWM0KDEsIDAsIDAsIDEpIH0pLFxyXG4gICAgICAgICAgICAvLyAreFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAtMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDEsIDAsIDApLCBjb2xvcjogbmV3IGdlby5WZWM0KDAsIDEsIDAsIDEpIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAtMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygxLCAwLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgwLCAxLCAwLCAxKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygxLCAwLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgwLCAxLCAwLCAxKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDEsIDAsIDApLCBjb2xvcjogbmV3IGdlby5WZWM0KDAsIDEsIDAsIDEpIH0pLFxyXG4gICAgICAgICAgICAvLyAteVxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgLTEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAtMSwgMCksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMCwgMCwgMSkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAtMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAtMSwgMCksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMCwgMCwgMSkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIC0xLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIC0xLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAwLCAwLCAxKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgLTEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAtMSwgMCksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMCwgMCwgMSkgfSksXHJcbiAgICAgICAgICAgIC8vICt5XHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAxLCAxKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMSwgMCksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMCwgMSwgMCwgMSkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIDEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAxLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgwLCAxLCAwLCAxKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAxLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgwLCAxLCAwLCAxKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIDEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMSwgMCksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMCwgMSwgMCwgMSkgfSksXHJcbiAgICAgICAgICAgIC8vIC16XHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAtMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAwLCAtMSksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMCwgMCwgMSkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAxLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIC0xKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAwLCAwLCAxKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAwLCAtMSksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMCwgMCwgMSkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIC0xLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIC0xKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAwLCAwLCAxKSB9KSxcclxuICAgICAgICAgICAgLy8gK3pcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIC0xLCAxKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMCwgMSksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMCwgMSwgMCwgMSkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIC0xLCAxKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMCwgMSksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMCwgMSwgMCwgMSkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIDEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAwLCAxKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgwLCAxLCAwLCAxKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIDEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAwLCAxKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgwLCAxLCAwLCAxKSB9KVxyXG4gICAgICAgIClcclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBJeE1lc2goe1xyXG4gICAgICAgICAgICB2ZXJ0aWNlcyxcclxuICAgICAgICAgICAgaW5kaWNlczogcXVhZEluZGljZXModmVydGljZXMubGVuZ3RoIC8gNClcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBzcGhlcmUocm93czogbnVtYmVyLCBjb2xzOiBudW1iZXIpOiBJeE1lc2gge1xyXG4gICAgICAgIC8vIGNyZWF0ZSBub3J0aCBwb2xlXHJcbiAgICAgICAgY29uc3QgdmVydGljZXMgPSBuZXcgQXJyYXk8VmVydGV4PigpXHJcbiAgICAgICAgY29uc3QgaW5kaWNlcyA9IG5ldyBBcnJheTxudW1iZXI+KClcclxuICAgICAgICBjb25zdCBub3J0aFBvbGUgPSBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygwLCAxLCAwKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMSwgMCksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMSwgMSwgMSkgfSlcclxuICAgICAgICB2ZXJ0aWNlcy5wdXNoKG5vcnRoUG9sZSlcclxuXHJcbiAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIGFuZ2xlcywgZXNzZW50aWFsbHkgZm9ybWluZyBwb2xhciBjb29yZGluYXRlcyBvZiBlYWNoIHBvaW50XHJcbiAgICAgICAgLy8gbGV0IHRoZXRhID0gZWxldmF0aW9uIGFuZ2xlIGFib3ZlIHh5IHBsYW5lXHJcbiAgICAgICAgLy8gbGV0IHBoaSA9IHh5IHBsYW5lIGFuZ2xlXHJcbiAgICAgICAgY29uc3QgZHRoZXRhID0gTWF0aC5QSSAvIChyb3dzICsgMSlcclxuICAgICAgICBjb25zdCBkcGhpID0gMiAqIE1hdGguUEkgLyBjb2xzXHJcblxyXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY29sczsgKytqKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBoaSA9IGRwaGkgKiBqXHJcbiAgICAgICAgICAgIGNvbnN0IHRoZXRhID0gZHRoZXRhXHJcbiAgICAgICAgICAgIGNvbnN0IHBvc2l0aW9uID0gbmV3IGdlby5WZWMzKFxyXG4gICAgICAgICAgICAgICAgTWF0aC5zaW4odGhldGEpICogTWF0aC5jb3MocGhpKSxcclxuICAgICAgICAgICAgICAgIE1hdGguY29zKHRoZXRhKSxcclxuICAgICAgICAgICAgICAgIE1hdGguc2luKHRoZXRhKSAqIE1hdGguc2luKHBoaSlcclxuICAgICAgICAgICAgKVxyXG5cclxuICAgICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVydGV4KHsgcG9zaXRpb246IHBvc2l0aW9uLCBub3JtYWw6IHBvc2l0aW9uLCBjb2xvcjogbmV3IGdlby5WZWM0KDEsIDEsIDEsIDEpIH0pKVxyXG5cclxuICAgICAgICAgICAgLy8gY29ubmVjdCB0byBwb2xlIHRvIGZvcm0gdHJpYW5nbGVcclxuICAgICAgICAgICAgaW5kaWNlcy5wdXNoKGogKyAxLCAoaiArIDEpICUgY29scyArIDEsIDApXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBpbnRlcmlvclxyXG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcm93czsgKytpKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRoZXRhID0gZHRoZXRhICogKGkgKyAxKVxyXG4gICAgICAgICAgICBjb25zdCBwcmV2Um93T2Zmc2V0ID0gKGkgLSAxKSAqIGNvbHMgKyAxXHJcbiAgICAgICAgICAgIGNvbnN0IHJvd09mZnNldCA9IHByZXZSb3dPZmZzZXQgKyBjb2xzXHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY29sczsgKytqKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwaGkgPSBkcGhpICogalxyXG4gICAgICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSBuZXcgZ2VvLlZlYzMoXHJcbiAgICAgICAgICAgICAgICAgICAgTWF0aC5zaW4odGhldGEpICogTWF0aC5jb3MocGhpKSxcclxuICAgICAgICAgICAgICAgICAgICBNYXRoLmNvcyh0aGV0YSksXHJcbiAgICAgICAgICAgICAgICAgICAgTWF0aC5zaW4odGhldGEpICogTWF0aC5zaW4ocGhpKVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVydGV4KHsgcG9zaXRpb246IHBvc2l0aW9uLCBub3JtYWw6IHBvc2l0aW9uLCBjb2xvcjogbmV3IGdlby5WZWM0KDEsIDEsIDEsIDEpIH0pKVxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBwcmV2Um93T2Zmc2V0ICsgalxyXG4gICAgICAgICAgICAgICAgY29uc3QgYiA9IHJvd09mZnNldCArIGpcclxuICAgICAgICAgICAgICAgIGNvbnN0IGMgPSByb3dPZmZzZXQgKyAoaiArIDEpICUgY29sc1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZCA9IHByZXZSb3dPZmZzZXQgKyAoaiArIDEpICUgY29sc1xyXG4gICAgICAgICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGMsIGEsIGMsIGQpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGNyZWF0ZSBzb3V0aCBwb2xlXHJcbiAgICAgICAgY29uc3Qgc291dGhQb2xlID0gbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMCwgLTEsIDApLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAtMSwgMCksIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMSwgMSwgMSkgfSlcclxuICAgICAgICB2ZXJ0aWNlcy5wdXNoKHNvdXRoUG9sZSlcclxuICAgICAgICBjb25zdCBzb3V0aFBvbGVJZHggPSB2ZXJ0aWNlcy5sZW5ndGggLSAxXHJcblxyXG4gICAgICAgIC8vIGNvbm5lY3Qgc291dGggcG9sZSB0byByZXN0IG9mIG1lc2hcclxuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNvbHM7ICsraikge1xyXG4gICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBzb3V0aFBvbGVJZHggLSBjb2xzXHJcblxyXG4gICAgICAgICAgICAvLyBjb25uZWN0IHRvIHBvbGUgdG8gZm9ybSB0cmlhbmdsZVxyXG4gICAgICAgICAgICBpbmRpY2VzLnB1c2gob2Zmc2V0ICsgaiwgc291dGhQb2xlSWR4LCBvZmZzZXQgKyAoaiArIDEpICUgY29scylcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgSXhNZXNoKHtcclxuICAgICAgICAgICAgdmVydGljZXMsXHJcbiAgICAgICAgICAgIGluZGljZXNcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyByZWN0KGFhYmI6IGdlby5BQUJCKTogSXhNZXNoIHtcclxuICAgICAgICAvLyAteCwgK3gsIC15LCAreSwgLXosICt6XHJcbiAgICAgICAgY29uc3QgbWVzaCA9IEl4TWVzaC5jdWJlKClcclxuICAgICAgICBjb25zdCBoYWxmRXh0ZW50cyA9IGFhYmIuZXh0ZW50cy5kaXZYKDIpXHJcbiAgICAgICAgY29uc3QgbmVnSGFsZkV4dGVudHMgPSBoYWxmRXh0ZW50cy5uZWcoKVxyXG4gICAgICAgIGNvbnN0IHRyYW5zbGF0aW9uID0gZ2VvLk1hdDQudHJhbnNsYXRpb24oYWFiYi5taW4uc3ViKG5lZ0hhbGZFeHRlbnRzKSlcclxuICAgICAgICBjb25zdCBzY2FsaW5nID0gZ2VvLk1hdDQuc2NhbGluZyhoYWxmRXh0ZW50cylcclxuICAgICAgICBjb25zdCBtYXQgPSBzY2FsaW5nLm1hdG11bCh0cmFuc2xhdGlvbilcclxuICAgICAgICBtZXNoLnRyYW5zZm9ybShtYXQpXHJcbiAgICAgICAgcmV0dXJuIG1lc2hcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcXVhZEluZGljZXMocXVhZHM6IG51bWJlcik6IG51bWJlcltdIHtcclxuICAgIHJldHVybiBhcnJheS5nZW5lcmF0ZShxdWFkcywgaSA9PiBbaSAqIDQsIGkgKiA0ICsgMSwgaSAqIDQgKyAyLCBpICogNCwgaSAqIDQgKyAyLCBpICogNCArIDNdKS5mbGF0KClcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBNZXNoRGF0YSB7XHJcbiAgICB2ZXJ0aWNlczogVmVydGV4W11cclxuICAgIGluZGljZXM6IG51bWJlcltdXHJcbiAgICBpbmRleE9mZnNldDogbnVtYmVyXHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgQmF0Y2gge1xyXG4gICAgd29ybGRNYXRyaXg6IGdlby5NYXQ0XHJcbiAgICB2YW86IFdlYkdMVmVydGV4QXJyYXlPYmplY3RcclxuICAgIG9mZnNldDogbnVtYmVyXHJcbiAgICBudW1JbmRpY2VzOiBudW1iZXJcclxufVxyXG5cclxuY29uc3QgZWxlbXNQZXJWZXJ0ZXggPSAxMFxyXG5jb25zdCB2ZXJ0ZXhTdHJpZGUgPSBlbGVtc1BlclZlcnRleCAqIDRcclxuXHJcbmV4cG9ydCBjbGFzcyBSZW5kZXJlciB7XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGdsOiBXZWJHTDJSZW5kZXJpbmdDb250ZXh0XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IHByb2dyYW06IFdlYkdMUHJvZ3JhbVxyXG4gICAgcHJpdmF0ZSByZWFkb25seSB3b3JsZE1hdHJpeExvYzogV2ViR0xVbmlmb3JtTG9jYXRpb25cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgdmlld01hdHJpeExvYzogV2ViR0xVbmlmb3JtTG9jYXRpb25cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgcHJvamVjdGlvbk1hdHJpeExvYzogV2ViR0xVbmlmb3JtTG9jYXRpb25cclxuICAgIHB1YmxpYyBwcm9qZWN0aW9uTWF0cml4OiBnZW8uTWF0NCA9IGdlby5NYXQ0LmlkZW50aXR5KClcclxuICAgIHB1YmxpYyB2aWV3TWF0cml4OiBnZW8uTWF0NCA9IGdlby5NYXQ0LmlkZW50aXR5KClcclxuICAgIHByaXZhdGUgYmF0Y2hlczogQmF0Y2hbXSA9IFtdXHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50KSB7XHJcbiAgICAgICAgdGhpcy5nbCA9IGdsdS5jcmVhdGVDb250ZXh0KHRoaXMuY2FudmFzKVxyXG4gICAgICAgIGNvbnN0IGdsID0gdGhpcy5nbFxyXG4gICAgICAgIHRoaXMucHJvZ3JhbSA9IGdsdS5jb21waWxlUHJvZ3JhbShnbCwgdmVydGV4U3JjLCBmcmFnbWVudFNyYylcclxuICAgICAgICB0aGlzLndvcmxkTWF0cml4TG9jID0gZ2x1LmdldFVuaWZvcm1Mb2NhdGlvbihnbCwgdGhpcy5wcm9ncmFtLCBcIndvcmxkX21hdHJpeFwiKVxyXG4gICAgICAgIHRoaXMudmlld01hdHJpeExvYyA9IGdsdS5nZXRVbmlmb3JtTG9jYXRpb24oZ2wsIHRoaXMucHJvZ3JhbSwgXCJ2aWV3X21hdHJpeFwiKVxyXG4gICAgICAgIHRoaXMucHJvamVjdGlvbk1hdHJpeExvYyA9IGdsdS5nZXRVbmlmb3JtTG9jYXRpb24oZ2wsIHRoaXMucHJvZ3JhbSwgXCJwcm9qZWN0aW9uX21hdHJpeFwiKVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBwcmVzZW50KCkge1xyXG4gICAgICAgIGNvbnN0IGdsID0gdGhpcy5nbFxyXG5cclxuICAgICAgICB0aGlzLnByb2plY3Rpb25NYXRyaXggPSBnZW8uTWF0NC5wZXJzcGVjdGl2ZShNYXRoLlBJIC8gMiwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoIC8gZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCwgMSwgNTEyKVxyXG5cclxuICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIG51bGwpXHJcbiAgICAgICAgZ2wudmlld3BvcnQoMCwgMCwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KVxyXG4gICAgICAgIGdsLmNsZWFyQ29sb3IoMCwgMCwgMCwgMSlcclxuICAgICAgICBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUIHwgZ2wuREVQVEhfQlVGRkVSX0JJVClcclxuICAgICAgICB0aGlzLnJlbmRlckJhdGNoZXMoKVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjcmVhdGVNZXNoKG1lc2g6IEl4TWVzaCk6IFdlYkdMVmVydGV4QXJyYXlPYmplY3Qge1xyXG4gICAgICAgIC8vIGZvciBub3cgLSBwbGFjZSBzaW5nbGUgdHJpYW5nbGUgaW50byB2ZXJ0ZXggYnVmZmVyXHJcbiAgICAgICAgY29uc3QgZ2wgPSB0aGlzLmdsXHJcbiAgICAgICAgY29uc3QgdmJvID0gZ2x1LmNyZWF0ZUJ1ZmZlcihnbClcclxuICAgICAgICBjb25zdCBpYm8gPSBnbHUuY3JlYXRlQnVmZmVyKGdsKVxyXG4gICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB2Ym8pXHJcbiAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIHRvRmxvYXRBcnJheShtZXNoLnZlcnRpY2VzKSwgZ2wuU1RBVElDX0RSQVcpXHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgaWJvKVxyXG4gICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIG5ldyBVaW50MzJBcnJheShtZXNoLmluZGljZXMpLCBnbC5TVEFUSUNfRFJBVylcclxuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVWYW8odmJvLCBpYm8pXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRyYXdCYXRjaChiYXRjaDogQmF0Y2gpIHtcclxuICAgICAgICB0aGlzLmJhdGNoZXMucHVzaChiYXRjaClcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZVZhbyh2Ym86IFdlYkdMQnVmZmVyLCBpYm86IFdlYkdMQnVmZmVyKTogV2ViR0xWZXJ0ZXhBcnJheU9iamVjdCB7XHJcbiAgICAgICAgY29uc3QgeyBnbCwgcHJvZ3JhbSB9ID0gdGhpc1xyXG4gICAgICAgIGNvbnN0IHZhbyA9IGdsdS5jcmVhdGVWZXJ0ZXhBcnJheShnbClcclxuICAgICAgICBnbC5iaW5kVmVydGV4QXJyYXkodmFvKVxyXG5cclxuICAgICAgICBjb25zdCBwb3NpdGlvbkF0dHJpYklkeCA9IGdsdS5nZXRBdHRyaWJMb2NhdGlvbihnbCwgcHJvZ3JhbSwgXCJ2ZXJ0X3Bvc2l0aW9uXCIpXHJcbiAgICAgICAgY29uc3Qgbm9ybWFsQXR0cmliSWR4ID0gZ2x1LmdldEF0dHJpYkxvY2F0aW9uKGdsLCBwcm9ncmFtLCBcInZlcnRfbm9ybWFsXCIpXHJcbiAgICAgICAgY29uc3QgY29sb3JBdHRyaWJJZHggPSBnbHUuZ2V0QXR0cmliTG9jYXRpb24oZ2wsIHByb2dyYW0sIFwidmVydF9jb2xvclwiKVxyXG4gICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB2Ym8pXHJcbiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkocG9zaXRpb25BdHRyaWJJZHgpXHJcbiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkobm9ybWFsQXR0cmliSWR4KVxyXG4gICAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KGNvbG9yQXR0cmliSWR4KVxyXG4gICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIocG9zaXRpb25BdHRyaWJJZHgsIDMsIGdsLkZMT0FULCBmYWxzZSwgdmVydGV4U3RyaWRlLCAwKVxyXG4gICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIobm9ybWFsQXR0cmliSWR4LCAzLCBnbC5GTE9BVCwgZmFsc2UsIHZlcnRleFN0cmlkZSwgMTIpXHJcbiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihjb2xvckF0dHJpYklkeCwgNCwgZ2wuRkxPQVQsIGZhbHNlLCB2ZXJ0ZXhTdHJpZGUsIDI0KVxyXG4gICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIGlibylcclxuXHJcbiAgICAgICAgZ2wuYmluZFZlcnRleEFycmF5KG51bGwpXHJcbiAgICAgICAgcmV0dXJuIHZhb1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVuZGVyQmF0Y2hlcygpIHtcclxuICAgICAgICBjb25zdCBnbCA9IHRoaXMuZ2xcclxuICAgICAgICBnbC51c2VQcm9ncmFtKHRoaXMucHJvZ3JhbSlcclxuICAgICAgICBnbC51bmlmb3JtTWF0cml4NGZ2KHRoaXMucHJvamVjdGlvbk1hdHJpeExvYywgZmFsc2UsIHRoaXMucHJvamVjdGlvbk1hdHJpeC50b0FycmF5KCkpXHJcbiAgICAgICAgZ2wudW5pZm9ybU1hdHJpeDRmdih0aGlzLnZpZXdNYXRyaXhMb2MsIGZhbHNlLCB0aGlzLnZpZXdNYXRyaXgudG9BcnJheSgpKVxyXG5cclxuICAgICAgICBmb3IgKGNvbnN0IGJhdGNoIG9mIHRoaXMuYmF0Y2hlcykge1xyXG4gICAgICAgICAgICBnbC51bmlmb3JtTWF0cml4NGZ2KHRoaXMud29ybGRNYXRyaXhMb2MsIGZhbHNlLCBiYXRjaC53b3JsZE1hdHJpeC50b0FycmF5KCkpXHJcbiAgICAgICAgICAgIGdsLmJpbmRWZXJ0ZXhBcnJheShiYXRjaC52YW8pXHJcbiAgICAgICAgICAgIGdsLmRyYXdFbGVtZW50cyhnbC5UUklBTkdMRVMsIGJhdGNoLm51bUluZGljZXMsIGdsLlVOU0lHTkVEX0lOVCwgYmF0Y2gub2Zmc2V0KVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5iYXRjaGVzID0gW11cclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gdG9GbG9hdEFycmF5KHZlcnRpY2VzOiBWZXJ0ZXhbXSk6IEZsb2F0MzJBcnJheSB7XHJcbiAgICBjb25zdCBhID0gbmV3IEZsb2F0MzJBcnJheSh2ZXJ0aWNlcy5mbGF0TWFwKHYgPT4gW1xyXG4gICAgICAgIHYucG9zaXRpb24ueCwgdi5wb3NpdGlvbi55LCB2LnBvc2l0aW9uLnosXHJcbiAgICAgICAgdi5ub3JtYWwueCwgdi5ub3JtYWwueSwgdi5ub3JtYWwueixcclxuICAgICAgICB2LmNvbG9yLngsIHYuY29sb3IueSwgdi5jb2xvci56LCB2LmNvbG9yLnddKSlcclxuXHJcbiAgICByZXR1cm4gYVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdHJhbnNmb3JtKG1hdDogZ2VvLk1hdDQsIHZlcnRpY2VzOiBWZXJ0ZXhbXSkge1xyXG4gICAgY29uc3QgYmFzaXMgPSBtYXQudG9NYXQzKClcclxuICAgIGZvciAoY29uc3QgdiBvZiB2ZXJ0aWNlcykge1xyXG4gICAgICAgIHYucG9zaXRpb24gPSBtYXQudHJhbnNmb3JtMyh2LnBvc2l0aW9uKVxyXG4gICAgICAgIHYubm9ybWFsID0gYmFzaXMudHJhbnNmb3JtKHYubm9ybWFsKVxyXG4gICAgfVxyXG59Il19