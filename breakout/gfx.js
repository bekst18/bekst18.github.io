import * as glu from "../shared/glu.js";
import * as geo from "../shared/geo3d.js";
import * as array from "../shared/array.js";
import * as iter from "../shared/iter.js";
const vertexSrc = `#version 300 es
precision mediump float;
uniform mat4 world_matrix;
uniform mat4 view_matrix;
uniform mat4 projection_matrix;
uniform vec4 diffuse_color;

in vec3 vert_position;
in vec3 vert_normal;
in vec4 vert_color;
out vec3 frag_normal;
out vec3 frag_position;
out vec4 frag_color;

void main() {
    frag_color = vert_color * diffuse_color;
    frag_normal = mat3(world_matrix) * vert_normal;
    vec4 position_world = world_matrix * vec4(vert_position, 1.f);
    gl_Position = projection_matrix * view_matrix * position_world;
    frag_position = position_world.xyz / position_world.w;
}`;
const fragmentSrc = `#version 300 es
precision highp float;
precision highp sampler2D;
precision highp sampler2DArray;

uniform vec3 eye_position;
uniform float roughness;
in vec4 frag_color;
in vec3 frag_position;
in vec3 frag_normal;
out vec4 out_color;

void main() {
    float specular_intensity = 1.f - roughness;
    float specular_pow = mix(.1f, 32.f, specular_intensity);
    vec3 surface_normal = normalize(frag_normal);
    vec3 to_light = normalize(vec3(-1, -1, 1));
    vec3 half_vec = normalize(normalize(eye_position - frag_position) + to_light);
    float ndl = clamp(dot(to_light, surface_normal), 0.f, 1.f);
    float ndh = pow(clamp(dot(half_vec, surface_normal), 0.0, 1.f), specular_pow);

    vec3 directional = frag_color.rgb * ndl;
    vec3 specular = vec3(1, 1, 1) * ndh * specular_intensity;
    out_color = vec4(directional + specular, frag_color.a);
}`;
export class Vertex {
    constructor(options = {}) {
        var _a, _b, _c, _d, _e, _f;
        this.position = (_b = (_a = options.position) === null || _a === void 0 ? void 0 : _a.clone(), (_b !== null && _b !== void 0 ? _b : new geo.Vec3(0, 0, 0)));
        this.normal = (_d = (_c = options.normal) === null || _c === void 0 ? void 0 : _c.clone(), (_d !== null && _d !== void 0 ? _d : new geo.Vec3(0, 0, 0)));
        this.color = (_f = (_e = options.color) === null || _e === void 0 ? void 0 : _e.clone(), (_f !== null && _f !== void 0 ? _f : new geo.Vec4(1, 1, 1, 1)));
    }
    clone() {
        return new Vertex(this);
    }
}
export class IxMesh {
    constructor(options = {}) {
        this.vertices = [];
        this.indices = [];
        if (options.vertices) {
            this.vertices.push(...options.vertices);
        }
        if (options.indices) {
            this.indices.push(...options.indices);
        }
    }
    clear() {
        this.vertices = [];
        this.indices = [];
    }
    transform(mat) {
        transform(mat, this.vertices);
    }
    cat(ixm) {
        const offset = this.vertices.length;
        this.vertices.push(...ixm.vertices.map(v => v.clone()));
        this.indices.push(...ixm.indices.map(ix => ix + offset));
    }
    calcAABB() {
        return calcAABB(this.vertices);
    }
    static cube() {
        // -x, +x, -y, +y, -z, +z
        const vertices = new Array(
        // -x
        new Vertex({ position: new geo.Vec3(-1, -1, -1), normal: new geo.Vec3(-1, 0, 0) }), new Vertex({ position: new geo.Vec3(-1, -1, 1), normal: new geo.Vec3(-1, 0, 0) }), new Vertex({ position: new geo.Vec3(-1, 1, 1), normal: new geo.Vec3(-1, 0, 0), }), new Vertex({ position: new geo.Vec3(-1, 1, -1), normal: new geo.Vec3(-1, 0, 0) }), 
        // +x
        new Vertex({ position: new geo.Vec3(1, -1, 1), normal: new geo.Vec3(1, 0, 0) }), new Vertex({ position: new geo.Vec3(1, -1, -1), normal: new geo.Vec3(1, 0, 0) }), new Vertex({ position: new geo.Vec3(1, 1, -1), normal: new geo.Vec3(1, 0, 0) }), new Vertex({ position: new geo.Vec3(1, 1, 1), normal: new geo.Vec3(1, 0, 0) }), 
        // -y
        new Vertex({ position: new geo.Vec3(-1, -1, 1), normal: new geo.Vec3(0, -1, 0) }), new Vertex({ position: new geo.Vec3(-1, -1, -1), normal: new geo.Vec3(0, -1, 0) }), new Vertex({ position: new geo.Vec3(1, -1, -1), normal: new geo.Vec3(0, -1, 0) }), new Vertex({ position: new geo.Vec3(1, -1, 1), normal: new geo.Vec3(0, -1, 0) }), 
        // +y
        new Vertex({ position: new geo.Vec3(-1, 1, 1), normal: new geo.Vec3(0, 1, 0) }), new Vertex({ position: new geo.Vec3(1, 1, 1), normal: new geo.Vec3(0, 1, 0) }), new Vertex({ position: new geo.Vec3(1, 1, -1), normal: new geo.Vec3(0, 1, 0) }), new Vertex({ position: new geo.Vec3(-1, 1, -1), normal: new geo.Vec3(0, 1, 0) }), 
        // -z
        new Vertex({ position: new geo.Vec3(-1, -1, -1), normal: new geo.Vec3(0, 0, -1) }), new Vertex({ position: new geo.Vec3(-1, 1, -1), normal: new geo.Vec3(0, 0, -1) }), new Vertex({ position: new geo.Vec3(1, 1, -1), normal: new geo.Vec3(0, 0, -1) }), new Vertex({ position: new geo.Vec3(1, -1, -1), normal: new geo.Vec3(0, 0, -1) }), 
        // +z
        new Vertex({ position: new geo.Vec3(-1, -1, 1), normal: new geo.Vec3(0, 0, 1) }), new Vertex({ position: new geo.Vec3(1, -1, 1), normal: new geo.Vec3(0, 0, 1) }), new Vertex({ position: new geo.Vec3(1, 1, 1), normal: new geo.Vec3(0, 0, 1) }), new Vertex({ position: new geo.Vec3(-1, 1, 1), normal: new geo.Vec3(0, 0, 1) }));
        return new IxMesh({
            vertices,
            indices: quadIndices(vertices.length / 4)
        });
    }
    static sphere(rows, cols) {
        // create north pole
        const vertices = new Array();
        const indices = new Array();
        const northPole = new Vertex({ position: new geo.Vec3(0, 1, 0), normal: new geo.Vec3(0, 1, 0), color: new geo.Vec4(1, 1, 1, 1) });
        vertices.push(northPole);
        // iterate over angles, essentially forming polar coordinates of each point
        // let theta = elevation angle above xy plane
        // let phi = xy plane angle
        const dtheta = Math.PI / (rows + 1);
        const dphi = 2 * Math.PI / cols;
        for (let j = 0; j < cols; ++j) {
            const phi = dphi * j;
            const theta = dtheta;
            const position = new geo.Vec3(Math.sin(theta) * Math.cos(phi), Math.cos(theta), Math.sin(theta) * Math.sin(phi));
            vertices.push(new Vertex({ position: position, normal: position, color: new geo.Vec4(1, 1, 1, 1) }));
            // connect to pole to form triangle
            indices.push(j + 1, (j + 1) % cols + 1, 0);
        }
        // interior
        for (let i = 1; i < rows; ++i) {
            const theta = dtheta * (i + 1);
            const prevRowOffset = (i - 1) * cols + 1;
            const rowOffset = prevRowOffset + cols;
            for (let j = 0; j < cols; ++j) {
                const phi = dphi * j;
                const position = new geo.Vec3(Math.sin(theta) * Math.cos(phi), Math.cos(theta), Math.sin(theta) * Math.sin(phi));
                vertices.push(new Vertex({ position: position, normal: position, color: new geo.Vec4(1, 1, 1, 1) }));
                const a = prevRowOffset + j;
                const b = rowOffset + j;
                const c = rowOffset + (j + 1) % cols;
                const d = prevRowOffset + (j + 1) % cols;
                indices.push(a, b, c, a, c, d);
            }
        }
        // create south pole
        const southPole = new Vertex({ position: new geo.Vec3(0, -1, 0), normal: new geo.Vec3(0, -1, 0), color: new geo.Vec4(1, 1, 1, 1) });
        vertices.push(southPole);
        const southPoleIdx = vertices.length - 1;
        // connect south pole to rest of mesh
        for (let j = 0; j < cols; ++j) {
            const offset = southPoleIdx - cols;
            // connect to pole to form triangle
            indices.push(offset + j, southPoleIdx, offset + (j + 1) % cols);
        }
        return new IxMesh({
            vertices,
            indices
        });
    }
    static rect(aabb) {
        // -x, +x, -y, +y, -z, +z
        const mesh = IxMesh.cube();
        const halfExtents = aabb.extents.divX(2);
        const negHalfExtents = halfExtents.neg();
        const translation = geo.Mat4.translation(aabb.min.sub(negHalfExtents));
        const scaling = geo.Mat4.scaling(halfExtents);
        const mat = scaling.matmul(translation);
        mesh.transform(mat);
        return mesh;
    }
    static rectFromCoords(minX, minY, minZ, maxX, maxY, maxZ) {
        return this.rect(geo.AABB.fromCoords(minX, minY, minZ, maxX, maxY, maxZ));
    }
}
function quadIndices(quads) {
    return array.generate(quads, i => [i * 4, i * 4 + 1, i * 4 + 2, i * 4, i * 4 + 2, i * 4 + 3]).flat();
}
export class Batch {
    constructor(options = {}) {
        var _a, _b, _c, _d, _e, _f;
        this.diffuseColor = new geo.Vec4(1, 1, 1, 1);
        this.roughness = 0;
        this.worldMatrix = (_a = options.worldMatrix, (_a !== null && _a !== void 0 ? _a : geo.Mat4.identity()));
        this.diffuseColor = (_b = options.diffuseColor, (_b !== null && _b !== void 0 ? _b : new geo.Vec4(1, 1, 1, 1)));
        this.roughness = (_c = options.roughness, (_c !== null && _c !== void 0 ? _c : 0));
        this.vao = (_d = options.vao, (_d !== null && _d !== void 0 ? _d : null));
        this.offset = (_e = options.offset, (_e !== null && _e !== void 0 ? _e : 0));
        this.numIndices = (_f = options.numIndices, (_f !== null && _f !== void 0 ? _f : 0));
    }
}
const elemsPerVertex = 10;
const vertexStride = elemsPerVertex * 4;
export class Renderer {
    constructor(canvas) {
        this.canvas = canvas;
        this.fov = Math.PI / 2;
        this.projectionMatrix = geo.Mat4.identity();
        this.viewMatrix = geo.Mat4.identity();
        this.batches = [];
        this.gl = glu.createContext(this.canvas);
        const gl = this.gl;
        this.program = glu.compileProgram(gl, vertexSrc, fragmentSrc);
        this.worldMatrixLoc = glu.getUniformLocation(gl, this.program, "world_matrix");
        this.viewMatrixLoc = glu.getUniformLocation(gl, this.program, "view_matrix");
        this.projectionMatrixLoc = glu.getUniformLocation(gl, this.program, "projection_matrix");
        this.projectionMatrixLoc = glu.getUniformLocation(gl, this.program, "projection_matrix");
        this.diffuseColorLoc = glu.getUniformLocation(gl, this.program, "diffuse_color");
        this.eyePositionLoc = glu.getUniformLocation(gl, this.program, "eye_position");
        this.roughnessLoc = glu.getUniformLocation(gl, this.program, "roughness");
    }
    get aspect() {
        return this.gl.drawingBufferWidth / this.gl.drawingBufferHeight;
    }
    present() {
        const gl = this.gl;
        this.projectionMatrix = geo.Mat4.perspective(this.fov, this.aspect, 1, 512);
        gl.bindFramebuffer(gl.FRAMEBUFFER, null);
        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
        gl.clearColor(0, 0, 0, 1);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
        gl.enable(gl.DEPTH_TEST);
        this.renderBatches();
    }
    createMesh(mesh) {
        // for now - place single triangle into vertex buffer
        const gl = this.gl;
        const vbo = glu.createBuffer(gl);
        const ibo = glu.createBuffer(gl);
        gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
        gl.bufferData(gl.ARRAY_BUFFER, toFloatArray(mesh.vertices), gl.STATIC_DRAW);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint32Array(mesh.indices), gl.STATIC_DRAW);
        return this.createVao(vbo, ibo);
    }
    drawBatch(batch) {
        this.batches.push(batch);
    }
    createVao(vbo, ibo) {
        const { gl, program } = this;
        const vao = glu.createVertexArray(gl);
        gl.bindVertexArray(vao);
        const positionAttribIdx = glu.getAttribLocation(gl, program, "vert_position");
        const normalAttribIdx = glu.getAttribLocation(gl, program, "vert_normal");
        const colorAttribIdx = glu.getAttribLocation(gl, program, "vert_color");
        gl.bindBuffer(gl.ARRAY_BUFFER, vbo);
        gl.enableVertexAttribArray(positionAttribIdx);
        gl.enableVertexAttribArray(normalAttribIdx);
        gl.enableVertexAttribArray(colorAttribIdx);
        gl.vertexAttribPointer(positionAttribIdx, 3, gl.FLOAT, false, vertexStride, 0);
        gl.vertexAttribPointer(normalAttribIdx, 3, gl.FLOAT, false, vertexStride, 12);
        gl.vertexAttribPointer(colorAttribIdx, 4, gl.FLOAT, false, vertexStride, 24);
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);
        gl.bindVertexArray(null);
        return vao;
    }
    renderBatches() {
        const gl = this.gl;
        gl.useProgram(this.program);
        gl.uniformMatrix4fv(this.projectionMatrixLoc, false, this.projectionMatrix.toArray());
        gl.uniformMatrix4fv(this.viewMatrixLoc, false, this.viewMatrix.toArray());
        // determine eye position and set uniform
        {
            const invViewMatrix = this.viewMatrix.invert();
            const eyePosition = invViewMatrix.transform3(new geo.Vec3(0, 0, 0));
            gl.uniform3fv(this.eyePositionLoc, eyePosition.toArray());
        }
        for (const batch of this.batches) {
            if (!batch.vao) {
                continue;
            }
            if (batch.numIndices <= 0) {
                continue;
            }
            gl.uniformMatrix4fv(this.worldMatrixLoc, false, batch.worldMatrix.toArray());
            gl.uniform4fv(this.diffuseColorLoc, batch.diffuseColor.toArray());
            gl.uniform1f(this.roughnessLoc, batch.roughness);
            gl.bindVertexArray(batch.vao);
            gl.drawElements(gl.TRIANGLES, batch.numIndices, gl.UNSIGNED_INT, batch.offset);
        }
        this.batches = [];
    }
}
function toFloatArray(vertices) {
    const a = new Float32Array(vertices.flatMap(v => [
        v.position.x, v.position.y, v.position.z,
        v.normal.x, v.normal.y, v.normal.z,
        v.color.x, v.color.y, v.color.z, v.color.w
    ]));
    return a;
}
export function transform(mat, vertices) {
    const basis = mat.toMat3();
    for (const v of vertices) {
        v.position = mat.transform3(v.position);
        v.normal = basis.transform(v.normal);
    }
}
export function calcAABB(vertices) {
    const aabb = geo.AABB.fromPoints(iter.map(vertices, v => v.position));
    return aabb;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2Z4LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZ2Z4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxHQUFHLE1BQU0sa0JBQWtCLENBQUE7QUFDdkMsT0FBTyxLQUFLLEdBQUcsTUFBTSxvQkFBb0IsQ0FBQTtBQUN6QyxPQUFPLEtBQUssS0FBSyxNQUFNLG9CQUFvQixDQUFBO0FBQzNDLE9BQU8sS0FBSyxJQUFJLE1BQU0sbUJBQW1CLENBQUE7QUFFekMsTUFBTSxTQUFTLEdBQUc7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0VBb0JoQixDQUFBO0FBRUYsTUFBTSxXQUFXLEdBQUc7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztFQXdCbEIsQ0FBQTtBQVFGLE1BQU0sT0FBTyxNQUFNO0lBS2YsWUFBWSxVQUF5QixFQUFFOztRQUNuQyxJQUFJLENBQUMsUUFBUSxlQUFHLE9BQU8sQ0FBQyxRQUFRLDBDQUFFLEtBQUsseUNBQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUEsQ0FBQTtRQUNsRSxJQUFJLENBQUMsTUFBTSxlQUFHLE9BQU8sQ0FBQyxNQUFNLDBDQUFFLEtBQUsseUNBQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUEsQ0FBQTtRQUM5RCxJQUFJLENBQUMsS0FBSyxlQUFHLE9BQU8sQ0FBQyxLQUFLLDBDQUFFLEtBQUsseUNBQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFBLENBQUE7SUFDbkUsQ0FBQztJQUVELEtBQUs7UUFDRCxPQUFPLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQzNCLENBQUM7Q0FDSjtBQU9ELE1BQU0sT0FBTyxNQUFNO0lBSWYsWUFBWSxVQUF5QixFQUFFO1FBSGhDLGFBQVEsR0FBYSxFQUFFLENBQUE7UUFDdkIsWUFBTyxHQUFhLEVBQUUsQ0FBQTtRQUd6QixJQUFJLE9BQU8sQ0FBQyxRQUFRLEVBQUU7WUFDbEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUE7U0FDMUM7UUFFRCxJQUFJLE9BQU8sQ0FBQyxPQUFPLEVBQUU7WUFDakIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUE7U0FDeEM7SUFDTCxDQUFDO0lBRUQsS0FBSztRQUNELElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFBO1FBQ2xCLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFBO0lBQ3JCLENBQUM7SUFFRCxTQUFTLENBQUMsR0FBYTtRQUNuQixTQUFTLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQTtJQUNqQyxDQUFDO0lBRUQsR0FBRyxDQUFDLEdBQVc7UUFDWCxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQTtRQUNuQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUN2RCxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUE7SUFDNUQsQ0FBQztJQUVELFFBQVE7UUFDSixPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDbEMsQ0FBQztJQUVELE1BQU0sQ0FBQyxJQUFJO1FBQ1AseUJBQXlCO1FBQ3pCLE1BQU0sUUFBUSxHQUFHLElBQUksS0FBSztRQUN0QixLQUFLO1FBQ0wsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUNsRixJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUNqRixJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFDakYsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDakYsS0FBSztRQUNMLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDL0UsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2hGLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDL0UsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDOUUsS0FBSztRQUNMLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2pGLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDbEYsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDakYsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ2hGLEtBQUs7UUFDTCxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQy9FLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQzlFLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDL0UsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQ2hGLEtBQUs7UUFDTCxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2xGLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2pGLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUNoRixJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUNqRixLQUFLO1FBQ0wsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQ2hGLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDL0UsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFDOUUsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUNsRixDQUFBO1FBRUQsT0FBTyxJQUFJLE1BQU0sQ0FBQztZQUNkLFFBQVE7WUFDUixPQUFPLEVBQUUsV0FBVyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1NBQzVDLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFFRCxNQUFNLENBQUMsTUFBTSxDQUFDLElBQVksRUFBRSxJQUFZO1FBQ3BDLG9CQUFvQjtRQUNwQixNQUFNLFFBQVEsR0FBRyxJQUFJLEtBQUssRUFBVSxDQUFBO1FBQ3BDLE1BQU0sT0FBTyxHQUFHLElBQUksS0FBSyxFQUFVLENBQUE7UUFDbkMsTUFBTSxTQUFTLEdBQUcsSUFBSSxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ2pJLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUE7UUFFeEIsMkVBQTJFO1FBQzNFLDZDQUE2QztRQUM3QywyQkFBMkI7UUFDM0IsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQTtRQUNuQyxNQUFNLElBQUksR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUE7UUFFL0IsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksRUFBRSxFQUFFLENBQUMsRUFBRTtZQUMzQixNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxDQUFBO1lBQ3BCLE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQTtZQUNwQixNQUFNLFFBQVEsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQ3pCLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFDL0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFDZixJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQ2xDLENBQUE7WUFFRCxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksTUFBTSxDQUFDLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7WUFFcEcsbUNBQW1DO1lBQ25DLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO1NBQzdDO1FBRUQsV0FBVztRQUNYLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsRUFBRSxDQUFDLEVBQUU7WUFDM0IsTUFBTSxLQUFLLEdBQUcsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO1lBQzlCLE1BQU0sYUFBYSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLENBQUE7WUFDeEMsTUFBTSxTQUFTLEdBQUcsYUFBYSxHQUFHLElBQUksQ0FBQTtZQUN0QyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxFQUFFLEVBQUUsQ0FBQyxFQUFFO2dCQUMzQixNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxDQUFBO2dCQUNwQixNQUFNLFFBQVEsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQ3pCLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFDL0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFDZixJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQ2xDLENBQUE7Z0JBQ0QsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO2dCQUVwRyxNQUFNLENBQUMsR0FBRyxhQUFhLEdBQUcsQ0FBQyxDQUFBO2dCQUMzQixNQUFNLENBQUMsR0FBRyxTQUFTLEdBQUcsQ0FBQyxDQUFBO2dCQUN2QixNQUFNLENBQUMsR0FBRyxTQUFTLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFBO2dCQUNwQyxNQUFNLENBQUMsR0FBRyxhQUFhLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFBO2dCQUN4QyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7YUFDakM7U0FDSjtRQUVELG9CQUFvQjtRQUNwQixNQUFNLFNBQVMsR0FBRyxJQUFJLE1BQU0sQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ25JLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUE7UUFDeEIsTUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUE7UUFFeEMscUNBQXFDO1FBQ3JDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsRUFBRSxDQUFDLEVBQUU7WUFDM0IsTUFBTSxNQUFNLEdBQUcsWUFBWSxHQUFHLElBQUksQ0FBQTtZQUVsQyxtQ0FBbUM7WUFDbkMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLFlBQVksRUFBRSxNQUFNLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUE7U0FDbEU7UUFFRCxPQUFPLElBQUksTUFBTSxDQUFDO1lBQ2QsUUFBUTtZQUNSLE9BQU87U0FDVixDQUFDLENBQUE7SUFDTixDQUFDO0lBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFjO1FBQ3RCLHlCQUF5QjtRQUN6QixNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDMUIsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDeEMsTUFBTSxjQUFjLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFBO1FBQ3hDLE1BQU0sV0FBVyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUE7UUFDdEUsTUFBTSxPQUFPLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUE7UUFDN0MsTUFBTSxHQUFHLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUN2QyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ25CLE9BQU8sSUFBSSxDQUFBO0lBQ2YsQ0FBQztJQUVELE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBWSxFQUFFLElBQVksRUFBRSxJQUFZLEVBQUUsSUFBWSxFQUFFLElBQVksRUFBRSxJQUFZO1FBQ3BHLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUE7SUFDN0UsQ0FBQztDQUNKO0FBRUQsU0FBUyxXQUFXLENBQUMsS0FBYTtJQUM5QixPQUFPLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFBO0FBQ3hHLENBQUM7QUFpQkQsTUFBTSxPQUFPLEtBQUs7SUFRZCxZQUFZLFVBQXdCLEVBQUU7O1FBTi9CLGlCQUFZLEdBQWEsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO1FBQ2pELGNBQVMsR0FBVyxDQUFDLENBQUE7UUFNeEIsSUFBSSxDQUFDLFdBQVcsU0FBRyxPQUFPLENBQUMsV0FBVyx1Q0FBSSxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFBLENBQUE7UUFDN0QsSUFBSSxDQUFDLFlBQVksU0FBRyxPQUFPLENBQUMsWUFBWSx1Q0FBSSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUEsQ0FBQTtRQUNwRSxJQUFJLENBQUMsU0FBUyxTQUFHLE9BQU8sQ0FBQyxTQUFTLHVDQUFJLENBQUMsRUFBQSxDQUFBO1FBQ3ZDLElBQUksQ0FBQyxHQUFHLFNBQUcsT0FBTyxDQUFDLEdBQUcsdUNBQUksSUFBSSxFQUFBLENBQUE7UUFDOUIsSUFBSSxDQUFDLE1BQU0sU0FBRyxPQUFPLENBQUMsTUFBTSx1Q0FBSSxDQUFDLEVBQUEsQ0FBQTtRQUNqQyxJQUFJLENBQUMsVUFBVSxTQUFHLE9BQU8sQ0FBQyxVQUFVLHVDQUFJLENBQUMsRUFBQSxDQUFBO0lBQzdDLENBQUM7Q0FDSjtBQUVELE1BQU0sY0FBYyxHQUFHLEVBQUUsQ0FBQTtBQUN6QixNQUFNLFlBQVksR0FBRyxjQUFjLEdBQUcsQ0FBQyxDQUFBO0FBRXZDLE1BQU0sT0FBTyxRQUFRO0lBY2pCLFlBQTZCLE1BQXlCO1FBQXpCLFdBQU0sR0FBTixNQUFNLENBQW1CO1FBWHRDLFFBQUcsR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQTtRQU8xQixxQkFBZ0IsR0FBYSxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO1FBQ2hELGVBQVUsR0FBYSxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO1FBQ3pDLFlBQU8sR0FBWSxFQUFFLENBQUE7UUFHekIsSUFBSSxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUN4QyxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFBO1FBQ2xCLElBQUksQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLGNBQWMsQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFLFdBQVcsQ0FBQyxDQUFBO1FBQzdELElBQUksQ0FBQyxjQUFjLEdBQUcsR0FBRyxDQUFDLGtCQUFrQixDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLGNBQWMsQ0FBQyxDQUFBO1FBQzlFLElBQUksQ0FBQyxhQUFhLEdBQUcsR0FBRyxDQUFDLGtCQUFrQixDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLGFBQWEsQ0FBQyxDQUFBO1FBQzVFLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxHQUFHLENBQUMsa0JBQWtCLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsbUJBQW1CLENBQUMsQ0FBQTtRQUN4RixJQUFJLENBQUMsbUJBQW1CLEdBQUcsR0FBRyxDQUFDLGtCQUFrQixDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsT0FBTyxFQUFFLG1CQUFtQixDQUFDLENBQUE7UUFDeEYsSUFBSSxDQUFDLGVBQWUsR0FBRyxHQUFHLENBQUMsa0JBQWtCLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsZUFBZSxDQUFDLENBQUE7UUFDaEYsSUFBSSxDQUFDLGNBQWMsR0FBRyxHQUFHLENBQUMsa0JBQWtCLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsY0FBYyxDQUFDLENBQUE7UUFDOUUsSUFBSSxDQUFDLFlBQVksR0FBRyxHQUFHLENBQUMsa0JBQWtCLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLENBQUE7SUFDN0UsQ0FBQztJQUVELElBQVcsTUFBTTtRQUNiLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLG1CQUFtQixDQUFBO0lBQ25FLENBQUM7SUFFTSxPQUFPO1FBQ1YsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQTtRQUVsQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQTtRQUUzRSxFQUFFLENBQUMsZUFBZSxDQUFDLEVBQUUsQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFDeEMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsRUFBRSxFQUFFLENBQUMsbUJBQW1CLENBQUMsQ0FBQTtRQUNoRSxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO1FBQ3pCLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLGdCQUFnQixHQUFHLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO1FBQ25ELEVBQUUsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFBO1FBQ3hCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQTtJQUN4QixDQUFDO0lBRU0sVUFBVSxDQUFDLElBQVk7UUFDMUIscURBQXFEO1FBQ3JELE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUE7UUFDbEIsTUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUNoQyxNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ2hDLEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFlBQVksRUFBRSxHQUFHLENBQUMsQ0FBQTtRQUNuQyxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFLENBQUMsV0FBVyxDQUFDLENBQUE7UUFDM0UsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxDQUFDLENBQUE7UUFDM0MsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsb0JBQW9CLEVBQUUsSUFBSSxXQUFXLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQTtRQUNyRixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ25DLENBQUM7SUFFTSxTQUFTLENBQUMsS0FBWTtRQUN6QixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUM1QixDQUFDO0lBRU8sU0FBUyxDQUFDLEdBQWdCLEVBQUUsR0FBZ0I7UUFDaEQsTUFBTSxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUE7UUFDNUIsTUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ3JDLEVBQUUsQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUE7UUFFdkIsTUFBTSxpQkFBaUIsR0FBRyxHQUFHLENBQUMsaUJBQWlCLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxlQUFlLENBQUMsQ0FBQTtRQUM3RSxNQUFNLGVBQWUsR0FBRyxHQUFHLENBQUMsaUJBQWlCLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxhQUFhLENBQUMsQ0FBQTtRQUN6RSxNQUFNLGNBQWMsR0FBRyxHQUFHLENBQUMsaUJBQWlCLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxZQUFZLENBQUMsQ0FBQTtRQUN2RSxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsR0FBRyxDQUFDLENBQUE7UUFDbkMsRUFBRSxDQUFDLHVCQUF1QixDQUFDLGlCQUFpQixDQUFDLENBQUE7UUFDN0MsRUFBRSxDQUFDLHVCQUF1QixDQUFDLGVBQWUsQ0FBQyxDQUFBO1FBQzNDLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQyxjQUFjLENBQUMsQ0FBQTtRQUMxQyxFQUFFLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUM5RSxFQUFFLENBQUMsbUJBQW1CLENBQUMsZUFBZSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsRUFBRSxDQUFDLENBQUE7UUFDN0UsRUFBRSxDQUFDLG1CQUFtQixDQUFDLGNBQWMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLEVBQUUsQ0FBQyxDQUFBO1FBQzVFLEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsQ0FBQyxDQUFBO1FBRTNDLEVBQUUsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDeEIsT0FBTyxHQUFHLENBQUE7SUFDZCxDQUFDO0lBRU8sYUFBYTtRQUNqQixNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFBO1FBQ2xCLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBQzNCLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFBO1FBQ3JGLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUE7UUFFekUseUNBQXlDO1FBQ3pDO1lBQ0ksTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQTtZQUM5QyxNQUFNLFdBQVcsR0FBRyxhQUFhLENBQUMsVUFBVSxDQUFDLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDbkUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLFdBQVcsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFBO1NBQzVEO1FBRUQsS0FBSyxNQUFNLEtBQUssSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQzlCLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFO2dCQUNaLFNBQVE7YUFDWDtZQUVELElBQUksS0FBSyxDQUFDLFVBQVUsSUFBSSxDQUFDLEVBQUU7Z0JBQ3ZCLFNBQVE7YUFDWDtZQUVELEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUE7WUFDNUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQTtZQUNqRSxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFBO1lBQ2hELEVBQUUsQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBQzdCLEVBQUUsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFBO1NBQ2pGO1FBRUQsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUE7SUFDckIsQ0FBQztDQUNKO0FBRUQsU0FBUyxZQUFZLENBQUMsUUFBa0I7SUFDcEMsTUFBTSxDQUFDLEdBQUcsSUFBSSxZQUFZLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQzdDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN4QyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDbEMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQUMsQ0FBQyxDQUFDLENBQUE7SUFFakQsT0FBTyxDQUFDLENBQUE7QUFDWixDQUFDO0FBRUQsTUFBTSxVQUFVLFNBQVMsQ0FBQyxHQUFhLEVBQUUsUUFBa0I7SUFDdkQsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFBO0lBQzFCLEtBQUssTUFBTSxDQUFDLElBQUksUUFBUSxFQUFFO1FBQ3RCLENBQUMsQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDdkMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQTtLQUN2QztBQUNMLENBQUM7QUFFRCxNQUFNLFVBQVUsUUFBUSxDQUFDLFFBQTBCO0lBQy9DLE1BQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUE7SUFDckUsT0FBTyxJQUFJLENBQUE7QUFDZixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZ2x1IGZyb20gXCIuLi9zaGFyZWQvZ2x1LmpzXCJcclxuaW1wb3J0ICogYXMgZ2VvIGZyb20gXCIuLi9zaGFyZWQvZ2VvM2QuanNcIlxyXG5pbXBvcnQgKiBhcyBhcnJheSBmcm9tIFwiLi4vc2hhcmVkL2FycmF5LmpzXCJcclxuaW1wb3J0ICogYXMgaXRlciBmcm9tIFwiLi4vc2hhcmVkL2l0ZXIuanNcIlxyXG5cclxuY29uc3QgdmVydGV4U3JjID0gYCN2ZXJzaW9uIDMwMCBlc1xyXG5wcmVjaXNpb24gbWVkaXVtcCBmbG9hdDtcclxudW5pZm9ybSBtYXQ0IHdvcmxkX21hdHJpeDtcclxudW5pZm9ybSBtYXQ0IHZpZXdfbWF0cml4O1xyXG51bmlmb3JtIG1hdDQgcHJvamVjdGlvbl9tYXRyaXg7XHJcbnVuaWZvcm0gdmVjNCBkaWZmdXNlX2NvbG9yO1xyXG5cclxuaW4gdmVjMyB2ZXJ0X3Bvc2l0aW9uO1xyXG5pbiB2ZWMzIHZlcnRfbm9ybWFsO1xyXG5pbiB2ZWM0IHZlcnRfY29sb3I7XHJcbm91dCB2ZWMzIGZyYWdfbm9ybWFsO1xyXG5vdXQgdmVjMyBmcmFnX3Bvc2l0aW9uO1xyXG5vdXQgdmVjNCBmcmFnX2NvbG9yO1xyXG5cclxudm9pZCBtYWluKCkge1xyXG4gICAgZnJhZ19jb2xvciA9IHZlcnRfY29sb3IgKiBkaWZmdXNlX2NvbG9yO1xyXG4gICAgZnJhZ19ub3JtYWwgPSBtYXQzKHdvcmxkX21hdHJpeCkgKiB2ZXJ0X25vcm1hbDtcclxuICAgIHZlYzQgcG9zaXRpb25fd29ybGQgPSB3b3JsZF9tYXRyaXggKiB2ZWM0KHZlcnRfcG9zaXRpb24sIDEuZik7XHJcbiAgICBnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25fbWF0cml4ICogdmlld19tYXRyaXggKiBwb3NpdGlvbl93b3JsZDtcclxuICAgIGZyYWdfcG9zaXRpb24gPSBwb3NpdGlvbl93b3JsZC54eXogLyBwb3NpdGlvbl93b3JsZC53O1xyXG59YFxyXG5cclxuY29uc3QgZnJhZ21lbnRTcmMgPSBgI3ZlcnNpb24gMzAwIGVzXHJcbnByZWNpc2lvbiBoaWdocCBmbG9hdDtcclxucHJlY2lzaW9uIGhpZ2hwIHNhbXBsZXIyRDtcclxucHJlY2lzaW9uIGhpZ2hwIHNhbXBsZXIyREFycmF5O1xyXG5cclxudW5pZm9ybSB2ZWMzIGV5ZV9wb3NpdGlvbjtcclxudW5pZm9ybSBmbG9hdCByb3VnaG5lc3M7XHJcbmluIHZlYzQgZnJhZ19jb2xvcjtcclxuaW4gdmVjMyBmcmFnX3Bvc2l0aW9uO1xyXG5pbiB2ZWMzIGZyYWdfbm9ybWFsO1xyXG5vdXQgdmVjNCBvdXRfY29sb3I7XHJcblxyXG52b2lkIG1haW4oKSB7XHJcbiAgICBmbG9hdCBzcGVjdWxhcl9pbnRlbnNpdHkgPSAxLmYgLSByb3VnaG5lc3M7XHJcbiAgICBmbG9hdCBzcGVjdWxhcl9wb3cgPSBtaXgoLjFmLCAzMi5mLCBzcGVjdWxhcl9pbnRlbnNpdHkpO1xyXG4gICAgdmVjMyBzdXJmYWNlX25vcm1hbCA9IG5vcm1hbGl6ZShmcmFnX25vcm1hbCk7XHJcbiAgICB2ZWMzIHRvX2xpZ2h0ID0gbm9ybWFsaXplKHZlYzMoLTEsIC0xLCAxKSk7XHJcbiAgICB2ZWMzIGhhbGZfdmVjID0gbm9ybWFsaXplKG5vcm1hbGl6ZShleWVfcG9zaXRpb24gLSBmcmFnX3Bvc2l0aW9uKSArIHRvX2xpZ2h0KTtcclxuICAgIGZsb2F0IG5kbCA9IGNsYW1wKGRvdCh0b19saWdodCwgc3VyZmFjZV9ub3JtYWwpLCAwLmYsIDEuZik7XHJcbiAgICBmbG9hdCBuZGggPSBwb3coY2xhbXAoZG90KGhhbGZfdmVjLCBzdXJmYWNlX25vcm1hbCksIDAuMCwgMS5mKSwgc3BlY3VsYXJfcG93KTtcclxuXHJcbiAgICB2ZWMzIGRpcmVjdGlvbmFsID0gZnJhZ19jb2xvci5yZ2IgKiBuZGw7XHJcbiAgICB2ZWMzIHNwZWN1bGFyID0gdmVjMygxLCAxLCAxKSAqIG5kaCAqIHNwZWN1bGFyX2ludGVuc2l0eTtcclxuICAgIG91dF9jb2xvciA9IHZlYzQoZGlyZWN0aW9uYWwgKyBzcGVjdWxhciwgZnJhZ19jb2xvci5hKTtcclxufWBcclxuXHJcbmludGVyZmFjZSBWZXJ0ZXhPcHRpb25zIHtcclxuICAgIHBvc2l0aW9uPzogZ2VvLlZlYzNcclxuICAgIG5vcm1hbD86IGdlby5WZWMzXHJcbiAgICBjb2xvcj86IGdlby5WZWM0XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBWZXJ0ZXgge1xyXG4gICAgcG9zaXRpb246IGdlby5WZWMzXHJcbiAgICBub3JtYWw6IGdlby5WZWMzXHJcbiAgICBjb2xvcjogZ2VvLlZlYzRcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zOiBWZXJ0ZXhPcHRpb25zID0ge30pIHtcclxuICAgICAgICB0aGlzLnBvc2l0aW9uID0gb3B0aW9ucy5wb3NpdGlvbj8uY2xvbmUoKSA/PyBuZXcgZ2VvLlZlYzMoMCwgMCwgMClcclxuICAgICAgICB0aGlzLm5vcm1hbCA9IG9wdGlvbnMubm9ybWFsPy5jbG9uZSgpID8/IG5ldyBnZW8uVmVjMygwLCAwLCAwKVxyXG4gICAgICAgIHRoaXMuY29sb3IgPSBvcHRpb25zLmNvbG9yPy5jbG9uZSgpID8/IG5ldyBnZW8uVmVjNCgxLCAxLCAxLCAxKVxyXG4gICAgfVxyXG5cclxuICAgIGNsb25lKCk6IFZlcnRleCB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBWZXJ0ZXgodGhpcylcclxuICAgIH1cclxufVxyXG5cclxuaW50ZXJmYWNlIEl4TWVzaE9wdGlvbnMge1xyXG4gICAgdmVydGljZXM/OiBWZXJ0ZXhbXVxyXG4gICAgaW5kaWNlcz86IG51bWJlcltdXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBJeE1lc2gge1xyXG4gICAgcHVibGljIHZlcnRpY2VzOiBWZXJ0ZXhbXSA9IFtdXHJcbiAgICBwdWJsaWMgaW5kaWNlczogbnVtYmVyW10gPSBbXVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnM6IEl4TWVzaE9wdGlvbnMgPSB7fSkge1xyXG4gICAgICAgIGlmIChvcHRpb25zLnZlcnRpY2VzKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmVydGljZXMucHVzaCguLi5vcHRpb25zLnZlcnRpY2VzKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG9wdGlvbnMuaW5kaWNlcykge1xyXG4gICAgICAgICAgICB0aGlzLmluZGljZXMucHVzaCguLi5vcHRpb25zLmluZGljZXMpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyKCkge1xyXG4gICAgICAgIHRoaXMudmVydGljZXMgPSBbXVxyXG4gICAgICAgIHRoaXMuaW5kaWNlcyA9IFtdXHJcbiAgICB9XHJcblxyXG4gICAgdHJhbnNmb3JtKG1hdDogZ2VvLk1hdDQpIHtcclxuICAgICAgICB0cmFuc2Zvcm0obWF0LCB0aGlzLnZlcnRpY2VzKVxyXG4gICAgfVxyXG5cclxuICAgIGNhdChpeG06IEl4TWVzaCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IHRoaXMudmVydGljZXMubGVuZ3RoXHJcbiAgICAgICAgdGhpcy52ZXJ0aWNlcy5wdXNoKC4uLml4bS52ZXJ0aWNlcy5tYXAodiA9PiB2LmNsb25lKCkpKVxyXG4gICAgICAgIHRoaXMuaW5kaWNlcy5wdXNoKC4uLml4bS5pbmRpY2VzLm1hcChpeCA9PiBpeCArIG9mZnNldCkpXHJcbiAgICB9XHJcblxyXG4gICAgY2FsY0FBQkIoKTogZ2VvLkFBQkIge1xyXG4gICAgICAgIHJldHVybiBjYWxjQUFCQih0aGlzLnZlcnRpY2VzKVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBjdWJlKCk6IEl4TWVzaCB7XHJcbiAgICAgICAgLy8gLXgsICt4LCAteSwgK3ksIC16LCArelxyXG4gICAgICAgIGNvbnN0IHZlcnRpY2VzID0gbmV3IEFycmF5PFZlcnRleD4oXHJcbiAgICAgICAgICAgIC8vIC14XHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAtMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygtMSwgMCwgMCkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAtMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKC0xLCAwLCAwKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIDEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygtMSwgMCwgMCksIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygtMSwgMCwgMCkgfSksXHJcbiAgICAgICAgICAgIC8vICt4XHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIC0xLCAxKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMSwgMCwgMCkgfSksXHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDEsIC0xLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDEsIDAsIDApIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAxLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDEsIDAsIDApIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAxLCAxKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMSwgMCwgMCkgfSksXHJcbiAgICAgICAgICAgIC8vIC15XHJcbiAgICAgICAgICAgIG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKC0xLCAtMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIC0xLCAwKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIC0xLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIC0xLCAwKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgLTEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgLTEsIDApIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAtMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIC0xLCAwKSB9KSxcclxuICAgICAgICAgICAgLy8gK3lcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIDEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAxLCAwKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDEsIDApIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAxLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDEsIDApIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgMSwgLTEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAxLCAwKSB9KSxcclxuICAgICAgICAgICAgLy8gLXpcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIC0xLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIC0xKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoLTEsIDEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMCwgLTEpIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygxLCAxLCAtMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIC0xKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgLTEsIC0xKSwgbm9ybWFsOiBuZXcgZ2VvLlZlYzMoMCwgMCwgLTEpIH0pLFxyXG4gICAgICAgICAgICAvLyArelxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgLTEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAwLCAxKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgLTEsIDEpLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAwLCAxKSB9KSxcclxuICAgICAgICAgICAgbmV3IFZlcnRleCh7IHBvc2l0aW9uOiBuZXcgZ2VvLlZlYzMoMSwgMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIDEpIH0pLFxyXG4gICAgICAgICAgICBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygtMSwgMSwgMSksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIDAsIDEpIH0pXHJcbiAgICAgICAgKVxyXG5cclxuICAgICAgICByZXR1cm4gbmV3IEl4TWVzaCh7XHJcbiAgICAgICAgICAgIHZlcnRpY2VzLFxyXG4gICAgICAgICAgICBpbmRpY2VzOiBxdWFkSW5kaWNlcyh2ZXJ0aWNlcy5sZW5ndGggLyA0KVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHNwaGVyZShyb3dzOiBudW1iZXIsIGNvbHM6IG51bWJlcik6IEl4TWVzaCB7XHJcbiAgICAgICAgLy8gY3JlYXRlIG5vcnRoIHBvbGVcclxuICAgICAgICBjb25zdCB2ZXJ0aWNlcyA9IG5ldyBBcnJheTxWZXJ0ZXg+KClcclxuICAgICAgICBjb25zdCBpbmRpY2VzID0gbmV3IEFycmF5PG51bWJlcj4oKVxyXG4gICAgICAgIGNvbnN0IG5vcnRoUG9sZSA9IG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogbmV3IGdlby5WZWMzKDAsIDEsIDApLCBub3JtYWw6IG5ldyBnZW8uVmVjMygwLCAxLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAxLCAxLCAxKSB9KVxyXG4gICAgICAgIHZlcnRpY2VzLnB1c2gobm9ydGhQb2xlKVxyXG5cclxuICAgICAgICAvLyBpdGVyYXRlIG92ZXIgYW5nbGVzLCBlc3NlbnRpYWxseSBmb3JtaW5nIHBvbGFyIGNvb3JkaW5hdGVzIG9mIGVhY2ggcG9pbnRcclxuICAgICAgICAvLyBsZXQgdGhldGEgPSBlbGV2YXRpb24gYW5nbGUgYWJvdmUgeHkgcGxhbmVcclxuICAgICAgICAvLyBsZXQgcGhpID0geHkgcGxhbmUgYW5nbGVcclxuICAgICAgICBjb25zdCBkdGhldGEgPSBNYXRoLlBJIC8gKHJvd3MgKyAxKVxyXG4gICAgICAgIGNvbnN0IGRwaGkgPSAyICogTWF0aC5QSSAvIGNvbHNcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjb2xzOyArK2opIHtcclxuICAgICAgICAgICAgY29uc3QgcGhpID0gZHBoaSAqIGpcclxuICAgICAgICAgICAgY29uc3QgdGhldGEgPSBkdGhldGFcclxuICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSBuZXcgZ2VvLlZlYzMoXHJcbiAgICAgICAgICAgICAgICBNYXRoLnNpbih0aGV0YSkgKiBNYXRoLmNvcyhwaGkpLFxyXG4gICAgICAgICAgICAgICAgTWF0aC5jb3ModGhldGEpLFxyXG4gICAgICAgICAgICAgICAgTWF0aC5zaW4odGhldGEpICogTWF0aC5zaW4ocGhpKVxyXG4gICAgICAgICAgICApXHJcblxyXG4gICAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogcG9zaXRpb24sIG5vcm1hbDogcG9zaXRpb24sIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMSwgMSwgMSkgfSkpXHJcblxyXG4gICAgICAgICAgICAvLyBjb25uZWN0IHRvIHBvbGUgdG8gZm9ybSB0cmlhbmdsZVxyXG4gICAgICAgICAgICBpbmRpY2VzLnB1c2goaiArIDEsIChqICsgMSkgJSBjb2xzICsgMSwgMClcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGludGVyaW9yXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCByb3dzOyArK2kpIHtcclxuICAgICAgICAgICAgY29uc3QgdGhldGEgPSBkdGhldGEgKiAoaSArIDEpXHJcbiAgICAgICAgICAgIGNvbnN0IHByZXZSb3dPZmZzZXQgPSAoaSAtIDEpICogY29scyArIDFcclxuICAgICAgICAgICAgY29uc3Qgcm93T2Zmc2V0ID0gcHJldlJvd09mZnNldCArIGNvbHNcclxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjb2xzOyArK2opIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHBoaSA9IGRwaGkgKiBqXHJcbiAgICAgICAgICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG5ldyBnZW8uVmVjMyhcclxuICAgICAgICAgICAgICAgICAgICBNYXRoLnNpbih0aGV0YSkgKiBNYXRoLmNvcyhwaGkpLFxyXG4gICAgICAgICAgICAgICAgICAgIE1hdGguY29zKHRoZXRhKSxcclxuICAgICAgICAgICAgICAgICAgICBNYXRoLnNpbih0aGV0YSkgKiBNYXRoLnNpbihwaGkpXHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZXJ0ZXgoeyBwb3NpdGlvbjogcG9zaXRpb24sIG5vcm1hbDogcG9zaXRpb24sIGNvbG9yOiBuZXcgZ2VvLlZlYzQoMSwgMSwgMSwgMSkgfSkpXHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgYSA9IHByZXZSb3dPZmZzZXQgKyBqXHJcbiAgICAgICAgICAgICAgICBjb25zdCBiID0gcm93T2Zmc2V0ICsgalxyXG4gICAgICAgICAgICAgICAgY29uc3QgYyA9IHJvd09mZnNldCArIChqICsgMSkgJSBjb2xzXHJcbiAgICAgICAgICAgICAgICBjb25zdCBkID0gcHJldlJvd09mZnNldCArIChqICsgMSkgJSBjb2xzXHJcbiAgICAgICAgICAgICAgICBpbmRpY2VzLnB1c2goYSwgYiwgYywgYSwgYywgZClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gY3JlYXRlIHNvdXRoIHBvbGVcclxuICAgICAgICBjb25zdCBzb3V0aFBvbGUgPSBuZXcgVmVydGV4KHsgcG9zaXRpb246IG5ldyBnZW8uVmVjMygwLCAtMSwgMCksIG5vcm1hbDogbmV3IGdlby5WZWMzKDAsIC0xLCAwKSwgY29sb3I6IG5ldyBnZW8uVmVjNCgxLCAxLCAxLCAxKSB9KVxyXG4gICAgICAgIHZlcnRpY2VzLnB1c2goc291dGhQb2xlKVxyXG4gICAgICAgIGNvbnN0IHNvdXRoUG9sZUlkeCA9IHZlcnRpY2VzLmxlbmd0aCAtIDFcclxuXHJcbiAgICAgICAgLy8gY29ubmVjdCBzb3V0aCBwb2xlIHRvIHJlc3Qgb2YgbWVzaFxyXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY29sczsgKytqKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IHNvdXRoUG9sZUlkeCAtIGNvbHNcclxuXHJcbiAgICAgICAgICAgIC8vIGNvbm5lY3QgdG8gcG9sZSB0byBmb3JtIHRyaWFuZ2xlXHJcbiAgICAgICAgICAgIGluZGljZXMucHVzaChvZmZzZXQgKyBqLCBzb3V0aFBvbGVJZHgsIG9mZnNldCArIChqICsgMSkgJSBjb2xzKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG5ldyBJeE1lc2goe1xyXG4gICAgICAgICAgICB2ZXJ0aWNlcyxcclxuICAgICAgICAgICAgaW5kaWNlc1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHJlY3QoYWFiYjogZ2VvLkFBQkIpOiBJeE1lc2gge1xyXG4gICAgICAgIC8vIC14LCAreCwgLXksICt5LCAteiwgK3pcclxuICAgICAgICBjb25zdCBtZXNoID0gSXhNZXNoLmN1YmUoKVxyXG4gICAgICAgIGNvbnN0IGhhbGZFeHRlbnRzID0gYWFiYi5leHRlbnRzLmRpdlgoMilcclxuICAgICAgICBjb25zdCBuZWdIYWxmRXh0ZW50cyA9IGhhbGZFeHRlbnRzLm5lZygpXHJcbiAgICAgICAgY29uc3QgdHJhbnNsYXRpb24gPSBnZW8uTWF0NC50cmFuc2xhdGlvbihhYWJiLm1pbi5zdWIobmVnSGFsZkV4dGVudHMpKVxyXG4gICAgICAgIGNvbnN0IHNjYWxpbmcgPSBnZW8uTWF0NC5zY2FsaW5nKGhhbGZFeHRlbnRzKVxyXG4gICAgICAgIGNvbnN0IG1hdCA9IHNjYWxpbmcubWF0bXVsKHRyYW5zbGF0aW9uKVxyXG4gICAgICAgIG1lc2gudHJhbnNmb3JtKG1hdClcclxuICAgICAgICByZXR1cm4gbWVzaFxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyByZWN0RnJvbUNvb3JkcyhtaW5YOiBudW1iZXIsIG1pblk6IG51bWJlciwgbWluWjogbnVtYmVyLCBtYXhYOiBudW1iZXIsIG1heFk6IG51bWJlciwgbWF4WjogbnVtYmVyKTogSXhNZXNoIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZWN0KGdlby5BQUJCLmZyb21Db29yZHMobWluWCwgbWluWSwgbWluWiwgbWF4WCwgbWF4WSwgbWF4WikpXHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHF1YWRJbmRpY2VzKHF1YWRzOiBudW1iZXIpOiBudW1iZXJbXSB7XHJcbiAgICByZXR1cm4gYXJyYXkuZ2VuZXJhdGUocXVhZHMsIGkgPT4gW2kgKiA0LCBpICogNCArIDEsIGkgKiA0ICsgMiwgaSAqIDQsIGkgKiA0ICsgMiwgaSAqIDQgKyAzXSkuZmxhdCgpXHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgTWVzaERhdGEge1xyXG4gICAgdmVydGljZXM6IFZlcnRleFtdXHJcbiAgICBpbmRpY2VzOiBudW1iZXJbXVxyXG4gICAgaW5kZXhPZmZzZXQ6IG51bWJlclxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEJhdGNoT3B0aW9ucyB7XHJcbiAgICB3b3JsZE1hdHJpeD86IGdlby5NYXQ0XHJcbiAgICBkaWZmdXNlQ29sb3I/OiBnZW8uVmVjNFxyXG4gICAgcm91Z2huZXNzPzogbnVtYmVyXHJcbiAgICB2YW8/OiBXZWJHTFZlcnRleEFycmF5T2JqZWN0XHJcbiAgICBvZmZzZXQ/OiBudW1iZXJcclxuICAgIG51bUluZGljZXM/OiBudW1iZXJcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEJhdGNoIHtcclxuICAgIHB1YmxpYyB3b3JsZE1hdHJpeDogZ2VvLk1hdDRcclxuICAgIHB1YmxpYyBkaWZmdXNlQ29sb3I6IGdlby5WZWM0ID0gbmV3IGdlby5WZWM0KDEsIDEsIDEsIDEpXHJcbiAgICBwdWJsaWMgcm91Z2huZXNzOiBudW1iZXIgPSAwXHJcbiAgICBwdWJsaWMgdmFvOiBXZWJHTFZlcnRleEFycmF5T2JqZWN0IHwgbnVsbFxyXG4gICAgcHVibGljIG9mZnNldDogbnVtYmVyXHJcbiAgICBwdWJsaWMgbnVtSW5kaWNlczogbnVtYmVyXHJcblxyXG4gICAgY29uc3RydWN0b3Iob3B0aW9uczogQmF0Y2hPcHRpb25zID0ge30pIHtcclxuICAgICAgICB0aGlzLndvcmxkTWF0cml4ID0gb3B0aW9ucy53b3JsZE1hdHJpeCA/PyBnZW8uTWF0NC5pZGVudGl0eSgpXHJcbiAgICAgICAgdGhpcy5kaWZmdXNlQ29sb3IgPSBvcHRpb25zLmRpZmZ1c2VDb2xvciA/PyBuZXcgZ2VvLlZlYzQoMSwgMSwgMSwgMSlcclxuICAgICAgICB0aGlzLnJvdWdobmVzcyA9IG9wdGlvbnMucm91Z2huZXNzID8/IDBcclxuICAgICAgICB0aGlzLnZhbyA9IG9wdGlvbnMudmFvID8/IG51bGxcclxuICAgICAgICB0aGlzLm9mZnNldCA9IG9wdGlvbnMub2Zmc2V0ID8/IDBcclxuICAgICAgICB0aGlzLm51bUluZGljZXMgPSBvcHRpb25zLm51bUluZGljZXMgPz8gMFxyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBlbGVtc1BlclZlcnRleCA9IDEwXHJcbmNvbnN0IHZlcnRleFN0cmlkZSA9IGVsZW1zUGVyVmVydGV4ICogNFxyXG5cclxuZXhwb3J0IGNsYXNzIFJlbmRlcmVyIHtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgZ2w6IFdlYkdMMlJlbmRlcmluZ0NvbnRleHRcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgcHJvZ3JhbTogV2ViR0xQcm9ncmFtXHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgZm92ID0gTWF0aC5QSSAvIDJcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgd29ybGRNYXRyaXhMb2M6IFdlYkdMVW5pZm9ybUxvY2F0aW9uXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IHZpZXdNYXRyaXhMb2M6IFdlYkdMVW5pZm9ybUxvY2F0aW9uXHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgcHJvamVjdGlvbk1hdHJpeExvYzogV2ViR0xVbmlmb3JtTG9jYXRpb25cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgZGlmZnVzZUNvbG9yTG9jOiBXZWJHTFVuaWZvcm1Mb2NhdGlvblxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBleWVQb3NpdGlvbkxvYzogV2ViR0xVbmlmb3JtTG9jYXRpb25cclxuICAgIHByaXZhdGUgcmVhZG9ubHkgcm91Z2huZXNzTG9jOiBXZWJHTFVuaWZvcm1Mb2NhdGlvblxyXG4gICAgcHVibGljIHByb2plY3Rpb25NYXRyaXg6IGdlby5NYXQ0ID0gZ2VvLk1hdDQuaWRlbnRpdHkoKVxyXG4gICAgcHVibGljIHZpZXdNYXRyaXg6IGdlby5NYXQ0ID0gZ2VvLk1hdDQuaWRlbnRpdHkoKVxyXG4gICAgcHJpdmF0ZSBiYXRjaGVzOiBCYXRjaFtdID0gW11cclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmdsID0gZ2x1LmNyZWF0ZUNvbnRleHQodGhpcy5jYW52YXMpXHJcbiAgICAgICAgY29uc3QgZ2wgPSB0aGlzLmdsXHJcbiAgICAgICAgdGhpcy5wcm9ncmFtID0gZ2x1LmNvbXBpbGVQcm9ncmFtKGdsLCB2ZXJ0ZXhTcmMsIGZyYWdtZW50U3JjKVxyXG4gICAgICAgIHRoaXMud29ybGRNYXRyaXhMb2MgPSBnbHUuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsLCB0aGlzLnByb2dyYW0sIFwid29ybGRfbWF0cml4XCIpXHJcbiAgICAgICAgdGhpcy52aWV3TWF0cml4TG9jID0gZ2x1LmdldFVuaWZvcm1Mb2NhdGlvbihnbCwgdGhpcy5wcm9ncmFtLCBcInZpZXdfbWF0cml4XCIpXHJcbiAgICAgICAgdGhpcy5wcm9qZWN0aW9uTWF0cml4TG9jID0gZ2x1LmdldFVuaWZvcm1Mb2NhdGlvbihnbCwgdGhpcy5wcm9ncmFtLCBcInByb2plY3Rpb25fbWF0cml4XCIpXHJcbiAgICAgICAgdGhpcy5wcm9qZWN0aW9uTWF0cml4TG9jID0gZ2x1LmdldFVuaWZvcm1Mb2NhdGlvbihnbCwgdGhpcy5wcm9ncmFtLCBcInByb2plY3Rpb25fbWF0cml4XCIpXHJcbiAgICAgICAgdGhpcy5kaWZmdXNlQ29sb3JMb2MgPSBnbHUuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsLCB0aGlzLnByb2dyYW0sIFwiZGlmZnVzZV9jb2xvclwiKVxyXG4gICAgICAgIHRoaXMuZXllUG9zaXRpb25Mb2MgPSBnbHUuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsLCB0aGlzLnByb2dyYW0sIFwiZXllX3Bvc2l0aW9uXCIpXHJcbiAgICAgICAgdGhpcy5yb3VnaG5lc3NMb2MgPSBnbHUuZ2V0VW5pZm9ybUxvY2F0aW9uKGdsLCB0aGlzLnByb2dyYW0sIFwicm91Z2huZXNzXCIpXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCBhc3BlY3QoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nbC5kcmF3aW5nQnVmZmVyV2lkdGggLyB0aGlzLmdsLmRyYXdpbmdCdWZmZXJIZWlnaHRcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcHJlc2VudCgpIHtcclxuICAgICAgICBjb25zdCBnbCA9IHRoaXMuZ2xcclxuXHJcbiAgICAgICAgdGhpcy5wcm9qZWN0aW9uTWF0cml4ID0gZ2VvLk1hdDQucGVyc3BlY3RpdmUodGhpcy5mb3YsIHRoaXMuYXNwZWN0LCAxLCA1MTIpXHJcblxyXG4gICAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgbnVsbClcclxuICAgICAgICBnbC52aWV3cG9ydCgwLCAwLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGgsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQpXHJcbiAgICAgICAgZ2wuY2xlYXJDb2xvcigwLCAwLCAwLCAxKVxyXG4gICAgICAgIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQgfCBnbC5ERVBUSF9CVUZGRVJfQklUKVxyXG4gICAgICAgIGdsLmVuYWJsZShnbC5ERVBUSF9URVNUKVxyXG4gICAgICAgIHRoaXMucmVuZGVyQmF0Y2hlcygpXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNyZWF0ZU1lc2gobWVzaDogSXhNZXNoKTogV2ViR0xWZXJ0ZXhBcnJheU9iamVjdCB7XHJcbiAgICAgICAgLy8gZm9yIG5vdyAtIHBsYWNlIHNpbmdsZSB0cmlhbmdsZSBpbnRvIHZlcnRleCBidWZmZXJcclxuICAgICAgICBjb25zdCBnbCA9IHRoaXMuZ2xcclxuICAgICAgICBjb25zdCB2Ym8gPSBnbHUuY3JlYXRlQnVmZmVyKGdsKVxyXG4gICAgICAgIGNvbnN0IGlibyA9IGdsdS5jcmVhdGVCdWZmZXIoZ2wpXHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHZibylcclxuICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgdG9GbG9hdEFycmF5KG1lc2gudmVydGljZXMpLCBnbC5TVEFUSUNfRFJBVylcclxuICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBpYm8pXHJcbiAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgbmV3IFVpbnQzMkFycmF5KG1lc2guaW5kaWNlcyksIGdsLlNUQVRJQ19EUkFXKVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVZhbyh2Ym8sIGlibylcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZHJhd0JhdGNoKGJhdGNoOiBCYXRjaCkge1xyXG4gICAgICAgIHRoaXMuYmF0Y2hlcy5wdXNoKGJhdGNoKVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY3JlYXRlVmFvKHZibzogV2ViR0xCdWZmZXIsIGlibzogV2ViR0xCdWZmZXIpOiBXZWJHTFZlcnRleEFycmF5T2JqZWN0IHtcclxuICAgICAgICBjb25zdCB7IGdsLCBwcm9ncmFtIH0gPSB0aGlzXHJcbiAgICAgICAgY29uc3QgdmFvID0gZ2x1LmNyZWF0ZVZlcnRleEFycmF5KGdsKVxyXG4gICAgICAgIGdsLmJpbmRWZXJ0ZXhBcnJheSh2YW8pXHJcblxyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uQXR0cmliSWR4ID0gZ2x1LmdldEF0dHJpYkxvY2F0aW9uKGdsLCBwcm9ncmFtLCBcInZlcnRfcG9zaXRpb25cIilcclxuICAgICAgICBjb25zdCBub3JtYWxBdHRyaWJJZHggPSBnbHUuZ2V0QXR0cmliTG9jYXRpb24oZ2wsIHByb2dyYW0sIFwidmVydF9ub3JtYWxcIilcclxuICAgICAgICBjb25zdCBjb2xvckF0dHJpYklkeCA9IGdsdS5nZXRBdHRyaWJMb2NhdGlvbihnbCwgcHJvZ3JhbSwgXCJ2ZXJ0X2NvbG9yXCIpXHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHZibylcclxuICAgICAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShwb3NpdGlvbkF0dHJpYklkeClcclxuICAgICAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShub3JtYWxBdHRyaWJJZHgpXHJcbiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoY29sb3JBdHRyaWJJZHgpXHJcbiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihwb3NpdGlvbkF0dHJpYklkeCwgMywgZ2wuRkxPQVQsIGZhbHNlLCB2ZXJ0ZXhTdHJpZGUsIDApXHJcbiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihub3JtYWxBdHRyaWJJZHgsIDMsIGdsLkZMT0FULCBmYWxzZSwgdmVydGV4U3RyaWRlLCAxMilcclxuICAgICAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKGNvbG9yQXR0cmliSWR4LCA0LCBnbC5GTE9BVCwgZmFsc2UsIHZlcnRleFN0cmlkZSwgMjQpXHJcbiAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgaWJvKVxyXG5cclxuICAgICAgICBnbC5iaW5kVmVydGV4QXJyYXkobnVsbClcclxuICAgICAgICByZXR1cm4gdmFvXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZW5kZXJCYXRjaGVzKCkge1xyXG4gICAgICAgIGNvbnN0IGdsID0gdGhpcy5nbFxyXG4gICAgICAgIGdsLnVzZVByb2dyYW0odGhpcy5wcm9ncmFtKVxyXG4gICAgICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYodGhpcy5wcm9qZWN0aW9uTWF0cml4TG9jLCBmYWxzZSwgdGhpcy5wcm9qZWN0aW9uTWF0cml4LnRvQXJyYXkoKSlcclxuICAgICAgICBnbC51bmlmb3JtTWF0cml4NGZ2KHRoaXMudmlld01hdHJpeExvYywgZmFsc2UsIHRoaXMudmlld01hdHJpeC50b0FycmF5KCkpXHJcblxyXG4gICAgICAgIC8vIGRldGVybWluZSBleWUgcG9zaXRpb24gYW5kIHNldCB1bmlmb3JtXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjb25zdCBpbnZWaWV3TWF0cml4ID0gdGhpcy52aWV3TWF0cml4LmludmVydCgpXHJcbiAgICAgICAgICAgIGNvbnN0IGV5ZVBvc2l0aW9uID0gaW52Vmlld01hdHJpeC50cmFuc2Zvcm0zKG5ldyBnZW8uVmVjMygwLCAwLCAwKSlcclxuICAgICAgICAgICAgZ2wudW5pZm9ybTNmdih0aGlzLmV5ZVBvc2l0aW9uTG9jLCBleWVQb3NpdGlvbi50b0FycmF5KCkpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGNvbnN0IGJhdGNoIG9mIHRoaXMuYmF0Y2hlcykge1xyXG4gICAgICAgICAgICBpZiAoIWJhdGNoLnZhbykge1xyXG4gICAgICAgICAgICAgICAgY29udGludWVcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGJhdGNoLm51bUluZGljZXMgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgY29udGludWVcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZ2wudW5pZm9ybU1hdHJpeDRmdih0aGlzLndvcmxkTWF0cml4TG9jLCBmYWxzZSwgYmF0Y2gud29ybGRNYXRyaXgudG9BcnJheSgpKVxyXG4gICAgICAgICAgICBnbC51bmlmb3JtNGZ2KHRoaXMuZGlmZnVzZUNvbG9yTG9jLCBiYXRjaC5kaWZmdXNlQ29sb3IudG9BcnJheSgpKVxyXG4gICAgICAgICAgICBnbC51bmlmb3JtMWYodGhpcy5yb3VnaG5lc3NMb2MsIGJhdGNoLnJvdWdobmVzcylcclxuICAgICAgICAgICAgZ2wuYmluZFZlcnRleEFycmF5KGJhdGNoLnZhbylcclxuICAgICAgICAgICAgZ2wuZHJhd0VsZW1lbnRzKGdsLlRSSUFOR0xFUywgYmF0Y2gubnVtSW5kaWNlcywgZ2wuVU5TSUdORURfSU5ULCBiYXRjaC5vZmZzZXQpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmJhdGNoZXMgPSBbXVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiB0b0Zsb2F0QXJyYXkodmVydGljZXM6IFZlcnRleFtdKTogRmxvYXQzMkFycmF5IHtcclxuICAgIGNvbnN0IGEgPSBuZXcgRmxvYXQzMkFycmF5KHZlcnRpY2VzLmZsYXRNYXAodiA9PiBbXHJcbiAgICAgICAgdi5wb3NpdGlvbi54LCB2LnBvc2l0aW9uLnksIHYucG9zaXRpb24ueixcclxuICAgICAgICB2Lm5vcm1hbC54LCB2Lm5vcm1hbC55LCB2Lm5vcm1hbC56LFxyXG4gICAgICAgIHYuY29sb3IueCwgdi5jb2xvci55LCB2LmNvbG9yLnosIHYuY29sb3Iud10pKVxyXG5cclxuICAgIHJldHVybiBhXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0cmFuc2Zvcm0obWF0OiBnZW8uTWF0NCwgdmVydGljZXM6IFZlcnRleFtdKSB7XHJcbiAgICBjb25zdCBiYXNpcyA9IG1hdC50b01hdDMoKVxyXG4gICAgZm9yIChjb25zdCB2IG9mIHZlcnRpY2VzKSB7XHJcbiAgICAgICAgdi5wb3NpdGlvbiA9IG1hdC50cmFuc2Zvcm0zKHYucG9zaXRpb24pXHJcbiAgICAgICAgdi5ub3JtYWwgPSBiYXNpcy50cmFuc2Zvcm0odi5ub3JtYWwpXHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjYWxjQUFCQih2ZXJ0aWNlczogSXRlcmFibGU8VmVydGV4Pik6IGdlby5BQUJCIHtcclxuICAgIGNvbnN0IGFhYmIgPSBnZW8uQUFCQi5mcm9tUG9pbnRzKGl0ZXIubWFwKHZlcnRpY2VzLCB2ID0+IHYucG9zaXRpb24pKVxyXG4gICAgcmV0dXJuIGFhYmJcclxufSJdfQ==