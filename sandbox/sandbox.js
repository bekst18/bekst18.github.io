import * as util from "../shared/util.js";
const canvas = util.byId("canvas");
const ctx = canvas.getContext("2d");
if (!ctx) {
    throw new Error("Canvas element not supported");
}
init();
async function init() {
    const image = await util.loadImage("olts.jpg");
    canvas.width = image.width;
    canvas.height = image.height;
    ctx.drawImage(image, 0, 0);
    const originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    {
        const imageData = copyImageData(originalImageData);
        util.bench(brightenImageData.name, () => brightenImageData(imageData));
    }
    {
        const imageData = copyImageData(originalImageData);
        util.bench(brightenLoop.name, () => brightenLoop(imageData));
    }
    {
        const imageData = copyImageData(originalImageData);
        util.bench(brightenScan.name, () => brightenScan(imageData));
    }
    {
        const imageData = copyImageData(originalImageData);
        const nested = nest(imageData);
        util.bench(brightenNested.name, () => brightenNested(nested));
        const newImageData = unnest(nested);
        ctx.putImageData(newImageData, 0, 0);
    }
    {
        const a = util.sequence(originalImageData.data.length / 4);
        util.bench("access array of numbers", () => {
            for (let i = 0; i < a.length; ++i) {
                a[1] += 9;
            }
        });
    }
}
function copyImageData(imageData) {
    return new ImageData(new Uint8ClampedArray(imageData.data), imageData.width, imageData.height);
}
function brightenImageData(imageData) {
    const data = imageData.data;
    for (let i = 0; i < data.length; i += 4) {
        data[i] += 64;
        data[i + 1] += 64;
        data[i + 2] += 64;
    }
}
function brightenLoop(imageData) {
    const { height, width, data } = imageData;
    const pixelPitch = 4;
    const rowPitch = width * pixelPitch;
    for (let y = 0; y < height; ++y) {
        const yOffset = y * rowPitch;
        for (let x = 0; x < width; ++x) {
            const xOffset = yOffset + x * pixelPitch;
            data[xOffset] += 64;
            data[xOffset + 1] += 64;
            data[xOffset + 2] += 64;
        }
    }
}
function brightenScan(imageData) {
    const data = imageData.data;
    scan(imageData, (_1, _2, offset) => {
        data[offset] += 64;
        data[offset + 1] += 64;
        data[offset + 2] += 64;
    });
}
function scan(imageData, f) {
    const { height, width } = imageData;
    const pixelPitch = 4;
    const rowPitch = width * pixelPitch;
    for (let y = 0; y < height; ++y) {
        const yOffset = y * rowPitch;
        for (let x = 0; x < width; ++x) {
            const xOffset = yOffset + x * pixelPitch;
            f(x, y, xOffset);
        }
    }
}
function nest(imageData) {
    const { height, width, data } = imageData;
    const pixelPitch = 4;
    const rowPitch = width * pixelPitch;
    const rows = [];
    for (let y = 0; y < height; ++y) {
        const yOffset = y * rowPitch;
        const row = [];
        for (let x = 0; x < width; ++x) {
            const xOffset = yOffset + x * pixelPitch;
            const color = [data[xOffset], data[xOffset + 1], data[xOffset + 2]];
            row.push(color);
        }
        rows.push(row);
    }
    return rows;
}
function unnest(data) {
    const flat = [];
    for (const row of data) {
        for (const color of row) {
            flat.push(color[0], color[1], color[2], 255);
        }
    }
    const height = data.length;
    const width = data[0].length;
    const imageData = new ImageData(new Uint8ClampedArray(flat), width, height);
    return imageData;
}
function brightenNested(data) {
    for (const row of data) {
        for (const color of row) {
            color[0] += 64;
            color[1] += 64;
            color[2] += 64;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2FuZGJveC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNhbmRib3gudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLElBQUksTUFBTSxtQkFBbUIsQ0FBQTtBQUV6QyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBc0IsQ0FBQTtBQUN2RCxNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBNkIsQ0FBQTtBQUMvRCxJQUFJLENBQUMsR0FBRyxFQUFFO0lBQ04sTUFBTSxJQUFJLEtBQUssQ0FBQyw4QkFBOEIsQ0FBQyxDQUFBO0NBQ2xEO0FBRUQsSUFBSSxFQUFFLENBQUE7QUFFTixLQUFLLFVBQVUsSUFBSTtJQUNmLE1BQU0sS0FBSyxHQUFHLE1BQU0sSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQTtJQUM5QyxNQUFNLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUE7SUFDMUIsTUFBTSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFBO0lBQzVCLEdBQUcsQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUUxQixNQUFNLGlCQUFpQixHQUFHLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQTtJQUU3RTtRQUNJLE1BQU0sU0FBUyxHQUFHLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBO1FBQ2xELElBQUksQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUE7S0FDekU7SUFFRDtRQUNJLE1BQU0sU0FBUyxHQUFHLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBO1FBQ2xELElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQTtLQUMvRDtJQUVEO1FBQ0ksTUFBTSxTQUFTLEdBQUcsYUFBYSxDQUFDLGlCQUFpQixDQUFDLENBQUE7UUFDbEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFBO0tBQy9EO0lBRUQ7UUFDSSxNQUFNLFNBQVMsR0FBRyxhQUFhLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtRQUNsRCxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUE7UUFDOUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFBO1FBQzdELE1BQU0sWUFBWSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUNuQyxHQUFHLENBQUMsWUFBWSxDQUFDLFlBQVksRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7S0FDdkM7SUFFRDtRQUNJLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQTtRQUMxRCxJQUFJLENBQUMsS0FBSyxDQUFDLHlCQUF5QixFQUFFLEdBQUcsRUFBRTtZQUN2QyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRTtnQkFDL0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQTthQUNaO1FBQ0wsQ0FBQyxDQUFDLENBQUE7S0FDTDtBQUNMLENBQUM7QUFFRCxTQUFTLGFBQWEsQ0FBQyxTQUFvQjtJQUN2QyxPQUFPLElBQUksU0FBUyxDQUFDLElBQUksaUJBQWlCLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLFNBQVMsQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0FBQ2xHLENBQUM7QUFFRCxTQUFTLGlCQUFpQixDQUFDLFNBQW9CO0lBQzNDLE1BQU0sSUFBSSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUE7SUFDM0IsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUNyQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFBO1FBQ2IsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDakIsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7S0FDcEI7QUFDTCxDQUFDO0FBRUQsU0FBUyxZQUFZLENBQUMsU0FBb0I7SUFDdEMsTUFBTSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEdBQUcsU0FBUyxDQUFBO0lBQ3pDLE1BQU0sVUFBVSxHQUFHLENBQUMsQ0FBQTtJQUNwQixNQUFNLFFBQVEsR0FBRyxLQUFLLEdBQUcsVUFBVSxDQUFBO0lBRW5DLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLEVBQUUsRUFBRSxDQUFDLEVBQUU7UUFDN0IsTUFBTSxPQUFPLEdBQUcsQ0FBQyxHQUFHLFFBQVEsQ0FBQTtRQUM1QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxFQUFFLEVBQUUsQ0FBQyxFQUFFO1lBQzVCLE1BQU0sT0FBTyxHQUFHLE9BQU8sR0FBRyxDQUFDLEdBQUcsVUFBVSxDQUFBO1lBQ3hDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUE7WUFDbkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7WUFDdkIsSUFBSSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7U0FDMUI7S0FDSjtBQUNMLENBQUM7QUFFRCxTQUFTLFlBQVksQ0FBQyxTQUFvQjtJQUN0QyxNQUFNLElBQUksR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFBO0lBQzNCLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxFQUFFO1FBQy9CLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDbEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDdEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7SUFDMUIsQ0FBQyxDQUFDLENBQUE7QUFDTixDQUFDO0FBRUQsU0FBUyxJQUFJLENBQUMsU0FBb0IsRUFBRSxDQUFpRDtJQUNqRixNQUFNLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLFNBQVMsQ0FBQTtJQUNuQyxNQUFNLFVBQVUsR0FBRyxDQUFDLENBQUE7SUFDcEIsTUFBTSxRQUFRLEdBQUcsS0FBSyxHQUFHLFVBQVUsQ0FBQTtJQUVuQyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUFFO1FBQzdCLE1BQU0sT0FBTyxHQUFHLENBQUMsR0FBRyxRQUFRLENBQUE7UUFDNUIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssRUFBRSxFQUFFLENBQUMsRUFBRTtZQUM1QixNQUFNLE9BQU8sR0FBRyxPQUFPLEdBQUcsQ0FBQyxHQUFHLFVBQVUsQ0FBQTtZQUN4QyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQTtTQUNuQjtLQUNKO0FBQ0wsQ0FBQztBQUVELFNBQVMsSUFBSSxDQUFDLFNBQW9CO0lBQzlCLE1BQU0sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLFNBQVMsQ0FBQTtJQUN6QyxNQUFNLFVBQVUsR0FBRyxDQUFDLENBQUE7SUFDcEIsTUFBTSxRQUFRLEdBQUcsS0FBSyxHQUFHLFVBQVUsQ0FBQTtJQUNuQyxNQUFNLElBQUksR0FBaUIsRUFBRSxDQUFBO0lBRTdCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLEVBQUUsRUFBRSxDQUFDLEVBQUU7UUFDN0IsTUFBTSxPQUFPLEdBQUcsQ0FBQyxHQUFHLFFBQVEsQ0FBQTtRQUM1QixNQUFNLEdBQUcsR0FBZSxFQUFFLENBQUE7UUFDMUIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssRUFBRSxFQUFFLENBQUMsRUFBRTtZQUM1QixNQUFNLE9BQU8sR0FBRyxPQUFPLEdBQUcsQ0FBQyxHQUFHLFVBQVUsQ0FBQTtZQUN4QyxNQUFNLEtBQUssR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQTtZQUNuRSxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO1NBQ2xCO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtLQUNqQjtJQUVELE9BQU8sSUFBSSxDQUFBO0FBQ2YsQ0FBQztBQUVELFNBQVMsTUFBTSxDQUFDLElBQWtCO0lBQzlCLE1BQU0sSUFBSSxHQUFhLEVBQUUsQ0FBQTtJQUN6QixLQUFLLE1BQU0sR0FBRyxJQUFJLElBQUksRUFBRTtRQUNwQixLQUFLLE1BQU0sS0FBSyxJQUFJLEdBQUcsRUFBRTtZQUNyQixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFBO1NBQy9DO0tBQ0o7SUFFRCxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFBO0lBQzFCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUE7SUFDNUIsTUFBTSxTQUFTLEdBQUcsSUFBSSxTQUFTLENBQUMsSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFDM0UsT0FBTyxTQUFTLENBQUE7QUFDcEIsQ0FBQztBQUVELFNBQVMsY0FBYyxDQUFDLElBQWtCO0lBQ3RDLEtBQUssTUFBTSxHQUFHLElBQUksSUFBSSxFQUFFO1FBQ3BCLEtBQUssTUFBTSxLQUFLLElBQUksR0FBRyxFQUFFO1lBQ3JCLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7WUFDZCxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFBO1lBQ2QsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtTQUNqQjtLQUNKO0FBQ0wsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHV0aWwgZnJvbSBcIi4uL3NoYXJlZC91dGlsLmpzXCJcclxuXHJcbmNvbnN0IGNhbnZhcyA9IHV0aWwuYnlJZChcImNhbnZhc1wiKSBhcyBIVE1MQ2FudmFzRWxlbWVudFxyXG5jb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpIGFzIENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRFxyXG5pZiAoIWN0eCkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FudmFzIGVsZW1lbnQgbm90IHN1cHBvcnRlZFwiKVxyXG59XHJcblxyXG5pbml0KClcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICBjb25zdCBpbWFnZSA9IGF3YWl0IHV0aWwubG9hZEltYWdlKFwib2x0cy5qcGdcIilcclxuICAgIGNhbnZhcy53aWR0aCA9IGltYWdlLndpZHRoXHJcbiAgICBjYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0XHJcbiAgICBjdHguZHJhd0ltYWdlKGltYWdlLCAwLCAwKVxyXG5cclxuICAgIGNvbnN0IG9yaWdpbmFsSW1hZ2VEYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpXHJcblxyXG4gICAge1xyXG4gICAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvcHlJbWFnZURhdGEob3JpZ2luYWxJbWFnZURhdGEpXHJcbiAgICAgICAgdXRpbC5iZW5jaChicmlnaHRlbkltYWdlRGF0YS5uYW1lLCAoKSA9PiBicmlnaHRlbkltYWdlRGF0YShpbWFnZURhdGEpKVxyXG4gICAgfVxyXG5cclxuICAgIHtcclxuICAgICAgICBjb25zdCBpbWFnZURhdGEgPSBjb3B5SW1hZ2VEYXRhKG9yaWdpbmFsSW1hZ2VEYXRhKVxyXG4gICAgICAgIHV0aWwuYmVuY2goYnJpZ2h0ZW5Mb29wLm5hbWUsICgpID0+IGJyaWdodGVuTG9vcChpbWFnZURhdGEpKVxyXG4gICAgfVxyXG5cclxuICAgIHtcclxuICAgICAgICBjb25zdCBpbWFnZURhdGEgPSBjb3B5SW1hZ2VEYXRhKG9yaWdpbmFsSW1hZ2VEYXRhKVxyXG4gICAgICAgIHV0aWwuYmVuY2goYnJpZ2h0ZW5TY2FuLm5hbWUsICgpID0+IGJyaWdodGVuU2NhbihpbWFnZURhdGEpKVxyXG4gICAgfVxyXG5cclxuICAgIHtcclxuICAgICAgICBjb25zdCBpbWFnZURhdGEgPSBjb3B5SW1hZ2VEYXRhKG9yaWdpbmFsSW1hZ2VEYXRhKVxyXG4gICAgICAgIGNvbnN0IG5lc3RlZCA9IG5lc3QoaW1hZ2VEYXRhKVxyXG4gICAgICAgIHV0aWwuYmVuY2goYnJpZ2h0ZW5OZXN0ZWQubmFtZSwgKCkgPT4gYnJpZ2h0ZW5OZXN0ZWQobmVzdGVkKSlcclxuICAgICAgICBjb25zdCBuZXdJbWFnZURhdGEgPSB1bm5lc3QobmVzdGVkKVxyXG4gICAgICAgIGN0eC5wdXRJbWFnZURhdGEobmV3SW1hZ2VEYXRhLCAwLCAwKVxyXG4gICAgfVxyXG5cclxuICAgIHtcclxuICAgICAgICBjb25zdCBhID0gdXRpbC5zZXF1ZW5jZShvcmlnaW5hbEltYWdlRGF0YS5kYXRhLmxlbmd0aCAvIDQpXHJcbiAgICAgICAgdXRpbC5iZW5jaChcImFjY2VzcyBhcnJheSBvZiBudW1iZXJzXCIsICgpID0+IHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBhWzFdICs9IDlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNvcHlJbWFnZURhdGEoaW1hZ2VEYXRhOiBJbWFnZURhdGEpOiBJbWFnZURhdGEge1xyXG4gICAgcmV0dXJuIG5ldyBJbWFnZURhdGEobmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGltYWdlRGF0YS5kYXRhKSwgaW1hZ2VEYXRhLndpZHRoLCBpbWFnZURhdGEuaGVpZ2h0KVxyXG59XHJcblxyXG5mdW5jdGlvbiBicmlnaHRlbkltYWdlRGF0YShpbWFnZURhdGE6IEltYWdlRGF0YSkge1xyXG4gICAgY29uc3QgZGF0YSA9IGltYWdlRGF0YS5kYXRhXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpICs9IDQpIHtcclxuICAgICAgICBkYXRhW2ldICs9IDY0XHJcbiAgICAgICAgZGF0YVtpICsgMV0gKz0gNjRcclxuICAgICAgICBkYXRhW2kgKyAyXSArPSA2NFxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBicmlnaHRlbkxvb3AoaW1hZ2VEYXRhOiBJbWFnZURhdGEpIHtcclxuICAgIGNvbnN0IHsgaGVpZ2h0LCB3aWR0aCwgZGF0YSB9ID0gaW1hZ2VEYXRhXHJcbiAgICBjb25zdCBwaXhlbFBpdGNoID0gNFxyXG4gICAgY29uc3Qgcm93UGl0Y2ggPSB3aWR0aCAqIHBpeGVsUGl0Y2hcclxuXHJcbiAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgKyt5KSB7XHJcbiAgICAgICAgY29uc3QgeU9mZnNldCA9IHkgKiByb3dQaXRjaFxyXG4gICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgd2lkdGg7ICsreCkge1xyXG4gICAgICAgICAgICBjb25zdCB4T2Zmc2V0ID0geU9mZnNldCArIHggKiBwaXhlbFBpdGNoXHJcbiAgICAgICAgICAgIGRhdGFbeE9mZnNldF0gKz0gNjRcclxuICAgICAgICAgICAgZGF0YVt4T2Zmc2V0ICsgMV0gKz0gNjRcclxuICAgICAgICAgICAgZGF0YVt4T2Zmc2V0ICsgMl0gKz0gNjRcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGJyaWdodGVuU2NhbihpbWFnZURhdGE6IEltYWdlRGF0YSkge1xyXG4gICAgY29uc3QgZGF0YSA9IGltYWdlRGF0YS5kYXRhXHJcbiAgICBzY2FuKGltYWdlRGF0YSwgKF8xLCBfMiwgb2Zmc2V0KSA9PiB7XHJcbiAgICAgICAgZGF0YVtvZmZzZXRdICs9IDY0XHJcbiAgICAgICAgZGF0YVtvZmZzZXQgKyAxXSArPSA2NFxyXG4gICAgICAgIGRhdGFbb2Zmc2V0ICsgMl0gKz0gNjRcclxuICAgIH0pXHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNjYW4oaW1hZ2VEYXRhOiBJbWFnZURhdGEsIGY6ICh4OiBudW1iZXIsIHk6IG51bWJlciwgb2Zmc2V0OiBudW1iZXIpID0+IHZvaWQpIHtcclxuICAgIGNvbnN0IHsgaGVpZ2h0LCB3aWR0aCB9ID0gaW1hZ2VEYXRhXHJcbiAgICBjb25zdCBwaXhlbFBpdGNoID0gNFxyXG4gICAgY29uc3Qgcm93UGl0Y2ggPSB3aWR0aCAqIHBpeGVsUGl0Y2hcclxuXHJcbiAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgKyt5KSB7XHJcbiAgICAgICAgY29uc3QgeU9mZnNldCA9IHkgKiByb3dQaXRjaFxyXG4gICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgd2lkdGg7ICsreCkge1xyXG4gICAgICAgICAgICBjb25zdCB4T2Zmc2V0ID0geU9mZnNldCArIHggKiBwaXhlbFBpdGNoXHJcbiAgICAgICAgICAgIGYoeCwgeSwgeE9mZnNldClcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG5lc3QoaW1hZ2VEYXRhOiBJbWFnZURhdGEpOiBudW1iZXJbXVtdW10ge1xyXG4gICAgY29uc3QgeyBoZWlnaHQsIHdpZHRoLCBkYXRhIH0gPSBpbWFnZURhdGFcclxuICAgIGNvbnN0IHBpeGVsUGl0Y2ggPSA0XHJcbiAgICBjb25zdCByb3dQaXRjaCA9IHdpZHRoICogcGl4ZWxQaXRjaFxyXG4gICAgY29uc3Qgcm93czogbnVtYmVyW11bXVtdID0gW11cclxuXHJcbiAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgKyt5KSB7XHJcbiAgICAgICAgY29uc3QgeU9mZnNldCA9IHkgKiByb3dQaXRjaFxyXG4gICAgICAgIGNvbnN0IHJvdzogbnVtYmVyW11bXSA9IFtdXHJcbiAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB3aWR0aDsgKyt4KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHhPZmZzZXQgPSB5T2Zmc2V0ICsgeCAqIHBpeGVsUGl0Y2hcclxuICAgICAgICAgICAgY29uc3QgY29sb3IgPSBbZGF0YVt4T2Zmc2V0XSwgZGF0YVt4T2Zmc2V0ICsgMV0sIGRhdGFbeE9mZnNldCArIDJdXVxyXG4gICAgICAgICAgICByb3cucHVzaChjb2xvcilcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJvd3MucHVzaChyb3cpXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJvd3NcclxufVxyXG5cclxuZnVuY3Rpb24gdW5uZXN0KGRhdGE6IG51bWJlcltdW11bXSk6IEltYWdlRGF0YSB7XHJcbiAgICBjb25zdCBmbGF0OiBudW1iZXJbXSA9IFtdXHJcbiAgICBmb3IgKGNvbnN0IHJvdyBvZiBkYXRhKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCBjb2xvciBvZiByb3cpIHtcclxuICAgICAgICAgICAgZmxhdC5wdXNoKGNvbG9yWzBdLCBjb2xvclsxXSwgY29sb3JbMl0sIDI1NSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgaGVpZ2h0ID0gZGF0YS5sZW5ndGhcclxuICAgIGNvbnN0IHdpZHRoID0gZGF0YVswXS5sZW5ndGhcclxuICAgIGNvbnN0IGltYWdlRGF0YSA9IG5ldyBJbWFnZURhdGEobmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGZsYXQpLCB3aWR0aCwgaGVpZ2h0KVxyXG4gICAgcmV0dXJuIGltYWdlRGF0YVxyXG59XHJcblxyXG5mdW5jdGlvbiBicmlnaHRlbk5lc3RlZChkYXRhOiBudW1iZXJbXVtdW10pIHtcclxuICAgIGZvciAoY29uc3Qgcm93IG9mIGRhdGEpIHtcclxuICAgICAgICBmb3IgKGNvbnN0IGNvbG9yIG9mIHJvdykge1xyXG4gICAgICAgICAgICBjb2xvclswXSArPSA2NFxyXG4gICAgICAgICAgICBjb2xvclsxXSArPSA2NFxyXG4gICAgICAgICAgICBjb2xvclsyXSArPSA2NFxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSJdfQ==