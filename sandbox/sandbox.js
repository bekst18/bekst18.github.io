import * as util from "../shared/util.js";
const canvas = util.byId("canvas");
const ctx = canvas.getContext("2d");
if (!ctx) {
    throw new Error("Canvas element not supported");
}
const gl = canvas.getContext("webgl2-compute");
if (!gl) {
    throw new Error("GL compute not supported");
}
init();
async function init() {
    const image = await util.loadImage("olts.jpg");
    canvas.width = image.width;
    canvas.height = image.height;
    ctx.drawImage(image, 0, 0);
    const originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    {
        const imageData = copyImageData(originalImageData);
        util.bench(brightenImageData.name, () => brightenImageData(imageData));
    }
    {
        const imageData = copyImageData(originalImageData);
        util.bench(brightenLoop.name, () => brightenLoop(imageData));
    }
    {
        const imageData = copyImageData(originalImageData);
        util.bench(brightenScan.name, () => brightenScan(imageData));
    }
    {
        const imageData = copyImageData(originalImageData);
        const nested = nest(imageData);
        util.bench(brightenNested.name, () => brightenNested(nested));
        const newImageData = unnest(nested);
        ctx.putImageData(newImageData, 0, 0);
    }
    {
        const a = util.sequence(originalImageData.data.length / 4);
        util.bench("access array of numbers", () => {
            for (let i = 0; i < a.length; ++i) {
                a[1] += 9;
            }
        });
    }
}
function copyImageData(imageData) {
    return new ImageData(new Uint8ClampedArray(imageData.data), imageData.width, imageData.height);
}
function brightenImageData(imageData) {
    const data = imageData.data;
    for (let i = 0; i < data.length; i += 4) {
        data[i] += 64;
        data[i + 1] += 64;
        data[i + 2] += 64;
    }
}
function brightenLoop(imageData) {
    const { height, width, data } = imageData;
    const pixelPitch = 4;
    const rowPitch = width * pixelPitch;
    for (let y = 0; y < height; ++y) {
        const yOffset = y * rowPitch;
        for (let x = 0; x < width; ++x) {
            const xOffset = yOffset + x * pixelPitch;
            data[xOffset] += 64;
            data[xOffset + 1] += 64;
            data[xOffset + 2] += 64;
        }
    }
}
function brightenScan(imageData) {
    const data = imageData.data;
    scan(imageData, (_1, _2, offset) => {
        data[offset] += 64;
        data[offset + 1] += 64;
        data[offset + 2] += 64;
    });
}
function scan(imageData, f) {
    const { height, width } = imageData;
    const pixelPitch = 4;
    const rowPitch = width * pixelPitch;
    for (let y = 0; y < height; ++y) {
        const yOffset = y * rowPitch;
        for (let x = 0; x < width; ++x) {
            const xOffset = yOffset + x * pixelPitch;
            f(x, y, xOffset);
        }
    }
}
function nest(imageData) {
    const { height, width, data } = imageData;
    const pixelPitch = 4;
    const rowPitch = width * pixelPitch;
    const rows = [];
    for (let y = 0; y < height; ++y) {
        const yOffset = y * rowPitch;
        const row = [];
        for (let x = 0; x < width; ++x) {
            const xOffset = yOffset + x * pixelPitch;
            const color = [data[xOffset], data[xOffset + 1], data[xOffset + 2]];
            row.push(color);
        }
        rows.push(row);
    }
    return rows;
}
function unnest(data) {
    const flat = [];
    for (const row of data) {
        for (const color of row) {
            flat.push(color[0], color[1], color[2], 255);
        }
    }
    const height = data.length;
    const width = data[0].length;
    const imageData = new ImageData(new Uint8ClampedArray(flat), width, height);
    return imageData;
}
function brightenNested(data) {
    for (const row of data) {
        for (const color of row) {
            color[0] += 64;
            color[1] += 64;
            color[2] += 64;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2FuZGJveC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNhbmRib3gudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLElBQUksTUFBTSxtQkFBbUIsQ0FBQTtBQUV6QyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBc0IsQ0FBQTtBQUN2RCxNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBNkIsQ0FBQTtBQUMvRCxJQUFJLENBQUMsR0FBRyxFQUFFO0lBQ04sTUFBTSxJQUFJLEtBQUssQ0FBQyw4QkFBOEIsQ0FBQyxDQUFBO0NBQ2xEO0FBRUQsTUFBTSxFQUFFLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO0FBQzlDLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDTCxNQUFNLElBQUksS0FBSyxDQUFDLDBCQUEwQixDQUFDLENBQUE7Q0FDOUM7QUFFRCxJQUFJLEVBQUUsQ0FBQTtBQUVOLEtBQUssVUFBVSxJQUFJO0lBQ2YsTUFBTSxLQUFLLEdBQUcsTUFBTSxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFBO0lBQzlDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQTtJQUMxQixNQUFNLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUE7SUFDNUIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO0lBRTFCLE1BQU0saUJBQWlCLEdBQUcsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBRTdFO1FBQ0ksTUFBTSxTQUFTLEdBQUcsYUFBYSxDQUFDLGlCQUFpQixDQUFDLENBQUE7UUFDbEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQTtLQUN6RTtJQUVEO1FBQ0ksTUFBTSxTQUFTLEdBQUcsYUFBYSxDQUFDLGlCQUFpQixDQUFDLENBQUE7UUFDbEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFBO0tBQy9EO0lBRUQ7UUFDSSxNQUFNLFNBQVMsR0FBRyxhQUFhLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtRQUNsRCxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUE7S0FDL0Q7SUFFRDtRQUNJLE1BQU0sU0FBUyxHQUFHLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBO1FBQ2xELE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQTtRQUM5QixJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUE7UUFDN0QsTUFBTSxZQUFZLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQ25DLEdBQUcsQ0FBQyxZQUFZLENBQUMsWUFBWSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtLQUN2QztJQUVEO1FBQ0ksTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFBO1FBQzFELElBQUksQ0FBQyxLQUFLLENBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO1lBQ3ZDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUFFO2dCQUMvQixDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFBO2FBQ1o7UUFDTCxDQUFDLENBQUMsQ0FBQTtLQUNMO0FBQ0wsQ0FBQztBQUVELFNBQVMsYUFBYSxDQUFDLFNBQW9CO0lBQ3ZDLE9BQU8sSUFBSSxTQUFTLENBQUMsSUFBSSxpQkFBaUIsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsU0FBUyxDQUFDLEtBQUssRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUE7QUFDbEcsQ0FBQztBQUVELFNBQVMsaUJBQWlCLENBQUMsU0FBb0I7SUFDM0MsTUFBTSxJQUFJLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQTtJQUMzQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFO1FBQ3JDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDYixJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtRQUNqQixJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtLQUNwQjtBQUNMLENBQUM7QUFFRCxTQUFTLFlBQVksQ0FBQyxTQUFvQjtJQUN0QyxNQUFNLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsR0FBRyxTQUFTLENBQUE7SUFDekMsTUFBTSxVQUFVLEdBQUcsQ0FBQyxDQUFBO0lBQ3BCLE1BQU0sUUFBUSxHQUFHLEtBQUssR0FBRyxVQUFVLENBQUE7SUFFbkMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRTtRQUM3QixNQUFNLE9BQU8sR0FBRyxDQUFDLEdBQUcsUUFBUSxDQUFBO1FBQzVCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLEVBQUUsRUFBRSxDQUFDLEVBQUU7WUFDNUIsTUFBTSxPQUFPLEdBQUcsT0FBTyxHQUFHLENBQUMsR0FBRyxVQUFVLENBQUE7WUFDeEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQTtZQUNuQixJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtZQUN2QixJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtTQUMxQjtLQUNKO0FBQ0wsQ0FBQztBQUVELFNBQVMsWUFBWSxDQUFDLFNBQW9CO0lBQ3RDLE1BQU0sSUFBSSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUE7SUFDM0IsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLEVBQUU7UUFDL0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQTtRQUNsQixJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtRQUN0QixJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtJQUMxQixDQUFDLENBQUMsQ0FBQTtBQUNOLENBQUM7QUFFRCxTQUFTLElBQUksQ0FBQyxTQUFvQixFQUFFLENBQWlEO0lBQ2pGLE1BQU0sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsU0FBUyxDQUFBO0lBQ25DLE1BQU0sVUFBVSxHQUFHLENBQUMsQ0FBQTtJQUNwQixNQUFNLFFBQVEsR0FBRyxLQUFLLEdBQUcsVUFBVSxDQUFBO0lBRW5DLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLEVBQUUsRUFBRSxDQUFDLEVBQUU7UUFDN0IsTUFBTSxPQUFPLEdBQUcsQ0FBQyxHQUFHLFFBQVEsQ0FBQTtRQUM1QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxFQUFFLEVBQUUsQ0FBQyxFQUFFO1lBQzVCLE1BQU0sT0FBTyxHQUFHLE9BQU8sR0FBRyxDQUFDLEdBQUcsVUFBVSxDQUFBO1lBQ3hDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFBO1NBQ25CO0tBQ0o7QUFDTCxDQUFDO0FBRUQsU0FBUyxJQUFJLENBQUMsU0FBb0I7SUFDOUIsTUFBTSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEdBQUcsU0FBUyxDQUFBO0lBQ3pDLE1BQU0sVUFBVSxHQUFHLENBQUMsQ0FBQTtJQUNwQixNQUFNLFFBQVEsR0FBRyxLQUFLLEdBQUcsVUFBVSxDQUFBO0lBQ25DLE1BQU0sSUFBSSxHQUFpQixFQUFFLENBQUE7SUFFN0IsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRTtRQUM3QixNQUFNLE9BQU8sR0FBRyxDQUFDLEdBQUcsUUFBUSxDQUFBO1FBQzVCLE1BQU0sR0FBRyxHQUFlLEVBQUUsQ0FBQTtRQUMxQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxFQUFFLEVBQUUsQ0FBQyxFQUFFO1lBQzVCLE1BQU0sT0FBTyxHQUFHLE9BQU8sR0FBRyxDQUFDLEdBQUcsVUFBVSxDQUFBO1lBQ3hDLE1BQU0sS0FBSyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLElBQUksQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFBO1lBQ25FLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUE7U0FDbEI7UUFFRCxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0tBQ2pCO0lBRUQsT0FBTyxJQUFJLENBQUE7QUFDZixDQUFDO0FBRUQsU0FBUyxNQUFNLENBQUMsSUFBa0I7SUFDOUIsTUFBTSxJQUFJLEdBQWEsRUFBRSxDQUFBO0lBQ3pCLEtBQUssTUFBTSxHQUFHLElBQUksSUFBSSxFQUFFO1FBQ3BCLEtBQUssTUFBTSxLQUFLLElBQUksR0FBRyxFQUFFO1lBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUE7U0FDL0M7S0FDSjtJQUVELE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUE7SUFDMUIsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQTtJQUM1QixNQUFNLFNBQVMsR0FBRyxJQUFJLFNBQVMsQ0FBQyxJQUFJLGlCQUFpQixDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQTtJQUMzRSxPQUFPLFNBQVMsQ0FBQTtBQUNwQixDQUFDO0FBRUQsU0FBUyxjQUFjLENBQUMsSUFBa0I7SUFDdEMsS0FBSyxNQUFNLEdBQUcsSUFBSSxJQUFJLEVBQUU7UUFDcEIsS0FBSyxNQUFNLEtBQUssSUFBSSxHQUFHLEVBQUU7WUFDckIsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQTtZQUNkLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUE7WUFDZCxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFBO1NBQ2pCO0tBQ0o7QUFDTCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgdXRpbCBmcm9tIFwiLi4vc2hhcmVkL3V0aWwuanNcIlxyXG5cclxuY29uc3QgY2FudmFzID0gdXRpbC5ieUlkKFwiY2FudmFzXCIpIGFzIEhUTUxDYW52YXNFbGVtZW50XHJcbmNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIikgYXMgQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEXHJcbmlmICghY3R4KSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW52YXMgZWxlbWVudCBub3Qgc3VwcG9ydGVkXCIpXHJcbn1cclxuXHJcbmNvbnN0IGdsID0gY2FudmFzLmdldENvbnRleHQoXCJ3ZWJnbDItY29tcHV0ZVwiKVxyXG5pZiAoIWdsKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJHTCBjb21wdXRlIG5vdCBzdXBwb3J0ZWRcIilcclxufVxyXG5cclxuaW5pdCgpXHJcblxyXG5hc3luYyBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgY29uc3QgaW1hZ2UgPSBhd2FpdCB1dGlsLmxvYWRJbWFnZShcIm9sdHMuanBnXCIpXHJcbiAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aFxyXG4gICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodFxyXG4gICAgY3R4LmRyYXdJbWFnZShpbWFnZSwgMCwgMClcclxuXHJcbiAgICBjb25zdCBvcmlnaW5hbEltYWdlRGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KVxyXG5cclxuICAgIHtcclxuICAgICAgICBjb25zdCBpbWFnZURhdGEgPSBjb3B5SW1hZ2VEYXRhKG9yaWdpbmFsSW1hZ2VEYXRhKVxyXG4gICAgICAgIHV0aWwuYmVuY2goYnJpZ2h0ZW5JbWFnZURhdGEubmFtZSwgKCkgPT4gYnJpZ2h0ZW5JbWFnZURhdGEoaW1hZ2VEYXRhKSlcclxuICAgIH1cclxuXHJcbiAgICB7XHJcbiAgICAgICAgY29uc3QgaW1hZ2VEYXRhID0gY29weUltYWdlRGF0YShvcmlnaW5hbEltYWdlRGF0YSlcclxuICAgICAgICB1dGlsLmJlbmNoKGJyaWdodGVuTG9vcC5uYW1lLCAoKSA9PiBicmlnaHRlbkxvb3AoaW1hZ2VEYXRhKSlcclxuICAgIH1cclxuXHJcbiAgICB7XHJcbiAgICAgICAgY29uc3QgaW1hZ2VEYXRhID0gY29weUltYWdlRGF0YShvcmlnaW5hbEltYWdlRGF0YSlcclxuICAgICAgICB1dGlsLmJlbmNoKGJyaWdodGVuU2Nhbi5uYW1lLCAoKSA9PiBicmlnaHRlblNjYW4oaW1hZ2VEYXRhKSlcclxuICAgIH1cclxuXHJcbiAgICB7XHJcbiAgICAgICAgY29uc3QgaW1hZ2VEYXRhID0gY29weUltYWdlRGF0YShvcmlnaW5hbEltYWdlRGF0YSlcclxuICAgICAgICBjb25zdCBuZXN0ZWQgPSBuZXN0KGltYWdlRGF0YSlcclxuICAgICAgICB1dGlsLmJlbmNoKGJyaWdodGVuTmVzdGVkLm5hbWUsICgpID0+IGJyaWdodGVuTmVzdGVkKG5lc3RlZCkpXHJcbiAgICAgICAgY29uc3QgbmV3SW1hZ2VEYXRhID0gdW5uZXN0KG5lc3RlZClcclxuICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG5ld0ltYWdlRGF0YSwgMCwgMClcclxuICAgIH1cclxuXHJcbiAgICB7XHJcbiAgICAgICAgY29uc3QgYSA9IHV0aWwuc2VxdWVuY2Uob3JpZ2luYWxJbWFnZURhdGEuZGF0YS5sZW5ndGggLyA0KVxyXG4gICAgICAgIHV0aWwuYmVuY2goXCJhY2Nlc3MgYXJyYXkgb2YgbnVtYmVyc1wiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYS5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgYVsxXSArPSA5XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjb3B5SW1hZ2VEYXRhKGltYWdlRGF0YTogSW1hZ2VEYXRhKTogSW1hZ2VEYXRhIHtcclxuICAgIHJldHVybiBuZXcgSW1hZ2VEYXRhKG5ldyBVaW50OENsYW1wZWRBcnJheShpbWFnZURhdGEuZGF0YSksIGltYWdlRGF0YS53aWR0aCwgaW1hZ2VEYXRhLmhlaWdodClcclxufVxyXG5cclxuZnVuY3Rpb24gYnJpZ2h0ZW5JbWFnZURhdGEoaW1hZ2VEYXRhOiBJbWFnZURhdGEpIHtcclxuICAgIGNvbnN0IGRhdGEgPSBpbWFnZURhdGEuZGF0YVxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSA0KSB7XHJcbiAgICAgICAgZGF0YVtpXSArPSA2NFxyXG4gICAgICAgIGRhdGFbaSArIDFdICs9IDY0XHJcbiAgICAgICAgZGF0YVtpICsgMl0gKz0gNjRcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gYnJpZ2h0ZW5Mb29wKGltYWdlRGF0YTogSW1hZ2VEYXRhKSB7XHJcbiAgICBjb25zdCB7IGhlaWdodCwgd2lkdGgsIGRhdGEgfSA9IGltYWdlRGF0YVxyXG4gICAgY29uc3QgcGl4ZWxQaXRjaCA9IDRcclxuICAgIGNvbnN0IHJvd1BpdGNoID0gd2lkdGggKiBwaXhlbFBpdGNoXHJcblxyXG4gICAgZm9yIChsZXQgeSA9IDA7IHkgPCBoZWlnaHQ7ICsreSkge1xyXG4gICAgICAgIGNvbnN0IHlPZmZzZXQgPSB5ICogcm93UGl0Y2hcclxuICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyArK3gpIHtcclxuICAgICAgICAgICAgY29uc3QgeE9mZnNldCA9IHlPZmZzZXQgKyB4ICogcGl4ZWxQaXRjaFxyXG4gICAgICAgICAgICBkYXRhW3hPZmZzZXRdICs9IDY0XHJcbiAgICAgICAgICAgIGRhdGFbeE9mZnNldCArIDFdICs9IDY0XHJcbiAgICAgICAgICAgIGRhdGFbeE9mZnNldCArIDJdICs9IDY0XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBicmlnaHRlblNjYW4oaW1hZ2VEYXRhOiBJbWFnZURhdGEpIHtcclxuICAgIGNvbnN0IGRhdGEgPSBpbWFnZURhdGEuZGF0YVxyXG4gICAgc2NhbihpbWFnZURhdGEsIChfMSwgXzIsIG9mZnNldCkgPT4ge1xyXG4gICAgICAgIGRhdGFbb2Zmc2V0XSArPSA2NFxyXG4gICAgICAgIGRhdGFbb2Zmc2V0ICsgMV0gKz0gNjRcclxuICAgICAgICBkYXRhW29mZnNldCArIDJdICs9IDY0XHJcbiAgICB9KVxyXG59XHJcblxyXG5mdW5jdGlvbiBzY2FuKGltYWdlRGF0YTogSW1hZ2VEYXRhLCBmOiAoeDogbnVtYmVyLCB5OiBudW1iZXIsIG9mZnNldDogbnVtYmVyKSA9PiB2b2lkKSB7XHJcbiAgICBjb25zdCB7IGhlaWdodCwgd2lkdGggfSA9IGltYWdlRGF0YVxyXG4gICAgY29uc3QgcGl4ZWxQaXRjaCA9IDRcclxuICAgIGNvbnN0IHJvd1BpdGNoID0gd2lkdGggKiBwaXhlbFBpdGNoXHJcblxyXG4gICAgZm9yIChsZXQgeSA9IDA7IHkgPCBoZWlnaHQ7ICsreSkge1xyXG4gICAgICAgIGNvbnN0IHlPZmZzZXQgPSB5ICogcm93UGl0Y2hcclxuICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyArK3gpIHtcclxuICAgICAgICAgICAgY29uc3QgeE9mZnNldCA9IHlPZmZzZXQgKyB4ICogcGl4ZWxQaXRjaFxyXG4gICAgICAgICAgICBmKHgsIHksIHhPZmZzZXQpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBuZXN0KGltYWdlRGF0YTogSW1hZ2VEYXRhKTogbnVtYmVyW11bXVtdIHtcclxuICAgIGNvbnN0IHsgaGVpZ2h0LCB3aWR0aCwgZGF0YSB9ID0gaW1hZ2VEYXRhXHJcbiAgICBjb25zdCBwaXhlbFBpdGNoID0gNFxyXG4gICAgY29uc3Qgcm93UGl0Y2ggPSB3aWR0aCAqIHBpeGVsUGl0Y2hcclxuICAgIGNvbnN0IHJvd3M6IG51bWJlcltdW11bXSA9IFtdXHJcblxyXG4gICAgZm9yIChsZXQgeSA9IDA7IHkgPCBoZWlnaHQ7ICsreSkge1xyXG4gICAgICAgIGNvbnN0IHlPZmZzZXQgPSB5ICogcm93UGl0Y2hcclxuICAgICAgICBjb25zdCByb3c6IG51bWJlcltdW10gPSBbXVxyXG4gICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgd2lkdGg7ICsreCkge1xyXG4gICAgICAgICAgICBjb25zdCB4T2Zmc2V0ID0geU9mZnNldCArIHggKiBwaXhlbFBpdGNoXHJcbiAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gW2RhdGFbeE9mZnNldF0sIGRhdGFbeE9mZnNldCArIDFdLCBkYXRhW3hPZmZzZXQgKyAyXV1cclxuICAgICAgICAgICAgcm93LnB1c2goY29sb3IpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByb3dzLnB1c2gocm93KVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiByb3dzXHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVubmVzdChkYXRhOiBudW1iZXJbXVtdW10pOiBJbWFnZURhdGEge1xyXG4gICAgY29uc3QgZmxhdDogbnVtYmVyW10gPSBbXVxyXG4gICAgZm9yIChjb25zdCByb3cgb2YgZGF0YSkge1xyXG4gICAgICAgIGZvciAoY29uc3QgY29sb3Igb2Ygcm93KSB7XHJcbiAgICAgICAgICAgIGZsYXQucHVzaChjb2xvclswXSwgY29sb3JbMV0sIGNvbG9yWzJdLCAyNTUpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGhlaWdodCA9IGRhdGEubGVuZ3RoXHJcbiAgICBjb25zdCB3aWR0aCA9IGRhdGFbMF0ubGVuZ3RoXHJcbiAgICBjb25zdCBpbWFnZURhdGEgPSBuZXcgSW1hZ2VEYXRhKG5ldyBVaW50OENsYW1wZWRBcnJheShmbGF0KSwgd2lkdGgsIGhlaWdodClcclxuICAgIHJldHVybiBpbWFnZURhdGFcclxufVxyXG5cclxuZnVuY3Rpb24gYnJpZ2h0ZW5OZXN0ZWQoZGF0YTogbnVtYmVyW11bXVtdKSB7XHJcbiAgICBmb3IgKGNvbnN0IHJvdyBvZiBkYXRhKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCBjb2xvciBvZiByb3cpIHtcclxuICAgICAgICAgICAgY29sb3JbMF0gKz0gNjRcclxuICAgICAgICAgICAgY29sb3JbMV0gKz0gNjRcclxuICAgICAgICAgICAgY29sb3JbMl0gKz0gNjRcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=