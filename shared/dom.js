/**
 * Dom utility library
 */
/**
 * Retrieve an element given its id
 * Throws an exception if element is not found
 */
export function byId(id) {
    const elem = document.getElementById(id);
    if (!elem) {
        throw Error(`elem with id ${id} was not found`);
    }
    return elem;
}
/**
 * Find first element that matches selector
 * throws an exception if not found
 * @param elem elem whose children to query
 * @param selector selector to apply
 */
export function bySelector(elem, selector) {
    const result = elem.querySelector(selector);
    if (result == null) {
        throw Error(`An element matching ${selector} was not found.`);
    }
    return result;
}
/**
 * Attach a delegated event listener to an element
 * Listener is only invoked if element matches selector
 * @param elem element to attach listener to
 * @param type type of event to listen for
 * @param selector target element selector
 * @param listener event listener
 */
export function delegate(elem, type, selector, listener) {
    elem.addEventListener(type, (evt) => {
        // check if any parent of target matches selector
        let target = evt.target;
        while (true) {
            if (!target) {
                break;
            }
            if (target == elem) {
                break;
            }
            if (target.matches(selector)) {
                listener.call(target, evt);
                break;
            }
            target = target.parentNode;
        }
    });
}
export function removeAllChildren(elem) {
    while (elem.firstChild) {
        elem.removeChild(elem.firstChild);
    }
}
// create a one-time event
export function once(elem, type, listener) {
    // create event
    elem.addEventListener(type, function (e) {
        // remove event
        elem.removeEventListener(e.type, listener);
        // call handler
        listener(e);
    });
}
export function getScrollOffset() {
    return {
        left: window.pageXOffset || document.documentElement.scrollLeft,
        top: window.pageYOffset || document.documentElement.scrollTop,
    };
}
/**
 * Get the offset of an element relative to document
 * @param e element
 */
export function getDocumentOffset(e) {
    const rect = e.getBoundingClientRect();
    const scrollOffset = getScrollOffset();
    return {
        left: rect.left + scrollOffset.left,
        top: rect.top + scrollOffset.top,
    };
}
/**
 * getElementIndex returns the index of the element within its parent container
 * @param elem element
 */
export function getElementIndex(elem) {
    let idx = 0;
    while (elem.previousElementSibling) {
        ++idx;
        elem = elem.previousElementSibling;
    }
    return idx;
}
/**
 * Load an image from the specified url
 * Returns a promise that resolves when the image is loaded
 * @param url url to load image from
 */
export function loadImage(url) {
    const promise = new Promise(resolve => {
        const img = new Image();
        img.addEventListener("load", () => resolve(img));
        img.src = url;
    });
    return promise;
}
export function copyImageData(imageData) {
    return new ImageData(new Uint8ClampedArray(imageData.data), imageData.width, imageData.height);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZG9tLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztHQUVHO0FBU0g7OztHQUdHO0FBQ0gsTUFBTSxVQUFVLElBQUksQ0FBQyxFQUFVO0lBQzNCLE1BQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDLENBQUE7SUFDeEMsSUFBSSxDQUFDLElBQUksRUFBRTtRQUNQLE1BQU0sS0FBSyxDQUFDLGdCQUFnQixFQUFFLGdCQUFnQixDQUFDLENBQUE7S0FDbEQ7SUFFRCxPQUFPLElBQUksQ0FBQTtBQUNmLENBQUM7QUFFRDs7Ozs7R0FLRztBQUNILE1BQU0sVUFBVSxVQUFVLENBQUMsSUFBZ0IsRUFBRSxRQUFnQjtJQUN6RCxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQzNDLElBQUksTUFBTSxJQUFJLElBQUksRUFBRTtRQUNoQixNQUFNLEtBQUssQ0FBQyx1QkFBdUIsUUFBUSxpQkFBaUIsQ0FBQyxDQUFBO0tBQ2hFO0lBRUQsT0FBTyxNQUFNLENBQUE7QUFDakIsQ0FBQztBQUdEOzs7Ozs7O0dBT0c7QUFDSCxNQUFNLFVBQVUsUUFBUSxDQUFDLElBQWlCLEVBQUUsSUFBWSxFQUFFLFFBQWdCLEVBQUUsUUFBdUI7SUFDL0YsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFO1FBQ2hDLGlEQUFpRDtRQUNqRCxJQUFJLE1BQU0sR0FBRyxHQUFHLENBQUMsTUFBNEIsQ0FBQztRQUM5QyxPQUFPLElBQUksRUFBRTtZQUNULElBQUksQ0FBQyxNQUFNLEVBQUU7Z0JBQ1QsTUFBSzthQUNSO1lBRUQsSUFBSSxNQUFNLElBQUksSUFBSSxFQUFFO2dCQUNoQixNQUFLO2FBQ1I7WUFFRCxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUU7Z0JBQzFCLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUFBO2dCQUMxQixNQUFLO2FBQ1I7WUFFRCxNQUFNLEdBQUcsTUFBTSxDQUFDLFVBQWdDLENBQUE7U0FDbkQ7SUFDTCxDQUFDLENBQUMsQ0FBQTtBQUNOLENBQUM7QUFHRCxNQUFNLFVBQVUsaUJBQWlCLENBQUMsSUFBaUI7SUFDL0MsT0FBTyxJQUFJLENBQUMsVUFBVSxFQUFFO1FBQ3BCLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFBO0tBQ3BDO0FBQ0wsQ0FBQztBQUVELDBCQUEwQjtBQUMxQixNQUFNLFVBQVUsSUFBSSxDQUFDLElBQWlCLEVBQUUsSUFBWSxFQUFFLFFBQXVCO0lBQ3pFLGVBQWU7SUFDZixJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLFVBQVUsQ0FBQztRQUNuQyxlQUFlO1FBQ2YsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUE7UUFFMUMsZUFBZTtRQUNmLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNoQixDQUFDLENBQUMsQ0FBQztBQUVQLENBQUM7QUFFRCxNQUFNLFVBQVUsZUFBZTtJQUMzQixPQUFPO1FBQ0gsSUFBSSxFQUFFLE1BQU0sQ0FBQyxXQUFXLElBQUksUUFBUSxDQUFDLGVBQWUsQ0FBQyxVQUFVO1FBQy9ELEdBQUcsRUFBRSxNQUFNLENBQUMsV0FBVyxJQUFJLFFBQVEsQ0FBQyxlQUFlLENBQUMsU0FBUztLQUNoRSxDQUFBO0FBQ0wsQ0FBQztBQUVEOzs7R0FHRztBQUNILE1BQU0sVUFBVSxpQkFBaUIsQ0FBQyxDQUFVO0lBQ3hDLE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxxQkFBcUIsRUFBRSxDQUFBO0lBQ3RDLE1BQU0sWUFBWSxHQUFHLGVBQWUsRUFBRSxDQUFBO0lBRXRDLE9BQU87UUFDSCxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksR0FBRyxZQUFZLENBQUMsSUFBSTtRQUNuQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUcsR0FBRyxZQUFZLENBQUMsR0FBRztLQUNuQyxDQUFBO0FBQ0wsQ0FBQztBQUVEOzs7R0FHRztBQUNILE1BQU0sVUFBVSxlQUFlLENBQUMsSUFBYTtJQUN6QyxJQUFJLEdBQUcsR0FBRyxDQUFDLENBQUE7SUFDWCxPQUFPLElBQUksQ0FBQyxzQkFBc0IsRUFBRTtRQUNoQyxFQUFFLEdBQUcsQ0FBQTtRQUNMLElBQUksR0FBRyxJQUFJLENBQUMsc0JBQXNCLENBQUE7S0FDckM7SUFFRCxPQUFPLEdBQUcsQ0FBQTtBQUNkLENBQUM7QUFFRDs7OztHQUlHO0FBQ0gsTUFBTSxVQUFVLFNBQVMsQ0FBQyxHQUFXO0lBQ2pDLE1BQU0sT0FBTyxHQUFHLElBQUksT0FBTyxDQUFtQixPQUFPLENBQUMsRUFBRTtRQUNwRCxNQUFNLEdBQUcsR0FBRyxJQUFJLEtBQUssRUFBRSxDQUFBO1FBQ3ZCLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7UUFDaEQsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUE7SUFDakIsQ0FBQyxDQUFDLENBQUE7SUFFRixPQUFPLE9BQU8sQ0FBQTtBQUNsQixDQUFDO0FBRUQsTUFBTSxVQUFVLGFBQWEsQ0FBQyxTQUFvQjtJQUM5QyxPQUFPLElBQUksU0FBUyxDQUFDLElBQUksaUJBQWlCLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLFNBQVMsQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0FBQ2xHLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogRG9tIHV0aWxpdHkgbGlicmFyeVxyXG4gKi9cclxuXHJcbmV4cG9ydCB0eXBlIEV2ZW50U291cmNlID0gRG9jdW1lbnQgfCBXaW5kb3cgfCBIVE1MRWxlbWVudFxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBPZmZzZXQge1xyXG4gICAgdG9wOiBudW1iZXJcclxuICAgIGxlZnQ6IG51bWJlclxyXG59XHJcblxyXG4vKipcclxuICogUmV0cmlldmUgYW4gZWxlbWVudCBnaXZlbiBpdHMgaWRcclxuICogVGhyb3dzIGFuIGV4Y2VwdGlvbiBpZiBlbGVtZW50IGlzIG5vdCBmb3VuZFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGJ5SWQoaWQ6IHN0cmluZyk6IEhUTUxFbGVtZW50IHtcclxuICAgIGNvbnN0IGVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZClcclxuICAgIGlmICghZWxlbSkge1xyXG4gICAgICAgIHRocm93IEVycm9yKGBlbGVtIHdpdGggaWQgJHtpZH0gd2FzIG5vdCBmb3VuZGApXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGVsZW1cclxufVxyXG5cclxuLyoqXHJcbiAqIEZpbmQgZmlyc3QgZWxlbWVudCB0aGF0IG1hdGNoZXMgc2VsZWN0b3JcclxuICogdGhyb3dzIGFuIGV4Y2VwdGlvbiBpZiBub3QgZm91bmRcclxuICogQHBhcmFtIGVsZW0gZWxlbSB3aG9zZSBjaGlsZHJlbiB0byBxdWVyeVxyXG4gKiBAcGFyYW0gc2VsZWN0b3Igc2VsZWN0b3IgdG8gYXBwbHlcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBieVNlbGVjdG9yKGVsZW06IFBhcmVudE5vZGUsIHNlbGVjdG9yOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGVsZW0ucXVlcnlTZWxlY3RvcihzZWxlY3RvcilcclxuICAgIGlmIChyZXN1bHQgPT0gbnVsbCkge1xyXG4gICAgICAgIHRocm93IEVycm9yKGBBbiBlbGVtZW50IG1hdGNoaW5nICR7c2VsZWN0b3J9IHdhcyBub3QgZm91bmQuYClcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzdWx0XHJcbn1cclxuXHJcblxyXG4vKipcclxuICogQXR0YWNoIGEgZGVsZWdhdGVkIGV2ZW50IGxpc3RlbmVyIHRvIGFuIGVsZW1lbnRcclxuICogTGlzdGVuZXIgaXMgb25seSBpbnZva2VkIGlmIGVsZW1lbnQgbWF0Y2hlcyBzZWxlY3RvclxyXG4gKiBAcGFyYW0gZWxlbSBlbGVtZW50IHRvIGF0dGFjaCBsaXN0ZW5lciB0b1xyXG4gKiBAcGFyYW0gdHlwZSB0eXBlIG9mIGV2ZW50IHRvIGxpc3RlbiBmb3JcclxuICogQHBhcmFtIHNlbGVjdG9yIHRhcmdldCBlbGVtZW50IHNlbGVjdG9yXHJcbiAqIEBwYXJhbSBsaXN0ZW5lciBldmVudCBsaXN0ZW5lclxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGRlbGVnYXRlKGVsZW06IEV2ZW50U291cmNlLCB0eXBlOiBzdHJpbmcsIHNlbGVjdG9yOiBzdHJpbmcsIGxpc3RlbmVyOiBFdmVudExpc3RlbmVyKSB7XHJcbiAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgKGV2dCkgPT4ge1xyXG4gICAgICAgIC8vIGNoZWNrIGlmIGFueSBwYXJlbnQgb2YgdGFyZ2V0IG1hdGNoZXMgc2VsZWN0b3JcclxuICAgICAgICBsZXQgdGFyZ2V0ID0gZXZ0LnRhcmdldCBhcyBIVE1MRWxlbWVudCB8IG51bGw7XHJcbiAgICAgICAgd2hpbGUgKHRydWUpIHtcclxuICAgICAgICAgICAgaWYgKCF0YXJnZXQpIHtcclxuICAgICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0YXJnZXQgPT0gZWxlbSkge1xyXG4gICAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHRhcmdldC5tYXRjaGVzKHNlbGVjdG9yKSkge1xyXG4gICAgICAgICAgICAgICAgbGlzdGVuZXIuY2FsbCh0YXJnZXQsIGV2dClcclxuICAgICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRhcmdldCA9IHRhcmdldC5wYXJlbnROb2RlIGFzIEhUTUxFbGVtZW50IHwgbnVsbFxyXG4gICAgICAgIH1cclxuICAgIH0pXHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlQWxsQ2hpbGRyZW4oZWxlbTogSFRNTEVsZW1lbnQpIHtcclxuICAgIHdoaWxlIChlbGVtLmZpcnN0Q2hpbGQpIHtcclxuICAgICAgICBlbGVtLnJlbW92ZUNoaWxkKGVsZW0uZmlyc3RDaGlsZClcclxuICAgIH1cclxufVxyXG5cclxuLy8gY3JlYXRlIGEgb25lLXRpbWUgZXZlbnRcclxuZXhwb3J0IGZ1bmN0aW9uIG9uY2UoZWxlbTogRXZlbnRTb3VyY2UsIHR5cGU6IHN0cmluZywgbGlzdGVuZXI6IEV2ZW50TGlzdGVuZXIpIHtcclxuICAgIC8vIGNyZWF0ZSBldmVudFxyXG4gICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKHR5cGUsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgLy8gcmVtb3ZlIGV2ZW50XHJcbiAgICAgICAgZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyKGUudHlwZSwgbGlzdGVuZXIpXHJcblxyXG4gICAgICAgIC8vIGNhbGwgaGFuZGxlclxyXG4gICAgICAgIGxpc3RlbmVyKGUpO1xyXG4gICAgfSk7XHJcblxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2Nyb2xsT2Zmc2V0KCk6IE9mZnNldCB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGxlZnQ6IHdpbmRvdy5wYWdlWE9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCxcclxuICAgICAgICB0b3A6IHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wLFxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogR2V0IHRoZSBvZmZzZXQgb2YgYW4gZWxlbWVudCByZWxhdGl2ZSB0byBkb2N1bWVudFxyXG4gKiBAcGFyYW0gZSBlbGVtZW50XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RG9jdW1lbnRPZmZzZXQoZTogRWxlbWVudCk6IE9mZnNldCB7XHJcbiAgICBjb25zdCByZWN0ID0gZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxyXG4gICAgY29uc3Qgc2Nyb2xsT2Zmc2V0ID0gZ2V0U2Nyb2xsT2Zmc2V0KClcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGxlZnQ6IHJlY3QubGVmdCArIHNjcm9sbE9mZnNldC5sZWZ0LFxyXG4gICAgICAgIHRvcDogcmVjdC50b3AgKyBzY3JvbGxPZmZzZXQudG9wLFxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogZ2V0RWxlbWVudEluZGV4IHJldHVybnMgdGhlIGluZGV4IG9mIHRoZSBlbGVtZW50IHdpdGhpbiBpdHMgcGFyZW50IGNvbnRhaW5lclxyXG4gKiBAcGFyYW0gZWxlbSBlbGVtZW50XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RWxlbWVudEluZGV4KGVsZW06IEVsZW1lbnQpOiBudW1iZXIge1xyXG4gICAgbGV0IGlkeCA9IDBcclxuICAgIHdoaWxlIChlbGVtLnByZXZpb3VzRWxlbWVudFNpYmxpbmcpIHtcclxuICAgICAgICArK2lkeFxyXG4gICAgICAgIGVsZW0gPSBlbGVtLnByZXZpb3VzRWxlbWVudFNpYmxpbmdcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaWR4XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBMb2FkIGFuIGltYWdlIGZyb20gdGhlIHNwZWNpZmllZCB1cmxcclxuICogUmV0dXJucyBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBpbWFnZSBpcyBsb2FkZWRcclxuICogQHBhcmFtIHVybCB1cmwgdG8gbG9hZCBpbWFnZSBmcm9tXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gbG9hZEltYWdlKHVybDogc3RyaW5nKTogUHJvbWlzZTxIVE1MSW1hZ2VFbGVtZW50PiB7XHJcbiAgICBjb25zdCBwcm9taXNlID0gbmV3IFByb21pc2U8SFRNTEltYWdlRWxlbWVudD4ocmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgY29uc3QgaW1nID0gbmV3IEltYWdlKClcclxuICAgICAgICBpbWcuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgKCkgPT4gcmVzb2x2ZShpbWcpKVxyXG4gICAgICAgIGltZy5zcmMgPSB1cmxcclxuICAgIH0pXHJcblxyXG4gICAgcmV0dXJuIHByb21pc2VcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNvcHlJbWFnZURhdGEoaW1hZ2VEYXRhOiBJbWFnZURhdGEpOiBJbWFnZURhdGEge1xyXG4gICAgcmV0dXJuIG5ldyBJbWFnZURhdGEobmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGltYWdlRGF0YS5kYXRhKSwgaW1hZ2VEYXRhLndpZHRoLCBpbWFnZURhdGEuaGVpZ2h0KVxyXG59Il19