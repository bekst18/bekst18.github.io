import * as util from "../shared/util.js";
var Axis;
(function (Axis) {
    Axis[Axis["None"] = 0] = "None";
    Axis[Axis["X"] = 1] = "X";
    Axis[Axis["Y"] = 2] = "Y";
    Axis[Axis["Z"] = 3] = "Z";
})(Axis || (Axis = {}));
export function palettizeMedianCut(imageData, maxColors) {
    const buckets = [];
    const data = imageData.data;
    // place all colors in initial bucket
    const bucket = createBucket(data, util.sequence(imageData.width * imageData.height));
    buckets.push(bucket);
    while (buckets.length < maxColors) {
        const bucket = buckets.reduce((x, y) => x.range > y.range ? x : y);
        const newBucket = splitBucket(data, bucket);
        buckets.push(newBucket);
    }
    // choose color for each bucket
    const palette = buckets.map(b => divXYZ(b.indices.reduce((xyz, i) => addXYZ(xyz, [data[i * 4], data[i * 4 + 1], data[i * 4 + 2]]), [0, 0, 0]), b.indices.length));
    const paletteOverlay = util.fill(0, imageData.width * imageData.height);
    for (let i = 0; i < buckets.length; ++i) {
        const bucket = buckets[i];
        for (let j = 0; j < bucket.indices.length; ++j) {
            paletteOverlay[bucket.indices[j]] = i;
        }
    }
    return [palette, paletteOverlay];
}
export function palettizeHistogram(imageData, bucketsPerComponent, maxColors) {
    const { width, height, data } = imageData;
    const pixels = width * height;
    const bucketPitch = bucketsPerComponent * bucketsPerComponent;
    const numBuckets = bucketPitch * bucketsPerComponent;
    // creat intial buckets
    const buckets = util.generate(numBuckets, () => ({ color: [0, 0, 0], pixels: 0 }));
    // assign and update bucket for each pixel
    const bucketOverlay = util.generate(pixels, i => {
        const r = data[i * 4] / 255;
        const g = data[i * 4 + 1] / 255;
        const b = data[i * 4 + 2] / 255;
        const rb = Math.min(Math.floor(r * bucketsPerComponent), bucketsPerComponent - 1);
        const gb = Math.min(Math.floor(g * bucketsPerComponent), bucketsPerComponent - 1);
        const bb = Math.min(Math.floor(b * bucketsPerComponent), bucketsPerComponent - 1);
        const bucketIdx = rb * bucketPitch + gb * bucketsPerComponent + bb;
        const bucket = buckets[bucketIdx];
        bucket.color = addXYZ([r, g, b], bucket.color);
        bucket.pixels++;
        return bucket;
    });
    // calculate bucket colors
    for (const bucket of buckets) {
        bucket.color = divXYZ(bucket.color, bucket.pixels);
    }
    const topBuckets = buckets
        .sort((b1, b2) => b2.pixels - b1.pixels)
        .slice(0, maxColors);
    const bucketSet = new Set(topBuckets);
    // map all colors to top N buckets
    for (let i = 0; i < bucketOverlay.length; ++i) {
        if (bucketSet.has(bucketOverlay[i])) {
            continue;
        }
        // otherwise, map to new bucket
        const r = data[i * 4] / 255;
        const g = data[i * 4] / 255;
        const b = data[i * 4] / 255;
        const color = [r, g, b];
        const bucket = topBuckets.reduce((b1, b2) => calcDistSq(b1.color, color) < calcDistSq(b2.color, color) ? b1 : b2);
        bucketOverlay[i] = bucket;
    }
    // determine palette colors
    const palette = topBuckets.map(b => mulXYZ(b.color, 255));
    const paletteOverlay = bucketOverlay.map(b => buckets.indexOf(b));
    return [palette, paletteOverlay];
}
export function applyPalette(palette, palleteOverlay, imageData) {
    const data = imageData.data;
    for (let i = 0; i < palleteOverlay.length; ++i) {
        // ignore index of -1
        const idx = palleteOverlay[i];
        if (idx == -1) {
            continue;
        }
        const color = palette[idx];
        data[i * 4] = color[0];
        data[i * 4 + 1] = color[1];
        data[i * 4 + 2] = color[2];
    }
}
function createBucket(data, indices) {
    if (indices.length == 0) {
        throw new Error("bucket must contain at least 1 value");
    }
    const bucket = {
        indices: indices,
        splitAxis: Axis.None,
        range: 0
    };
    updateBucket(data, bucket);
    return bucket;
}
function updateBucket(data, bucket) {
    bucket.range = 0;
    bucket.splitAxis = Axis.None;
    let minX = Infinity;
    let maxX = -1;
    let minY = Infinity;
    let maxY = -1;
    let minZ = Infinity;
    let maxZ = -1;
    for (const i of bucket.indices) {
        const x = data[i * 4];
        const y = data[i * 4 + 1];
        const z = data[i * 4 + 2];
        minX = Math.min(x, minX);
        maxX = Math.max(x, maxX);
        minY = Math.min(y, minY);
        maxY = Math.max(y, maxY);
        minZ = Math.min(z, minZ);
        maxZ = Math.max(z, maxZ);
    }
    const dx = maxX - minX;
    const dy = maxY - minY;
    const dz = maxZ - minZ;
    bucket.range = Math.max(dx, dy, dz);
    if (bucket.range === dx) {
        bucket.splitAxis = Axis.X;
    }
    else if (bucket.range === dy) {
        bucket.splitAxis = Axis.Y;
    }
    else {
        bucket.splitAxis = Axis.Z;
    }
}
function splitBucket(data, bucket) {
    if (bucket.indices.length <= 1) {
        throw Error("Bucket must > 1 element to split");
    }
    // determine component with max range in bucket
    switch (bucket.splitAxis) {
        case Axis.X:
            bucket.indices.sort((a, b) => data[a * 4] - data[b * 4]);
            break;
        case Axis.Y:
            bucket.indices.sort((a, b) => data[a * 4 + 1] - data[b * 4 + 1]);
            break;
        case Axis.Z:
            bucket.indices.sort((a, b) => data[a * 4 + 2] - data[b * 4 + 2]);
            break;
        default:
            throw new Error("Invalid split axis");
            break;
    }
    // left half of array stays in bucket
    // right half moves to new bucket
    const medianIdx = Math.floor(bucket.indices.length / 2);
    const newIndices = bucket.indices.splice(medianIdx, bucket.indices.length - medianIdx);
    const newBucket = createBucket(data, newIndices);
    updateBucket(data, bucket);
    return newBucket;
}
export function mulXYZ(xyz, s) {
    const [x, y, z] = xyz;
    return [x * s, y * s, z * s];
}
export function divXYZ(xyz, s) {
    const [x, y, z] = xyz;
    return [x / s, y / s, z / s];
}
export function addXYZ(xyz1, xyz2) {
    return [xyz1[0] + xyz2[0], xyz1[1] + xyz2[1], xyz1[2] + xyz2[2]];
}
export function equalXYZ(xyz1, xyz2) {
    return xyz1[0] === xyz2[0] && xyz1[1] === xyz2[1] && xyz1[2] === xyz2[2];
}
export function calcDistSq(xyz1, xyz2) {
    const [x1, y1, z1] = xyz1;
    const [x2, y2, z2] = xyz2;
    const dx = x2 - x1;
    const dy = y2 - y1;
    const dz = z2 - z1;
    const distSq = dx * dx + dy * dy + dz * dz;
    return distSq;
}
export function scanImageData(imageData, f) {
    const { width, height } = imageData;
    scan(width, height, f);
}
export function scan(width, height, f) {
    for (let y = 0; y < height; ++y) {
        const yOffset = y * width;
        for (let x = 0; x < width; ++x) {
            const xOffset = yOffset + x;
            f(x, y, xOffset);
        }
    }
}
export function scanRegion(x0, y0, width, height, rowPitch, f) {
    const x1 = x0 + width;
    const y1 = y0 + height;
    for (let y = y0; y < y1; ++y) {
        const yOffset = y * rowPitch;
        for (let x = x0; x < x1; ++x) {
            const xOffset = yOffset + x;
            f(x, y, xOffset);
        }
    }
}
export function scanRows(width, height, f) {
    for (let y = 0; y < height; ++y) {
        const offset = y * width;
        f(y, offset);
    }
}
export function scanRowsRegion(y0, height, rowPitch, f) {
    const y1 = y0 + height;
    for (let y = 0; y < y1; ++y) {
        const offset = y * rowPitch;
        f(y, offset);
    }
}
export function rgb2xyz(rgb) {
    let [r, b, g] = rgb;
    r /= 255.0;
    g /= 255.0;
    b /= 255.0;
    const x = r * 0.4124564 + g * 0.3575761 + b * 0.1804375;
    const y = r * 0.2126729 + g * 0.7151522 + b * 0.0721750;
    const z = r * 0.0193339 + g * 0.1191920 + b * 0.9503041;
    return [x, y, z];
}
export function xyz2rgb(xyz) {
    const [x, y, z] = xyz;
    const r = (x * 3.2404542 + y * -1.5371385 + z * -0.4985314) * 255;
    const g = (x * -0.9692660 + y * 1.8760108 + z * 0.0415560) * 255;
    const b = (x * 0.0556434 + y * -0.2040259 + z * 1.0572252) * 255;
    return [r, g, b];
}
export function linear(x) {
    if (x <= .04045) {
        return x / 12.92;
    }
    return Math.pow(((x + .055) / 1.055), 2.4);
}
export function imageData2RGBArray(data) {
    const result = [];
    for (let i = 0; i < data.length; i += 4) {
        result.push([data[i], data[i + 1], data[i + 2]]);
    }
    return result;
}
export function calcLuminance(color) {
    const [r, g, b] = color;
    const l = 0.2126 * (r / 255) + 0.7152 * (g / 255) + 0.0722 * (b / 255);
    return l;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2luZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImltYWdpbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLElBQUksTUFBTSxtQkFBbUIsQ0FBQTtBQUV6QyxJQUFLLElBQXNCO0FBQTNCLFdBQUssSUFBSTtJQUFHLCtCQUFJLENBQUE7SUFBRSx5QkFBQyxDQUFBO0lBQUUseUJBQUMsQ0FBQTtJQUFFLHlCQUFDLENBQUE7QUFBQyxDQUFDLEVBQXRCLElBQUksS0FBSixJQUFJLFFBQWtCO0FBVTNCLE1BQU0sVUFBVSxrQkFBa0IsQ0FBQyxTQUFvQixFQUFFLFNBQWlCO0lBQ3RFLE1BQU0sT0FBTyxHQUFhLEVBQUUsQ0FBQTtJQUM1QixNQUFNLElBQUksR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFBO0lBRTNCLHFDQUFxQztJQUNyQyxNQUFNLE1BQU0sR0FBRyxZQUFZLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQTtJQUNwRixPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBRXBCLE9BQU8sT0FBTyxDQUFDLE1BQU0sR0FBRyxTQUFTLEVBQUU7UUFDL0IsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUNsRSxNQUFNLFNBQVMsR0FBRyxXQUFXLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFBO1FBQzNDLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUE7S0FDMUI7SUFFRCwrQkFBK0I7SUFDL0IsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUE7SUFDakssTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsU0FBUyxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUE7SUFFdkUsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEVBQUU7UUFDckMsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ3pCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRTtZQUM1QyxjQUFjLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQTtTQUN4QztLQUNKO0lBRUQsT0FBTyxDQUFDLE9BQU8sRUFBRSxjQUFjLENBQUMsQ0FBQTtBQUNwQyxDQUFDO0FBRUQsTUFBTSxVQUFVLGtCQUFrQixDQUFDLFNBQW9CLEVBQUUsbUJBQTJCLEVBQUUsU0FBaUI7SUFDbkcsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsU0FBUyxDQUFBO0lBQ3pDLE1BQU0sTUFBTSxHQUFHLEtBQUssR0FBRyxNQUFNLENBQUE7SUFDN0IsTUFBTSxXQUFXLEdBQUcsbUJBQW1CLEdBQUcsbUJBQW1CLENBQUE7SUFDN0QsTUFBTSxVQUFVLEdBQUcsV0FBVyxHQUFHLG1CQUFtQixDQUFBO0lBRXBELHVCQUF1QjtJQUN2QixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQTZCLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUU5RywwQ0FBMEM7SUFDMUMsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUU7UUFDNUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUE7UUFDM0IsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFBO1FBQy9CLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQTtRQUMvQixNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLG1CQUFtQixDQUFDLEVBQUUsbUJBQW1CLEdBQUcsQ0FBQyxDQUFDLENBQUE7UUFDakYsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxtQkFBbUIsQ0FBQyxFQUFFLG1CQUFtQixHQUFHLENBQUMsQ0FBQyxDQUFBO1FBQ2pGLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsbUJBQW1CLENBQUMsRUFBRSxtQkFBbUIsR0FBRyxDQUFDLENBQUMsQ0FBQTtRQUNqRixNQUFNLFNBQVMsR0FBRyxFQUFFLEdBQUcsV0FBVyxHQUFHLEVBQUUsR0FBRyxtQkFBbUIsR0FBRyxFQUFFLENBQUE7UUFDbEUsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFBO1FBQ2pDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDOUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFBO1FBQ2YsT0FBTyxNQUFNLENBQUE7SUFDakIsQ0FBQyxDQUFDLENBQUE7SUFFRiwwQkFBMEI7SUFDMUIsS0FBSyxNQUFNLE1BQU0sSUFBSSxPQUFPLEVBQUU7UUFDMUIsTUFBTSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUE7S0FDckQ7SUFFRCxNQUFNLFVBQVUsR0FBRyxPQUFPO1NBQ3JCLElBQUksQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQztTQUN2QyxLQUFLLENBQUMsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxDQUFBO0lBRXhCLE1BQU0sU0FBUyxHQUFHLElBQUksR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFBO0lBRXJDLGtDQUFrQztJQUNsQyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsYUFBYSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRTtRQUMzQyxJQUFJLFNBQVMsQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUU7WUFDakMsU0FBUTtTQUNYO1FBRUQsK0JBQStCO1FBQy9CLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFBO1FBQzNCLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFBO1FBQzNCLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFBO1FBQzNCLE1BQU0sS0FBSyxHQUE2QixDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDakQsTUFBTSxNQUFNLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxHQUFHLFVBQVUsQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ2pILGFBQWEsQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUE7S0FDNUI7SUFFRCwyQkFBMkI7SUFDM0IsTUFBTSxPQUFPLEdBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUE7SUFDekQsTUFBTSxjQUFjLEdBQUcsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUVqRSxPQUFPLENBQUMsT0FBTyxFQUFFLGNBQWMsQ0FBQyxDQUFBO0FBQ3BDLENBQUM7QUFFRCxNQUFNLFVBQVUsWUFBWSxDQUFDLE9BQWdCLEVBQUUsY0FBd0IsRUFBRSxTQUFvQjtJQUN6RixNQUFNLElBQUksR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFBO0lBQzNCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxjQUFjLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUFFO1FBQzVDLHFCQUFxQjtRQUNyQixNQUFNLEdBQUcsR0FBRyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDN0IsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDLEVBQUU7WUFDWCxTQUFRO1NBQ1g7UUFFRCxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDMUIsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDdEIsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQzFCLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQTtLQUM3QjtBQUNMLENBQUM7QUFHRCxTQUFTLFlBQVksQ0FBQyxJQUF1QixFQUFFLE9BQWlCO0lBQzVELElBQUksT0FBTyxDQUFDLE1BQU0sSUFBSSxDQUFDLEVBQUU7UUFDckIsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFBO0tBQzFEO0lBRUQsTUFBTSxNQUFNLEdBQVc7UUFDbkIsT0FBTyxFQUFFLE9BQU87UUFDaEIsU0FBUyxFQUFFLElBQUksQ0FBQyxJQUFJO1FBQ3BCLEtBQUssRUFBRSxDQUFDO0tBQ1gsQ0FBQTtJQUVELFlBQVksQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFDMUIsT0FBTyxNQUFNLENBQUE7QUFDakIsQ0FBQztBQUVELFNBQVMsWUFBWSxDQUFDLElBQXVCLEVBQUUsTUFBYztJQUN6RCxNQUFNLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQTtJQUNoQixNQUFNLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUE7SUFFNUIsSUFBSSxJQUFJLEdBQUcsUUFBUSxDQUFBO0lBQ25CLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFBO0lBQ2IsSUFBSSxJQUFJLEdBQUcsUUFBUSxDQUFBO0lBQ25CLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFBO0lBQ2IsSUFBSSxJQUFJLEdBQUcsUUFBUSxDQUFBO0lBQ25CLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFBO0lBRWIsS0FBSyxNQUFNLENBQUMsSUFBSSxNQUFNLENBQUMsT0FBTyxFQUFFO1FBQzVCLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7UUFDckIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7UUFDekIsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7UUFDekIsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFBO1FBQ3hCLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUN4QixJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFDeEIsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFBO1FBQ3hCLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUN4QixJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUE7S0FDM0I7SUFFRCxNQUFNLEVBQUUsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFBO0lBQ3RCLE1BQU0sRUFBRSxHQUFHLElBQUksR0FBRyxJQUFJLENBQUE7SUFDdEIsTUFBTSxFQUFFLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQTtJQUN0QixNQUFNLENBQUMsS0FBSyxHQUFH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QUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUNyQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7S0FDbkQ7SUFFRCxPQUFPLE1BQU0sQ0FBQTtBQUNqQixDQUFDO0FBRUQsTUFBTSxVQUFVLGFBQWEsQ0FBQyxLQUFZO0lBQ3RDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQTtJQUN2QixNQUFNLENBQUMsR0FBRyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQTtJQUN0RSxPQUFPLENBQUMsQ0FBQTtBQUNaLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyB1dGlsIGZyb20gXCIuLi9zaGFyZWQvdXRpbC5qc1wiXHJcblxyXG5lbnVtIEF4aXMgeyBOb25lLCBYLCBZLCBaIH1cclxuXHJcbmludGVyZmFjZSBCdWNrZXQge1xyXG4gICAgaW5kaWNlczogbnVtYmVyW11cclxuICAgIHJhbmdlOiBudW1iZXJcclxuICAgIHNwbGl0QXhpczogQXhpc1xyXG59XHJcblxyXG5leHBvcnQgdHlwZSBDb2xvciA9IFtudW1iZXIsIG51bWJlciwgbnVtYmVyXVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHBhbGV0dGl6ZU1lZGlhbkN1dChpbWFnZURhdGE6IEltYWdlRGF0YSwgbWF4Q29sb3JzOiBudW1iZXIpOiBbQ29sb3JbXSwgbnVtYmVyW11dIHtcclxuICAgIGNvbnN0IGJ1Y2tldHM6IEJ1Y2tldFtdID0gW11cclxuICAgIGNvbnN0IGRhdGEgPSBpbWFnZURhdGEuZGF0YVxyXG5cclxuICAgIC8vIHBsYWNlIGFsbCBjb2xvcnMgaW4gaW5pdGlhbCBidWNrZXRcclxuICAgIGNvbnN0IGJ1Y2tldCA9IGNyZWF0ZUJ1Y2tldChkYXRhLCB1dGlsLnNlcXVlbmNlKGltYWdlRGF0YS53aWR0aCAqIGltYWdlRGF0YS5oZWlnaHQpKVxyXG4gICAgYnVja2V0cy5wdXNoKGJ1Y2tldClcclxuXHJcbiAgICB3aGlsZSAoYnVja2V0cy5sZW5ndGggPCBtYXhDb2xvcnMpIHtcclxuICAgICAgICBjb25zdCBidWNrZXQgPSBidWNrZXRzLnJlZHVjZSgoeCwgeSkgPT4geC5yYW5nZSA+IHkucmFuZ2UgPyB4IDogeSlcclxuICAgICAgICBjb25zdCBuZXdCdWNrZXQgPSBzcGxpdEJ1Y2tldChkYXRhLCBidWNrZXQpXHJcbiAgICAgICAgYnVja2V0cy5wdXNoKG5ld0J1Y2tldClcclxuICAgIH1cclxuXHJcbiAgICAvLyBjaG9vc2UgY29sb3IgZm9yIGVhY2ggYnVja2V0XHJcbiAgICBjb25zdCBwYWxldHRlID0gYnVja2V0cy5tYXAoYiA9PiBkaXZYWVooYi5pbmRpY2VzLnJlZHVjZSgoeHl6LCBpKSA9PiBhZGRYWVooeHl6LCBbZGF0YVtpICogNF0sIGRhdGFbaSAqIDQgKyAxXSwgZGF0YVtpICogNCArIDJdXSksIFswLCAwLCAwXSksIGIuaW5kaWNlcy5sZW5ndGgpKVxyXG4gICAgY29uc3QgcGFsZXR0ZU92ZXJsYXkgPSB1dGlsLmZpbGwoMCwgaW1hZ2VEYXRhLndpZHRoICogaW1hZ2VEYXRhLmhlaWdodClcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ1Y2tldHMubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICBjb25zdCBidWNrZXQgPSBidWNrZXRzW2ldXHJcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBidWNrZXQuaW5kaWNlcy5sZW5ndGg7ICsraikge1xyXG4gICAgICAgICAgICBwYWxldHRlT3ZlcmxheVtidWNrZXQuaW5kaWNlc1tqXV0gPSBpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBbcGFsZXR0ZSwgcGFsZXR0ZU92ZXJsYXldXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwYWxldHRpemVIaXN0b2dyYW0oaW1hZ2VEYXRhOiBJbWFnZURhdGEsIGJ1Y2tldHNQZXJDb21wb25lbnQ6IG51bWJlciwgbWF4Q29sb3JzOiBudW1iZXIpOiBbQ29sb3JbXSwgbnVtYmVyW11dIHtcclxuICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCwgZGF0YSB9ID0gaW1hZ2VEYXRhXHJcbiAgICBjb25zdCBwaXhlbHMgPSB3aWR0aCAqIGhlaWdodFxyXG4gICAgY29uc3QgYnVja2V0UGl0Y2ggPSBidWNrZXRzUGVyQ29tcG9uZW50ICogYnVja2V0c1BlckNvbXBvbmVudFxyXG4gICAgY29uc3QgbnVtQnVja2V0cyA9IGJ1Y2tldFBpdGNoICogYnVja2V0c1BlckNvbXBvbmVudFxyXG5cclxuICAgIC8vIGNyZWF0IGludGlhbCBidWNrZXRzXHJcbiAgICBjb25zdCBidWNrZXRzID0gdXRpbC5nZW5lcmF0ZShudW1CdWNrZXRzLCAoKSA9PiAoeyBjb2xvcjogWzAsIDAsIDBdIGFzIFtudW1iZXIsIG51bWJlciwgbnVtYmVyXSwgcGl4ZWxzOiAwIH0pKVxyXG5cclxuICAgIC8vIGFzc2lnbiBhbmQgdXBkYXRlIGJ1Y2tldCBmb3IgZWFjaCBwaXhlbFxyXG4gICAgY29uc3QgYnVja2V0T3ZlcmxheSA9IHV0aWwuZ2VuZXJhdGUocGl4ZWxzLCBpID0+IHtcclxuICAgICAgICBjb25zdCByID0gZGF0YVtpICogNF0gLyAyNTVcclxuICAgICAgICBjb25zdCBnID0gZGF0YVtpICogNCArIDFdIC8gMjU1XHJcbiAgICAgICAgY29uc3QgYiA9IGRhdGFbaSAqIDQgKyAyXSAvIDI1NVxyXG4gICAgICAgIGNvbnN0IHJiID0gTWF0aC5taW4oTWF0aC5mbG9vcihyICogYnVja2V0c1BlckNvbXBvbmVudCksIGJ1Y2tldHNQZXJDb21wb25lbnQgLSAxKVxyXG4gICAgICAgIGNvbnN0IGdiID0gTWF0aC5taW4oTWF0aC5mbG9vcihnICogYnVja2V0c1BlckNvbXBvbmVudCksIGJ1Y2tldHNQZXJDb21wb25lbnQgLSAxKVxyXG4gICAgICAgIGNvbnN0IGJiID0gTWF0aC5taW4oTWF0aC5mbG9vcihiICogYnVja2V0c1BlckNvbXBvbmVudCksIGJ1Y2tldHNQZXJDb21wb25lbnQgLSAxKVxyXG4gICAgICAgIGNvbnN0IGJ1Y2tldElkeCA9IHJiICogYnVja2V0UGl0Y2ggKyBnYiAqIGJ1Y2tldHNQZXJDb21wb25lbnQgKyBiYlxyXG4gICAgICAgIGNvbnN0IGJ1Y2tldCA9IGJ1Y2tldHNbYnVja2V0SWR4XVxyXG4gICAgICAgIGJ1Y2tldC5jb2xvciA9IGFkZFhZWihbciwgZywgYl0sIGJ1Y2tldC5jb2xvcilcclxuICAgICAgICBidWNrZXQucGl4ZWxzKytcclxuICAgICAgICByZXR1cm4gYnVja2V0XHJcbiAgICB9KVxyXG5cclxuICAgIC8vIGNhbGN1bGF0ZSBidWNrZXQgY29sb3JzXHJcbiAgICBmb3IgKGNvbnN0IGJ1Y2tldCBvZiBidWNrZXRzKSB7XHJcbiAgICAgICAgYnVja2V0LmNvbG9yID0gZGl2WFlaKGJ1Y2tldC5jb2xvciwgYnVja2V0LnBpeGVscylcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB0b3BCdWNrZXRzID0gYnVja2V0c1xyXG4gICAgICAgIC5zb3J0KChiMSwgYjIpID0+IGIyLnBpeGVscyAtIGIxLnBpeGVscylcclxuICAgICAgICAuc2xpY2UoMCwgbWF4Q29sb3JzKVxyXG5cclxuICAgIGNvbnN0IGJ1Y2tldFNldCA9IG5ldyBTZXQodG9wQnVja2V0cylcclxuXHJcbiAgICAvLyBtYXAgYWxsIGNvbG9ycyB0byB0b3AgTiBidWNrZXRzXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ1Y2tldE92ZXJsYXkubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICBpZiAoYnVja2V0U2V0LmhhcyhidWNrZXRPdmVybGF5W2ldKSkge1xyXG4gICAgICAgICAgICBjb250aW51ZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gb3RoZXJ3aXNlLCBtYXAgdG8gbmV3IGJ1Y2tldFxyXG4gICAgICAgIGNvbnN0IHIgPSBkYXRhW2kgKiA0XSAvIDI1NVxyXG4gICAgICAgIGNvbnN0IGcgPSBkYXRhW2kgKiA0XSAvIDI1NVxyXG4gICAgICAgIGNvbnN0IGIgPSBkYXRhW2kgKiA0XSAvIDI1NVxyXG4gICAgICAgIGNvbnN0IGNvbG9yOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlcl0gPSBbciwgZywgYl1cclxuICAgICAgICBjb25zdCBidWNrZXQgPSB0b3BCdWNrZXRzLnJlZHVjZSgoYjEsIGIyKSA9PiBjYWxjRGlzdFNxKGIxLmNvbG9yLCBjb2xvcikgPCBjYWxjRGlzdFNxKGIyLmNvbG9yLCBjb2xvcikgPyBiMSA6IGIyKVxyXG4gICAgICAgIGJ1Y2tldE92ZXJsYXlbaV0gPSBidWNrZXRcclxuICAgIH1cclxuXHJcbiAgICAvLyBkZXRlcm1pbmUgcGFsZXR0ZSBjb2xvcnNcclxuICAgIGNvbnN0IHBhbGV0dGUgPSB0b3BCdWNrZXRzLm1hcChiID0+IG11bFhZWihiLmNvbG9yLCAyNTUpKVxyXG4gICAgY29uc3QgcGFsZXR0ZU92ZXJsYXkgPSBidWNrZXRPdmVybGF5Lm1hcChiID0+IGJ1Y2tldHMuaW5kZXhPZihiKSlcclxuXHJcbiAgICByZXR1cm4gW3BhbGV0dGUsIHBhbGV0dGVPdmVybGF5XVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYXBwbHlQYWxldHRlKHBhbGV0dGU6IENvbG9yW10sIHBhbGxldGVPdmVybGF5OiBudW1iZXJbXSwgaW1hZ2VEYXRhOiBJbWFnZURhdGEpIHtcclxuICAgIGNvbnN0IGRhdGEgPSBpbWFnZURhdGEuZGF0YVxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWxsZXRlT3ZlcmxheS5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgIC8vIGlnbm9yZSBpbmRleCBvZiAtMVxyXG4gICAgICAgIGNvbnN0IGlkeCA9IHBhbGxldGVPdmVybGF5W2ldXHJcbiAgICAgICAgaWYgKGlkeCA9PSAtMSkge1xyXG4gICAgICAgICAgICBjb250aW51ZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgY29sb3IgPSBwYWxldHRlW2lkeF1cclxuICAgICAgICBkYXRhW2kgKiA0XSA9IGNvbG9yWzBdXHJcbiAgICAgICAgZGF0YVtpICogNCArIDFdID0gY29sb3JbMV1cclxuICAgICAgICBkYXRhW2kgKiA0ICsgMl0gPSBjb2xvclsyXVxyXG4gICAgfVxyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gY3JlYXRlQnVja2V0KGRhdGE6IFVpbnQ4Q2xhbXBlZEFycmF5LCBpbmRpY2VzOiBudW1iZXJbXSk6IEJ1Y2tldCB7XHJcbiAgICBpZiAoaW5kaWNlcy5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImJ1Y2tldCBtdXN0IGNvbnRhaW4gYXQgbGVhc3QgMSB2YWx1ZVwiKVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGJ1Y2tldDogQnVja2V0ID0ge1xyXG4gICAgICAgIGluZGljZXM6IGluZGljZXMsXHJcbiAgICAgICAgc3BsaXRBeGlzOiBBeGlzLk5vbmUsXHJcbiAgICAgICAgcmFuZ2U6IDBcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVCdWNrZXQoZGF0YSwgYnVja2V0KVxyXG4gICAgcmV0dXJuIGJ1Y2tldFxyXG59XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVCdWNrZXQoZGF0YTogVWludDhDbGFtcGVkQXJyYXksIGJ1Y2tldDogQnVja2V0KSB7XHJcbiAgICBidWNrZXQucmFuZ2UgPSAwXHJcbiAgICBidWNrZXQuc3BsaXRBeGlzID0gQXhpcy5Ob25lXHJcblxyXG4gICAgbGV0IG1pblggPSBJbmZpbml0eVxyXG4gICAgbGV0IG1heFggPSAtMVxyXG4gICAgbGV0IG1pblkgPSBJbmZpbml0eVxyXG4gICAgbGV0IG1heFkgPSAtMVxyXG4gICAgbGV0IG1pblogPSBJbmZpbml0eVxyXG4gICAgbGV0IG1heFogPSAtMVxyXG5cclxuICAgIGZvciAoY29uc3QgaSBvZiBidWNrZXQuaW5kaWNlcykge1xyXG4gICAgICAgIGNvbnN0IHggPSBkYXRhW2kgKiA0XVxyXG4gICAgICAgIGNvbnN0IHkgPSBkYXRhW2kgKiA0ICsgMV1cclxuICAgICAgICBjb25zdCB6ID0gZGF0YVtpICogNCArIDJdXHJcbiAgICAgICAgbWluWCA9IE1hdGgubWluKHgsIG1pblgpXHJcbiAgICAgICAgbWF4WCA9IE1hdGgubWF4KHgsIG1heFgpXHJcbiAgICAgICAgbWluWSA9IE1hdGgubWluKHksIG1pblkpXHJcbiAgICAgICAgbWF4WSA9IE1hdGgubWF4KHksIG1heFkpXHJcbiAgICAgICAgbWluWiA9IE1hdGgubWluKHosIG1pblopXHJcbiAgICAgICAgbWF4WiA9IE1hdGgubWF4KHosIG1heFopXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZHggPSBtYXhYIC0gbWluWFxyXG4gICAgY29uc3QgZHkgPSBtYXhZIC0gbWluWVxyXG4gICAgY29uc3QgZHogPSBtYXhaIC0gbWluWlxyXG4gICAgYnVja2V0LnJhbmdlID0gTWF0aC5tYXgoZHgsIGR5LCBkeilcclxuXHJcbiAgICBpZiAoYnVja2V0LnJhbmdlID09PSBkeCkge1xyXG4gICAgICAgIGJ1Y2tldC5zcGxpdEF4aXMgPSBBeGlzLlhcclxuICAgIH0gZWxzZSBpZiAoYnVja2V0LnJhbmdlID09PSBkeSkge1xyXG4gICAgICAgIGJ1Y2tldC5zcGxpdEF4aXMgPSBBeGlzLllcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYnVja2V0LnNwbGl0QXhpcyA9IEF4aXMuWlxyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBzcGxpdEJ1Y2tldChkYXRhOiBVaW50OENsYW1wZWRBcnJheSwgYnVja2V0OiBCdWNrZXQpOiBCdWNrZXQge1xyXG4gICAgaWYgKGJ1Y2tldC5pbmRpY2VzLmxlbmd0aCA8PSAxKSB7XHJcbiAgICAgICAgdGhyb3cgRXJyb3IoXCJCdWNrZXQgbXVzdCA+IDEgZWxlbWVudCB0byBzcGxpdFwiKVxyXG4gICAgfVxyXG5cclxuICAgIC8vIGRldGVybWluZSBjb21wb25lbnQgd2l0aCBtYXggcmFuZ2UgaW4gYnVja2V0XHJcbiAgICBzd2l0Y2ggKGJ1Y2tldC5zcGxpdEF4aXMpIHtcclxuICAgICAgICBjYXNlIEF4aXMuWDpcclxuICAgICAgICAgICAgYnVja2V0LmluZGljZXMuc29ydCgoYSwgYikgPT4gZGF0YVthICogNF0gLSBkYXRhW2IgKiA0XSlcclxuICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICBjYXNlIEF4aXMuWTpcclxuICAgICAgICAgICAgYnVja2V0LmluZGljZXMuc29ydCgoYSwgYikgPT4gZGF0YVthICogNCArIDFdIC0gZGF0YVtiICogNCArIDFdKVxyXG4gICAgICAgICAgICBicmVha1xyXG4gICAgICAgIGNhc2UgQXhpcy5aOlxyXG4gICAgICAgICAgICBidWNrZXQuaW5kaWNlcy5zb3J0KChhLCBiKSA9PiBkYXRhW2EgKiA0ICsgMl0gLSBkYXRhW2IgKiA0ICsgMl0pXHJcbiAgICAgICAgICAgIGJyZWFrXHJcblxyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc3BsaXQgYXhpc1wiKVxyXG4gICAgICAgICAgICBicmVha1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGxlZnQgaGFsZiBvZiBhcnJheSBzdGF5cyBpbiBidWNrZXRcclxuICAgIC8vIHJpZ2h0IGhhbGYgbW92ZXMgdG8gbmV3IGJ1Y2tldFxyXG4gICAgY29uc3QgbWVkaWFuSWR4ID0gTWF0aC5mbG9vcihidWNrZXQuaW5kaWNlcy5sZW5ndGggLyAyKVxyXG4gICAgY29uc3QgbmV3SW5kaWNlcyA9IGJ1Y2tldC5pbmRpY2VzLnNwbGljZShtZWRpYW5JZHgsIGJ1Y2tldC5pbmRpY2VzLmxlbmd0aCAtIG1lZGlhbklkeClcclxuICAgIGNvbnN0IG5ld0J1Y2tldCA9IGNyZWF0ZUJ1Y2tldChkYXRhLCBuZXdJbmRpY2VzKVxyXG4gICAgdXBkYXRlQnVja2V0KGRhdGEsIGJ1Y2tldClcclxuICAgIHJldHVybiBuZXdCdWNrZXRcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG11bFhZWih4eXo6IENvbG9yLCBzOiBudW1iZXIpOiBDb2xvciB7XHJcbiAgICBjb25zdCBbeCwgeSwgel0gPSB4eXpcclxuICAgIHJldHVybiBbeCAqIHMsIHkgKiBzLCB6ICogc11cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRpdlhZWih4eXo6IENvbG9yLCBzOiBudW1iZXIpOiBDb2xvciB7XHJcbiAgICBjb25zdCBbeCwgeSwgel0gPSB4eXpcclxuICAgIHJldHVybiBbeCAvIHMsIHkgLyBzLCB6IC8gc11cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGFkZFhZWih4eXoxOiBDb2xvciwgeHl6MjogQ29sb3IpOiBDb2xvciB7XHJcbiAgICByZXR1cm4gW3h5ejFbMF0gKyB4eXoyWzBdLCB4eXoxWzFdICsgeHl6MlsxXSwgeHl6MVsyXSArIHh5ejJbMl1dXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBlcXVhbFhZWih4eXoxOiBDb2xvciwgeHl6MjogQ29sb3IpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB4eXoxWzBdID09PSB4eXoyWzBdICYmIHh5ejFbMV0gPT09IHh5ejJbMV0gJiYgeHl6MVsyXSA9PT0geHl6MlsyXVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2FsY0Rpc3RTcSh4eXoxOiBDb2xvciwgeHl6MjogQ29sb3IpOiBudW1iZXIge1xyXG4gICAgY29uc3QgW3gxLCB5MSwgejFdID0geHl6MVxyXG4gICAgY29uc3QgW3gyLCB5MiwgejJdID0geHl6MlxyXG4gICAgY29uc3QgZHggPSB4MiAtIHgxXHJcbiAgICBjb25zdCBkeSA9IHkyIC0geTFcclxuICAgIGNvbnN0IGR6ID0gejIgLSB6MVxyXG4gICAgY29uc3QgZGlzdFNxID0gZHggKiBkeCArIGR5ICogZHkgKyBkeiAqIGR6XHJcbiAgICByZXR1cm4gZGlzdFNxXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzY2FuSW1hZ2VEYXRhKGltYWdlRGF0YTogSW1hZ2VEYXRhLCBmOiAoeDogbnVtYmVyLCB5OiBudW1iZXIsIG9mZnNldDogbnVtYmVyKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGltYWdlRGF0YVxyXG4gICAgc2Nhbih3aWR0aCwgaGVpZ2h0LCBmKVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2Nhbih3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgZjogKHg6IG51bWJlciwgeTogbnVtYmVyLCBvZmZzZXQ6IG51bWJlcikgPT4gdm9pZCk6IHZvaWQge1xyXG4gICAgZm9yIChsZXQgeSA9IDA7IHkgPCBoZWlnaHQ7ICsreSkge1xyXG4gICAgICAgIGNvbnN0IHlPZmZzZXQgPSB5ICogd2lkdGhcclxuICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyArK3gpIHtcclxuICAgICAgICAgICAgY29uc3QgeE9mZnNldCA9IHlPZmZzZXQgKyB4XHJcbiAgICAgICAgICAgIGYoeCwgeSwgeE9mZnNldClcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzY2FuUmVnaW9uKHgwOiBudW1iZXIsIHkwOiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCByb3dQaXRjaDogbnVtYmVyLCBmOiAoeDogbnVtYmVyLCB5OiBudW1iZXIsIG9mZnNldDogbnVtYmVyKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICBjb25zdCB4MSA9IHgwICsgd2lkdGhcclxuICAgIGNvbnN0IHkxID0geTAgKyBoZWlnaHRcclxuICAgIGZvciAobGV0IHkgPSB5MDsgeSA8IHkxOyArK3kpIHtcclxuICAgICAgICBjb25zdCB5T2Zmc2V0ID0geSAqIHJvd1BpdGNoXHJcbiAgICAgICAgZm9yIChsZXQgeCA9IHgwOyB4IDwgeDE7ICsreCkge1xyXG4gICAgICAgICAgICBjb25zdCB4T2Zmc2V0ID0geU9mZnNldCArIHhcclxuICAgICAgICAgICAgZih4LCB5LCB4T2Zmc2V0KVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNjYW5Sb3dzKHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBmOiAoeTogbnVtYmVyLCBvZmZzZXQ6IG51bWJlcikgPT4gdm9pZCkge1xyXG4gICAgZm9yIChsZXQgeSA9IDA7IHkgPCBoZWlnaHQ7ICsreSkge1xyXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IHkgKiB3aWR0aFxyXG4gICAgICAgIGYoeSwgb2Zmc2V0KVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2NhblJvd3NSZWdpb24oeTA6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIHJvd1BpdGNoOiBudW1iZXIsIGY6ICh5OiBudW1iZXIsIG9mZnNldDogbnVtYmVyKSA9PiB2b2lkKSB7XHJcbiAgICBjb25zdCB5MSA9IHkwICsgaGVpZ2h0XHJcbiAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHkxOyArK3kpIHtcclxuICAgICAgICBjb25zdCBvZmZzZXQgPSB5ICogcm93UGl0Y2hcclxuICAgICAgICBmKHksIG9mZnNldClcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJnYjJ4eXoocmdiOiBDb2xvcik6IENvbG9yIHtcclxuICAgIGxldCBbciwgYiwgZ10gPSByZ2JcclxuICAgIHIgLz0gMjU1LjBcclxuICAgIGcgLz0gMjU1LjBcclxuICAgIGIgLz0gMjU1LjBcclxuXHJcbiAgICBjb25zdCB4ID0gciAqIDAuNDEyNDU2NCArIGcgKiAwLjM1NzU3NjEgKyBiICogMC4xODA0Mzc1XHJcbiAgICBjb25zdCB5ID0gciAqIDAuMjEyNjcyOSArIGcgKiAwLjcxNTE1MjIgKyBiICogMC4wNzIxNzUwXHJcbiAgICBjb25zdCB6ID0gciAqIDAuMDE5MzMzOSArIGcgKiAwLjExOTE5MjAgKyBiICogMC45NTAzMDQxXHJcbiAgICByZXR1cm4gW3gsIHksIHpdXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB4eXoycmdiKHh5ejogQ29sb3IpOiBDb2xvciB7XHJcbiAgICBjb25zdCBbeCwgeSwgel0gPSB4eXpcclxuICAgIGNvbnN0IHIgPSAoeCAqIDMuMjQwNDU0MiArIHkgKiAtMS41MzcxMzg1ICsgeiAqIC0wLjQ5ODUzMTQpICogMjU1XHJcbiAgICBjb25zdCBnID0gKHggKiAtMC45NjkyNjYwICsgeSAqIDEuODc2MDEwOCArIHogKiAwLjA0MTU1NjApICogMjU1XHJcbiAgICBjb25zdCBiID0gKHggKiAwLjA1NTY0MzQgKyB5ICogLTAuMjA0MDI1OSArIHogKiAxLjA1NzIyNTIpICogMjU1XHJcbiAgICByZXR1cm4gW3IsIGcsIGJdXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBsaW5lYXIoeDogbnVtYmVyKSB7XHJcbiAgICBpZiAoeCA8PSAuMDQwNDUpIHtcclxuICAgICAgICByZXR1cm4geCAvIDEyLjkyXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIE1hdGgucG93KCgoeCArIC4wNTUpIC8gMS4wNTUpLCAyLjQpXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpbWFnZURhdGEyUkdCQXJyYXkoZGF0YTogVWludDhDbGFtcGVkQXJyYXkpOiBDb2xvcltdIHtcclxuICAgIGNvbnN0IHJlc3VsdDogQ29sb3JbXSA9IFtdXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpICs9IDQpIHtcclxuICAgICAgICByZXN1bHQucHVzaChbZGF0YVtpXSwgZGF0YVtpICsgMV0sIGRhdGFbaSArIDJdXSlcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzdWx0XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjYWxjTHVtaW5hbmNlKGNvbG9yOiBDb2xvcikge1xyXG4gICAgY29uc3QgW3IsIGcsIGJdID0gY29sb3JcclxuICAgIGNvbnN0IGwgPSAwLjIxMjYgKiAociAvIDI1NSkgKyAwLjcxNTIgKiAoZyAvIDI1NSkgKyAwLjA3MjIgKiAoYiAvIDI1NSlcclxuICAgIHJldHVybiBsXHJcbn0iXX0=