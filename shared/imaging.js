export function quantMedianCut(ctx, maxColors, tolerance) {
    const imgData = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
    const { width, height, data } = imgData;
    const rowPitch = width * 4;
    const buckets = new Array();
    buckets.push(createInitialBucket());
    while (true) {
        const bucket = chooseBucket(tolerance, buckets);
        if (!bucket) {
            break;
        }
        buckets.push(splitBucket(bucket));
        if (buckets.length >= maxColors) {
            break;
        }
    }
    // calculate the average color for each bucket
    const colors = new Array();
    for (const bucket of buckets) {
        let r = 0;
        let g = 0;
        let b = 0;
        for (const pixel of bucket) {
            r += pixel.r;
            g += pixel.g;
            b += pixel.b;
        }
        r /= bucket.length;
        g /= bucket.length;
        b /= bucket.length;
        colors.push([Math.round(r), Math.round(g), Math.round(b)]);
    }
    // iterate through each bucket, replacing pixel color with bucket color for each pixel
    for (let i = 0; i < buckets.length; ++i) {
        const bucket = buckets[i];
        const [r, g, b] = colors[i];
        for (const pixel of bucket) {
            const offset = pixel.offset * 4;
            data[offset] = r;
            data[offset + 1] = g;
            data[offset + 2] = b;
        }
    }
    ctx.putImageData(imgData, 0, 0);
    function createInitialBucket() {
        // create initial bucket
        const bucket = new Array();
        for (let y = 0; y < height; ++y) {
            const yOffset = y * rowPitch;
            for (let x = 0; x < width; ++x) {
                const offset = yOffset + x * 4;
                const r = data[offset];
                const g = data[offset + 1];
                const b = data[offset + 2];
                // pack into bucket
                const pixel = {
                    offset: flat(x, y, width),
                    r: r,
                    g: g,
                    b: b
                };
                bucket.push(pixel);
            }
        }
        return bucket;
    }
    function calcRange(pixels, selector) {
        let min = Infinity;
        let max = -Infinity;
        for (const pixel of pixels) {
            min = Math.min(selector(pixel), min);
            max = Math.max(selector(pixel), max);
        }
        return max - min;
    }
    function chooseBucket(tolerance, buckets) {
        let maxRange = -Infinity;
        let maxBucket = null;
        for (const bucket of buckets) {
            const rangeR = calcRange(bucket, p => p.r);
            const rangeG = calcRange(bucket, p => p.g);
            const rangeB = calcRange(bucket, p => p.b);
            let range = 0;
            if (rangeR > rangeG && rangeR > rangeB) {
                range = rangeR;
            }
            else if (rangeG > rangeR) {
                range = rangeG;
            }
            else {
                range = rangeB;
            }
            if (range > maxRange) {
                maxRange = range;
                maxBucket = bucket;
            }
        }
        return maxRange > tolerance ? maxBucket : null;
    }
    function splitBucket(bucket) {
        const rangeR = calcRange(bucket, p => p.r);
        const rangeG = calcRange(bucket, p => p.g);
        const rangeB = calcRange(bucket, p => p.b);
        if (rangeR > rangeG && rangeR > rangeB) {
            bucket.sort((a, b) => a.r - b.r);
        }
        else if (rangeG > rangeR) {
            bucket.sort((a, b) => a.g - b.g);
        }
        else {
            bucket.sort((a, b) => a.b - b.b);
        }
        const middle = Math.floor(bucket.length / 2);
        const newBucket = bucket.splice(middle);
        return newBucket;
    }
}
export function scanImageData(imageData, f) {
    const { width, height } = imageData;
    scan(width, height, f);
}
export function scan(width, height, f) {
    for (let y = 0; y < height; ++y) {
        const yOffset = y * width;
        for (let x = 0; x < width; ++x) {
            const xOffset = yOffset + x;
            f(x, y, xOffset);
        }
    }
}
export function generate(width, height, f) {
    const a = new Array();
    scan(width, height, (x, y) => {
        a.push(f(x, y));
    });
    return a;
}
export function scanRegion(x0, y0, width, height, rowPitch, f) {
    const x1 = x0 + width;
    const y1 = y0 + height;
    for (let y = y0; y < y1; ++y) {
        const yOffset = y * rowPitch;
        for (let x = x0; x < x1; ++x) {
            const xOffset = yOffset + x;
            f(x, y, xOffset);
        }
    }
}
export function scanRows(width, height, f) {
    for (let y = 0; y < height; ++y) {
        const offset = y * width;
        f(y, offset);
    }
}
export function scanRowsRegion(y0, height, rowPitch, f) {
    const y1 = y0 + height;
    for (let y = 0; y < y1; ++y) {
        const offset = y * rowPitch;
        f(y, offset);
    }
}
export function calcLuminance(color) {
    const [r, g, b] = color;
    const l = 0.2126 * (r / 255) + 0.7152 * (g / 255) + 0.0722 * (b / 255);
    return l;
}
export function copyImageData(imageData) {
    return new ImageData(new Uint8ClampedArray(imageData.data), imageData.width, imageData.height);
}
export function canvas2Blob(canvas, type, quality) {
    return new Promise((resolve, reject) => {
        canvas.toBlob((blob) => {
            if (blob) {
                resolve(blob);
            }
            else {
                reject(new Error("toBlob returned null"));
            }
        }, type, quality);
    });
}
export function flat(x, y, rowPitch) {
    return y * rowPitch + x;
}
export function unflat(i, rowPitch) {
    return [i % rowPitch, Math.floor(i / rowPitch)];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2luZy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImltYWdpbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTSxVQUFVLGNBQWMsQ0FBQyxHQUE2QixFQUFFLFNBQWlCLEVBQUUsU0FBaUI7SUFROUYsTUFBTSxPQUFPLEdBQUcsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUE7SUFDM0UsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsT0FBTyxDQUFBO0lBQ3ZDLE1BQU0sUUFBUSxHQUFHLEtBQUssR0FBRyxDQUFDLENBQUE7SUFFMUIsTUFBTSxPQUFPLEdBQUcsSUFBSSxLQUFLLEVBQVcsQ0FBQTtJQUNwQyxPQUFPLENBQUMsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQTtJQUVuQyxPQUFPLElBQUksRUFBRTtRQUNULE1BQU0sTUFBTSxHQUFHLFlBQVksQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUE7UUFDL0MsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNULE1BQUs7U0FDUjtRQUVELE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUE7UUFDakMsSUFBSSxPQUFPLENBQUMsTUFBTSxJQUFJLFNBQVMsRUFBRTtZQUM3QixNQUFLO1NBQ1I7S0FDSjtJQUVELDhDQUE4QztJQUM5QyxNQUFNLE1BQU0sR0FBRyxJQUFJLEtBQUssRUFBNEIsQ0FBQTtJQUNwRCxLQUFLLE1BQU0sTUFBTSxJQUFJLE9BQU8sRUFBRTtRQUMxQixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDVCxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDVCxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7UUFFVCxLQUFLLE1BQU0sS0FB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RSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFBO0FBQ25ELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZnVuY3Rpb24gcXVhbnRNZWRpYW5DdXQoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIG1heENvbG9yczogbnVtYmVyLCB0b2xlcmFuY2U6IG51bWJlcikge1xyXG4gICAgaW50ZXJmYWNlIFBpeGVsIHtcclxuICAgICAgICBvZmZzZXQ6IG51bWJlclxyXG4gICAgICAgIHI6IG51bWJlclxyXG4gICAgICAgIGc6IG51bWJlclxyXG4gICAgICAgIGI6IG51bWJlclxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGltZ0RhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIGN0eC5jYW52YXMud2lkdGgsIGN0eC5jYW52YXMuaGVpZ2h0KVxyXG4gICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0LCBkYXRhIH0gPSBpbWdEYXRhXHJcbiAgICBjb25zdCByb3dQaXRjaCA9IHdpZHRoICogNFxyXG5cclxuICAgIGNvbnN0IGJ1Y2tldHMgPSBuZXcgQXJyYXk8UGl4ZWxbXT4oKVxyXG4gICAgYnVja2V0cy5wdXNoKGNyZWF0ZUluaXRpYWxCdWNrZXQoKSlcclxuXHJcbiAgICB3aGlsZSAodHJ1ZSkge1xyXG4gICAgICAgIGNvbnN0IGJ1Y2tldCA9IGNob29zZUJ1Y2tldCh0b2xlcmFuY2UsIGJ1Y2tldHMpXHJcbiAgICAgICAgaWYgKCFidWNrZXQpIHtcclxuICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGJ1Y2tldHMucHVzaChzcGxpdEJ1Y2tldChidWNrZXQpKVxyXG4gICAgICAgIGlmIChidWNrZXRzLmxlbmd0aCA+PSBtYXhDb2xvcnMpIHtcclxuICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gY2FsY3VsYXRlIHRoZSBhdmVyYWdlIGNvbG9yIGZvciBlYWNoIGJ1Y2tldFxyXG4gICAgY29uc3QgY29sb3JzID0gbmV3IEFycmF5PFtudW1iZXIsIG51bWJlciwgbnVtYmVyXT4oKVxyXG4gICAgZm9yIChjb25zdCBidWNrZXQgb2YgYnVja2V0cykge1xyXG4gICAgICAgIGxldCByID0gMFxyXG4gICAgICAgIGxldCBnID0gMFxyXG4gICAgICAgIGxldCBiID0gMFxyXG5cclxuICAgICAgICBmb3IgKGNvbnN0IHBpeGVsIG9mIGJ1Y2tldCkge1xyXG4gICAgICAgICAgICByICs9IHBpeGVsLnJcclxuICAgICAgICAgICAgZyArPSBwaXhlbC5nXHJcbiAgICAgICAgICAgIGIgKz0gcGl4ZWwuYlxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgciAvPSBidWNrZXQubGVuZ3RoXHJcbiAgICAgICAgZyAvPSBidWNrZXQubGVuZ3RoXHJcbiAgICAgICAgYiAvPSBidWNrZXQubGVuZ3RoXHJcblxyXG4gICAgICAgIGNvbG9ycy5wdXNoKFtNYXRoLnJvdW5kKHIpLCBNYXRoLnJvdW5kKGcpLCBNYXRoLnJvdW5kKGIpXSlcclxuICAgIH1cclxuXHJcbiAgICAvLyBpdGVyYXRlIHRocm91Z2ggZWFjaCBidWNrZXQsIHJlcGxhY2luZyBwaXhlbCBjb2xvciB3aXRoIGJ1Y2tldCBjb2xvciBmb3IgZWFjaCBwaXhlbFxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBidWNrZXRzLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgY29uc3QgYnVja2V0ID0gYnVja2V0c1tpXVxyXG4gICAgICAgIGNvbnN0IFtyLCBnLCBiXSA9IGNvbG9yc1tpXVxyXG5cclxuICAgICAgICBmb3IgKGNvbnN0IHBpeGVsIG9mIGJ1Y2tldCkge1xyXG4gICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBwaXhlbC5vZmZzZXQgKiA0XHJcbiAgICAgICAgICAgIGRhdGFbb2Zmc2V0XSA9IHJcclxuICAgICAgICAgICAgZGF0YVtvZmZzZXQgKyAxXSA9IGdcclxuICAgICAgICAgICAgZGF0YVtvZmZzZXQgKyAyXSA9IGJcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY3R4LnB1dEltYWdlRGF0YShpbWdEYXRhLCAwLCAwKVxyXG5cclxuICAgIGZ1bmN0aW9uIGNyZWF0ZUluaXRpYWxCdWNrZXQoKTogUGl4ZWxbXSB7XHJcbiAgICAgICAgLy8gY3JlYXRlIGluaXRpYWwgYnVja2V0XHJcbiAgICAgICAgY29uc3QgYnVja2V0ID0gbmV3IEFycmF5PFBpeGVsPigpXHJcbiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBoZWlnaHQ7ICsreSkge1xyXG4gICAgICAgICAgICBjb25zdCB5T2Zmc2V0ID0geSAqIHJvd1BpdGNoXHJcbiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgd2lkdGg7ICsreCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0geU9mZnNldCArIHggKiA0XHJcbiAgICAgICAgICAgICAgICBjb25zdCByID0gZGF0YVtvZmZzZXRdXHJcbiAgICAgICAgICAgICAgICBjb25zdCBnID0gZGF0YVtvZmZzZXQgKyAxXVxyXG4gICAgICAgICAgICAgICAgY29uc3QgYiA9IGRhdGFbb2Zmc2V0ICsgMl1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBwYWNrIGludG8gYnVja2V0XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwaXhlbDogUGl4ZWwgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiBmbGF0KHgsIHksIHdpZHRoKSxcclxuICAgICAgICAgICAgICAgICAgICByOiByLFxyXG4gICAgICAgICAgICAgICAgICAgIGc6IGcsXHJcbiAgICAgICAgICAgICAgICAgICAgYjogYlxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGJ1Y2tldC5wdXNoKHBpeGVsKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gYnVja2V0XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY2FsY1JhbmdlKHBpeGVsczogUGl4ZWxbXSwgc2VsZWN0b3I6ICh4OiBQaXhlbCkgPT4gbnVtYmVyKTogbnVtYmVyIHtcclxuICAgICAgICBsZXQgbWluID0gSW5maW5pdHlcclxuICAgICAgICBsZXQgbWF4ID0gLUluZmluaXR5XHJcblxyXG4gICAgICAgIGZvciAoY29uc3QgcGl4ZWwgb2YgcGl4ZWxzKSB7XHJcbiAgICAgICAgICAgIG1pbiA9IE1hdGgubWluKHNlbGVjdG9yKHBpeGVsKSwgbWluKVxyXG4gICAgICAgICAgICBtYXggPSBNYXRoLm1heChzZWxlY3RvcihwaXhlbCksIG1heClcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBtYXggLSBtaW5cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjaG9vc2VCdWNrZXQodG9sZXJhbmNlOiBudW1iZXIsIGJ1Y2tldHM6IFBpeGVsW11bXSk6IFBpeGVsW10gfCBudWxsIHtcclxuICAgICAgICBsZXQgbWF4UmFuZ2UgPSAtSW5maW5pdHlcclxuICAgICAgICBsZXQgbWF4QnVja2V0OiBQaXhlbFtdIHwgbnVsbCA9IG51bGxcclxuXHJcbiAgICAgICAgZm9yIChjb25zdCBidWNrZXQgb2YgYnVja2V0cykge1xyXG4gICAgICAgICAgICBjb25zdCByYW5nZVIgPSBjYWxjUmFuZ2UoYnVja2V0LCBwID0+IHAucilcclxuICAgICAgICAgICAgY29uc3QgcmFuZ2VHID0gY2FsY1JhbmdlKGJ1Y2tldCwgcCA9PiBwLmcpXHJcbiAgICAgICAgICAgIGNvbnN0IHJhbmdlQiA9IGNhbGNSYW5nZShidWNrZXQsIHAgPT4gcC5iKVxyXG4gICAgICAgICAgICBsZXQgcmFuZ2UgPSAwXHJcbiAgICAgICAgICAgIGlmIChyYW5nZVIgPiByYW5nZUcgJiYgcmFuZ2VSID4gcmFuZ2VCKSB7XHJcbiAgICAgICAgICAgICAgICByYW5nZSA9IHJhbmdlUlxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJhbmdlRyA+IHJhbmdlUikge1xyXG4gICAgICAgICAgICAgICAgcmFuZ2UgPSByYW5nZUdcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJhbmdlID0gcmFuZ2VCXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChyYW5nZSA+IG1heFJhbmdlKSB7XHJcbiAgICAgICAgICAgICAgICBtYXhSYW5nZSA9IHJhbmdlXHJcbiAgICAgICAgICAgICAgICBtYXhCdWNrZXQgPSBidWNrZXRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG1heFJhbmdlID4gdG9sZXJhbmNlID8gbWF4QnVja2V0IDogbnVsbFxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHNwbGl0QnVja2V0KGJ1Y2tldDogUGl4ZWxbXSk6IFBpeGVsW10ge1xyXG4gICAgICAgIGNvbnN0IHJhbmdlUiA9IGNhbGNSYW5nZShidWNrZXQsIHAgPT4gcC5yKVxyXG4gICAgICAgIGNvbnN0IHJhbmdlRyA9IGNhbGNSYW5nZShidWNrZXQsIHAgPT4gcC5nKVxyXG4gICAgICAgIGNvbnN0IHJhbmdlQiA9IGNhbGNSYW5nZShidWNrZXQsIHAgPT4gcC5iKVxyXG5cclxuICAgICAgICBpZiAocmFuZ2VSID4gcmFuZ2VHICYmIHJhbmdlUiA+IHJhbmdlQikge1xyXG4gICAgICAgICAgICBidWNrZXQuc29ydCgoYSwgYikgPT4gYS5yIC0gYi5yKVxyXG4gICAgICAgIH0gZWxzZSBpZiAocmFuZ2VHID4gcmFuZ2VSKSB7XHJcbiAgICAgICAgICAgIGJ1Y2tldC5zb3J0KChhLCBiKSA9PiBhLmcgLSBiLmcpXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYnVja2V0LnNvcnQoKGEsIGIpID0+IGEuYiAtIGIuYilcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG1pZGRsZSA9IE1hdGguZmxvb3IoYnVja2V0Lmxlbmd0aCAvIDIpXHJcbiAgICAgICAgY29uc3QgbmV3QnVja2V0ID0gYnVja2V0LnNwbGljZShtaWRkbGUpXHJcbiAgICAgICAgcmV0dXJuIG5ld0J1Y2tldFxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2NhbkltYWdlRGF0YShpbWFnZURhdGE6IEltYWdlRGF0YSwgZjogKHg6IG51bWJlciwgeTogbnVtYmVyLCBvZmZzZXQ6IG51bWJlcikgPT4gdm9pZCk6IHZvaWQge1xyXG4gICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBpbWFnZURhdGFcclxuICAgIHNjYW4od2lkdGgsIGhlaWdodCwgZilcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNjYW4od2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIGY6ICh4OiBudW1iZXIsIHk6IG51bWJlciwgb2Zmc2V0OiBudW1iZXIpID0+IHZvaWQpOiB2b2lkIHtcclxuICAgIGZvciAobGV0IHkgPSAwOyB5IDwgaGVpZ2h0OyArK3kpIHtcclxuICAgICAgICBjb25zdCB5T2Zmc2V0ID0geSAqIHdpZHRoXHJcbiAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB3aWR0aDsgKyt4KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHhPZmZzZXQgPSB5T2Zmc2V0ICsgeFxyXG4gICAgICAgICAgICBmKHgsIHksIHhPZmZzZXQpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGUod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIGY6ICh4OiBudW1iZXIsIHk6IG51bWJlcikgPT4gbnVtYmVyKTogbnVtYmVyW10ge1xyXG4gICAgY29uc3QgYSA9IG5ldyBBcnJheTxudW1iZXI+KClcclxuICAgIHNjYW4od2lkdGgsIGhlaWdodCwgKHgsIHkpID0+IHtcclxuICAgICAgICBhLnB1c2goZih4LCB5KSlcclxuICAgIH0pXHJcblxyXG4gICAgcmV0dXJuIGFcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNjYW5SZWdpb24oeDA6IG51bWJlciwgeTA6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIHJvd1BpdGNoOiBudW1iZXIsIGY6ICh4OiBudW1iZXIsIHk6IG51bWJlciwgb2Zmc2V0OiBudW1iZXIpID0+IHZvaWQpOiB2b2lkIHtcclxuICAgIGNvbnN0IHgxID0geDAgKyB3aWR0aFxyXG4gICAgY29uc3QgeTEgPSB5MCArIGhlaWdodFxyXG4gICAgZm9yIChsZXQgeSA9IHkwOyB5IDwgeTE7ICsreSkge1xyXG4gICAgICAgIGNvbnN0IHlPZmZzZXQgPSB5ICogcm93UGl0Y2hcclxuICAgICAgICBmb3IgKGxldCB4ID0geDA7IHggPCB4MTsgKyt4KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHhPZmZzZXQgPSB5T2Zmc2V0ICsgeFxyXG4gICAgICAgICAgICBmKHgsIHksIHhPZmZzZXQpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2NhblJvd3Mod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIGY6ICh5OiBudW1iZXIsIG9mZnNldDogbnVtYmVyKSA9PiB2b2lkKSB7XHJcbiAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgKyt5KSB7XHJcbiAgICAgICAgY29uc3Qgb2Zmc2V0ID0geSAqIHdpZHRoXHJcbiAgICAgICAgZih5LCBvZmZzZXQpXHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzY2FuUm93c1JlZ2lvbih5MDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgcm93UGl0Y2g6IG51bWJlciwgZjogKHk6IG51bWJlciwgb2Zmc2V0OiBudW1iZXIpID0+IHZvaWQpIHtcclxuICAgIGNvbnN0IHkxID0geTAgKyBoZWlnaHRcclxuICAgIGZvciAobGV0IHkgPSAwOyB5IDwgeTE7ICsreSkge1xyXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IHkgKiByb3dQaXRjaFxyXG4gICAgICAgIGYoeSwgb2Zmc2V0KVxyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2FsY0x1bWluYW5jZShjb2xvcjogW251bWJlciwgbnVtYmVyLCBudW1iZXJdKSB7XHJcbiAgICBjb25zdCBbciwgZywgYl0gPSBjb2xvclxyXG4gICAgY29uc3QgbCA9IDAuMjEyNiAqIChyIC8gMjU1KSArIDAuNzE1MiAqIChnIC8gMjU1KSArIDAuMDcyMiAqIChiIC8gMjU1KVxyXG4gICAgcmV0dXJuIGxcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNvcHlJbWFnZURhdGEoaW1hZ2VEYXRhOiBJbWFnZURhdGEpOiBJbWFnZURhdGEge1xyXG4gICAgcmV0dXJuIG5ldyBJbWFnZURhdGEobmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGltYWdlRGF0YS5kYXRhKSwgaW1hZ2VEYXRhLndpZHRoLCBpbWFnZURhdGEuaGVpZ2h0KVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2FudmFzMkJsb2IoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCwgdHlwZT86IHN0cmluZywgcXVhbGl0eT86IG51bWJlcik6IFByb21pc2U8QmxvYj4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPEJsb2I+KChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICBjYW52YXMudG9CbG9iKChibG9iKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChibG9iKSB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKGJsb2IpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKFwidG9CbG9iIHJldHVybmVkIG51bGxcIikpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgICAgICB0eXBlLFxyXG4gICAgICAgICAgICBxdWFsaXR5KVxyXG4gICAgfSlcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGZsYXQoeDogbnVtYmVyLCB5OiBudW1iZXIsIHJvd1BpdGNoOiBudW1iZXIpIHtcclxuICAgIHJldHVybiB5ICogcm93UGl0Y2ggKyB4XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB1bmZsYXQoaTogbnVtYmVyLCByb3dQaXRjaDogbnVtYmVyKTogW251bWJlciwgbnVtYmVyXSB7XHJcbiAgICByZXR1cm4gW2kgJSByb3dQaXRjaCwgTWF0aC5mbG9vcihpIC8gcm93UGl0Y2gpXVxyXG59XHJcbiJdfQ==