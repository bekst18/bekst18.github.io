import * as geo from "../shared/geo2d.js";
/**
 * a generic 2d array of data
 */
export class Grid {
    constructor(width = 0, height = 0, data, offset = 0, rowPitch = 0) {
        this.width = width;
        this.height = height;
        this.data = data;
        this.offset = offset;
        this.rowPitch = rowPitch;
        // check for errors
        if (this.rowPitch === 0) {
            this.rowPitch = this.width;
        }
        const maxOffset = this.offset + this.rowPitch * this.height;
        if (maxOffset > this.data.length) {
            throw new Error(`Max offset of ${maxOffset} is greater than length of data array - ${this.data.length}`);
        }
    }
    assertBounds(x, y) {
        if (x < 0 || x >= this.width) {
            throw new Error(`${x} x-coordinate is out of bounds, must be between 0 and ${this.width - 1}`);
        }
        if (y < 0 || y >= this.height) {
            throw new Error(`${y} y-coordinate is out of bounds, must be between 0 and ${this.height - 1}`);
        }
    }
    inBounds(x, y) {
        return x >= 0 && x < this.width && y >= 0 && y < this.height;
    }
    regionInBounds(x, y, width, height) {
        return this.inBounds(x, y) && this.inBounds(x + width - 1, y + height - 1);
    }
    aabbInBounds(aabb) {
        return this.regionInBounds(aabb.min.x, aabb.min.y, aabb.width, aabb.height);
    }
    /**
     * return flattened index for specified coordinates
     * @param x x coord
     * @param y y coord
     */
    flat(x, y) {
        this.assertBounds(x, y);
        const i = this.offset + y * this.rowPitch + x;
        return i;
    }
    /**
     * return flattened index for coordinates
     * @param xy coordinates to flatten
     */
    flatPoint(xy) {
        const { x, y } = xy;
        return this.flat(x, y);
    }
    /**
     * return item at specified "flat" index
     * @param i flat coordinate to access item at
     */
    atf(i) {
        const item = this.data[i];
        return item;
    }
    /**
     * access item at specified coordinates
     * @param x x coordinate
     * @param y y coordinate
     */
    at(x, y) {
        const i = this.flat(x, y);
        const item = this.atf(i);
        return item;
    }
    /**
     * access item at specified coordinates
     * @param xy coordinates to access
     */
    atPoint(xy) {
        const { x, y } = xy;
        return this.at(x, y);
    }
    /**
     * set item at specified flat index to specified value
     * @param i flat index of item
     * @param value value
     */
    setf(i, value) {
        this.data[i] = value;
    }
    /**
     * set item at specified coordinates to specified value
     * @param x x coordinate
     * @param y y coordinate
     * @param value value to set
     */
    set(x, y, value) {
        this.setf(this.flat(x, y), value);
    }
    /**
     * set item at specified coordinates to specified value
     * @param xy point
     * @param value value to set
     */
    setPoint(xy, value) {
        const { x, y } = xy;
        this.set(x, y, value);
    }
    /**
     * scan the specified region of the array
     * @param x0 x coord
     * @param y0 y coord
     * @param width width of scan region
     * @param height height of scan region
     * @param f function to call for each x/y coordinate
     */
    *scanRegion(x0, y0, width, height) {
        const r = x0 + width;
        const b = y0 + height;
        for (let y = y0; y < b; ++y) {
            for (let x = x0; x < r; ++x) {
                yield [this.at(x, y), x, y];
            }
        }
    }
    /**
     * scan the specified region of the array
     * @param aabb aabb containing area to scan
     * @param f function to call for each x/y coordinate
     */
    scanAABB(aabb) {
        return this.scanRegion(aabb.min.x, aabb.min.y, aabb.width, aabb.height);
    }
    /**
     * scan the entire grid
     * @param f function to call for each x/y coordinate
     */
    scan() {
        return this.scanRegion(0, 0, this.width, this.height);
    }
    /**
     * iterate over all data in grid
     */
    *[Symbol.iterator]() {
        for (const x of this.data) {
            yield x;
        }
    }
    /**
     * iterate over a specified region
     */
    *iterRegion(x0, y0, width, height) {
        const r = x0 + width;
        const b = y0 + height;
        for (let x = x0; x < r; ++x) {
            for (let y = y0; y < b; ++y) {
                yield this.at(x, y);
            }
        }
    }
    /**
    * iterate over a specified region
    */
    iterAABB(aabb) {
        return this.iterRegion(aabb.min.x, aabb.min.y, aabb.width, aabb.height);
    }
    /**
     * copy a portion of this grid into a new grid
     */
    view(x, y, width, height) {
        const offset = this.flat(x, y);
        const dst = new Grid(width, height, this.data, offset, this.rowPitch);
        return dst;
    }
    /**
    * copy a portion of this grid into a new grid
    */
    viewAABB(aabb) {
        const v = this.view(aabb.min.x, aabb.min.y, aabb.width, aabb.height);
        return v;
    }
    /**
     * construct an array by applying a function to every element in this grid
     * @param f mapping function
     */
    map(f) {
        const data = [];
        for (let y = 0; y < this.height; ++y) {
            for (let x = 0; x < this.width; ++x) {
                const v = this.at(x, y);
                data.push(f(v, x, y));
            }
        }
        return data;
    }
    /**
     * construct a grid by applying a function to every element in this grid
     * @param f mapping function
     */
    map2(f) {
        const data = this.map(f);
        return new Grid(this.width, this.height, data);
    }
    /**
     * find the coordinates of an element in the grid that meets the specified criteria
     * @param f predicate function
     */
    findPoint(f) {
        for (let y = 0; y < this.height; ++y) {
            for (let x = 0; x < this.width; ++x) {
                const v = this.at(x, y);
                if (f(v)) {
                    return new geo.Point(x, y);
                }
            }
        }
        return null;
    }
}
/**
 * copy source grid to destination grid
 * @param src source grid
 * @param dst destination grid
 * @param x destination x offset
 * @param y destination y offset
 */
export function copy(src, dst, dx, dy) {
    for (const [v, x, y] of src.scan()) {
        dst.set(x + dx, y + dy, v);
    }
}
/**
 * copy a region of grid to subgrid
 * @param src source grid
 * @param sx source x offset
 * @param sy source y offset
 * @param width width of region
 * @param height height of region
 * @param dst destination grid
 * @param dx destination x offset
 * @param dy destination y offset
 */
export function copyRegion(src, sx, sy, width, height, dst, dx, dy) {
    for (const [v, x, y] of src.scanRegion(sx, sy, width, height)) {
        dst.set(x + dx, y + dy, v);
    }
}
/**
 * Generate a grid of specified width and height by invoking function for every element
 * @param width width of grid
 * @param height height of grid
 * @param f function to invoke to get value for every x,y coordinate of grid
 */
export function generate(width, height, f) {
    const data = [];
    for (let y = 0; y < height; ++y) {
        for (let x = 0; x < width; ++x) {
            data.push(f(x, y));
        }
    }
    const grd = new Grid(width, height, data);
    return grd;
}
export function* scan(x0, y0, width, height) {
    const r = x0 + width;
    const b = y0 + height;
    for (let x = x0; x < r; ++x) {
        for (let y = y0; y < b; ++y) {
            yield new geo.Point(x, y);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImdyaWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLEdBQUcsTUFBTSxvQkFBb0IsQ0FBQTtBQUV6Qzs7R0FFRztBQUNILE1BQU0sT0FBTyxJQUFJO0lBQ2IsWUFBcUIsUUFBZ0IsQ0FBQyxFQUFXLFNBQWlCLENBQUMsRUFBVyxJQUFTLEVBQVcsU0FBaUIsQ0FBQyxFQUFXLFdBQW1CLENBQUM7UUFBOUgsVUFBSyxHQUFMLEtBQUssQ0FBWTtRQUFXLFdBQU0sR0FBTixNQUFNLENBQVk7UUFBVyxTQUFJLEdBQUosSUFBSSxDQUFLO1FBQVcsV0FBTSxHQUFOLE1BQU0sQ0FBWTtRQUFXLGFBQVEsR0FBUixRQUFRLENBQVk7UUFDL0ksbUJBQW1CO1FBQ25CLElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxDQUFDLEVBQUU7WUFDckIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFBO1NBQzdCO1FBRUQsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUE7UUFDM0QsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDOUIsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQkFBaUIsU0FBUywyQ0FBMkMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFBO1NBQzNHO0lBQ0wsQ0FBQztJQUVELFlBQVksQ0FBQyxDQUFTLEVBQUUsQ0FBUztRQUM3QixJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDMUIsTUFBTSxJQUFJLEtBQUssQ0FBQyxHQUFHLENBQUMseURBQXlELElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQTtTQUNqRztRQUVELElBQUksQ0FBQyxH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SSxLQUFhLEVBQUUsTUFBYyxFQUFFLENBQThCO0lBQ3JGLE1BQU0sSUFBSSxHQUFRLEVBQUUsQ0FBQTtJQUNwQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUFFO1FBQzdCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLEVBQUUsRUFBRSxDQUFDLEVBQUU7WUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7U0FDckI7S0FDSjtJQUVELE1BQU0sR0FBRyxHQUFHLElBQUksSUFBSSxDQUFJLEtBQUssRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDNUMsT0FBTyxHQUFHLENBQUE7QUFDZCxDQUFDO0FBRUQsTUFBTSxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBVSxFQUFFLEVBQVUsRUFBRSxLQUFhLEVBQUUsTUFBYztJQUN2RSxNQUFNLENBQUMsR0FBRyxFQUFFLEdBQUcsS0FBSyxDQUFBO0lBQ3BCLE1BQU0sQ0FBQyxHQUFHLEVBQUUsR0FBRyxNQUFNLENBQUE7SUFFckIsS0FBSyxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRTtRQUN6QixLQUFLLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFO1lBQ3pCLE1BQU0sSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtTQUM1QjtLQUNKO0FBQ0wsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGdlbyBmcm9tIFwiLi4vc2hhcmVkL2dlbzJkLmpzXCJcclxuXHJcbi8qKlxyXG4gKiBhIGdlbmVyaWMgMmQgYXJyYXkgb2YgZGF0YVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEdyaWQ8VD4ge1xyXG4gICAgY29uc3RydWN0b3IocmVhZG9ubHkgd2lkdGg6IG51bWJlciA9IDAsIHJlYWRvbmx5IGhlaWdodDogbnVtYmVyID0gMCwgcmVhZG9ubHkgZGF0YTogVFtdLCByZWFkb25seSBvZmZzZXQ6IG51bWJlciA9IDAsIHJlYWRvbmx5IHJvd1BpdGNoOiBudW1iZXIgPSAwKSB7XHJcbiAgICAgICAgLy8gY2hlY2sgZm9yIGVycm9yc1xyXG4gICAgICAgIGlmICh0aGlzLnJvd1BpdGNoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMucm93UGl0Y2ggPSB0aGlzLndpZHRoXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBtYXhPZmZzZXQgPSB0aGlzLm9mZnNldCArIHRoaXMucm93UGl0Y2ggKiB0aGlzLmhlaWdodFxyXG4gICAgICAgIGlmIChtYXhPZmZzZXQgPiB0aGlzLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTWF4IG9mZnNldCBvZiAke21heE9mZnNldH0gaXMgZ3JlYXRlciB0aGFuIGxlbmd0aCBvZiBkYXRhIGFycmF5IC0gJHt0aGlzLmRhdGEubGVuZ3RofWApXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGFzc2VydEJvdW5kcyh4OiBudW1iZXIsIHk6IG51bWJlcikge1xyXG4gICAgICAgIGlmICh4IDwgMCB8fCB4ID49IHRoaXMud2lkdGgpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke3h9IHgtY29vcmRpbmF0ZSBpcyBvdXQgb2YgYm91bmRzLCBtdXN0IGJlIGJldHdlZW4gMCBhbmQgJHt0aGlzLndpZHRoIC0gMX1gKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHkgPCAwIHx8IHkgPj0gdGhpcy5oZWlnaHQpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke3l9IHktY29vcmRpbmF0ZSBpcyBvdXQgb2YgYm91bmRzLCBtdXN0IGJlIGJldHdlZW4gMCBhbmQgJHt0aGlzLmhlaWdodCAtIDF9YClcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaW5Cb3VuZHMoeDogbnVtYmVyLCB5OiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4geCA+PSAwICYmIHggPCB0aGlzLndpZHRoICYmIHkgPj0gMCAmJiB5IDwgdGhpcy5oZWlnaHRcclxuICAgIH1cclxuXHJcbiAgICByZWdpb25JbkJvdW5kcyh4OiBudW1iZXIsIHk6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pbkJvdW5kcyh4LCB5KSAmJiB0aGlzLmluQm91bmRzKHggKyB3aWR0aCAtIDEsIHkgKyBoZWlnaHQgLSAxKVxyXG4gICAgfVxyXG5cclxuICAgIGFhYmJJbkJvdW5kcyhhYWJiOiBnZW8uQUFCQik6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlZ2lvbkluQm91bmRzKGFhYmIubWluLngsIGFhYmIubWluLnksIGFhYmIud2lkdGgsIGFhYmIuaGVpZ2h0KVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogcmV0dXJuIGZsYXR0ZW5lZCBpbmRleCBmb3Igc3BlY2lmaWVkIGNvb3JkaW5hdGVzXHJcbiAgICAgKiBAcGFyYW0geCB4IGNvb3JkXHJcbiAgICAgKiBAcGFyYW0geSB5IGNvb3JkXHJcbiAgICAgKi9cclxuICAgIGZsYXQoeDogbnVtYmVyLCB5OiBudW1iZXIpOiBudW1iZXIge1xyXG4gICAgICAgIHRoaXMuYXNzZXJ0Qm91bmRzKHgsIHkpXHJcbiAgICAgICAgY29uc3QgaSA9IHRoaXMub2Zmc2V0ICsgeSAqIHRoaXMucm93UGl0Y2ggKyB4XHJcbiAgICAgICAgcmV0dXJuIGlcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHJldHVybiBmbGF0dGVuZWQgaW5kZXggZm9yIGNvb3JkaW5hdGVzXHJcbiAgICAgKiBAcGFyYW0geHkgY29vcmRpbmF0ZXMgdG8gZmxhdHRlblxyXG4gICAgICovXHJcbiAgICBmbGF0UG9pbnQoeHk6IGdlby5Qb2ludCk6IG51bWJlciB7XHJcbiAgICAgICAgY29uc3QgeyB4LCB5IH0gPSB4eVxyXG4gICAgICAgIHJldHVybiB0aGlzLmZsYXQoeCwgeSlcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHJldHVybiBpdGVtIGF0IHNwZWNpZmllZCBcImZsYXRcIiBpbmRleFxyXG4gICAgICogQHBhcmFtIGkgZmxhdCBjb29yZGluYXRlIHRvIGFjY2VzcyBpdGVtIGF0IFxyXG4gICAgICovXHJcbiAgICBhdGYoaTogbnVtYmVyKTogVCB7XHJcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuZGF0YVtpXVxyXG4gICAgICAgIHJldHVybiBpdGVtXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBhY2Nlc3MgaXRlbSBhdCBzcGVjaWZpZWQgY29vcmRpbmF0ZXNcclxuICAgICAqIEBwYXJhbSB4IHggY29vcmRpbmF0ZVxyXG4gICAgICogQHBhcmFtIHkgeSBjb29yZGluYXRlXHJcbiAgICAgKi9cclxuICAgIGF0KHg6IG51bWJlciwgeTogbnVtYmVyKTogVCB7XHJcbiAgICAgICAgY29uc3QgaSA9IHRoaXMuZmxhdCh4LCB5KVxyXG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmF0ZihpKVxyXG4gICAgICAgIHJldHVybiBpdGVtXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBhY2Nlc3MgaXRlbSBhdCBzcGVjaWZpZWQgY29vcmRpbmF0ZXNcclxuICAgICAqIEBwYXJhbSB4eSBjb29yZGluYXRlcyB0byBhY2Nlc3NcclxuICAgICAqL1xyXG4gICAgYXRQb2ludCh4eTogZ2VvLlBvaW50KTogVCB7XHJcbiAgICAgICAgY29uc3QgeyB4LCB5IH0gPSB4eVxyXG4gICAgICAgIHJldHVybiB0aGlzLmF0KHgsIHkpXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBzZXQgaXRlbSBhdCBzcGVjaWZpZWQgZmxhdCBpbmRleCB0byBzcGVjaWZpZWQgdmFsdWVcclxuICAgICAqIEBwYXJhbSBpIGZsYXQgaW5kZXggb2YgaXRlbVxyXG4gICAgICogQHBhcmFtIHZhbHVlIHZhbHVlXHJcbiAgICAgKi9cclxuICAgIHNldGYoaTogbnVtYmVyLCB2YWx1ZTogVCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZGF0YVtpXSA9IHZhbHVlXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBzZXQgaXRlbSBhdCBzcGVjaWZpZWQgY29vcmRpbmF0ZXMgdG8gc3BlY2lmaWVkIHZhbHVlXHJcbiAgICAgKiBAcGFyYW0geCB4IGNvb3JkaW5hdGVcclxuICAgICAqIEBwYXJhbSB5IHkgY29vcmRpbmF0ZVxyXG4gICAgICogQHBhcmFtIHZhbHVlIHZhbHVlIHRvIHNldFxyXG4gICAgICovXHJcbiAgICBzZXQoeDogbnVtYmVyLCB5OiBudW1iZXIsIHZhbHVlOiBUKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5zZXRmKHRoaXMuZmxhdCh4LCB5KSwgdmFsdWUpXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBzZXQgaXRlbSBhdCBzcGVjaWZpZWQgY29vcmRpbmF0ZXMgdG8gc3BlY2lmaWVkIHZhbHVlXHJcbiAgICAgKiBAcGFyYW0geHkgcG9pbnRcclxuICAgICAqIEBwYXJhbSB2YWx1ZSB2YWx1ZSB0byBzZXRcclxuICAgICAqL1xyXG4gICAgc2V0UG9pbnQoeHk6IGdlby5Qb2ludCwgdmFsdWU6IFQpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCB7IHgsIHkgfSA9IHh5XHJcbiAgICAgICAgdGhpcy5zZXQoeCwgeSwgdmFsdWUpXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBzY2FuIHRoZSBzcGVjaWZpZWQgcmVnaW9uIG9mIHRoZSBhcnJheVxyXG4gICAgICogQHBhcmFtIHgwIHggY29vcmRcclxuICAgICAqIEBwYXJhbSB5MCB5IGNvb3JkXHJcbiAgICAgKiBAcGFyYW0gd2lkdGggd2lkdGggb2Ygc2NhbiByZWdpb25cclxuICAgICAqIEBwYXJhbSBoZWlnaHQgaGVpZ2h0IG9mIHNjYW4gcmVnaW9uXHJcbiAgICAgKiBAcGFyYW0gZiBmdW5jdGlvbiB0byBjYWxsIGZvciBlYWNoIHgveSBjb29yZGluYXRlXHJcbiAgICAgKi9cclxuICAgICpzY2FuUmVnaW9uKHgwOiBudW1iZXIsIHkwOiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKTogSXRlcmFibGU8W1QsIG51bWJlciwgbnVtYmVyXT4ge1xyXG4gICAgICAgIGNvbnN0IHIgPSB4MCArIHdpZHRoXHJcbiAgICAgICAgY29uc3QgYiA9IHkwICsgaGVpZ2h0XHJcblxyXG4gICAgICAgIGZvciAobGV0IHkgPSB5MDsgeSA8IGI7ICsreSkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCB4ID0geDA7IHggPCByOyArK3gpIHtcclxuICAgICAgICAgICAgICAgIHlpZWxkIFt0aGlzLmF0KHgsIHkpLCB4LCB5XVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogc2NhbiB0aGUgc3BlY2lmaWVkIHJlZ2lvbiBvZiB0aGUgYXJyYXlcclxuICAgICAqIEBwYXJhbSBhYWJiIGFhYmIgY29udGFpbmluZyBhcmVhIHRvIHNjYW5cclxuICAgICAqIEBwYXJhbSBmIGZ1bmN0aW9uIHRvIGNhbGwgZm9yIGVhY2ggeC95IGNvb3JkaW5hdGVcclxuICAgICAqL1xyXG4gICAgc2NhbkFBQkIoYWFiYjogZ2VvLkFBQkIpOiBJdGVyYWJsZTxbVCwgbnVtYmVyLCBudW1iZXJdPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NhblJlZ2lvbihhYWJiLm1pbi54LCBhYWJiLm1pbi55LCBhYWJiLndpZHRoLCBhYWJiLmhlaWdodClcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHNjYW4gdGhlIGVudGlyZSBncmlkXHJcbiAgICAgKiBAcGFyYW0gZiBmdW5jdGlvbiB0byBjYWxsIGZvciBlYWNoIHgveSBjb29yZGluYXRlXHJcbiAgICAgKi9cclxuICAgIHNjYW4oKTogSXRlcmFibGU8W1QsIG51bWJlciwgbnVtYmVyXT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNjYW5SZWdpb24oMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBpdGVyYXRlIG92ZXIgYWxsIGRhdGEgaW4gZ3JpZFxyXG4gICAgICovXHJcbiAgICAqW1N5bWJvbC5pdGVyYXRvcl0oKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCB4IG9mIHRoaXMuZGF0YSkge1xyXG4gICAgICAgICAgICB5aWVsZCB4XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogaXRlcmF0ZSBvdmVyIGEgc3BlY2lmaWVkIHJlZ2lvblxyXG4gICAgICovXHJcbiAgICAqaXRlclJlZ2lvbih4MDogbnVtYmVyLCB5MDogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikge1xyXG4gICAgICAgIGNvbnN0IHIgPSB4MCArIHdpZHRoXHJcbiAgICAgICAgY29uc3QgYiA9IHkwICsgaGVpZ2h0XHJcblxyXG4gICAgICAgIGZvciAobGV0IHggPSB4MDsgeCA8IHI7ICsreCkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCB5ID0geTA7IHkgPCBiOyArK3kpIHtcclxuICAgICAgICAgICAgICAgIHlpZWxkIHRoaXMuYXQoeCwgeSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICogaXRlcmF0ZSBvdmVyIGEgc3BlY2lmaWVkIHJlZ2lvblxyXG4gICAgKi9cclxuICAgIGl0ZXJBQUJCKGFhYmI6IGdlby5BQUJCKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaXRlclJlZ2lvbihhYWJiLm1pbi54LCBhYWJiLm1pbi55LCBhYWJiLndpZHRoLCBhYWJiLmhlaWdodClcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGNvcHkgYSBwb3J0aW9uIG9mIHRoaXMgZ3JpZCBpbnRvIGEgbmV3IGdyaWRcclxuICAgICAqL1xyXG4gICAgdmlldyh4OiBudW1iZXIsIHk6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBHcmlkPFQ+IHtcclxuICAgICAgICBjb25zdCBvZmZzZXQgPSB0aGlzLmZsYXQoeCwgeSlcclxuICAgICAgICBjb25zdCBkc3QgPSBuZXcgR3JpZDxUPih3aWR0aCwgaGVpZ2h0LCB0aGlzLmRhdGEsIG9mZnNldCwgdGhpcy5yb3dQaXRjaClcclxuICAgICAgICByZXR1cm4gZHN0XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAqIGNvcHkgYSBwb3J0aW9uIG9mIHRoaXMgZ3JpZCBpbnRvIGEgbmV3IGdyaWRcclxuICAgICovXHJcbiAgICB2aWV3QUFCQihhYWJiOiBnZW8uQUFCQik6IEdyaWQ8VD4ge1xyXG4gICAgICAgIGNvbnN0IHYgPSB0aGlzLnZpZXcoYWFiYi5taW4ueCwgYWFiYi5taW4ueSwgYWFiYi53aWR0aCwgYWFiYi5oZWlnaHQpXHJcbiAgICAgICAgcmV0dXJuIHZcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGNvbnN0cnVjdCBhbiBhcnJheSBieSBhcHBseWluZyBhIGZ1bmN0aW9uIHRvIGV2ZXJ5IGVsZW1lbnQgaW4gdGhpcyBncmlkXHJcbiAgICAgKiBAcGFyYW0gZiBtYXBwaW5nIGZ1bmN0aW9uXHJcbiAgICAgKi9cclxuICAgIG1hcDxVPihmOiAodjogVCwgeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IFUpOiBVW10ge1xyXG4gICAgICAgIGNvbnN0IGRhdGE6IFVbXSA9IFtdXHJcbiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB0aGlzLmhlaWdodDsgKyt5KSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgdGhpcy53aWR0aDsgKyt4KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2ID0gdGhpcy5hdCh4LCB5KVxyXG4gICAgICAgICAgICAgICAgZGF0YS5wdXNoKGYodiwgeCwgeSkpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBkYXRhXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBjb25zdHJ1Y3QgYSBncmlkIGJ5IGFwcGx5aW5nIGEgZnVuY3Rpb24gdG8gZXZlcnkgZWxlbWVudCBpbiB0aGlzIGdyaWRcclxuICAgICAqIEBwYXJhbSBmIG1hcHBpbmcgZnVuY3Rpb25cclxuICAgICAqL1xyXG4gICAgbWFwMjxVPihmOiAodjogVCwgeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IFUpOiBHcmlkPFU+IHtcclxuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5tYXAoZilcclxuICAgICAgICByZXR1cm4gbmV3IEdyaWQ8VT4odGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsIGRhdGEpXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBmaW5kIHRoZSBjb29yZGluYXRlcyBvZiBhbiBlbGVtZW50IGluIHRoZSBncmlkIHRoYXQgbWVldHMgdGhlIHNwZWNpZmllZCBjcml0ZXJpYVxyXG4gICAgICogQHBhcmFtIGYgcHJlZGljYXRlIGZ1bmN0aW9uXHJcbiAgICAgKi9cclxuICAgIGZpbmRQb2ludChmOiAodjogVCkgPT4gYm9vbGVhbik6IChnZW8uUG9pbnQgfCBudWxsKSB7XHJcbiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB0aGlzLmhlaWdodDsgKyt5KSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgdGhpcy53aWR0aDsgKyt4KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2ID0gdGhpcy5hdCh4LCB5KVxyXG4gICAgICAgICAgICAgICAgaWYgKGYodikpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IGdlby5Qb2ludCh4LCB5KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbnVsbFxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogY29weSBzb3VyY2UgZ3JpZCB0byBkZXN0aW5hdGlvbiBncmlkXHJcbiAqIEBwYXJhbSBzcmMgc291cmNlIGdyaWRcclxuICogQHBhcmFtIGRzdCBkZXN0aW5hdGlvbiBncmlkXHJcbiAqIEBwYXJhbSB4IGRlc3RpbmF0aW9uIHggb2Zmc2V0XHJcbiAqIEBwYXJhbSB5IGRlc3RpbmF0aW9uIHkgb2Zmc2V0XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY29weTxUPihzcmM6IEdyaWQ8VD4sIGRzdDogR3JpZDxUPiwgZHg6IG51bWJlciwgZHk6IG51bWJlcikge1xyXG4gICAgZm9yIChjb25zdCBbdiwgeCwgeV0gb2Ygc3JjLnNjYW4oKSkge1xyXG4gICAgICAgIGRzdC5zZXQoeCArIGR4LCB5ICsgZHksIHYpXHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBjb3B5IGEgcmVnaW9uIG9mIGdyaWQgdG8gc3ViZ3JpZFxyXG4gKiBAcGFyYW0gc3JjIHNvdXJjZSBncmlkXHJcbiAqIEBwYXJhbSBzeCBzb3VyY2UgeCBvZmZzZXRcclxuICogQHBhcmFtIHN5IHNvdXJjZSB5IG9mZnNldFxyXG4gKiBAcGFyYW0gd2lkdGggd2lkdGggb2YgcmVnaW9uXHJcbiAqIEBwYXJhbSBoZWlnaHQgaGVpZ2h0IG9mIHJlZ2lvblxyXG4gKiBAcGFyYW0gZHN0IGRlc3RpbmF0aW9uIGdyaWRcclxuICogQHBhcmFtIGR4IGRlc3RpbmF0aW9uIHggb2Zmc2V0XHJcbiAqIEBwYXJhbSBkeSBkZXN0aW5hdGlvbiB5IG9mZnNldFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNvcHlSZWdpb248VD4oXHJcbiAgICBzcmM6IEdyaWQ8VD4sIHN4OiBudW1iZXIsIHN5OiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLFxyXG4gICAgZHN0OiBHcmlkPFQ+LCBkeDogbnVtYmVyLCBkeTogbnVtYmVyKSB7XHJcblxyXG4gICAgZm9yIChjb25zdCBbdiwgeCwgeV0gb2Ygc3JjLnNjYW5SZWdpb24oc3gsIHN5LCB3aWR0aCwgaGVpZ2h0KSkge1xyXG4gICAgICAgIGRzdC5zZXQoeCArIGR4LCB5ICsgZHksIHYpXHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZW5lcmF0ZSBhIGdyaWQgb2Ygc3BlY2lmaWVkIHdpZHRoIGFuZCBoZWlnaHQgYnkgaW52b2tpbmcgZnVuY3Rpb24gZm9yIGV2ZXJ5IGVsZW1lbnRcclxuICogQHBhcmFtIHdpZHRoIHdpZHRoIG9mIGdyaWRcclxuICogQHBhcmFtIGhlaWdodCBoZWlnaHQgb2YgZ3JpZFxyXG4gKiBAcGFyYW0gZiBmdW5jdGlvbiB0byBpbnZva2UgdG8gZ2V0IHZhbHVlIGZvciBldmVyeSB4LHkgY29vcmRpbmF0ZSBvZiBncmlkXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGU8VD4od2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIGY6ICh4OiBudW1iZXIsIHk6IG51bWJlcikgPT4gVCk6IEdyaWQ8VD4ge1xyXG4gICAgY29uc3QgZGF0YTogVFtdID0gW11cclxuICAgIGZvciAobGV0IHkgPSAwOyB5IDwgaGVpZ2h0OyArK3kpIHtcclxuICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyArK3gpIHtcclxuICAgICAgICAgICAgZGF0YS5wdXNoKGYoeCwgeSkpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGdyZCA9IG5ldyBHcmlkPFQ+KHdpZHRoLCBoZWlnaHQsIGRhdGEpXHJcbiAgICByZXR1cm4gZ3JkXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiogc2Nhbih4MDogbnVtYmVyLCB5MDogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcik6IEl0ZXJhYmxlPGdlby5Qb2ludD4ge1xyXG4gICAgY29uc3QgciA9IHgwICsgd2lkdGhcclxuICAgIGNvbnN0IGIgPSB5MCArIGhlaWdodFxyXG5cclxuICAgIGZvciAobGV0IHggPSB4MDsgeCA8IHI7ICsreCkge1xyXG4gICAgICAgIGZvciAobGV0IHkgPSB5MDsgeSA8IGI7ICsreSkge1xyXG4gICAgICAgICAgICB5aWVsZCBuZXcgZ2VvLlBvaW50KHgsIHkpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59Il19