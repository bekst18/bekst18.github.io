/**
 * a generic 2d array of data
 */
export class Grid {
    constructor(width, height, f) {
        this.width = width;
        this.height = height;
        this.data = [];
        for (let y = 0; y < height; ++y) {
            for (let x = 0; x < width; ++x) {
                this.data.push(f(x, y));
            }
        }
    }
    assertBounds(x, y) {
        if (x < 0 || x >= this.width) {
            throw new Error(`${x} x-coordinate is out of bounds, must be between 0 and ${this.width - 1}`);
        }
        if (y < 0 || y >= this.width) {
            throw new Error(`${y} y-coordinate is out of bounds, must be between 0 and ${this.height - 1}`);
        }
    }
    inBounds(x, y) {
        return x >= 0 && x < this.width && y >= 0 && y < this.height;
    }
    regionInBounds(x, y, width, height) {
        return this.inBounds(x, y) && this.inBounds(x + width - 1, y + height - 1);
    }
    flat(x, y) {
        this.assertBounds(x, y);
        const i = y * this.width + x;
        return i;
    }
    /**
     * return item at specified "flat" index
     * @param i flat coordinate to access item at
     */
    atf(i) {
        const item = this.data[i];
        return item;
    }
    /**
     * access item at specified coordinates
     * @param x x coordinate
     * @param y y coordinate
     */
    at(x, y) {
        const i = this.flat(x, y);
        const item = this.atf(i);
        return item;
    }
    /**
     * set item at specified flat index to specified value
     * @param i flat index of item
     * @param value value
     */
    setf(i, value) {
        this.data[i] = value;
    }
    /**
     * set item at specified coordinates to specified value
     * @param x x coordinate
     * @param y y coordinate
     * @param value value to set
     */
    set(x, y, value) {
        this.setf(this.flat(x, y), value);
    }
    /**
     * scan the specified region of the array
     * @param x0 x coord
     * @param y0 y coord
     * @param width width of scan region
     * @param height height of scan region
     * @param f function to call for each x/y coordinate
     */
    scanRegion(x0, y0, width, height, f) {
        const r = x0 + width;
        const b = y0 + height;
        for (let y = y0; y < b; ++y) {
            for (let x = x0; x < r; ++x) {
                f(x, y, this.at(x, y));
            }
        }
    }
    /**
     * scan the entire grid
     * @param f function to call for each x/y coordinate
     */
    scan(f) {
        this.scanRegion(0, 0, this.width, this.height, f);
    }
    *[Symbol.iterator]() {
        for (const x of this.data) {
            yield x;
        }
    }
    /**
     * iterate over a specified region
     */
    *iterRegion(x0, y0, width, height) {
        const r = x0 + width;
        const b = y0 + height;
        for (let x = x0; x < r; ++x) {
            for (let y = y0; y < b; ++y) {
                yield this.at(x, y);
            }
        }
    }
    subgrid(x, y, width, height) {
        const dst = new Grid(width, height, (dx, dy) => this.at(x + dx, y + dy));
        return dst;
    }
}
/**
 * copy source grid to destination grid
 * @param src source grid
 * @param dst destination grid
 * @param x destination x offset
 * @param y destination y offset
 */
export function copy(src, dst, dx, dy) {
    src.scan((x, y, v) => {
        dst.set(x + dx, y + dy, v);
    });
}
/**
 * copy a region of grid to subgrid
 * @param src source grid
 * @param sx source x offset
 * @param sy source y offset
 * @param width width of region
 * @param height height of region
 * @param dst destination grid
 * @param dx destination x offset
 * @param dy destination y offset
 */
export function copyRegion(src, sx, sy, width, height, dst, dx, dy) {
    src.scanRegion(sx, sy, width, height, (x, y, v) => {
        dst.set(x + dx, y + dy, v);
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImdyaWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0dBRUc7QUFDSCxNQUFNLE9BQU8sSUFBSTtJQUdiLFlBQXFCLEtBQWEsRUFBVyxNQUFjLEVBQUUsQ0FBOEI7UUFBdEUsVUFBSyxHQUFMLEtBQUssQ0FBUTtRQUFXLFdBQU0sR0FBTixNQUFNLENBQVE7UUFGbkQsU0FBSSxHQUFRLEVBQUUsQ0FBQTtRQUdsQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxFQUFFLEVBQUUsQ0FBQyxFQUFFO1lBQzdCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLEVBQUUsRUFBRSxDQUFDLEVBQUU7Z0JBQzVCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTthQUMxQjtTQUNKO0lBQ0wsQ0FBQztJQUVELFlBQVksQ0FBQyxDQUFTLEVBQUUsQ0FBUztRQUM3QixJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDMUIsTUFBTSxJQUFJLEtBQUssQ0FBQyxHQUFHLENBQUMseURBQXlELElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQTtTQUNqRztRQUVELElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtZQUMxQixNQUFNLElBQUksS0FBSyxDQUFDLEdBQUcsQ0FBQyx5REFBeUQsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFBO1NBQ2xHO0lBQ0wsQ0FBQztJQUVELFFBQVEsQ0FBQyxDQUFTLEVBQUUsQ0FBUztRQUN6QixPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFL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RSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtRQUM5QyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUM5QixDQUFDLENBQUMsQ0FBQTtBQUNOLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogYSBnZW5lcmljIDJkIGFycmF5IG9mIGRhdGFcclxuICovXHJcbmV4cG9ydCBjbGFzcyBHcmlkPFQ+IHtcclxuICAgIHByaXZhdGUgZGF0YTogVFtdID0gW11cclxuXHJcbiAgICBjb25zdHJ1Y3RvcihyZWFkb25seSB3aWR0aDogbnVtYmVyLCByZWFkb25seSBoZWlnaHQ6IG51bWJlciwgZjogKHg6IG51bWJlciwgeTogbnVtYmVyKSA9PiBUKSB7XHJcbiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBoZWlnaHQ7ICsreSkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyArK3gpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5wdXNoKGYoeCwgeSkpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYXNzZXJ0Qm91bmRzKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKHggPCAwIHx8IHggPj0gdGhpcy53aWR0aCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7eH0geC1jb29yZGluYXRlIGlzIG91dCBvZiBib3VuZHMsIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAke3RoaXMud2lkdGggLSAxfWApXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoeSA8IDAgfHwgeSA+PSB0aGlzLndpZHRoKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgJHt5fSB5LWNvb3JkaW5hdGUgaXMgb3V0IG9mIGJvdW5kcywgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kICR7dGhpcy5oZWlnaHQgLSAxfWApXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGluQm91bmRzKHg6IG51bWJlciwgeTogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHggPj0gMCAmJiB4IDwgdGhpcy53aWR0aCAmJiB5ID49IDAgJiYgeSA8IHRoaXMuaGVpZ2h0XHJcbiAgICB9XHJcblxyXG4gICAgcmVnaW9uSW5Cb3VuZHMoeDogbnVtYmVyLCB5OiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5Cb3VuZHMoeCwgeSkgJiYgdGhpcy5pbkJvdW5kcyh4ICsgd2lkdGggLSAxLCB5ICsgaGVpZ2h0IC0gMSlcclxuICAgIH1cclxuXHJcbiAgICBmbGF0KHg6IG51bWJlciwgeTogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgICAgICB0aGlzLmFzc2VydEJvdW5kcyh4LCB5KVxyXG4gICAgICAgIGNvbnN0IGkgPSB5ICogdGhpcy53aWR0aCArIHhcclxuICAgICAgICByZXR1cm4gaVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogcmV0dXJuIGl0ZW0gYXQgc3BlY2lmaWVkIFwiZmxhdFwiIGluZGV4XHJcbiAgICAgKiBAcGFyYW0gaSBmbGF0IGNvb3JkaW5hdGUgdG8gYWNjZXNzIGl0ZW0gYXQgXHJcbiAgICAgKi9cclxuICAgIGF0ZihpOiBudW1iZXIpOiBUIHtcclxuICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5kYXRhW2ldXHJcbiAgICAgICAgcmV0dXJuIGl0ZW1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGFjY2VzcyBpdGVtIGF0IHNwZWNpZmllZCBjb29yZGluYXRlc1xyXG4gICAgICogQHBhcmFtIHggeCBjb29yZGluYXRlXHJcbiAgICAgKiBAcGFyYW0geSB5IGNvb3JkaW5hdGVcclxuICAgICAqL1xyXG4gICAgYXQoeDogbnVtYmVyLCB5OiBudW1iZXIpOiBUIHtcclxuICAgICAgICBjb25zdCBpID0gdGhpcy5mbGF0KHgsIHkpXHJcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuYXRmKGkpXHJcbiAgICAgICAgcmV0dXJuIGl0ZW1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHNldCBpdGVtIGF0IHNwZWNpZmllZCBmbGF0IGluZGV4IHRvIHNwZWNpZmllZCB2YWx1ZVxyXG4gICAgICogQHBhcmFtIGkgZmxhdCBpbmRleCBvZiBpdGVtXHJcbiAgICAgKiBAcGFyYW0gdmFsdWUgdmFsdWVcclxuICAgICAqL1xyXG4gICAgc2V0ZihpOiBudW1iZXIsIHZhbHVlOiBUKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kYXRhW2ldID0gdmFsdWVcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHNldCBpdGVtIGF0IHNwZWNpZmllZCBjb29yZGluYXRlcyB0byBzcGVjaWZpZWQgdmFsdWVcclxuICAgICAqIEBwYXJhbSB4IHggY29vcmRpbmF0ZVxyXG4gICAgICogQHBhcmFtIHkgeSBjb29yZGluYXRlXHJcbiAgICAgKiBAcGFyYW0gdmFsdWUgdmFsdWUgdG8gc2V0XHJcbiAgICAgKi9cclxuICAgIHNldCh4OiBudW1iZXIsIHk6IG51bWJlciwgdmFsdWU6IFQpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldGYodGhpcy5mbGF0KHgsIHkpLCB2YWx1ZSlcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHNjYW4gdGhlIHNwZWNpZmllZCByZWdpb24gb2YgdGhlIGFycmF5XHJcbiAgICAgKiBAcGFyYW0geDAgeCBjb29yZFxyXG4gICAgICogQHBhcmFtIHkwIHkgY29vcmRcclxuICAgICAqIEBwYXJhbSB3aWR0aCB3aWR0aCBvZiBzY2FuIHJlZ2lvblxyXG4gICAgICogQHBhcmFtIGhlaWdodCBoZWlnaHQgb2Ygc2NhbiByZWdpb25cclxuICAgICAqIEBwYXJhbSBmIGZ1bmN0aW9uIHRvIGNhbGwgZm9yIGVhY2ggeC95IGNvb3JkaW5hdGVcclxuICAgICAqL1xyXG4gICAgc2NhblJlZ2lvbih4MDogbnVtYmVyLCB5MDogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgZjogKHg6IG51bWJlciwgeTogbnVtYmVyLCB2OiBUKSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgciA9IHgwICsgd2lkdGhcclxuICAgICAgICBjb25zdCBiID0geTAgKyBoZWlnaHRcclxuXHJcbiAgICAgICAgZm9yIChsZXQgeSA9IHkwOyB5IDwgYjsgKyt5KSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IHggPSB4MDsgeCA8IHI7ICsreCkge1xyXG4gICAgICAgICAgICAgICAgZih4LCB5LCB0aGlzLmF0KHgsIHkpKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogc2NhbiB0aGUgZW50aXJlIGdyaWRcclxuICAgICAqIEBwYXJhbSBmIGZ1bmN0aW9uIHRvIGNhbGwgZm9yIGVhY2ggeC95IGNvb3JkaW5hdGVcclxuICAgICAqL1xyXG4gICAgc2NhbihmOiAoeDogbnVtYmVyLCB5OiBudW1iZXIsIHY6IFQpID0+IHZvaWQpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNjYW5SZWdpb24oMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsIGYpXHJcbiAgICB9XHJcblxyXG4gICAgKltTeW1ib2wuaXRlcmF0b3JdKCkge1xyXG4gICAgICAgIGZvciAoY29uc3QgeCBvZiB0aGlzLmRhdGEpIHtcclxuICAgICAgICAgICAgeWllbGQgeFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBpdGVyYXRlIG92ZXIgYSBzcGVjaWZpZWQgcmVnaW9uXHJcbiAgICAgKi9cclxuICAgICppdGVyUmVnaW9uKHgwOiBudW1iZXIsIHkwOiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSB7XHJcbiAgICAgICAgY29uc3QgciA9IHgwICsgd2lkdGhcclxuICAgICAgICBjb25zdCBiID0geTAgKyBoZWlnaHRcclxuXHJcbiAgICAgICAgZm9yIChsZXQgeCA9IHgwOyB4IDwgcjsgKyt4KSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IHkgPSB5MDsgeSA8IGI7ICsreSkge1xyXG4gICAgICAgICAgICAgICAgeWllbGQgdGhpcy5hdCh4LCB5KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogY29weSBhIHBvcnRpb24gb2YgdGhpcyBncmlkIGludG8gYSBuZXcgZ3JpZFxyXG4gICAgICovXHJcbiAgICBHcmlkPFQ+IHN1YmdyaWQoeDogbnVtYmVyLCB5OiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSB7XHJcbiAgICAgICAgY29uc3QgZHN0ID0gbmV3IEdyaWQ8VD4od2lkdGgsIGhlaWdodCwgKGR4LCBkeSk9PnRoaXMuYXQoeCArIGR4LCB5ICsgZHkpKVxyXG4gICAgICAgIHJldHVybiBkc3RcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIGNvcHkgc291cmNlIGdyaWQgdG8gZGVzdGluYXRpb24gZ3JpZFxyXG4gKiBAcGFyYW0gc3JjIHNvdXJjZSBncmlkXHJcbiAqIEBwYXJhbSBkc3QgZGVzdGluYXRpb24gZ3JpZFxyXG4gKiBAcGFyYW0geCBkZXN0aW5hdGlvbiB4IG9mZnNldFxyXG4gKiBAcGFyYW0geSBkZXN0aW5hdGlvbiB5IG9mZnNldFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNvcHk8VD4oc3JjOiBHcmlkPFQ+LCBkc3Q6IEdyaWQ8VD4sIGR4OiBudW1iZXIsIGR5OiBudW1iZXIpIHtcclxuICAgIHNyYy5zY2FuKCh4LCB5LCB2KSA9PiB7XHJcbiAgICAgICAgZHN0LnNldCh4ICsgZHgsIHkgKyBkeSwgdilcclxuICAgIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBjb3B5IGEgcmVnaW9uIG9mIGdyaWQgdG8gc3ViZ3JpZFxyXG4gKiBAcGFyYW0gc3JjIHNvdXJjZSBncmlkXHJcbiAqIEBwYXJhbSBzeCBzb3VyY2UgeCBvZmZzZXRcclxuICogQHBhcmFtIHN5IHNvdXJjZSB5IG9mZnNldFxyXG4gKiBAcGFyYW0gd2lkdGggd2lkdGggb2YgcmVnaW9uXHJcbiAqIEBwYXJhbSBoZWlnaHQgaGVpZ2h0IG9mIHJlZ2lvblxyXG4gKiBAcGFyYW0gZHN0IGRlc3RpbmF0aW9uIGdyaWRcclxuICogQHBhcmFtIGR4IGRlc3RpbmF0aW9uIHggb2Zmc2V0XHJcbiAqIEBwYXJhbSBkeSBkZXN0aW5hdGlvbiB5IG9mZnNldFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNvcHlSZWdpb248VD4oXHJcbiAgICBzcmM6IEdyaWQ8VD4sIHN4OiBudW1iZXIsIHN5OiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLFxyXG4gICAgZHN0OiBHcmlkPFQ+LCBkeDogbnVtYmVyLCBkeTogbnVtYmVyKSB7XHJcbiAgICBzcmMuc2NhblJlZ2lvbihzeCwgc3ksIHdpZHRoLCBoZWlnaHQsICh4LCB5LCB2KSA9PiB7XHJcbiAgICAgICAgZHN0LnNldCh4ICsgZHgsIHkgKyBkeSwgdilcclxuICAgIH0pXHJcbn0iXX0=