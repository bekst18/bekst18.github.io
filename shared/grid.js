/**
 * a generic 2d array of data
 */
export class Grid {
    constructor(width = 0, height = 0, data, offset = 0, rowPitch = 0) {
        this.width = width;
        this.height = height;
        this.data = data;
        this.offset = offset;
        this.rowPitch = rowPitch;
        // check for errors
        if (this.rowPitch === 0) {
            this.rowPitch = this.width;
        }
        const maxOffset = this.offset + this.rowPitch * this.height;
        if (maxOffset > this.data.length) {
            throw new Error(`Max offset of ${maxOffset} is greater than length of data array - ${this.data.length}`);
        }
    }
    assertBounds(x, y) {
        if (x < 0 || x >= this.width) {
            throw new Error(`${x} x-coordinate is out of bounds, must be between 0 and ${this.width - 1}`);
        }
        if (y < 0 || y >= this.height) {
            throw new Error(`${y} y-coordinate is out of bounds, must be between 0 and ${this.height - 1}`);
        }
    }
    inBounds(x, y) {
        return x >= 0 && x < this.width && y >= 0 && y < this.height;
    }
    regionInBounds(x, y, width, height) {
        return this.inBounds(x, y) && this.inBounds(x + width - 1, y + height - 1);
    }
    rectInBounds(rect) {
        return this.regionInBounds(rect.x, rect.y, rect.width, rect.height);
    }
    flat(x, y) {
        this.assertBounds(x, y);
        const i = this.offset + y * this.rowPitch + x;
        return i;
    }
    /**
     * return item at specified "flat" index
     * @param i flat coordinate to access item at
     */
    atf(i) {
        const item = this.data[i];
        return item;
    }
    /**
     * access item at specified coordinates
     * @param x x coordinate
     * @param y y coordinate
     */
    at(x, y) {
        const i = this.flat(x, y);
        const item = this.atf(i);
        return item;
    }
    /**
     * set item at specified flat index to specified value
     * @param i flat index of item
     * @param value value
     */
    setf(i, value) {
        this.data[i] = value;
    }
    /**
     * set item at specified coordinates to specified value
     * @param x x coordinate
     * @param y y coordinate
     * @param value value to set
     */
    set(x, y, value) {
        this.setf(this.flat(x, y), value);
    }
    /**
     * scan the specified region of the array
     * @param x0 x coord
     * @param y0 y coord
     * @param width width of scan region
     * @param height height of scan region
     * @param f function to call for each x/y coordinate
     */
    *scanRegion(x0, y0, width, height) {
        const r = x0 + width;
        const b = y0 + height;
        for (let y = y0; y < b; ++y) {
            for (let x = x0; x < r; ++x) {
                yield [x, y, this.at(x, y)];
            }
        }
    }
    /**
     * scan the specified region of the array
     * @param rect rect containing area to scan
     * @param f function to call for each x/y coordinate
     */
    scanRect(rect) {
        return this.scanRegion(rect.x, rect.y, rect.width, rect.height);
    }
    /**
     * scan the entire grid
     * @param f function to call for each x/y coordinate
     */
    scan() {
        return this.scanRegion(0, 0, this.width, this.height);
    }
    *[Symbol.iterator]() {
        for (const x of this.data) {
            yield x;
        }
    }
    /**
     * iterate over a specified region
     */
    *iterRegion(x0, y0, width, height) {
        const r = x0 + width;
        const b = y0 + height;
        for (let x = x0; x < r; ++x) {
            for (let y = y0; y < b; ++y) {
                yield this.at(x, y);
            }
        }
    }
    /**
    * iterate over a specified region
    */
    iterRect(rect) {
        return this.iterRegion(rect.x, rect.y, rect.width, rect.height);
    }
    /**
     * copy a portion of this grid into a new grid
     */
    subgrid(x, y, width, height) {
        const dst = new Grid(width, height, (dx, dy) => this.at(x + dx, y + dy));
        return dst;
    }
}
/**
 * copy source grid to destination grid
 * @param src source grid
 * @param dst destination grid
 * @param x destination x offset
 * @param y destination y offset
 */
export function copy(src, dst, dx, dy) {
    for (const [x, y, v] of src.scan()) {
        dst.set(x + dx, y + dy, v);
    }
}
/**
 * copy a region of grid to subgrid
 * @param src source grid
 * @param sx source x offset
 * @param sy source y offset
 * @param width width of region
 * @param height height of region
 * @param dst destination grid
 * @param dx destination x offset
 * @param dy destination y offset
 */
export function copyRegion(src, sx, sy, width, height, dst, dx, dy) {
    for (const [x, y, v] of src.scanRegion(sx, sy, width, height)) {
        dst.set(x + dx, y + dy, v);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImdyaWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBVUE7O0dBRUc7QUFDSCxNQUFNLE9BQU8sSUFBSTtJQUNiLFlBQXFCLFFBQWdCLENBQUMsRUFBVyxTQUFpQixDQUFDLEVBQVcsSUFBUyxFQUFXLFNBQWUsQ0FBQyxFQUFXLFdBQWlCLENBQUM7UUFBMUgsVUFBSyxHQUFMLEtBQUssQ0FBWTtRQUFXLFdBQU0sR0FBTixNQUFNLENBQVk7UUFBVyxTQUFJLEdBQUosSUFBSSxDQUFLO1FBQVcsV0FBTSxHQUFOLE1BQU0sQ0FBVTtRQUFXLGFBQVEsR0FBUixRQUFRLENBQVU7UUFDM0ksbUJBQW1CO1FBQ25CLElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxDQUFDLEVBQUU7WUFDckIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFBO1NBQzdCO1FBRUQsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUE7UUFDM0QsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDOUIsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQkFBaUIsU0FBUywyQ0FBMkMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFBO1NBQzNHO0lBQ0wsQ0FBQztJQUVELFlBQVksQ0FBQyxDQUFTLEVBQUUsQ0FBUztRQUM3QixJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7WUFDMUIsTUFBTSxJQUFJLEtBQUssQ0FBQyxHQUFHLENBQUMseURBQXlELElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQTtTQUNqRztRQUVELElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLE1BQU0s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biAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIFJlY3Qge1xyXG4gICAgeDogbnVtYmVyLFxyXG4gICAgeTogbnVtYmVyLFxyXG4gICAgd2lkdGg6IG51bWJlcixcclxuICAgIGhlaWdodDogbnVtYmVyXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBhIGdlbmVyaWMgMmQgYXJyYXkgb2YgZGF0YVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEdyaWQ8VD4ge1xyXG4gICAgY29uc3RydWN0b3IocmVhZG9ubHkgd2lkdGg6IG51bWJlciA9IDAsIHJlYWRvbmx5IGhlaWdodDogbnVtYmVyID0gMCwgcmVhZG9ubHkgZGF0YTogVFtdLCByZWFkb25seSBvZmZzZXQ6IG51bWJlcj0wLCByZWFkb25seSByb3dQaXRjaDogbnVtYmVyPTApIHtcclxuICAgICAgICAvLyBjaGVjayBmb3IgZXJyb3JzXHJcbiAgICAgICAgaWYgKHRoaXMucm93UGl0Y2ggPT09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5yb3dQaXRjaCA9IHRoaXMud2lkdGhcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG1heE9mZnNldCA9IHRoaXMub2Zmc2V0ICsgdGhpcy5yb3dQaXRjaCAqIHRoaXMuaGVpZ2h0XHJcbiAgICAgICAgaWYgKG1heE9mZnNldCA+IHRoaXMuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBNYXggb2Zmc2V0IG9mICR7bWF4T2Zmc2V0fSBpcyBncmVhdGVyIHRoYW4gbGVuZ3RoIG9mIGRhdGEgYXJyYXkgLSAke3RoaXMuZGF0YS5sZW5ndGh9YClcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYXNzZXJ0Qm91bmRzKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKHggPCAwIHx8IHggPj0gdGhpcy53aWR0aCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7eH0geC1jb29yZGluYXRlIGlzIG91dCBvZiBib3VuZHMsIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAke3RoaXMud2lkdGggLSAxfWApXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoeSA8IDAgfHwgeSA+PSB0aGlzLmhlaWdodCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7eX0geS1jb29yZGluYXRlIGlzIG91dCBvZiBib3VuZHMsIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAke3RoaXMuaGVpZ2h0IC0gMX1gKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpbkJvdW5kcyh4OiBudW1iZXIsIHk6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB4ID49IDAgJiYgeCA8IHRoaXMud2lkdGggJiYgeSA+PSAwICYmIHkgPCB0aGlzLmhlaWdodFxyXG4gICAgfVxyXG5cclxuICAgIHJlZ2lvbkluQm91bmRzKHg6IG51bWJlciwgeTogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmluQm91bmRzKHgsIHkpICYmIHRoaXMuaW5Cb3VuZHMoeCArIHdpZHRoIC0gMSwgeSArIGhlaWdodCAtIDEpXHJcbiAgICB9XHJcblxyXG4gICAgcmVjdEluQm91bmRzKHJlY3Q6IFJlY3QpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZWdpb25JbkJvdW5kcyhyZWN0LngsIHJlY3QueSwgcmVjdC53aWR0aCwgcmVjdC5oZWlnaHQpXHJcbiAgICB9XHJcblxyXG4gICAgZmxhdCh4OiBudW1iZXIsIHk6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICAgICAgdGhpcy5hc3NlcnRCb3VuZHMoeCwgeSlcclxuICAgICAgICBjb25zdCBpID0gdGhpcy5vZmZzZXQgKyB5ICogdGhpcy5yb3dQaXRjaCArIHhcclxuICAgICAgICByZXR1cm4gaVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogcmV0dXJuIGl0ZW0gYXQgc3BlY2lmaWVkIFwiZmxhdFwiIGluZGV4XHJcbiAgICAgKiBAcGFyYW0gaSBmbGF0IGNvb3JkaW5hdGUgdG8gYWNjZXNzIGl0ZW0gYXQgXHJcbiAgICAgKi9cclxuICAgIGF0ZihpOiBudW1iZXIpOiBUIHtcclxuICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5kYXRhW2ldXHJcbiAgICAgICAgcmV0dXJuIGl0ZW1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGFjY2VzcyBpdGVtIGF0IHNwZWNpZmllZCBjb29yZGluYXRlc1xyXG4gICAgICogQHBhcmFtIHggeCBjb29yZGluYXRlXHJcbiAgICAgKiBAcGFyYW0geSB5IGNvb3JkaW5hdGVcclxuICAgICAqL1xyXG4gICAgYXQoeDogbnVtYmVyLCB5OiBudW1iZXIpOiBUIHtcclxuICAgICAgICBjb25zdCBpID0gdGhpcy5mbGF0KHgsIHkpXHJcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuYXRmKGkpXHJcbiAgICAgICAgcmV0dXJuIGl0ZW1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHNldCBpdGVtIGF0IHNwZWNpZmllZCBmbGF0IGluZGV4IHRvIHNwZWNpZmllZCB2YWx1ZVxyXG4gICAgICogQHBhcmFtIGkgZmxhdCBpbmRleCBvZiBpdGVtXHJcbiAgICAgKiBAcGFyYW0gdmFsdWUgdmFsdWVcclxuICAgICAqL1xyXG4gICAgc2V0ZihpOiBudW1iZXIsIHZhbHVlOiBUKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kYXRhW2ldID0gdmFsdWVcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHNldCBpdGVtIGF0IHNwZWNpZmllZCBjb29yZGluYXRlcyB0byBzcGVjaWZpZWQgdmFsdWVcclxuICAgICAqIEBwYXJhbSB4IHggY29vcmRpbmF0ZVxyXG4gICAgICogQHBhcmFtIHkgeSBjb29yZGluYXRlXHJcbiAgICAgKiBAcGFyYW0gdmFsdWUgdmFsdWUgdG8gc2V0XHJcbiAgICAgKi9cclxuICAgIHNldCh4OiBudW1iZXIsIHk6IG51bWJlciwgdmFsdWU6IFQpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldGYodGhpcy5mbGF0KHgsIHkpLCB2YWx1ZSlcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHNjYW4gdGhlIHNwZWNpZmllZCByZWdpb24gb2YgdGhlIGFycmF5XHJcbiAgICAgKiBAcGFyYW0geDAgeCBjb29yZFxyXG4gICAgICogQHBhcmFtIHkwIHkgY29vcmRcclxuICAgICAqIEBwYXJhbSB3aWR0aCB3aWR0aCBvZiBzY2FuIHJlZ2lvblxyXG4gICAgICogQHBhcmFtIGhlaWdodCBoZWlnaHQgb2Ygc2NhbiByZWdpb25cclxuICAgICAqIEBwYXJhbSBmIGZ1bmN0aW9uIHRvIGNhbGwgZm9yIGVhY2ggeC95IGNvb3JkaW5hdGVcclxuICAgICAqL1xyXG4gICAgKnNjYW5SZWdpb24oeDA6IG51bWJlciwgeTA6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBJdGVyYWJsZTxbbnVtYmVyLCBudW1iZXIsIFRdPiB7XHJcbiAgICAgICAgY29uc3QgciA9IHgwICsgd2lkdGhcclxuICAgICAgICBjb25zdCBiID0geTAgKyBoZWlnaHRcclxuXHJcbiAgICAgICAgZm9yIChsZXQgeSA9IHkwOyB5IDwgYjsgKyt5KSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IHggPSB4MDsgeCA8IHI7ICsreCkge1xyXG4gICAgICAgICAgICAgICAgeWllbGQgW3gsIHksIHRoaXMuYXQoeCwgeSldXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICogc2NhbiB0aGUgc3BlY2lmaWVkIHJlZ2lvbiBvZiB0aGUgYXJyYXlcclxuICAgICAqIEBwYXJhbSByZWN0IHJlY3QgY29udGFpbmluZyBhcmVhIHRvIHNjYW5cclxuICAgICAqIEBwYXJhbSBmIGZ1bmN0aW9uIHRvIGNhbGwgZm9yIGVhY2ggeC95IGNvb3JkaW5hdGVcclxuICAgICAqL1xyXG4gICAgc2NhblJlY3QocmVjdDogUmVjdCk6IEl0ZXJhYmxlPFtudW1iZXIsIG51bWJlciwgVF0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zY2FuUmVnaW9uKHJlY3QueCwgcmVjdC55LCByZWN0LndpZHRoLCByZWN0LmhlaWdodClcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHNjYW4gdGhlIGVudGlyZSBncmlkXHJcbiAgICAgKiBAcGFyYW0gZiBmdW5jdGlvbiB0byBjYWxsIGZvciBlYWNoIHgveSBjb29yZGluYXRlXHJcbiAgICAgKi9cclxuICAgIHNjYW4oKTogSXRlcmFibGU8W251bWJlciwgbnVtYmVyLCBUXT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnNjYW5SZWdpb24oMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpXHJcbiAgICB9XHJcblxyXG4gICAgKltTeW1ib2wuaXRlcmF0b3JdKCkge1xyXG4gICAgICAgIGZvciAoY29uc3QgeCBvZiB0aGlzLmRhdGEpIHtcclxuICAgICAgICAgICAgeWllbGQgeFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGl0ZXJhdGUgb3ZlciBhIHNwZWNpZmllZCByZWdpb25cclxuICAgICAqL1xyXG4gICAgKml0ZXJSZWdpb24oeDA6IG51bWJlciwgeTA6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpIHtcclxuICAgICAgICBjb25zdCByID0geDAgKyB3aWR0aFxyXG4gICAgICAgIGNvbnN0IGIgPSB5MCArIGhlaWdodFxyXG5cclxuICAgICAgICBmb3IgKGxldCB4ID0geDA7IHggPCByOyArK3gpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgeSA9IHkwOyB5IDwgYjsgKyt5KSB7XHJcbiAgICAgICAgICAgICAgICB5aWVsZCB0aGlzLmF0KHgsIHkpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAqIGl0ZXJhdGUgb3ZlciBhIHNwZWNpZmllZCByZWdpb25cclxuICAgICovXHJcbiAgICBpdGVyUmVjdChyZWN0OiBSZWN0KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaXRlclJlZ2lvbihyZWN0LngsIHJlY3QueSwgcmVjdC53aWR0aCwgcmVjdC5oZWlnaHQpXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBjb3B5IGEgcG9ydGlvbiBvZiB0aGlzIGdyaWQgaW50byBhIG5ldyBncmlkXHJcbiAgICAgKi9cclxuICAgIHN1YmdyaWQoeDogbnVtYmVyLCB5OiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKTogR3JpZDxUPiB7XHJcbiAgICAgICAgY29uc3QgZHN0ID0gbmV3IEdyaWQ8VD4od2lkdGgsIGhlaWdodCwgKGR4LCBkeSkgPT4gdGhpcy5hdCh4ICsgZHgsIHkgKyBkeSkpXHJcbiAgICAgICAgcmV0dXJuIGRzdFxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogY29weSBzb3VyY2UgZ3JpZCB0byBkZXN0aW5hdGlvbiBncmlkXHJcbiAqIEBwYXJhbSBzcmMgc291cmNlIGdyaWRcclxuICogQHBhcmFtIGRzdCBkZXN0aW5hdGlvbiBncmlkXHJcbiAqIEBwYXJhbSB4IGRlc3RpbmF0aW9uIHggb2Zmc2V0XHJcbiAqIEBwYXJhbSB5IGRlc3RpbmF0aW9uIHkgb2Zmc2V0XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY29weTxUPihzcmM6IEdyaWQ8VD4sIGRzdDogR3JpZDxUPiwgZHg6IG51bWJlciwgZHk6IG51bWJlcikge1xyXG4gICAgZm9yIChjb25zdCBbeCwgeSwgdl0gb2Ygc3JjLnNjYW4oKSkge1xyXG4gICAgICAgIGRzdC5zZXQoeCArIGR4LCB5ICsgZHksIHYpXHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBjb3B5IGEgcmVnaW9uIG9mIGdyaWQgdG8gc3ViZ3JpZFxyXG4gKiBAcGFyYW0gc3JjIHNvdXJjZSBncmlkXHJcbiAqIEBwYXJhbSBzeCBzb3VyY2UgeCBvZmZzZXRcclxuICogQHBhcmFtIHN5IHNvdXJjZSB5IG9mZnNldFxyXG4gKiBAcGFyYW0gd2lkdGggd2lkdGggb2YgcmVnaW9uXHJcbiAqIEBwYXJhbSBoZWlnaHQgaGVpZ2h0IG9mIHJlZ2lvblxyXG4gKiBAcGFyYW0gZHN0IGRlc3RpbmF0aW9uIGdyaWRcclxuICogQHBhcmFtIGR4IGRlc3RpbmF0aW9uIHggb2Zmc2V0XHJcbiAqIEBwYXJhbSBkeSBkZXN0aW5hdGlvbiB5IG9mZnNldFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNvcHlSZWdpb248VD4oXHJcbiAgICBzcmM6IEdyaWQ8VD4sIHN4OiBudW1iZXIsIHN5OiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLFxyXG4gICAgZHN0OiBHcmlkPFQ+LCBkeDogbnVtYmVyLCBkeTogbnVtYmVyKSB7XHJcblxyXG4gICAgZm9yIChjb25zdCBbeCwgeSwgdl0gb2Ygc3JjLnNjYW5SZWdpb24oc3gsIHN5LCB3aWR0aCwgaGVpZ2h0KSkge1xyXG4gICAgICAgIGRzdC5zZXQoeCArIGR4LCB5ICsgZHksIHYpXHJcbiAgICB9XHJcbn0iXX0=