import * as geo from "../shared/geo2d.js";
import * as array from "../shared/array.js";
/**
 * a generic 2d array of data
 */
export class Grid {
    constructor(width = 0, height = 0, data, offset = 0, rowPitch = 0) {
        this.width = width;
        this.height = height;
        this.data = data;
        this.offset = offset;
        this.rowPitch = rowPitch;
        // check for errors
        if (this.rowPitch === 0) {
            this.rowPitch = this.width;
        }
        const maxOffset = this.offset + this.rowPitch * (this.height - 1) + this.width;
        if (maxOffset > this.data.length) {
            throw new Error(`Max offset of ${maxOffset} is greater than length of data array - ${this.data.length}`);
        }
    }
    /**
     * get total number of entries - width * height
     */
    get size() {
        return this.width * this.height;
    }
    assertBounds(x, y) {
        if (x < 0 || x >= this.width) {
            throw new Error(`${x} x-coordinate is out of bounds, must be between 0 and ${this.width - 1}`);
        }
        if (y < 0 || y >= this.height) {
            throw new Error(`${y} y-coordinate is out of bounds, must be between 0 and ${this.height - 1}`);
        }
    }
    inBounds(x, y) {
        return x >= 0 && x < this.width && y >= 0 && y < this.height;
    }
    regionInBounds(x, y, width, height) {
        return this.inBounds(x, y) && this.inBounds(x + width - 1, y + height - 1);
    }
    aabbInBounds(aabb) {
        return this.regionInBounds(aabb.min.x, aabb.min.y, aabb.width, aabb.height);
    }
    /**
     * return flattened index for specified coordinates
     * @param x x coord
     * @param y y coord
     */
    flat(x, y) {
        this.assertBounds(x, y);
        const i = this.offset + y * this.rowPitch + x;
        return i;
    }
    /**
     * return flattened index for coordinates
     * @param xy coordinates to flatten
     */
    flatPoint(xy) {
        const { x, y } = xy;
        return this.flat(x, y);
    }
    /**
     * return item at specified "flat" index
     * @param i flat coordinate to access item at
     */
    atf(i) {
        const item = this.data[i];
        return item;
    }
    /**
     * access item at specified coordinates
     * @param x x coordinate
     * @param y y coordinate
     */
    at(x, y) {
        const i = this.flat(x, y);
        const item = this.atf(i);
        return item;
    }
    /**
     * access item at specified coordinates
     * @param xy coordinates to access
     */
    atPoint(xy) {
        const { x, y } = xy;
        return this.at(x, y);
    }
    /**
     * set item at specified flat index to specified value
     * @param i flat index of item
     * @param value value
     */
    setf(i, value) {
        this.data[i] = value;
    }
    /**
     * set item at specified coordinates to specified value
     * @param x x coordinate
     * @param y y coordinate
     * @param value value to set
     */
    set(x, y, value) {
        this.setf(this.flat(x, y), value);
    }
    /**
     * set item at specified coordinates to specified value
     * @param xy point
     * @param value value to set
     */
    setPoint(xy, value) {
        const { x, y } = xy;
        this.set(x, y, value);
    }
    /**
     * scan the specified region of the array
     * @param x0 x coord
     * @param y0 y coord
     * @param width width of scan region
     * @param height height of scan region
     * @param f function to call for each x/y coordinate
     */
    *scanRegion(x0, y0, width, height) {
        const r = x0 + width;
        const b = y0 + height;
        for (let y = y0; y < b; ++y) {
            for (let x = x0; x < r; ++x) {
                yield [this.at(x, y), x, y];
            }
        }
    }
    /**
     * scan the specified region of the array
     * @param aabb aabb containing area to scan
     * @param f function to call for each x/y coordinate
     */
    scanAABB(aabb) {
        return this.scanRegion(aabb.min.x, aabb.min.y, aabb.width, aabb.height);
    }
    /**
     * scan the entire grid
     * @param f function to call for each x/y coordinate
     */
    scan() {
        return this.scanRegion(0, 0, this.width, this.height);
    }
    /**
     * iterate over all data in grid
     */
    *[Symbol.iterator]() {
        for (const x of this.data) {
            yield x;
        }
    }
    /**
     * iterate over a specified region
     */
    *iterRegion(x0, y0, width, height) {
        const r = x0 + width;
        const b = y0 + height;
        for (let x = x0; x < r; ++x) {
            for (let y = y0; y < b; ++y) {
                yield this.at(x, y);
            }
        }
    }
    /**
    * iterate over a specified region
    */
    iterAABB(aabb) {
        return this.iterRegion(aabb.min.x, aabb.min.y, aabb.width, aabb.height);
    }
    /**
     * copy a portion of this grid into a new grid
     */
    view(x, y, width, height) {
        const offset = this.flat(x, y);
        const dst = new Grid(width, height, this.data, offset, this.rowPitch);
        return dst;
    }
    /**
    * copy a portion of this grid into a new grid
    */
    viewAABB(aabb) {
        const v = this.view(aabb.min.x, aabb.min.y, aabb.width, aabb.height);
        return v;
    }
    /**
     * construct an array by applying a function to every element in this grid
     * @param f mapping function
     */
    map(f) {
        const data = [];
        for (let y = 0; y < this.height; ++y) {
            for (let x = 0; x < this.width; ++x) {
                const v = this.at(x, y);
                data.push(f(v, x, y));
            }
        }
        return data;
    }
    /**
     * construct a grid by applying a function to every element in this grid
     * @param f mapping function
     */
    map2(f) {
        const data = this.map(f);
        return new Grid(this.width, this.height, data);
    }
    /**
     * find the coordinates of an element in the grid that meets the specified criteria
     * @param f predicate function
     */
    findPoint(f) {
        for (let y = 0; y < this.height; ++y) {
            for (let x = 0; x < this.width; ++x) {
                const v = this.at(x, y);
                if (f(v)) {
                    return new geo.Point(x, y);
                }
            }
        }
        return null;
    }
    /**
     * find the coordinates of all elements in the grid that meet the specified criteria
     * @param f predicate function
     */
    *findPoints(f) {
        for (let y = 0; y < this.height; ++y) {
            for (let x = 0; x < this.width; ++x) {
                const v = this.at(x, y);
                if (f(v)) {
                    yield new geo.Point(x, y);
                }
            }
        }
    }
}
/**
 * copy source grid to destination grid
 * @param src source grid
 * @param dst destination grid
 * @param x destination x offset
 * @param y destination y offset
 */
export function copy(src, dst, dx, dy) {
    for (const [v, x, y] of src.scan()) {
        dst.set(x + dx, y + dy, v);
    }
}
/**
 * copy a region of grid to subgrid
 * @param src source grid
 * @param sx source x offset
 * @param sy source y offset
 * @param width width of region
 * @param height height of region
 * @param dst destination grid
 * @param dx destination x offset
 * @param dy destination y offset
 */
export function copyRegion(src, sx, sy, width, height, dst, dx, dy) {
    for (const [v, x, y] of src.scanRegion(sx, sy, width, height)) {
        dst.set(x + dx, y + dy, v);
    }
}
/**
 * Generate a grid of specified width and height by invoking function for every element
 * @param width width of grid
 * @param height height of grid
 * @param f function to invoke to get value for every x,y coordinate of grid
 */
export function generate(width, height, f) {
    const data = [];
    for (let y = 0; y < height; ++y) {
        for (let x = 0; x < width; ++x) {
            data.push(f(x, y));
        }
    }
    const grd = new Grid(width, height, data);
    return grd;
}
export function* scan(x0, y0, width, height) {
    const r = x0 + width;
    const b = y0 + height;
    for (let x = x0; x < r; ++x) {
        for (let y = y0; y < b; ++y) {
            yield new geo.Point(x, y);
        }
    }
}
export function* visitNeighbors(cells, pt) {
    cells.assertBounds(pt.x, pt.y);
    // w
    if (pt.x > 0) {
        const w = new geo.Point(pt.x - 1, pt.y);
        yield [cells.atPoint(w), w];
    }
    // s
    if (pt.y < cells.height - 1) {
        const s = new geo.Point(pt.x, pt.y + 1);
        yield [cells.atPoint(s), s];
    }
    // e
    if (pt.x < cells.width - 1) {
        const e = new geo.Point(pt.x + 1, pt.y);
        yield [cells.atPoint(e), e];
    }
    // n
    if (pt.y > 0) {
        const n = new geo.Point(pt.x, pt.y - 1);
        yield [cells.atPoint(n), n];
    }
}
/**
 * calculate the maximal rectangle that satisfies the specified predicate
 * @param grd grid
 * @param f predicate
 */
export function findMaximalRect(grd, f) {
    // derived from https://stackoverflow.com/questions/7245/puzzle-find-largest-rectangle-maximal-rectangle-problem
    // algorithm needs to keep track of rectangle state for every column for every region
    const { width, height } = grd;
    const ls = array.uniform(0, width);
    const rs = array.uniform(width, width);
    const hs = array.uniform(0, width);
    const sat = array.uniform(false, width);
    let maxArea = 0;
    const aabb = new geo.AABB(new geo.Point(0, 0), new geo.Point(0, 0));
    for (let y = 0; y < height; ++y) {
        let l = 0;
        let r = grd.width;
        // determine whether each cell meets predicate
        for (let x = 0; x < width; ++x) {
            sat[x] = f(grd.at(x, y));
        }
        // height scan
        for (let x = 0; x < width; ++x) {
            if (sat[x]) {
                hs[x] += 1;
            }
            else {
                hs[x] = 0;
            }
        }
        // l scan
        for (let x = 0; x < width; ++x) {
            if (sat[x]) {
                ls[x] = Math.max(ls[x], l);
            }
            else {
                ls[x] = 0;
                l = x + 1;
            }
        }
        // r scan
        for (let x = width - 1; x >= 0; --x) {
            if (sat[x]) {
                rs[x] = Math.min(rs[x], r);
            }
            else {
                rs[x] = width;
                r = x;
            }
        }
        // area scan
        for (let x = 0; x < width; ++x) {
            const area = hs[x] * (rs[x] - ls[x]);
            if (area > maxArea) {
                maxArea = area;
                aabb.min.x = ls[x];
                aabb.max.x = rs[x];
                aabb.min.y = y - hs[x] + 1;
                aabb.max.y = y + 1;
            }
        }
    }
    return aabb;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JpZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImdyaWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLEdBQUcsTUFBTSxvQkFBb0IsQ0FBQTtBQUN6QyxPQUFPLEtBQUssS0FBSyxNQUFNLG9CQUFvQixDQUFBO0FBRTNDOztHQUVHO0FBQ0gsTUFBTSxPQUFPLElBQUk7SUFDYixZQUFxQixRQUFnQixDQUFDLEVBQVcsU0FBaUIsQ0FBQyxFQUFXLElBQVMsRUFBVyxTQUFpQixDQUFDLEVBQVcsV0FBbUIsQ0FBQztRQUE5SCxVQUFLLEdBQUwsS0FBSyxDQUFZO1FBQVcsV0FBTSxHQUFOLE1BQU0sQ0FBWTtRQUFXLFNBQUksR0FBSixJQUFJLENBQUs7UUFBVyxXQUFNLEdBQU4sTUFBTSxDQUFZO1FBQVcsYUFBUSxHQUFSLFFBQVEsQ0FBWTtRQUMvSSxtQkFBbUI7UUFDbkIsSUFBSSxJQUFJLENBQUMsUUFBUSxLQUFLLENBQUMsRUFBRTtZQUNyQixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUE7U0FDN0I7UUFFRCxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUE7UUFDOUUsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDOUIsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQkFBaUIsU0FBUywyQ0FBMkMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFBO1NBQzNHO0lBQ0wsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBSSxJQUFJO1FBQ0osT0FBTyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUE7SUFDbkMsQ0FBQztJQUVELFlBQVksQ0FBQyxDQUFTLEVBQUUsQ0FBUztR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QUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQTtnQkFDMUIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTthQUNyQjtTQUNKO0tBQ0o7SUFFRCxPQUFPLElBQUksQ0FBQTtBQUNmLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBnZW8gZnJvbSBcIi4uL3NoYXJlZC9nZW8yZC5qc1wiXHJcbmltcG9ydCAqIGFzIGFycmF5IGZyb20gXCIuLi9zaGFyZWQvYXJyYXkuanNcIlxyXG5cclxuLyoqXHJcbiAqIGEgZ2VuZXJpYyAyZCBhcnJheSBvZiBkYXRhXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgR3JpZDxUPiB7XHJcbiAgICBjb25zdHJ1Y3RvcihyZWFkb25seSB3aWR0aDogbnVtYmVyID0gMCwgcmVhZG9ubHkgaGVpZ2h0OiBudW1iZXIgPSAwLCByZWFkb25seSBkYXRhOiBUW10sIHJlYWRvbmx5IG9mZnNldDogbnVtYmVyID0gMCwgcmVhZG9ubHkgcm93UGl0Y2g6IG51bWJlciA9IDApIHtcclxuICAgICAgICAvLyBjaGVjayBmb3IgZXJyb3JzXHJcbiAgICAgICAgaWYgKHRoaXMucm93UGl0Y2ggPT09IDApIHtcclxuICAgICAgICAgICAgdGhpcy5yb3dQaXRjaCA9IHRoaXMud2lkdGhcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG1heE9mZnNldCA9IHRoaXMub2Zmc2V0ICsgdGhpcy5yb3dQaXRjaCAqICh0aGlzLmhlaWdodCAtIDEpICsgdGhpcy53aWR0aFxyXG4gICAgICAgIGlmIChtYXhPZmZzZXQgPiB0aGlzLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTWF4IG9mZnNldCBvZiAke21heE9mZnNldH0gaXMgZ3JlYXRlciB0aGFuIGxlbmd0aCBvZiBkYXRhIGFycmF5IC0gJHt0aGlzLmRhdGEubGVuZ3RofWApXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogZ2V0IHRvdGFsIG51bWJlciBvZiBlbnRyaWVzIC0gd2lkdGggKiBoZWlnaHRcclxuICAgICAqL1xyXG4gICAgZ2V0IHNpemUoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy53aWR0aCAqIHRoaXMuaGVpZ2h0XHJcbiAgICB9XHJcblxyXG4gICAgYXNzZXJ0Qm91bmRzKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKHggPCAwIHx8IHggPj0gdGhpcy53aWR0aCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7eH0geC1jb29yZGluYXRlIGlzIG91dCBvZiBib3VuZHMsIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAke3RoaXMud2lkdGggLSAxfWApXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoeSA8IDAgfHwgeSA+PSB0aGlzLmhlaWdodCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7eX0geS1jb29yZGluYXRlIGlzIG91dCBvZiBib3VuZHMsIG11c3QgYmUgYmV0d2VlbiAwIGFuZCAke3RoaXMuaGVpZ2h0IC0gMX1gKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpbkJvdW5kcyh4OiBudW1iZXIsIHk6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB4ID49IDAgJiYgeCA8IHRoaXMud2lkdGggJiYgeSA+PSAwICYmIHkgPCB0aGlzLmhlaWdodFxyXG4gICAgfVxyXG5cclxuICAgIHJlZ2lvbkluQm91bmRzKHg6IG51bWJlciwgeTogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcik6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmluQm91bmRzKHgsIHkpICYmIHRoaXMuaW5Cb3VuZHMoeCArIHdpZHRoIC0gMSwgeSArIGhlaWdodCAtIDEpXHJcbiAgICB9XHJcblxyXG4gICAgYWFiYkluQm91bmRzKGFhYmI6IGdlby5BQUJCKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVnaW9uSW5Cb3VuZHMoYWFiYi5taW4ueCwgYWFiYi5taW4ueSwgYWFiYi53aWR0aCwgYWFiYi5oZWlnaHQpXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiByZXR1cm4gZmxhdHRlbmVkIGluZGV4IGZvciBzcGVjaWZpZWQgY29vcmRpbmF0ZXNcclxuICAgICAqIEBwYXJhbSB4IHggY29vcmRcclxuICAgICAqIEBwYXJhbSB5IHkgY29vcmRcclxuICAgICAqL1xyXG4gICAgZmxhdCh4OiBudW1iZXIsIHk6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICAgICAgdGhpcy5hc3NlcnRCb3VuZHMoeCwgeSlcclxuICAgICAgICBjb25zdCBpID0gdGhpcy5vZmZzZXQgKyB5ICogdGhpcy5yb3dQaXRjaCArIHhcclxuICAgICAgICByZXR1cm4gaVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogcmV0dXJuIGZsYXR0ZW5lZCBpbmRleCBmb3IgY29vcmRpbmF0ZXNcclxuICAgICAqIEBwYXJhbSB4eSBjb29yZGluYXRlcyB0byBmbGF0dGVuXHJcbiAgICAgKi9cclxuICAgIGZsYXRQb2ludCh4eTogZ2VvLlBvaW50KTogbnVtYmVyIHtcclxuICAgICAgICBjb25zdCB7IHgsIHkgfSA9IHh5XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZmxhdCh4LCB5KVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogcmV0dXJuIGl0ZW0gYXQgc3BlY2lmaWVkIFwiZmxhdFwiIGluZGV4XHJcbiAgICAgKiBAcGFyYW0gaSBmbGF0IGNvb3JkaW5hdGUgdG8gYWNjZXNzIGl0ZW0gYXQgXHJcbiAgICAgKi9cclxuICAgIGF0ZihpOiBudW1iZXIpOiBUIHtcclxuICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5kYXRhW2ldXHJcbiAgICAgICAgcmV0dXJuIGl0ZW1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGFjY2VzcyBpdGVtIGF0IHNwZWNpZmllZCBjb29yZGluYXRlc1xyXG4gICAgICogQHBhcmFtIHggeCBjb29yZGluYXRlXHJcbiAgICAgKiBAcGFyYW0geSB5IGNvb3JkaW5hdGVcclxuICAgICAqL1xyXG4gICAgYXQoeDogbnVtYmVyLCB5OiBudW1iZXIpOiBUIHtcclxuICAgICAgICBjb25zdCBpID0gdGhpcy5mbGF0KHgsIHkpXHJcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuYXRmKGkpXHJcbiAgICAgICAgcmV0dXJuIGl0ZW1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGFjY2VzcyBpdGVtIGF0IHNwZWNpZmllZCBjb29yZGluYXRlc1xyXG4gICAgICogQHBhcmFtIHh5IGNvb3JkaW5hdGVzIHRvIGFjY2Vzc1xyXG4gICAgICovXHJcbiAgICBhdFBvaW50KHh5OiBnZW8uUG9pbnQpOiBUIHtcclxuICAgICAgICBjb25zdCB7IHgsIHkgfSA9IHh5XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYXQoeCwgeSlcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHNldCBpdGVtIGF0IHNwZWNpZmllZCBmbGF0IGluZGV4IHRvIHNwZWNpZmllZCB2YWx1ZVxyXG4gICAgICogQHBhcmFtIGkgZmxhdCBpbmRleCBvZiBpdGVtXHJcbiAgICAgKiBAcGFyYW0gdmFsdWUgdmFsdWVcclxuICAgICAqL1xyXG4gICAgc2V0ZihpOiBudW1iZXIsIHZhbHVlOiBUKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kYXRhW2ldID0gdmFsdWVcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHNldCBpdGVtIGF0IHNwZWNpZmllZCBjb29yZGluYXRlcyB0byBzcGVjaWZpZWQgdmFsdWVcclxuICAgICAqIEBwYXJhbSB4IHggY29vcmRpbmF0ZVxyXG4gICAgICogQHBhcmFtIHkgeSBjb29yZGluYXRlXHJcbiAgICAgKiBAcGFyYW0gdmFsdWUgdmFsdWUgdG8gc2V0XHJcbiAgICAgKi9cclxuICAgIHNldCh4OiBudW1iZXIsIHk6IG51bWJlciwgdmFsdWU6IFQpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNldGYodGhpcy5mbGF0KHgsIHkpLCB2YWx1ZSlcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHNldCBpdGVtIGF0IHNwZWNpZmllZCBjb29yZGluYXRlcyB0byBzcGVjaWZpZWQgdmFsdWVcclxuICAgICAqIEBwYXJhbSB4eSBwb2ludFxyXG4gICAgICogQHBhcmFtIHZhbHVlIHZhbHVlIHRvIHNldFxyXG4gICAgICovXHJcbiAgICBzZXRQb2ludCh4eTogZ2VvLlBvaW50LCB2YWx1ZTogVCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IHsgeCwgeSB9ID0geHlcclxuICAgICAgICB0aGlzLnNldCh4LCB5LCB2YWx1ZSlcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHNjYW4gdGhlIHNwZWNpZmllZCByZWdpb24gb2YgdGhlIGFycmF5XHJcbiAgICAgKiBAcGFyYW0geDAgeCBjb29yZFxyXG4gICAgICogQHBhcmFtIHkwIHkgY29vcmRcclxuICAgICAqIEBwYXJhbSB3aWR0aCB3aWR0aCBvZiBzY2FuIHJlZ2lvblxyXG4gICAgICogQHBhcmFtIGhlaWdodCBoZWlnaHQgb2Ygc2NhbiByZWdpb25cclxuICAgICAqIEBwYXJhbSBmIGZ1bmN0aW9uIHRvIGNhbGwgZm9yIGVhY2ggeC95IGNvb3JkaW5hdGVcclxuICAgICAqL1xyXG4gICAgKnNjYW5SZWdpb24oeDA6IG51bWJlciwgeTA6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBJdGVyYWJsZTxbVCwgbnVtYmVyLCBudW1iZXJdPiB7XHJcbiAgICAgICAgY29uc3QgciA9IHgwICsgd2lkdGhcclxuICAgICAgICBjb25zdCBiID0geTAgKyBoZWlnaHRcclxuXHJcbiAgICAgICAgZm9yIChsZXQgeSA9IHkwOyB5IDwgYjsgKyt5KSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IHggPSB4MDsgeCA8IHI7ICsreCkge1xyXG4gICAgICAgICAgICAgICAgeWllbGQgW3RoaXMuYXQoeCwgeSksIHgsIHldXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBzY2FuIHRoZSBzcGVjaWZpZWQgcmVnaW9uIG9mIHRoZSBhcnJheVxyXG4gICAgICogQHBhcmFtIGFhYmIgYWFiYiBjb250YWluaW5nIGFyZWEgdG8gc2NhblxyXG4gICAgICogQHBhcmFtIGYgZnVuY3Rpb24gdG8gY2FsbCBmb3IgZWFjaCB4L3kgY29vcmRpbmF0ZVxyXG4gICAgICovXHJcbiAgICBzY2FuQUFCQihhYWJiOiBnZW8uQUFCQik6IEl0ZXJhYmxlPFtULCBudW1iZXIsIG51bWJlcl0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zY2FuUmVnaW9uKGFhYmIubWluLngsIGFhYmIubWluLnksIGFhYmIud2lkdGgsIGFhYmIuaGVpZ2h0KVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogc2NhbiB0aGUgZW50aXJlIGdyaWRcclxuICAgICAqIEBwYXJhbSBmIGZ1bmN0aW9uIHRvIGNhbGwgZm9yIGVhY2ggeC95IGNvb3JkaW5hdGVcclxuICAgICAqL1xyXG4gICAgc2NhbigpOiBJdGVyYWJsZTxbVCwgbnVtYmVyLCBudW1iZXJdPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NhblJlZ2lvbigwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodClcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGl0ZXJhdGUgb3ZlciBhbGwgZGF0YSBpbiBncmlkXHJcbiAgICAgKi9cclxuICAgICpbU3ltYm9sLml0ZXJhdG9yXSgpIHtcclxuICAgICAgICBmb3IgKGNvbnN0IHggb2YgdGhpcy5kYXRhKSB7XHJcbiAgICAgICAgICAgIHlpZWxkIHhcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBpdGVyYXRlIG92ZXIgYSBzcGVjaWZpZWQgcmVnaW9uXHJcbiAgICAgKi9cclxuICAgICppdGVyUmVnaW9uKHgwOiBudW1iZXIsIHkwOiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSB7XHJcbiAgICAgICAgY29uc3QgciA9IHgwICsgd2lkdGhcclxuICAgICAgICBjb25zdCBiID0geTAgKyBoZWlnaHRcclxuXHJcbiAgICAgICAgZm9yIChsZXQgeCA9IHgwOyB4IDwgcjsgKyt4KSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IHkgPSB5MDsgeSA8IGI7ICsreSkge1xyXG4gICAgICAgICAgICAgICAgeWllbGQgdGhpcy5hdCh4LCB5KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgKiBpdGVyYXRlIG92ZXIgYSBzcGVjaWZpZWQgcmVnaW9uXHJcbiAgICAqL1xyXG4gICAgaXRlckFBQkIoYWFiYjogZ2VvLkFBQkIpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pdGVyUmVnaW9uKGFhYmIubWluLngsIGFhYmIubWluLnksIGFhYmIud2lkdGgsIGFhYmIuaGVpZ2h0KVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogY29weSBhIHBvcnRpb24gb2YgdGhpcyBncmlkIGludG8gYSBuZXcgZ3JpZFxyXG4gICAgICovXHJcbiAgICB2aWV3KHg6IG51bWJlciwgeTogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcik6IEdyaWQ8VD4ge1xyXG4gICAgICAgIGNvbnN0IG9mZnNldCA9IHRoaXMuZmxhdCh4LCB5KVxyXG4gICAgICAgIGNvbnN0IGRzdCA9IG5ldyBHcmlkPFQ+KHdpZHRoLCBoZWlnaHQsIHRoaXMuZGF0YSwgb2Zmc2V0LCB0aGlzLnJvd1BpdGNoKVxyXG4gICAgICAgIHJldHVybiBkc3RcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICogY29weSBhIHBvcnRpb24gb2YgdGhpcyBncmlkIGludG8gYSBuZXcgZ3JpZFxyXG4gICAgKi9cclxuICAgIHZpZXdBQUJCKGFhYmI6IGdlby5BQUJCKTogR3JpZDxUPiB7XHJcbiAgICAgICAgY29uc3QgdiA9IHRoaXMudmlldyhhYWJiLm1pbi54LCBhYWJiLm1pbi55LCBhYWJiLndpZHRoLCBhYWJiLmhlaWdodClcclxuICAgICAgICByZXR1cm4gdlxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogY29uc3RydWN0IGFuIGFycmF5IGJ5IGFwcGx5aW5nIGEgZnVuY3Rpb24gdG8gZXZlcnkgZWxlbWVudCBpbiB0aGlzIGdyaWRcclxuICAgICAqIEBwYXJhbSBmIG1hcHBpbmcgZnVuY3Rpb25cclxuICAgICAqL1xyXG4gICAgbWFwPFU+KGY6ICh2OiBULCB4OiBudW1iZXIsIHk6IG51bWJlcikgPT4gVSk6IFVbXSB7XHJcbiAgICAgICAgY29uc3QgZGF0YTogVVtdID0gW11cclxuICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHRoaXMuaGVpZ2h0OyArK3kpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB0aGlzLndpZHRoOyArK3gpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmF0KHgsIHkpXHJcbiAgICAgICAgICAgICAgICBkYXRhLnB1c2goZih2LCB4LCB5KSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGRhdGFcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGNvbnN0cnVjdCBhIGdyaWQgYnkgYXBwbHlpbmcgYSBmdW5jdGlvbiB0byBldmVyeSBlbGVtZW50IGluIHRoaXMgZ3JpZFxyXG4gICAgICogQHBhcmFtIGYgbWFwcGluZyBmdW5jdGlvblxyXG4gICAgICovXHJcbiAgICBtYXAyPFU+KGY6ICh2OiBULCB4OiBudW1iZXIsIHk6IG51bWJlcikgPT4gVSk6IEdyaWQ8VT4ge1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLm1hcChmKVxyXG4gICAgICAgIHJldHVybiBuZXcgR3JpZDxVPih0aGlzLndpZHRoLCB0aGlzLmhlaWdodCwgZGF0YSlcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGZpbmQgdGhlIGNvb3JkaW5hdGVzIG9mIGFuIGVsZW1lbnQgaW4gdGhlIGdyaWQgdGhhdCBtZWV0cyB0aGUgc3BlY2lmaWVkIGNyaXRlcmlhXHJcbiAgICAgKiBAcGFyYW0gZiBwcmVkaWNhdGUgZnVuY3Rpb25cclxuICAgICAqL1xyXG4gICAgZmluZFBvaW50KGY6ICh2OiBUKSA9PiBib29sZWFuKTogKGdlby5Qb2ludCB8IG51bGwpIHtcclxuICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHRoaXMuaGVpZ2h0OyArK3kpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB0aGlzLndpZHRoOyArK3gpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmF0KHgsIHkpXHJcbiAgICAgICAgICAgICAgICBpZiAoZih2KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgZ2VvLlBvaW50KHgsIHkpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBudWxsXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBmaW5kIHRoZSBjb29yZGluYXRlcyBvZiBhbGwgZWxlbWVudHMgaW4gdGhlIGdyaWQgdGhhdCBtZWV0IHRoZSBzcGVjaWZpZWQgY3JpdGVyaWFcclxuICAgICAqIEBwYXJhbSBmIHByZWRpY2F0ZSBmdW5jdGlvblxyXG4gICAgICovXHJcbiAgICAqZmluZFBvaW50cyhmOiAodjpUKT0+Ym9vbGVhbikgOiBJdGVyYWJsZTxnZW8uUG9pbnQ+IHtcclxuICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHRoaXMuaGVpZ2h0OyArK3kpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB0aGlzLndpZHRoOyArK3gpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmF0KHgsIHkpXHJcbiAgICAgICAgICAgICAgICBpZiAoZih2KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIG5ldyBnZW8uUG9pbnQoeCwgeSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIGNvcHkgc291cmNlIGdyaWQgdG8gZGVzdGluYXRpb24gZ3JpZFxyXG4gKiBAcGFyYW0gc3JjIHNvdXJjZSBncmlkXHJcbiAqIEBwYXJhbSBkc3QgZGVzdGluYXRpb24gZ3JpZFxyXG4gKiBAcGFyYW0geCBkZXN0aW5hdGlvbiB4IG9mZnNldFxyXG4gKiBAcGFyYW0geSBkZXN0aW5hdGlvbiB5IG9mZnNldFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNvcHk8VD4oc3JjOiBHcmlkPFQ+LCBkc3Q6IEdyaWQ8VD4sIGR4OiBudW1iZXIsIGR5OiBudW1iZXIpIHtcclxuICAgIGZvciAoY29uc3QgW3YsIHgsIHldIG9mIHNyYy5zY2FuKCkpIHtcclxuICAgICAgICBkc3Quc2V0KHggKyBkeCwgeSArIGR5LCB2KVxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogY29weSBhIHJlZ2lvbiBvZiBncmlkIHRvIHN1YmdyaWRcclxuICogQHBhcmFtIHNyYyBzb3VyY2UgZ3JpZFxyXG4gKiBAcGFyYW0gc3ggc291cmNlIHggb2Zmc2V0XHJcbiAqIEBwYXJhbSBzeSBzb3VyY2UgeSBvZmZzZXRcclxuICogQHBhcmFtIHdpZHRoIHdpZHRoIG9mIHJlZ2lvblxyXG4gKiBAcGFyYW0gaGVpZ2h0IGhlaWdodCBvZiByZWdpb25cclxuICogQHBhcmFtIGRzdCBkZXN0aW5hdGlvbiBncmlkXHJcbiAqIEBwYXJhbSBkeCBkZXN0aW5hdGlvbiB4IG9mZnNldFxyXG4gKiBAcGFyYW0gZHkgZGVzdGluYXRpb24geSBvZmZzZXRcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjb3B5UmVnaW9uPFQ+KFxyXG4gICAgc3JjOiBHcmlkPFQ+LCBzeDogbnVtYmVyLCBzeTogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcixcclxuICAgIGRzdDogR3JpZDxUPiwgZHg6IG51bWJlciwgZHk6IG51bWJlcikge1xyXG5cclxuICAgIGZvciAoY29uc3QgW3YsIHgsIHldIG9mIHNyYy5zY2FuUmVnaW9uKHN4LCBzeSwgd2lkdGgsIGhlaWdodCkpIHtcclxuICAgICAgICBkc3Quc2V0KHggKyBkeCwgeSArIGR5LCB2KVxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogR2VuZXJhdGUgYSBncmlkIG9mIHNwZWNpZmllZCB3aWR0aCBhbmQgaGVpZ2h0IGJ5IGludm9raW5nIGZ1bmN0aW9uIGZvciBldmVyeSBlbGVtZW50XHJcbiAqIEBwYXJhbSB3aWR0aCB3aWR0aCBvZiBncmlkXHJcbiAqIEBwYXJhbSBoZWlnaHQgaGVpZ2h0IG9mIGdyaWRcclxuICogQHBhcmFtIGYgZnVuY3Rpb24gdG8gaW52b2tlIHRvIGdldCB2YWx1ZSBmb3IgZXZlcnkgeCx5IGNvb3JkaW5hdGUgb2YgZ3JpZFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlPFQ+KHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBmOiAoeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IFQpOiBHcmlkPFQ+IHtcclxuICAgIGNvbnN0IGRhdGE6IFRbXSA9IFtdXHJcbiAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgKyt5KSB7XHJcbiAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB3aWR0aDsgKyt4KSB7XHJcbiAgICAgICAgICAgIGRhdGEucHVzaChmKHgsIHkpKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBncmQgPSBuZXcgR3JpZDxUPih3aWR0aCwgaGVpZ2h0LCBkYXRhKVxyXG4gICAgcmV0dXJuIGdyZFxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24qIHNjYW4oeDA6IG51bWJlciwgeTA6IG51bWJlciwgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBJdGVyYWJsZTxnZW8uUG9pbnQ+IHtcclxuICAgIGNvbnN0IHIgPSB4MCArIHdpZHRoXHJcbiAgICBjb25zdCBiID0geTAgKyBoZWlnaHRcclxuXHJcbiAgICBmb3IgKGxldCB4ID0geDA7IHggPCByOyArK3gpIHtcclxuICAgICAgICBmb3IgKGxldCB5ID0geTA7IHkgPCBiOyArK3kpIHtcclxuICAgICAgICAgICAgeWllbGQgbmV3IGdlby5Qb2ludCh4LCB5KVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uKiB2aXNpdE5laWdoYm9yczxUPihjZWxsczogR3JpZDxUPiwgcHQ6IGdlby5Qb2ludCk6IEl0ZXJhYmxlPFtULCBnZW8uUG9pbnRdPiB7XHJcbiAgICBjZWxscy5hc3NlcnRCb3VuZHMocHQueCwgcHQueSlcclxuXHJcbiAgICAvLyB3XHJcbiAgICBpZiAocHQueCA+IDApIHtcclxuICAgICAgICBjb25zdCB3ID0gbmV3IGdlby5Qb2ludChwdC54IC0gMSwgcHQueSlcclxuICAgICAgICB5aWVsZCBbY2VsbHMuYXRQb2ludCh3KSwgd11cclxuICAgIH1cclxuXHJcbiAgICAvLyBzXHJcbiAgICBpZiAocHQueSA8IGNlbGxzLmhlaWdodCAtIDEpIHtcclxuICAgICAgICBjb25zdCBzID0gbmV3IGdlby5Qb2ludChwdC54LCBwdC55ICsgMSlcclxuICAgICAgICB5aWVsZCBbY2VsbHMuYXRQb2ludChzKSwgc11cclxuICAgIH1cclxuXHJcbiAgICAvLyBlXHJcbiAgICBpZiAocHQueCA8IGNlbGxzLndpZHRoIC0gMSkge1xyXG4gICAgICAgIGNvbnN0IGUgPSBuZXcgZ2VvLlBvaW50KHB0LnggKyAxLCBwdC55KVxyXG4gICAgICAgIHlpZWxkIFtjZWxscy5hdFBvaW50KGUpLCBlXVxyXG4gICAgfVxyXG5cclxuICAgIC8vIG5cclxuICAgIGlmIChwdC55ID4gMCkge1xyXG4gICAgICAgIGNvbnN0IG4gPSBuZXcgZ2VvLlBvaW50KHB0LngsIHB0LnkgLSAxKVxyXG4gICAgICAgIHlpZWxkIFtjZWxscy5hdFBvaW50KG4pLCBuXVxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogY2FsY3VsYXRlIHRoZSBtYXhpbWFsIHJlY3RhbmdsZSB0aGF0IHNhdGlzZmllcyB0aGUgc3BlY2lmaWVkIHByZWRpY2F0ZVxyXG4gKiBAcGFyYW0gZ3JkIGdyaWRcclxuICogQHBhcmFtIGYgcHJlZGljYXRlXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZmluZE1heGltYWxSZWN0PFQ+KGdyZDogR3JpZDxUPiwgZjogKHg6IFQpID0+IGJvb2xlYW4pOiBnZW8uQUFCQiB7XHJcbiAgICAvLyBkZXJpdmVkIGZyb20gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNzI0NS9wdXp6bGUtZmluZC1sYXJnZXN0LXJlY3RhbmdsZS1tYXhpbWFsLXJlY3RhbmdsZS1wcm9ibGVtXHJcbiAgICAvLyBhbGdvcml0aG0gbmVlZHMgdG8ga2VlcCB0cmFjayBvZiByZWN0YW5nbGUgc3RhdGUgZm9yIGV2ZXJ5IGNvbHVtbiBmb3IgZXZlcnkgcmVnaW9uXHJcbiAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGdyZFxyXG4gICAgY29uc3QgbHMgPSBhcnJheS51bmlmb3JtKDAsIHdpZHRoKVxyXG4gICAgY29uc3QgcnMgPSBhcnJheS51bmlmb3JtKHdpZHRoLCB3aWR0aClcclxuICAgIGNvbnN0IGhzID0gYXJyYXkudW5pZm9ybSgwLCB3aWR0aClcclxuICAgIGNvbnN0IHNhdCA9IGFycmF5LnVuaWZvcm0oZmFsc2UsIHdpZHRoKVxyXG5cclxuICAgIGxldCBtYXhBcmVhID0gMFxyXG4gICAgY29uc3QgYWFiYiA9IG5ldyBnZW8uQUFCQihuZXcgZ2VvLlBvaW50KDAsIDApLCBuZXcgZ2VvLlBvaW50KDAsIDApKVxyXG5cclxuICAgIGZvciAobGV0IHkgPSAwOyB5IDwgaGVpZ2h0OyArK3kpIHtcclxuICAgICAgICBsZXQgbCA9IDBcclxuICAgICAgICBsZXQgciA9IGdyZC53aWR0aFxyXG5cclxuICAgICAgICAvLyBkZXRlcm1pbmUgd2hldGhlciBlYWNoIGNlbGwgbWVldHMgcHJlZGljYXRlXHJcbiAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB3aWR0aDsgKyt4KSB7XHJcbiAgICAgICAgICAgIHNhdFt4XSA9IGYoZ3JkLmF0KHgsIHkpKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gaGVpZ2h0IHNjYW5cclxuICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyArK3gpIHtcclxuICAgICAgICAgICAgaWYgKHNhdFt4XSkge1xyXG4gICAgICAgICAgICAgICAgaHNbeF0gKz0gMVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaHNbeF0gPSAwXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGwgc2NhblxyXG4gICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgd2lkdGg7ICsreCkge1xyXG4gICAgICAgICAgICBpZiAoc2F0W3hdKSB7XHJcbiAgICAgICAgICAgICAgICBsc1t4XSA9IE1hdGgubWF4KGxzW3hdLCBsKVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbHNbeF0gPSAwXHJcbiAgICAgICAgICAgICAgICBsID0geCArIDFcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gciBzY2FuXHJcbiAgICAgICAgZm9yIChsZXQgeCA9IHdpZHRoIC0gMTsgeCA+PSAwOyAtLXgpIHtcclxuICAgICAgICAgICAgaWYgKHNhdFt4XSkge1xyXG4gICAgICAgICAgICAgICAgcnNbeF0gPSBNYXRoLm1pbihyc1t4XSwgcilcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJzW3hdID0gd2lkdGhcclxuICAgICAgICAgICAgICAgIHIgPSB4XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGFyZWEgc2NhblxyXG4gICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgd2lkdGg7ICsreCkge1xyXG4gICAgICAgICAgICBjb25zdCBhcmVhID0gaHNbeF0gKiAocnNbeF0gLSBsc1t4XSlcclxuICAgICAgICAgICAgaWYgKGFyZWEgPiBtYXhBcmVhKSB7XHJcbiAgICAgICAgICAgICAgICBtYXhBcmVhID0gYXJlYVxyXG4gICAgICAgICAgICAgICAgYWFiYi5taW4ueCA9IGxzW3hdXHJcbiAgICAgICAgICAgICAgICBhYWJiLm1heC54ID0gcnNbeF1cclxuICAgICAgICAgICAgICAgIGFhYmIubWluLnkgPSB5IC0gaHNbeF0gKyAxXHJcbiAgICAgICAgICAgICAgICBhYWJiLm1heC55ID0geSArIDFcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYWFiYlxyXG59Il19